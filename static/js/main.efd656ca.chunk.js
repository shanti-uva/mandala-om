(this["webpackJsonpkmaps-app"]=this["webpackJsonpkmaps-app"]||[]).push([[0],{117:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return v}));var s=a(0),n=a.n(s),i=(a(259),a(21)),r=(a(597),a(598),a(2)),l=a.n(r),c=a(33),o=a.n(c),d=a(52),u=function(e,t,a,s){var n={termIndex:"http://localhost/solr/kmterms_dev",assetIndex:"http://localhost/solr/kmassets_dev",featureId:"places-1",domain:"places",perspective:"general",view:"roman.scholar",tree:"places",featuresPath:"/features/%%ID%%"},i={init:function(t){var a=l.a.extend(!0,{},this);return a.settings=e.extend({},n,t),a},getDirectDescendantCount:function(){var t=this,a=e.Deferred(),s=t.settings.termIndex+"/select?q={!child of=block_type:parent}id:"+t.settings.featureId+"&group=true&group.field=block_child_type&group.limit=0&wt=json&json.wrf=?";return e.ajax({type:"GET",url:s,dataType:"jsonp",timeout:9e4,error:function(e){console.error(e)},beforeSend:function(){},success:function(s){var n={};e.each(s.grouped.block_child_type.groups,(function(e,t){var a=t.groupValue,s=t.doclist.numFound;n[a]=s})),a.resolve(n["related_"+t.settings.domain])}}),a.promise()},addPlacesSummaryItems:function(t,a,s,n){var i=e("."+this.settings.domain+"-in-"+this.settings.domain),r=t;for(var c in n[s]){var o=l()("<div></div>").addClass("feature-block"),d=l()("<h6></h6>").html(r+" "+c).addClass("dontend");o.append(d);var u=l()('<ul class="collapsibleList"></ul>'),p=Object.keys(n[s][c]).sort(),m=0;for(var h in p){m++,h=p[h];var v=l()("<li></li>"),f=l()("<ul></ul>"),g=0,_=n[s][c][h];for(var b in _){var y=l()('<li class="dontsplit"></li>'),E=_[b],k=E["related_"+this.settings.domain+"_id_s"].replace(this.settings.domain+"-",""),w=l()("<a href="+a.replace("%%ID%%",k)+">"+E["related_"+this.settings.domain+"_header_s"]+"</a>"),x=l()('<span class="popover-kmaps" data-id="'+this.settings.domain+"-"+k+'"><span class="popover-kmaps-tip"></span><span class="icon shanticon-menu3"></span></span>');y.append(w),y.append(l()(x)),f.append(y),g++}var T=l()('<div class="dontsplit"></div>');T.append(l()('<span class="glyphicon"></span> ')),T.append(h+" ("+g+")"),v.append(T),v.append(f),1==g&&v.addClass("dontsplit"),u.append(v)}o.append(u),1==m&&1==g&&o.addClass("dontsplit"),i.append(o)}},getPlacesSummaryElements:function(){var t=this,a=e.Deferred(),s=["header","id","uid","related_"+t.settings.domain+"_feature_type_s","related_"+t.settings.domain+"_relation_label_s","related_kmaps_node_type","related_"+t.settings.domain+"_feature_types_t","related_"+t.settings.domain+"_id_s","related_"+t.settings.domain+"_header_s"].join(",");"places"==t.settings.domain&&(s+=",related_subjects_t");var n=t.settings.termIndex+"/select?&q={!child of=block_type:parent}id:"+t.settings.featureId+"&fl="+s+"&rows=200&indent=true&wt=json&json.wrf=?&sort=related_"+t.settings.domain+"_header_s+asc";return e.ajax({url:n,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var s=e.response;if(s.numFound>0){var n=s.docs.reduce((function(e,a,s){var n=a.related_kmaps_node_type;void 0===n&&(n="other"),void 0===e[n]&&(e[n]=[]);var i=a["related_"+t.settings.domain+"_relation_label_s"];if(void 0===i)return e;for(var r in void 0===e[n][i]&&(e[n][i]=[]),a["related_"+t.settings.domain+"_feature_types_t"]){var l=a["related_"+t.settings.domain+"_feature_types_t"][r];void 0===e[n][i][l]&&(e[n][i][l]={});var c=a["related_"+t.settings.domain+"_id_s"];e[n][i][l][c]=a}return e}),[]);a.resolve(n)}else a.resolve([])})),a.promise()},addSubjectsSummaryItems:function(t,a,s,n){var i=e("."+this.settings.domain+"-in-"+this.settings.domain),r=t;for(var c in n[s]){var o=l()("<div></div>").addClass("feature-block"),d=l()("<h6></h6>").addClass("dontend").append(l()('<span class="glyphicon"></span> '));d.append(r+" "+c);var u=l()('<ul style="list-stype:none;" class="collapsibleList"></ul>'),p=l()('<li class="collapsible_list_header"></li>');p.append(d);var m=l()("<ul></ul>"),h=0,v=n[s][c];for(var f in v){var g=l()('<li class="dontsplit"></li>'),_=v[f],b=_["related_"+this.settings.domain+"_id_s"].replace(this.settings.domain+"-","");g.append("<a href="+a.replace("%%ID%%",b)+">"+_["related_"+this.settings.domain+"_header_s"]+"</a>");var y=l()('<span class="popover-kmaps" data-id="'+this.settings.domain+"-"+b+'"><span class="popover-kmaps-tip"></span><span class="icon shanticon-menu3"></span></span>');g.append(l()(y)),m.append(g),h++}p.append(m),u.append(p),1==h&&u.addClass("dontsplit"),o.append(u),i.append(o)}},getSubjectsSummaryElements:function(){var t=this,a=e.Deferred(),s=["header","id","related_"+t.settings.domain+"_feature_type_s","related_"+t.settings.domain+"_relation_label_s"].join(",");"places"==t.settings.domain&&(s+=",related_subjects_t");var n=t.settings.termIndex+"/select?&q={!child of=block_type:parent}id:"+t.settings.featureId+"&fl=related_"+t.settings.domain+"_feature_types_t,uid,related_"+t.settings.domain+"_id_s,related_"+t.settings.domain+"_header_s,"+s+"&rows=200&indent=true&wt=json&json.wrf=?&sort=related_"+t.settings.domain+"_header_s+asc";return e.ajax({url:n,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var s=e.response;if(s.numFound>0){var n=s.docs.reduce((function(e,a,s){var n=a.related_kmaps_node_type;void 0===n&&(n="other"),void 0===e[n]&&(e[n]=[]);var i=a["related_"+t.settings.domain+"_relation_label_s"];if(void 0===i)return e;void 0===e[n][i]&&(e[n][i]=[]);var r=a["related_"+t.settings.domain+"_id_s"];return e[n][i][r]=a,e}),[]);a.resolve(n)}else a.resolve([])})),a.promise()},getNodeInfo:function(t,a){var s=this,n=e.Deferred(),i=[];i.always="present";var r=["ancestors_"+s.settings.perspective,"ancestor_ids_"+s.settings.perspective,"ancestor_ids_closest_"+s.settings.perspective,"ancestors_closest_"+s.settings.perspective].join(","),l=s.settings.termIndex+"/select?q=id:"+t+"&fl=header,"+r+"*&wt=json&json.wrf=?";return e.ajax({url:l,dataType:"jsonp",jsonp:"json.wrf",error:function(e){console.error(e),n.resolve([])},beforesend:function(){},success:function(e){if(e.response.docs.length>0){var t=e.response.docs[0],r="ancestor_ids_"+s.settings.perspective,l="ancestors_"+s.settings.perspective;void 0===t[r]&&(r="ancestor_ids_closest_"+s.settings.perspective,l="ancestors_closest_"+s.settings.perspective),i.ancestors=void 0===t[r]?"":t[r].reduce((function(e,s,n){return e+="/"+("<a href='"+a.replace("%%ID%%",s)+"'>"+t[l][n]+"</a>")}),""),i.title="<strong>"+t.header+"</strong>",n.resolve(i)}}}),n.promise()},getNodeCaptions:function(t){var a=e.Deferred(),s=this.settings.termIndex+"/select?q=id:"+t+"&fl=caption_*&wt=json&json.wrf=?";return e.ajax({type:"GET",url:s,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),a.resolve([])},success:function(t){var s={};t.response.docs.length>0&&e.each(t.response.docs[0],(function(e,t){null!=e&&(s[e]=t[0])})),a.resolve(s)}}),a.promise()},getNodeAssetCount:function(t,a,s){var n=e.Deferred(),i=this.settings.assetIndex+"/select?q=kmapid:"+t+a+"&start=0&facets=on&group=true&group.field=asset_type&group.facet=true&group.ngroups=true&group.limit=0&wt=json&json.wrf=?";return e.ajax({type:"GET",url:i,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),n.resolve([])},success:function(t){var a={};e.each(t.grouped.asset_type.groups,(function(e,t){var s=t.groupValue,n=t.doclist.numFound;a[s]=n})),n.resolve(a)}}),n.promise()},getNodeRelatedCount:function(t,a,s){var n=e.Deferred(),i=this.settings.termIndex+"/select?q={!child of=block_type:parent}id:"+t+a+"&wt=json&indent=true&group=true&group.field=block_child_type&group.limit=0&wt=json&json.wrf=?";return e.ajax({type:"GET",url:i,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),n.resolve([])},success:function(t){var a={};e.each(t.grouped.block_child_type.groups,(function(e,t){var s=t.groupValue,n=t.doclist.numFound;a[s]=n})),n.resolve(a)}}),n.promise()},getNodeSubjectsRelatedPlacesCount:function(t,a){var s=e.Deferred(),n=this.settings.termIndex+"/select?indent=on&q={!parent%20which=block_type:parent}related_subject_uid_s:"+t+"&wt=json&json.wrf=?&group=true&group.field=tree&group.limit=0";return e.ajax({type:"GET",url:n,dataType:"jsonp",jsonp:"json.wrf",timeout:9e4,error:function(e){console.error(e),s.resolve([])},success:function(t){var a={};e.each(t.grouped.tree.groups,(function(e,t){var s=t.groupValue,n=t.doclist.numFound;a["related_"+s]=n})),s.resolve(a)}}),s.promise()},getAncestorPath:function(){var t=this,a=e.Deferred(),s=t.settings.termIndex+"/select?&q=id:"+t.settings.domain+"-"+t.settings.featureId+"&fl=level_"+t.settings.perspective+"_i,ancestor_id_"+t.settings.perspective+"_path&fq=tree:"+t.settings.tree+"&indent=true&wt=json&json.wrf=?&rows=2000&limit=2000";return e.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var s=e.response;if(s.numFound<1)a.resolve([]);else{s.docs[0]["ancestor_id_"+t.settings.perspective+"_path"],s.docs[0]["level_"+t.settings.perspective+"_i"];a.resolve([e])}})).fail((function(e){a.resolve([])})),a.promise()},getFullAncestorTree:function(t){var a=this,s=!!t.descendants&&!!t.descendants,n=!!t.directAncestors&&t.directAncestors,i=t.sortBy?t.sortBy:"header_ssort+ASC",r=t.extraFields?t.extraFields:[],l=t.nodeMarkerPredicates?t.nodeMarkerPredicates:[],c=e.Deferred(),u=(a.settings.view.blank?"header":"header:name_"+a.settings.view)+["id","ancestor_id_"+a.settings.perspective+"_path","level_"+a.settings.perspective+"_i"].concat(r).join(","),p=a.settings.termIndex+"/select?";return n||(a.settings.featureId?p+="&q=id:"+a.settings.featureId:(p+="&q=*",p+="&df=header",p+="&fq=level_"+a.settings.perspective+"_i:[1 TO 1]")),p+="&fl="+u+"&fq=tree:"+a.settings.tree+"&indent=true&wt=json&json.wrf=?&rows=2000&limit=2000",e.ajax({url:p,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var t=e.response,n=function(){var e=Object(d.a)(o.a.mark((function e(t,n){var c,u,p,m,h,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c="ancestor_id_"+a.settings.perspective+"_path",u=t[c].split("/"),void 0===t["level_"+a.settings.perspective+"_i"]&&(p=u.length-1,a.settings.featureId=a.settings.domain+"-"+u[p]),void 0!==u){e.next=5;break}return e.abrupt("return",[]);case 5:m=function(){var e=Object(d.a)(o.a.mark((function e(t,n,c){var d,p,m,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if([],-1,d=[],0==c){e.next=11;break}return u[c-1],p=c+1,e.next=8,a.getDescendantsInPath(u.slice(0,c).join("/"),p,i,r,l);case 8:d=e.sent,e.next=15;break;case 11:if(0!=c){e.next=15;break}return e.next=14,a.getDescendantsInPath("*",1,i,r,l);case 14:d=e.sent;case 15:e.t0=o.a.keys(d);case 16:if((e.t1=e.t0()).done){e.next=26;break}if(m=e.t1.value,(h=d[m]).key!=a.settings.domain+"-"+n){e.next=24;break}return t&&(h.children=[].concat(t)),h.expanded=s,h.key==a.settings.featureId&&(h.active=!0,h.lazy=!0,h.backColor="#eaeaea"),e.abrupt("break",26);case 24:e.next=16;break;case 26:return e.abrupt("return",d);case 27:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),h=n,v=u.length-1;case 8:if(!(v>=0)){e.next=15;break}return e.next=11,m(h,u[v],v);case 11:h=e.sent;case 12:v--,e.next=8;break;case 15:return e.abrupt("return",h);case 16:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();if(t.numFound>0){var u=t.docs[0];if(s&&a.settings.featureId){var p="ancestor_id_"+a.settings.perspective+"_path",m="level_"+a.settings.perspective+"_i",h=u[p].split("/"),v=u[m];void 0===u[m]&&(v=h.length),a.getDescendantsInPath(u[p],v+1,i,r,l).then((function(e){n(u,e).then((function(e){c.resolve(e)}))}))}else{if(t.numFound>=1)n(u).then((function(e){c.resolve(e)}));else a.getDescendantsInPath("*",1,i,r,l).then((function(e){c.resolve(e)}))}}else c.resolve([])})),c.promise()},getDescendantsInPath:function(t,a,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=this,l=e.Deferred(),c=["header:name_"+r.settings.view,"id","ancestor_id_"+r.settings.perspective+"_path","ancestor_ids_"+r.settings.perspective,"ancestors_"+r.settings.perspective,"ancestor_id_closest_"+r.settings.perspective+"_path","ancestors_closest_"+r.settings.perspective,"level_"+r.settings.perspective+"_i","related_"+r.settings.domain+"_feature_type_s","related_"+r.settings.domain+"_relation_label_s"].concat(n).join(",");"places"==r.settings.domain&&(c+=",related_subjects_t");var o=r.settings.termIndex+"/select?&q="+t+"&sort="+s+"&df=ancestor_id_"+r.settings.perspective+"_path&fq=level_"+r.settings.perspective+"_i:["+a+"+TO+"+(a+1)+"]&fq={!tag=children}level_"+r.settings.perspective+"_i:["+a+"+TO+"+(a+0)+"]&facet.mincount=2&facet.limit=-1&facet.field={!ex=children}ancestor_id_"+r.settings.perspective+"_path&fl="+c+"&facet=true&wt=json&limit=2000&indent=true&wt=json&json.wrf=?&rows=2000";return e.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){for(var t=e.response,a=e.facet_counts.facet_fields["ancestor_id_"+r.settings.perspective+"_path"],s={},n=0;n<a.length;n+=2)s[a[n]]=a[n+1];if(t.numFound>0){var c=t.docs.reduce((function(e,t,a){var n=new RegExp(r.settings.domain+"-(.*)"),l=t.id.match(n),c=l?void 0===l[1]?"":l[1]:"",o="ancestor_ids_"+r.settings.perspective;r.settings.perspective;void 0===t[o]&&(o="ancestor_ids_closest_"+r.settings.perspective,r.settings.perspective);var d=[];i.length>0&&i.forEach((function(e,a){if("=="==e.operation)JSON.stringify(t[e.field])==JSON.stringify(e.value)&&d.push(e.mark);else if("includes"==e.operation)t[e.field].includes(e.value)&&d.push(e.mark);else if("!includes"==e.operation){var s;(null===(s=t[e.field])||void 0===s?void 0:s.includes(e.value))||d.push(e.mark)}}));var u={title:t.header,displayPath:"",key:r.settings.domain+"-"+c,expanded:!1,lazy:!0,href:r.settings.featuresPath.replace("%%ID%%",c),marks:d};return void 0===s[t["ancestor_id_"+r.settings.perspective+"_path"]]&&(u.lazy=!1),void 0!==e?e.concat([u]):[u]}),[]);l.resolve(c)}else l.resolve([])})),l.promise()},getAncestorTree:function(t){var a=this,s=!!t.descendants&&!!t.descendants,n=!!t.directAncestors&&!!t.directAncestors,i=!!t.descendantsFullDetail&&!!t.descendantsFullDetail,r=t.sortBy?t.sortBy:"header_ssort+ASC",l=t.extraFields?t.extraFields:[],c=t.nodeMarkerPredicates?t.nodeMarkerPredicates:[],o=e.Deferred(),d=["header:name_"+a.settings.view,"id","ancestor_id_"+a.settings.perspective+"_path","ancestor_ids_"+a.settings.perspective,"ancestors_"+a.settings.perspective,"ancestors_closest_"+a.settings.perspective,"ancestor_id_closest_"+a.settings.perspective+"_path","ancestor_ids_closest_"+a.settings.perspective,"level_"+a.settings.perspective+"_i"].concat(l).join(","),u=a.settings.termIndex+"/select?";return n&&(a.settings.featureId?u+="&q=id:"+a.settings.featureId:(u+="&q=*",u+="&df=header",u+="&fq=level_"+a.settings.perspective+"_i:[1 TO 1]")),u+="&fl="+d+"&fq=tree:"+a.settings.tree+"&indent=true&wt=json&json.wrf=?&rows=2000&limit=2000&sort="+r,e.ajax({url:u,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var t=e.response,n=function(e,t){var s="ancestor_ids_"+a.settings.perspective,n="ancestors_"+a.settings.perspective;return void 0===e[s]&&(s="ancestor_ids_closest_"+a.settings.perspective,n="ancestors_closest_"+a.settings.perspective),[void 0===e[s]?[]:e[s].reduceRight((function(t,s,i){var r={title:"<strong>"+e[n][i]+"</strong>",key:a.settings.domain+"-"+s,expanded:!0,href:a.settings.featuresPath.replace("%%ID%%",s),lazy:!0,displayPath:e[n].join("/"),children:void 0===t?null:[].concat(t)};return r.key===a.settings.featureId&&(r.active=!0,r.backColor="#eaeaea"),r}),t)]};if(t.numFound>0){var d=t.docs[0];if(s&&a.settings.featureId)a.getDescendantTree(a.settings.featureId,i,r,l,c).then((function(e){o.resolve(n(d,e))}));else if(t.numFound>1){for(var u=[],p=0;p<t.numFound;p++){d=t.docs[p];n(d);u=u.concat(n(d))}o.resolve(u)}else o.resolve(n(d))}else o.resolve([])})),o.promise()},getDescendantTree:function(t,a,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=this;a=a||!1;var r=e.Deferred(),l=["header:name_"+i.settings.view,"id","ancestor_id_"+i.settings.perspective+"_path","ancestors_"+i.settings.perspective,"ancestor_id_closest_"+i.settings.perspective+"_path","ancestor_ids_closest_"+i.settings.perspective,"caption_eng","related_"+i.settings.domain+"_feature_type_s","related_"+i.settings.domain+"_relation_label_s"].concat(n).join(",");"places"==i.settings.domain&&(l+=",related_subjects_t");var c=s||"related_"+i.settings.domain+"_header_s+ASC",o=i.settings.termIndex+"/select?&q={!child of=block_type:parent}id:"+t+"&fl=child_count:[subquery],uid,related_"+i.settings.domain+"_id_s,related_"+i.settings.domain+"_header_s,"+l+"&expand=true&child_count.fq=related_kmaps_node_type:child&child_count.fl=uid&child_count.rows=0&child_count.q={!child of='block_type:parent'}{!term f=uid v=$row.related_"+i.settings.domain+"_id_s}&fq=related_kmaps_node_type:child&fq={!collapse field=related_"+i.settings.domain+"_id_s}&wt=json&limit=2000&indent=true&wt=json&json.wrf=?&sort="+c+"&rows=2000";return e.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){var t=e.response;if(t.numFound>0){var s=t.docs.reduce((function(t,s,n){var r=new RegExp(i.settings.domain+"-(.*)"),l=s["related_"+i.settings.domain+"_id_s"].match(r),c=l?void 0===l[1]?"":l[1]:"",o="";if("places"==i.settings.domain){var d=e.expanded[s["related_"+i.settings.domain+"_id_s"]],u=d&&d.docs[0]||[],p=u.related_subjects_t?u.related_subjects_t.join(",")+": ":"";o=p,""==p&&(o=(o=s["related_"+i.settings.domain+"_feature_type_s"])?o+": ":" ")}var m="ancestor_ids_"+i.settings.perspective;i.settings.perspective;void 0===s[m]&&(m="ancestor_ids_closest_"+i.settings.perspective,i.settings.perspective);var h="<strong>"+s["related_"+i.settings.domain+"_header_s"]+"</strong>";a&&(h+=" ("+o+s["related_"+i.settings.domain+"_relation_label_s"]+")");var v={title:h,displayPath:"",key:i.settings.domain+"-"+c,expanded:!1,lazy:!0,href:i.settings.featuresPath.replace("%%ID%%",c)};return void 0!==s.child_count&&0===s.child_count.numFound&&(v.lazy=!1),void 0!==t?t.concat([v]):[v]}),[]);r.resolve(s)}else r.resolve([])})),r.promise()}};return i}(l.a,window,document),p=a(55),m=a.n(p),h=a(44);!function(e,t,a,s){var i="kmapsRelationsTree",r={termIndex:"http://localhost/solr/kmterms_dev",assetIndex:"http://localhost/solr/kmassets_dev",tree:"places",featuresPath:"/features/%%ID%%",domain:"places",featureId:1,perspective:"pol.admin.hier",descendants:!1,directAncestors:!0,descendantsFullDetail:!0,sortBy:"header_ssort+ASC",initialScrollToActive:!1,displayPopup:!1,mandalaURL:"https://mandala.shanti.virginia.edu/%%APP%%/%%ID%%/%%REL%%/nojs",solrUtils:{},language:"eng",extraFields:[],nodeMarkerPredicates:[]};function l(t,a){this.element=t,this.options=e.extend({},r,a),this._defaults=r,this._name=i,this.init()}l.prototype={init:function(){var t=this,a={descendants:t.options.descendants,directAncestors:t.options.directAncestors,descendantsFullDetail:t.options.descendantsFullDetail,sortBy:t.options.sortBy,extraFields:t.options.extraFields,nodeMarkerPredicates:t.options.nodeMarkerPredicates};e(t.element).fancytree({extensions:["filter","glyph"],source:t.getAncestorTree(a),init:function(e,a){t.options.initialScrollToActive&&t.scrollToActiveNode()},glyph:{preset:"awesome5",map:{doc:"",docOpen:"",error:"fas fa-exclamation-circle",expanderClosed:"fas fa-plus-circle",expanderLazy:"fas fa-plus-circle",expanderOpen:"fas fa-minus-circle",folder:"",folderOpen:"",loading:"fas fa-spinner"}},activate:function(e,a){var s=a.node;a.originalEvent;s.data.marks&&s.data.marks.includes("nonInteractiveNode")?s.toggleExpanded():s.data.href&&t.options.history.push(s.data.href.replace("https://shanti-uva.github.io/mandala-om",""))},lazyLoad:function(e,a){a.result=t.getDescendantTree(a.node.key,a.node.getKeyPath(),t.options.sortBy)},createNode:function(a,s){s.node.span.childNodes[2].innerHTML='<span id="ajax-id-'+s.node.key+'">'+s.node.title+" "+(s.node.data.path||"")+"</span>";var i=s.node.span,r=s.node.key;s.node.title,s.node.data.caption,s.node.data.path,s.node.getParentList(!0,!0).reduce((function(e,t){var a=t.title,s="";null!=a&&(s=a[0]);var n="<a href='"+t.data.href+"'>"+s+"</a>";return""==e?n:e+"/"+n}),"");if(t.options.displayPopup){var l=e('<span class="popover-kmaps" id="'+r+'" data-app="places" data-id="'+r+'"><span class="popover-kmaps-tip"></span><span class="icon shanticon-menu3"></span></span>');if(e(i).append(e(l)),r.startsWith(t.options.domain+"-")){var c=r.replace(t.options.domain+"-","");m.a.render(n.a.createElement(h.a,{domain:t.options.domain,kid:c}),i.lastChild)}}return s}})},scrollToActiveNode:function(){var t=Object(d.a)(o.a.mark((function t(){var a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e(this.element).fancytree("getTree"),(s=a.getActiveNode())&&s.makeVisible().then((function(){var t=e(s.li).offset().top-e(s.li).closest(".view-wrap").offset().top;e(s.li).closest(".view-wrap").scrollTop(t)}));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),getAncestorPath:function(){return this.options.solrUtils.getAncestorPath()},getAncestorTree:function(e){return this.options.directAncestors?this.options.solrUtils.getAncestorTree(e):this.options.solrUtils.getFullAncestorTree(e)},getDescendantTree:function(e,t){if(!this.options.directAncestors){var a=t.split("/"+this.options.domain+"-");return a.shift(),this.options.solrUtils.getDescendantsInPath(a.join("/"),a.length+1,this.options.sortBy,this.options.extraFields,this.options.nodeMarkerPredicates)}return this.options.solrUtils.getDescendantTree(e,this.options.descendantsFullDetail,this.options.sortBay,this.options.extraFields,this.options.nodeMarkerPredicates)}},e.fn[i]=function(t){var a,s=arguments;return void 0===t||"object"===typeof t?this.each((function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new l(this,t))})):"string"===typeof t&&"_"!==t[0]&&"init"!==t?(this.each((function(){var n=e.data(this,"plugin_"+i);n instanceof l&&"function"===typeof n[t]&&(a=n[t].apply(n,Array.prototype.slice.call(s,1))),"destroy"===t&&e.data(this,"plugin_"+i,null)})),void 0!==a?a:this):void 0}}(l.a,window,document);a(599),a(600);var v=function(e){var t=e.domain,a=e.tree,r=e.descendants,c=void 0===r||r,o=e.directAncestors,d=void 0!==o&&o,p=e.displayPopup,m=void 0!==p&&p,h=e.perspective,v=void 0===h?"tib.alpha":h,f=e.view,g=void 0===f?"roman.scholar":f,_=e.sortBy,b=void 0===_?"position_i+ASC":_,y=e.currentFeatureId,E=void 0===y?"":y,k=Object(s.useRef)(null),w=Object(i.h)(),x=Object(i.j)(),T="";return E&&E.startsWith(t)&&(T=E),Object(s.useEffect)((function(){var e={termIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",assetIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",featureId:T,domain:t,perspective:v,view:g,tree:a,featuresPath:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%")},s=u.init(e),n=l()(k.current),i={domain:t,featureId:T,featuresPath:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%"),perspective:v,tree:a,termIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",assetIndex:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",descendants:c,descendantsFullDetail:!1,directAncestors:d,displayPopup:m,mandalaURL:"https://shanti-uva.github.io/mandala-om"+"/".concat(t,"/").concat(t,"-%%ID%%"),solrUtils:s,view:g,sortBy:b,initialScrollToActive:!0,history:w,params:x};return n.kmapsRelationsTree(i),function(){n.fancytree("destroy")}}),[]),n.a.createElement("div",{className:"suiFancyTree view-wrap",ref:k})}},199:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(0),n=a.n(s),i=a(45),r=a(19),l=a.n(r),c=a(21);function o(e){var t,a,r,o,d;Object(c.j)();var u,p=Object(i.c)((function(e){return e.search})),m=(u=Object(i.b)((function(e){return e.search})),l.a.reduce(u,(function(e,t,a){var s;return e[a]=(s=t,l.a.debounce(s,100)),e}),{})),h=m.update,v=m.setSearchText,f=m.addFilters,g=m.gotoPage,_=m.nextPage,b=m.prevPage,y=m.lastPage,E=m.firstPage,k=m.clearFilters,w=m.clearAll,x=m.removeFilters,T=m.setPageSize,j=m.narrowFilters,S=m.superClear;var A={query:p.query,currentText:p.searchText,update:h,setSearchText:v,addFilters:f,clearFilters:k,clearAll:w,superClear:S,removeFilters:x,narrowFilters:j};Object(s.useEffect)((function(){h()}),[]);var P=null===(t=p.results)||void 0===t?void 0:t.docs,N={numFound:null===(a=p.results)||void 0===a?void 0:a.numFound,currentPage:null===(r=p.page)||void 0===r?void 0:r.current,currentPageSize:null===(o=p.page)||void 0===o?void 0:o.rows,getMaxPage:function(){var e;if(null===(e=p.results)||void 0===e?void 0:e.numFound){var t,a,s=null===(t=p.results)||void 0===t?void 0:t.numFound,n=null===(a=p.page)||void 0===a?void 0:a.rows;return Math.floor((s-1)/n)}return 0},getPage:function(){var e;return null===(e=p.page)||void 0===e?void 0:e.current},setPage:function(e){var t,a;e=Number(e);var s=null===(t=p.results)||void 0===t?void 0:t.numFound,n=null===(a=p.page)||void 0===a?void 0:a.rows,i=Math.floor(s/n);e=l.a.isNaN(e)?0:e,g(e>i?i:e<0?0:e)},setPageSize:function(e){var t,a;e=Number(e);var s=Number(e),n=Number(null===(t=p.page)||void 0===t?void 0:t.current);e=e<1?1:e,e=l.a.isNaN(e)?s:e,T(e);var i=null===(a=p.page)||void 0===a?void 0:a.rows,r=Math.floor(i/s*n);r=l.a.isNaN(r)?0:r,N.setPage(r)},getPageSize:function(){var e;return null===(e=p.page)||void 0===e?void 0:e.rows},nextPage:function(){_()},prevPage:function(){b()},firstPage:function(){E()},lastPage:function(){y()}},O=null===(d=p.results)||void 0===d?void 0:d.facets;return n.a.Children.map(e.children,(function(e){return e.type?n.a.cloneElement(e,{docs:P,facets:O,pager:N,search:A}):e}))}},267:function(e,t,a){},281:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(31),n=a(0),i=a.n(n),r=a(46),l=a(231),c=a(166);function o(e){var t,a;var n=e.chosen?"chosen":"",o=Object(r.e)(e.facetType),d="add"===e.mode?i.a.createElement("div",{onClick:function(){e.onFacetClick(Object(s.a)(Object(s.a)({},e),{},{action:"add"}))},className:"sui-advEditLine "+n},i.a.createElement("span",{className:e.className})," ",o," ",e.label,"(",e.count,")"," "):i.a.createElement("div",null,i.a.createElement("span",{onClick:function(t,a){e.onFacetClick(Object(s.a)(Object(s.a)({},e),{},{action:"remove"}))},className:e.className})," ",o," ",e.label);return i.a.createElement(l.a,{placement:"auto",delay:{show:250,hide:400},overlay:function(t){return i.a.createElement(c.a,Object.assign({},t,{className:"c-FacetChoice--popover"}),i.a.createElement(c.a.Content,null,e.value))},"data-filters":null===(t=e.location)||void 0===t||null===(a=t.state)||void 0===a?void 0:a.filters,popperConfig:{modifiers:[{name:"offset",options:{offset:[0,10]}}]}},d)}},342:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return l}));var s,n=a(31),i=a(18);function r(e,t){return e.key===t.key||JSON.stringify(Object(n.a)(Object(n.a)({},e),{},{key:null,name:null}))===JSON.stringify(Object(n.a)(Object(n.a)({},t),{},{key:null,name:null}))}!function(e){e[e.search=0]="search",e[e.visit=1]="visit"}(s||(s={}));var l={addLocation:Object(i.b)((function(e,t){var a=e.historyStack.findIndex((function(e){return r(e,t)}));a>-1&&e.historyStack.splice(a,1),e.historyStack.push(t)})),clear:Object(i.b)((function(e){e.historyStack=[]})),removeType:Object(i.b)((function(e,t){console.log("HistoryModel: type = ",t.valueOf()),console.log("HistoryModel: Type.search = ",s.search),console.log(t==s.search);var a=e.historyStack.filter((function(e){return console.log(" x====> ",JSON.stringify(e)),t.valueOf()!=s.search||!e.pathname.startsWith("/search/")||(console.log("omitting: ",e),!1)}));e.historyStack=a})),removeLocation:Object(i.b)((function(e,t){var a=e.historyStack.findIndex((function(e){return r(e,t)}));a>-1?(console.log("removing item number "+a),e.historyStack.splice(a,1)):console.log("HistoryModel.ts: remove failed:  location = ",t)})),historyStack:[]}},366:function(e,t,a){},367:function(e,t,a){},382:function(e,t,a){},383:function(e,t,a){"use strict";a.d(t,"a",(function(){return ms}));var s=a(34),n=a(35),i=a(154),r=a(153),l=a(0),c=a.n(l),o=a(2),d=a.n(o),u=function(){function e(t){if(Object(s.a)(this,e),"undefined"===typeof d.a)throw"This libraries requires jQuery";this.defaultState={solrUrl:"https://solrUrl.must.be.set.in.the.state.object",mode:"input",view:"Card",sort:"Alpha",type:"All",page:0,pageSize:100,query:{text:"",places:[],collections:[],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],assets:[],dateStart:"",dateEnd:"",project_filter:""}},t&&(this.defaultState=d.a.extend(!0,{},this.defaultState,t)),this.facetJSON={asset_counts:{limit:100,type:"terms",field:"asset_type",domain:{excludeTags:"ast"}},places:{limit:300,type:"terms",field:"kmapid_places_idfacet"},subjects:{limit:300,type:"terms",field:"kmapid_subjects_idfacet"},terms:{limit:300,type:"terms",field:"kmapid_terms_idfacet"},features:{limit:300,type:"terms",field:"feature_types_idfacet"},languages:{limit:300,type:"terms",field:"node_lang"},collections:{limit:300,type:"terms",field:"collection_idfacet"},collection_nid:{limit:300,type:"terms",field:"collection_nid"},collection_uid:{limit:300,type:"terms",field:"collection_uid_s"},asset_subtype:{limit:300,type:"terms",field:"asset_subtype",facet:{parent_type:{limit:1,type:"terms",field:"asset_type"}}},node_user:{limit:300,type:"terms",field:"user_name_full_s"},creator:{limit:300,type:"terms",field:"creator"}},this.facetAdvancedJSON={related:{domain:{blockChildren:"block_type:parent"},type:"terms",field:"related_subjects_relation_code_s",limit:-1,facet:{related_subject:{type:"terms",field:"related_subjects_id_s",limit:-1,facet:{related_subject_name:{type:"terms",field:"related_subjects_header_s",limit:1}}}}}}}return Object(n.a)(e,[{key:"allAssets",value:function(){return[{id:"audio-video",title:"audio-video",bool:"OR"},{id:"images",title:"images",bool:"OR"},{id:"texts",title:"images",bool:"OR"},{id:"visuals",title:"visuals",bool:"OR"},{id:"sources",title:"sources",bool:"OR"},{id:"subjects",title:"subjects",bool:"OR"},{id:"places",title:"places",bool:"OR"},{id:"terms",title:"terms",bool:"OR"}]}},{key:"createBasicQuery",value:function(e,t,a){var s=this.allAssets();e=d.a.extend(!0,{},this.defaultState,e);var n={};if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=t[i],l=this.facetJSON[r];l?n[r]=l:console.error("Warning: ignoring unknown facet: "+r)}d.a.isEmptyObject(n)&&(console.log("no currentFacets so using ALL facets"),n=this.facetJSON);var c=[];if(a&&a.length>0)for(var o=0;o<a.length;o++){var u=a[o].split(":"),p=u[0],m=u[1],h=this.facetJSON[p].field+":*"+m+"*";c.push(h)}var v=e.query.text||"";v=v.replace(/ /g,"\\ ").replace("(","\\(").replace(")","\\)").replace(":","\\:").replace("+","\\+").replace("-","\\-").replace('"','\\"').replace("?","\\?");var f=e.page||0,g=e.pageSize||100;c.length>0&&(g=0);var _=v.length?v+"*":"*",b=v.length?"*"+v+"*":"*",y=v+"/";"undefined"!==d.a.type(v)&&0!==v.length||(v=b=y="*");var E=f*g,k=[];if(e.query.places&&e.query.places.length&&k.push(this.buildFq(e.query.places,"kmapid")),e.query.subjects&&e.query.subjects.length&&k.push(this.buildFq(e.query.subjects,"kmapid")),e.query.terms&&e.query.terms.length&&k.push(this.buildFq(e.query.terms,"kmapid")),e.query.features&&e.query.features.length&&k.push(this.buildFq(e.query.features,"feature_types_ss","title")),e.query.collections&&e.query.collections.length&&k.push(this.buildFq(e.query.collections,"collection_uid_s","id")),e.query.languages&&e.query.languages.length&&k.push(this.buildFq(e.query.languages,"node_lang","title")),e.query.assets&&e.query.assets.length){for(var w=0;w<e.query.assets.length;w++)"all"===e.query.assets[w].id&&(e.query.assets=s);k.push(this.buildFq(e.query.assets,"asset_type","id","ast"))}e.query.users&&e.query.users.length&&k.push(this.buildFq(e.query.users,"node_user","title")),e.query.creators&&e.query.creators.length&&k.push(this.buildFq(e.query.creators,"creator","title")),e.project_filter&&e.project_filter.length&&k.push(e.project_filter);var x="";e.query.kmapid&&(x=e.query.kmapid);var T={q:"( title:${xact}^100 title:${slashy}^100 names_txt:${xact}^90 title:${starts}^80 names_txt:${starts}^70 title:${search}^10 caption:${search} summary:${search} names_txt:${search})",xact:v,starts:_,search:b,slashy:y},j={q:"(uid:${kmapid}^100 kmapid:${kmapid})",kmapid:x};"*"!==v&&""!==v||(T={q:"*"});var S=x.length?j:T,A=d.a.extend({},{fl:"*",wt:"json",start:E,rows:g,facet:"on","json.facet":JSON.stringify(n),echoParams:"explicit",indent:"true"},S),P=e.solrUrl,N=new URLSearchParams(A);for(w=0;w<k.length;w++)N.append("fq",k[w]);for(var O=0;O<c.length;O++)N.append("fq",c[O]);return new URL(P+"?"+N.toString())}},{key:"createKmapQuery",value:function(e,t,a,s){var n=this.allAssets();s=s||10,a=a||0;var i=t?[{id:t,title:t,bool:"OR"}]:n;return this.createBasicQuery({page:a,pageSize:s,query:{kmapid:e,assets:i}},["asset_counts"])}},{key:"createAssetsByCollectionQuery",value:function(e,t,a){return this.createBasicQuery({page:t,pageSize:a,query:{collections:[{title:e,id:e,bool:"OR"}]}})}},{key:"buildFq",value:function(e,t,a,s){a||(a="id");for(var n=s?"{!tag="+s+"}":"",i="",r=0;r<e.length;r++){var l=e[r],c=l[a],o="";"AND"===l.bool?o="+":"NOT"===l.bool?o="-":"OR"===l.bool?o="":console.error("Unknown operator = "+l.bool+" : "+JSON.stringify(l)),i+=" "+o+'"'+c+'"'}return n+t+":("+i+")"}},{key:"createAdvancedFacetQuery",value:function(e){(e=d.a.extend(!0,{},this.defaultState,e)).solrUrl="https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select";var t=e.query.text||"",a=e.page||0,s=e.pageSize||100,n=t+"*",i="*"+t+"*",r=t+"/";"undefined"!==d.a.type(t)&&0!==t.length||(t=i=r="*");var l={q:"( header:${xact}^100 header:${slashy}^100 header:${starts}^80 header:${search}^10)",xact:t,starts:n,search:i,slashy:r,fl:"*,[child parentFilter=block_type:parent]",wt:"json",start:a,rows:s,facet:"on","json.facet":JSON.stringify(this.facetAdvancedJSON),echoParams:"explicit",indent:"true"},c=e.solrUrl,o=new URLSearchParams(l);return new URL(c+"?"+o.toString())}},{key:"buildQuery",value:function(e,t,a,s,n,i){""===(a=a.replace(/^\//,"").replace(/\s\//," "))&&(a="*");var r="level_i",l="ancestor_id_path";"terms"===t&&(r="level_tib.alpha_i",l="ancestor_id_tib.alpha_path");for(var c={child_counts:{limit:300,mincount:2,type:"terms",field:l,domain:{excludeTags:"hoot"}}},o=i||["header","id","ancestor*","caption_eng","position*",r].join(","),d=[],u=n+1;u>s;u--){var p=a.split("/").slice(0,u-1).join("/"),m=p.length?" AND "+l+":"+p:"";d.push("("+r+":"+(u-1)+m+")")}var h=d.join(" ");return e+"/select?df="+l+"&q="+a.split("/").slice(0,s).join("/")+"&wt=json&indent=true&limit=2000&facet=true&fl="+o+"&indent=true&fq=tree:"+t+"&fq="+r+":["+s+"+TO+"+(n+1)+"]&fq={!tag=hoot}"+h+"&facet.mincount=2&facet.limit=-1&sort="+r+"+asc,position_i+asc,header+asc&facet.sort="+l+"+ASC&facet.field={!ex=hoot}"+l+"&json.facet="+JSON.stringify(c)+"&wt=json&json.wrf=?&rows=2000"}},{key:"buildAssetQuery",value:function(e){return this.createBasicQuery(e)}}]),e}(),p=function(){function e(t,a){Object(s.a)(this,e),this.sui=this,this.curResults="",this.numItems=0,this.AND="AND",this.OR="OR",this.NOT="NOT",this.ss={},this.site=t,this.facets={},this.facets.assets={type:"list",icon:"&#xe60b",mode:null,data:[]},this.facets.places={type:"tree",icon:"&#xe62b",mode:null,data:[]},this.facets.features={type:"tree",icon:"&#xe638",mode:null,data:[]},this.facets.subjects={type:"tree",icon:"&#xe634",mode:null,data:[]},this.facets.terms={type:"tree",icon:"&#xe635",mode:null,data:[]},this.facets.collections={type:"list",icon:"&#xe633",mode:null,data:[]},this.facets.languages={type:"tree",icon:"&#xe670",mode:null,data:[]},this.facets.users={type:"input",icon:"&#xe600",mode:null,data:[]},this.assets={},this.assets.all={c:"#5b66cb",g:"&#xe60b"},this.assets.places={c:"#6faaf1",g:"&#xe62b"},this.assets["audio-video"]={c:"#58aab4",g:"&#xe648"},this.assets.images={c:"#b49c59",g:"&#xe62a"},this.assets.sources={c:"#5a57ad",g:"&#xe631"},this.assets.texts={c:"#8b5aa1",g:"&#xe636"},this.assets.visuals={c:"#6e9456",g:"&#xe63b"},this.assets.subjects={c:"#cc4c39",g:"&#xe634"},this.assets.terms={c:"#a2733f",g:"&#xe635"},this.assets.collections={c:"#5b66cb",g:"&#xe633"},this.searches=[],this.showBool=!1,this.showSearch=!1,this.noTop="CU"==t,d()("<link/>",{rel:"stylesheet",type:"text/css",href:"searchui.css"}).appendTo("head"),this.solrId=a?"_prod":"_dev",this.solrBase="https://"+(a?"ss395824":"ss251856")+"-us-east-1-aws.measuredsearch.com/solr/",this.ss.solrUrl=this.solrBase+"kmassets"+(a?"":"_dev")+"/select",this.ss.mode="input",this.ss.view="Card",this.ss.sort="Alpha",this.ss.page=0,this.ss.pageSize=100,this.ss.site="Mandala",this.ss.numResults=0,this.solrUtil=new u({solrUrl:this.ss.solrUrl}),this.ClearQuery()}return Object(n.a)(e,[{key:"Draw",value:function(e){e&&(this.ss.mode=e),this.DrawResults()}},{key:"ShowAdvanced",value:function(e){throw new Error("ShowAdvanced")}},{key:"ShowHamburger",value:function(){d()("#sui-hamburger").html("<span id='sui-help' class='sui-hamItem'>&#xe67e&nbsp;&nbsp;HELP GUIDE</span>\n\t\t<span id='sui-home' class='sui-hamItem'>&#xe60b&nbsp;&nbsp;HOME</span>".replace(/\t|\n|\r/g,"")),d()("#sui-hamburger").slideToggle(),d()("#sui-home").on("click",(function(){alert("DrawLandingPage()")})),d()("#sui-help").on("click",(function(){window.open("//confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools","_blank")})),d()("#sui-hamburger").on("click",(function(){d()("#sui-hamburger").slideUp()}))}},{key:"SetState",value:function(e){var t=window.location.href.split("#")[0];window.history.pushState("#"+e,"Mandala",t+(e?"#"+e:""))}},{key:"PageRouter",value:function(e){var t,a=this,s=this.sui;window.location.href.split("#")[0];if(t=e.match(/#p=(.+)/))t=t[1].toLowerCase(),i(),this.alert("======== PAGEROUTER: "+e+" Handling p: Drawing "+t),this.log("\tPAGEROUTER: calling pages.Draw() with id="+t),this.GetKmapFromID(t,(function(e){a.log("\tPAGEROUTER: calling pages.Draw() with kmap="+e.uid),a.pages.Draw(e,!0)}));else if(t=e.match(/#r=(.+)/)){i();var n=t[1].replace(/\%20/g," ").split("=");this.pages.relatedId=n[0],this.pages.relatedType=n[2],this.alert("======== PAGEROUTER: "+e+" Handling r: calling getKmapFromID with id = "+n[3]+" this.pages.relatedId="+this.pages.relatedId+" this.pages.relatedType="+this.pages.relatedType),this.GetKmapFromID(n[3],(function(e){a.pages.relatedBase=e,a.pages.DrawRelatedResults(e,!0)}))}else(t=e.match(/#s=(.+)/))&&(i(),t=t[1].replace(/\%20/g," "),this.ParseQuerystring(t),this.alert("======== PAGEROUTER: "+e+" Handling s: Parsing querystring: "+t+" set ss.query.text to "+ss.query.text),d()("#sui-search").val(this.ss.query.text),this.Query(!0));function i(){s.ss.mode="simple",s.ss.page=0,d()("#sui-legacy").scrollTop(0),d()("#c-columnContent__main").scrollTop(0),d()("#plc-infoDiv").remove(),d()("#l-content__main").css({width:"100%",display:"inline-block"}),d()("#sui-adv").css({display:"none"}),d()("#sui-legacy").css({display:"block"}),s.DrawHeader(!0),s.DrawFooter()}}},{key:"SerializeQuery",value:function(e){var t,a,s="";for(a in this.ss.query.assets=[this.ss.query.assets[0]],e.query)if("text"==a&&e.query[a])s+="".concat(a,":").concat(e.query[a],"=");else for(t=0;t<e.query[a].length;++t)s+="".concat(a,":").concat(e.query[a][t].title,":").concat(e.query[a][t].id,":").concat(e.query[a][t].bool,"=");return s.slice(0,-1)}},{key:"ParseQuerystring",value:function(e){var t,a,s,n=e.split("=");for(this.ClearQuery(),this.ss.query.assets=[],t=0;t<n.length;++t)n[t].match(/^text/)?this.ss.query.text=n[t].substr(5):(s={title:(a=n[t].split(":"))[1],id:a[2],bool:a[3]},this.ss.query[a[0]].push(s));this.ss.query.assets=[this.ss.query.assets[0]]}},{key:"ClearQuery",value:function(){d()("#sui-search").val(""),this.pages&&(this.pages.relatedBase=this.pages.relatedId=""),this.ss.page=0,this.ss.query={text:"",places:[],collections:[],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],assets:[{title:"All",id:"all",bool:"AND"}],termPerspective:"",subjectPerspective:"",placePerspective:"",view:""}}},{key:"Query",value:function(e,t){var a,s=this;if(this.LoadingIcon(!0,64),t){var n=JSON.parse(JSON.stringify(this.ss));n.query={text:"",places:[],assets:[{id:this.pages.relatedType,bool:"AND"}],languages:[],features:[],subjects:[],terms:[],relationships:[],users:[],perspectives:[],collections:[{title:"all",id:t,bool:"AND"}]},a=this.solrUtil.buildAssetQuery(n)}else a="related"==this.ss.mode?this.solrUtil.createKmapQuery(this.pages.relatedId.toLowerCase(),this.pages.relatedType.toLowerCase(),this.ss.page,this.ss.pageSize):this.solrUtil.buildAssetQuery(this.ss);"related"==this.ss.mode||e||this.SetState("s="+this.SerializeQuery(this.ss)),d()("#sui-relatedAssets").remove(),this.ActiveSearch()&&(this.searches.filter((function(e,t){JSON.stringify(e.query)===JSON.stringify(s.ss.query)&&s.searches.splice(t,1)})),this.searches.push(JSON.parse(JSON.stringify(this.ss)))),d.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){s.curResults=s.MassageKmapData(e.response.docs),s.ParseFacetData(e),s.LoadingIcon(!1),s.DrawResults()})).fail((function(e){s.LoadingIcon(!1),s.Popup("Query error")}))}},{key:"GetKmapFromID",value:function(e,t){var a=this,s=this.ss.solrUrl+"?q=uid:"+e.toLowerCase()+"&wt=json";d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){try{e=a.MassageKmapData(e.response.docs[0])}catch(s){e.error=s}t(e)})).fail((function(e){console.log(e)}))}},{key:"GetDefinitionAssets",value:function(e,t){var a=this,s=this.ss.solrUrl+"?q=kmapid:"+e.toLowerCase()+"&wt=json";d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){e=a.MassageKmapData(e.response.docs),t(e)})).fail((function(e){console.log(e)}))}},{key:"GetRelatedFromID",value:function(e,t){var a=this;this.log("GetRelatedFromID() called with arguments");var s="".concat(this.solrBase,"kmterms").concat(this.solrId,"/query");s+="?child_count.fq=related_kmaps_node_type:child&child_count.fl=uid&fq=!related_kmaps_node_type:parent",s+="&child_count.rows=0&fl=child_count:[subquery],*&child_count.q={!child%20of='block_type:parent'}",s+="{!term%20f=uid%20v=$row.related_subjects_id_s}&rows=2000&q=id:"+e+"%20OR%20{!child%20of=block_type:parent}id:"+e+"%20&sort=block_type%20DESC,%20related_subjects_header_s%20ASC",this.log("SOLR QUERY GetRelatedFromID():  query = "+s),d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){a.log("GetRelatedFromID() returns "+e),t(e.response.docs)})).fail((function(e){console.log(e)}))}},{key:"GetRelatedPlaces",value:function(e,t){var a=this;this.LoadingIcon(!0,64);var s=this.solrUtil.createKmapQuery(e,"places",0,1e4);d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){e=a.MassageKmapData(e.response.docs),a.LoadingIcon(!1),t(e)})).fail((function(e){console.log(e),a.LoadingIcon(!1),a.Popup("Related query error")}))}},{key:"GetChildNamesFromID",value:function(e,t,a){var s="".concat(this.solrBase,"kmterms").concat(this.solrId,"/select?fl=uid%2C%5Bchild%20childFilter%3Did%3A").concat(e,"-").concat(t,"_names-*%20parentFilter%3Dblock_type%3Aparent%5D&q=uid%3A").concat(e,"-").concat(t,"&wt=json&rows=300");d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){a(e.response.docs)})).fail((function(e){console.log(e)}))}},{key:"GetChildDataFromID",value:function(e,t){var a="".concat(this.solrBase,"kmterms").concat(this.solrId,"/query?q=uid:").concat(e,"&wt=json&fl=*,[child%20parentFilter=block_type:parent%20limit=300]");d.a.ajax({url:a,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){t(e.response.docs[0])})).fail((function(e){console.log(e)}))}},{key:"GetTreeChildren",value:function(e,t,a){var s=this.sui,n="".concat(this.solrBase,"kmterms").concat(this.solrId),i=Math.max(t.split("/").length+1,2);"features"!=e&&"languages"!=e||(e="subjects");var r=s.solrUtil.buildQuery(n,e,t,i,i);d.a.ajax({url:r,dataType:"jsonp"}).done((function(e){a(e)})).fail((function(e){console.log(e)}))}},{key:"GetAudioFromID",value:function(e,t){d.a.getJSON("//terms.kmaps.virginia.edu/slices/"+e+"/recordings",(function(e){var a,s=[];try{for(a=0;a<e.recordings.length;++a)s.push(e.recordings[a].audio_file);t(s)}catch(n){}})).fail((function(e){console.log(e)}))}},{key:"GetJSONFromKmap",value:function(e,t){var a=this,s=e.url_json;s&&(s=(s=s.replace(/images.shanti.virginia.edu/i,"images-dev.shanti.virginia.edu")).replace(/https:|http:/i,""),s+="?callback=myfunc",("audio-video"==e.asset_type||e.subcollection_uid_ss)&&(s=s.replace(/.json/i,".jsonp")),d.a.ajax({url:s,dataType:"jsonp",error:function(e){a.Popup("JSON access error")}}).done((function(e){t(e)})))}},{key:"MassageKmapData",value:function(e){var t,a;for(t=0;t<e.length;++t)(a=e[t]).asset_subtype&&(a.asset_subtype=a.asset_subtype.charAt(0).toUpperCase()+a.asset_subtype.slice(1)),a.url_thumb&&(a.url_thumb=a.url_thumb.replace(/images-test/i,"images")),"places"==a.asset_type&&(a.ancestors_txt&&a.ancestors_txt.length&&a.ancestors_txt.splice(0,1),a.ancestor_ids_is&&a.ancestor_ids_is.length&&a.ancestor_ids_is.splice(0,1)),"texts"==a.asset_type?a.url_thumb="gradient.jpg":a.url_thumb||(a.url_thumb="gradient.jpg"),a.display_label&&(a.title=a.display_label);return e}},{key:"ParseFacetData",value:function(e){var t,a,s,n,i=0;for(a in this.assets)this.assets[a].n=0;if(e&&e.facets&&e.facets.asset_counts&&e.facets.asset_counts.buckets){for(n=e.facets.asset_counts.buckets,t=0;t<n.length;++t)s=n[t].val,this.assets[s]&&(this.assets[s].n=n[t].count),i+=n[t].count;this.ss.numResults=this.assets.all.n=i}}},{key:"QueryFacets",value:function(e,t){var a=this;if("users"!=e&&"relationships"!=e){this.LoadingIcon(!0,64);var s=this.solrUtil.createBasicQuery(this.ss,["assets"==e?"languages":e]);d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var s,n,i;if(a.LoadingIcon(!1),t.facets[e])for(n=t.facets[e].buckets,a.facets[e].data=[],s=0;s<Math.min(300,n.length);++s)i=n[s].val.split("|"),a.facets[e].data.push({title:i[0],id:i[1],n:n[s].count});a.ResetFacetList(e)}))}}},{key:"DrawResults",value:function(e){if(this.log("DrawResults() called",arguments),d()("#c-columnContent__main").scrollTop(0),d()("#sui-legacy").scrollTop(0),d()("#sui-legacy").css({"background-image":""}),d()("#sui-legacy").css({display:"block"}),d()("#plc-infoDiv").remove(),"related"==this.ss.mode?this.numItems=this.assets[this.pages.relatedType].n:this.numItems=this.assets[this.ss.query.assets[0].id].n,"input"==this.ss.mode)return d()("#sui-header").css({display:"none"}),d()("#sui-header").css({display:"inline-block","background-color":"#4d59ca"}),d()("#sui-content").css({display:"block",width:"100%"}),d()("#sui-adv").css({display:"none"}),void d()("#sui-legacy").css({display:"none"});"simple"==this.ss.mode?(d()("#sui-content").css({width:"100%"}),d()("#sui-adv").css({display:"none"}),d()("#sui-content").slideDown(),d()("#sui-content").css({width:d()("#l-site__wrap").width()})):"advanced"==this.ss.mode&&(d()("#sui-adv").css({display:"block"}),d()("#sui-content").css({width:d()("#l-site__wrap").width()-d()("#sui-adv").width()})),d()("#sui-mode").prop({title:"advanced"==this.ss.mode?"Basic search":"Advanced search"}),d()("#sui-mode").html("advanced"==this.ss.mode?"BASIC<br>SEARCH":"ADVANCED<br>SEARCH"),d()("#sui-header").css({display:"block"}),e||(this.DrawHeader(),this.DrawItems(),this.DrawFooter())}},{key:"DrawHeader",value:function(){var e=this;if("related"!=this.ss.mode){var t=Math.floor(this.numItems/this.ss.pageSize),a=this.ss.page*this.ss.pageSize+1,s=Math.min(a+this.ss.pageSize,this.numItems),n="<span style='vertical-align:-10px'>".concat(this.ss.query.assets[0].title.toUpperCase()," search results &nbsp; <span style='font-size:12px'> (").concat(a,"-").concat(s,") of ").concat(this.numItems,"\t\n\t\t<div style='float:right;font-size:11px;margin:12px -48px 0 0'>\n\t\t\t<div id='sui-page1T' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pagePT' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePageT' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ").concat(t+1,"</div>\n\t\t\t<div id='sui-pageNT' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageLT' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>");d()("#c-content__header__main").html(n.replace(/\t|\n|\r/g,"")),d()("#sui-header").css("background-color","#888"),d()("#sui-typePageT").val(this.ss.page+1),d()("[id^=sui-page]").css("color","#fff"),0==this.ss.page&&(d()("#sui-page1T").css("color","#ddd"),d()("#sui-pagePT").css("color","#ddd")),this.ss.page==t&&(d()("#sui-pageNT").css("color","#ddd"),d()("#sui-pageLT").css("color","#ddd")),d()("#sui-page1T").on("click",(function(){e.ss.page=0,e.Query()})),d()("#sui-pagePT").on("click",(function(){e.ss.page=Math.max(e.ss.page-1,0),e.Query()})),d()("#sui-pageNT").on("click",(function(){e.ss.page=Math.min(e.ss.page+1,t),e.Query()})),d()("#sui-pageLT").on("click",(function(){e.ss.page=t,e.Query()})),d()("#sui-typePageT").on("change",(function(){var a=d()("#sui-typePageT").val();isNaN(a)||(e.ss.page=Math.max(Math.min(a-1,t),0)),e.Query()}))}}},{key:"DrawFooter",value:function(){var e=this,t=Math.floor(this.numItems/this.ss.pageSize);"related"!=this.ss.mode&&d()("#sui-footer").css("background-color","#888");var a="\n\t\t<div style='float:left;font-size:18px'>\n\t\t\t<div id='sui-viewModeList' class='sui-resDisplay' title='List view'>&#xe61f</div>\n\t\t\t<div id='sui-viewModeGrid' class='sui-resDisplay' title='Grid view'>&#xe61b</div>\n\t\t\t<div id='sui-viewModeCard' class='sui-resDisplay' title='Card view'>&#xe673</div>\n\t\t</div>\t\n\t\t<div style='display:inline-block;font-size:11px'>\n\t\t\t<div id='sui-page1' class='sui-resDisplay' title='Go to first page'>&#xe63c</div>\n\t\t\t<div id='sui-pageP' class='sui-resDisplay' title='Go to previous page'>&#xe63f</div>\n\t\t\t<div class='sui-resDisplay'> PAGE <input type='text' id='sui-typePage' \n\t\t\tstyle='border:0;border-radius:4px;width:30px;text-align:center;vertical-align:1px;font-size:10px;padding:2px'\n\t\t\ttitle='Enter page, then press Return'> OF ".concat(t+1,"</div>\n\t\t\t<div id='sui-pageN' class='sui-resDisplay' title='Go to next page'>&#xe63e</div>\n\t\t\t<div id='sui-pageL' class='sui-resDisplay' title='Go to last page'>&#xe63d</div>\n\t\t\t</div>\t\n\t\t<div style='float:right;font-size:16px;'>\n\t\t\t<div id='sui-viewSortAlpha' class='sui-resDisplay' title='Sort alphabetically'>&#xe652</div>\n\t\t\t<div id='sui-viewSortDate'  class='sui-resDisplay' title='Sort by date'>&#xe60c</div>\n\t\t\t<div id='sui-viewSortAuthor' class='sui-resDisplay' title='Sort by author'>&#xe600</div>\n\t\t\t</div>");d()("#sui-footer").html(a.replace(/\t|\n|\r/g,"")),d()("#sui-typePage").val(this.ss.page+1),d()("[id^=sui-viewMode]").css("color","#ddd"),d()("#sui-viewMode"+this.ss.view).css("color","#fff"),d()("[id^=sui-viewMode]").on("click",(function(t){e.ss.view=t.currentTarget.id.substring(12),e.DrawResults()})),d()("[id^=sui-viewSort]").css("color","#ddd"),d()("#sui-viewSort"+this.ss.sort).css("color","#fff"),d()("[id^=sui-viewSort]").on("click",(function(t){e.ss.sort=t.currentTarget.id.substring(12),"Alpha"==e.ss.sort?e.curResults.sort((function(e,t){return e.title[0]>t.title[0]?1:e.title[0]<t.title[0]?-1:0})):"Date"==e.ss.sort?e.curResults.sort((function(e,t){return e.timestamp>t.timestamp?1:e.timestamp<t.timestamp?-1:0})):"Author"==e.ss.sort&&e.curResults.sort((function(e,t){return e.node_user>t.node_user?1:e.node_user<t.node_user?-1:0})),e.DrawResults()})),d()("[id^=sui-page]").css("color","#fff"),0==this.ss.page&&(d()("#sui-page1").css("color","#ddd"),d()("#sui-pageP").css("color","#ddd")),this.ss.page==t&&(d()("#sui-pageN").css("color","#ddd"),d()("#sui-pageL").css("color","#ddd")),d()("#sui-page1").on("click",(function(){e.ss.page=0,e.Query()})),d()("#sui-pageP").on("click",(function(){e.ss.page=Math.max(e.ss.page-1,0),e.Query()})),d()("#sui-pageN").on("click",(function(){e.ss.page=Math.min(e.ss.page+1,t),e.Query()})),d()("#sui-pageL").on("click",(function(){e.ss.page=t,e.Query()})),d()("#sui-typePage").on("change",(function(){var a=d()("#sui-typePage").val();isNaN(a)||(e.ss.page=Math.max(Math.min(a-1,t),0)),e.Query()}))}},{key:"DrawItems",value:function(){var e,t=this,a="";for(d()("#sui-legacy").css({"background-color":"List"==this.ss.view?"#fff":"#ddd"}),"related"==this.ss.mode?d()("#sui-legacy").css({"padding-left":"204px",width:"calc(100% - 216px"}):d()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),e=0;e<this.curResults.length;++e)"Card"==this.ss.view?a+=this.DrawCardItem(e):"Grid"==this.ss.view?a+=this.DrawGridItem(e):a+=this.DrawListItem(e);this.curResults.length||(a="<br><br><br><div style='text-align:center;color:#666'>Sorry, there were no items found<br>Try broadening your search</div>"),d()("#sui-legacy").html(a.replace(/\t|\n|\r/g,"")),"related"==this.ss.mode&&this.pages.DrawRelatedAssets(),d()(".sui-itemIcon").on("click",(function(e){var a=e.currentTarget.id.substring(13);return e.originalEvent.metaKey?window.open("#p="+t.curResults[a].uid,"_blank"):t.SendMessage("page="+t.curResults[a].url_html,t.curResults[a]),!1})),d()("[id^=sui-itemPic-]").on("click",(function(e){var a=e.currentTarget.id.substring(12);return e.originalEvent.metaKey?window.open("#p="+t.curResults[a].uid,"_blank"):t.SendMessage("page="+t.curResults[a].url_html,t.curResults[a]),!1})),d()(".sui-gridInfo").on("mouseover",(function(e){var a=e.currentTarget.id.substring(13),s=t.curResults[a],n="";if(s.title&&(n+="<strong>"+s.title+"</strong><br><br>"),n+=t.assets[s.asset_type].g+"&nbsp;&nbsp;"+s.asset_type.toUpperCase(),s.asset_subtype&&(n+=" / "+s.asset_subtype),n+="<br>",s.creator&&(n+="<p>&#xe600&nbsp;&nbsp;"+s.creator.join(", ")+"</p>"),s.summary||s.caption){var i=s.summary||s.caption;i.length>80&&(i=i.substr(0,80)+"..."),n+="<p><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>"+i+"</i></p>"}s.summary&&(n+="<p style='font-family:serif;'>"+s.summary+"</p>");var r=d()("#"+e.currentTarget.id).offset();t.Popup(n,20,Math.max(8,r.left-220),r.top+24)})),d()(".sui-gridInfo").on("mouseout",(function(e){d()("#sui-popupDiv").remove()})),d()("[id^=sui-itemTitle-]").on("click",(function(e){var a=e.currentTarget.id.substring(14);return e.originalEvent.metaKey?window.open("#p="+t.curResults[a].uid,"_blank"):t.SendMessage("page="+t.curResults[a].url_html,t.curResults[a]),!1})),d()(".sui-itemPlus").on("click",(function(e){t.ShowItemMore(e.currentTarget.id.substring(13))}))}},{key:"DrawListItem",value:function(e){var t,a=this.curResults[e],s="<div class='sui-item'>";if(s+="<div class='sui-itemPlus' id='sui-itemPlus-"+e+"'>&#xe669</div>",s+="<div class='sui-itemIcon' id='sui-itemIcon-"+e+"' style='background-color:"+this.assets[a.asset_type].c+"'>",s+="<a class='sui-noA' href='#p="+a.uid+"'><span style='color:#fff'>"+this.assets[a.asset_type].g+"</span></a></div>",s+="<div class='sui-itemTitle' id='sui-itemTitle-"+e+"'>",s+="<a class='sui-noA' href='#p="+a.uid+"'>"+a.title+"</a></div>",a.feature_types_ss&&(s+="<span style='color:"+this.assets[a.asset_type].c+"'>&nbsp;&bull;&nbsp;</span>",s+="<div class='sui-itemFeature'>&nbsp;"+a.feature_types_ss.join(", ")+"</div>"),s+="<div class='sui-itemId'>"+a.uid,a.collection_title&&(s+="<div style='text-align:right;margin-top:2px;'>&#xe633&nbsp;"+a.collection_title+"</div>"),s+="</div>",a.ancestors_txt&&a.ancestors_txt.length>1){for(s+="<div class='sui-itemTrail'>",t=0;t<a.ancestors_txt.length;++t)s+="<span class='sui-itemAncestor' onclick='sui.SendMessage(\"page=",s+="https://mandala.shanti.virginia.edu/"+a.asset_type+"/",s+=a.ancestor_ids_is[t+1]+"/overview/nojs#search,"+this.curResults[e]+")'>",s+="<a href='#p="+a.uid+"'>"+a.ancestors_txt[t]+"</a></span>",t<a.ancestors_txt.length-1&&(s+=" > ");s+="</div>"}return(s+="<div class='sui-itemMore' id='sui-itemMore-"+e+"'></div>")+"</div>"}},{key:"ShowItemMore",value:function(e){var t,a,s,n=this,i="";if(d()("#sui-itemMore-"+e).html())d()("#sui-itemMore-"+e).slideUp(400,(function(){d()("#sui-itemMore-"+e).html("")}));else{if((a=this.curResults[e]).url_thumb.match(/gradient.jpg/)||(i+="<img src='"+a.url_thumb+"' class='sui-itemPic' id='sui-itemPic-"+e+"'>"),i+="<div class='sui-itemInfo'>",i+=this.assets[a.asset_type].g+"&nbsp;&nbsp;"+a.asset_type.toUpperCase(),a.asset_subtype&&(i+=" / "+a.asset_subtype),a.creator&&(i+="<br>&#xe600&nbsp;&nbsp;"+a.creator.join(", ")),(a.summary||a.caption)&&((s=a.summary||a.caption).length>137&&(s=s.substr(0,137)+"..."),i+="<br><div style='display:inline-block;background-color:#ccc;width:4px;height:18px;margin:2px 10px 0 5px;vertical-align:-4px'></div>&nbsp;<i>"+s+"</i>"),i+="</div>",a.summary&&(i+="<br><div style='font-family:serif'>"+a.summary+"</div>"),a.kmapid_strict&&a.kmapid_strict.length){var r=[],l=[];for(i+="<div style='margin-bottom:12px'>",t=0;t<a.kmapid_strict.length;++t)a.kmapid_strict[t].match(/subjects/i)?l.push(t):a.kmapid_strict[t].match(/places/i)&&r.push(t);if(i+="<div style='float:left;min-width:200px;'><span style='color:"+this.assets.places.c+"'>",i+="<br><strong>"+this.assets.places.g+"</strong></span>&nbsp;RELATED PLACES",r.length)for(t=0;t<r.length;++t)i+="<br>",a.kmapid_strict_ss&&(i+="<span class='sui-itemRelated'>"+a.kmapid_strict_ss[r[t]]+"</span>"),i+="&nbsp;<span style='font-size:10px;margin-right:40px'>("+a.kmapid_strict[r[t]]+")</span>";if(i+="</div>",i+="<div><span style='display:inline-block;color:"+this.assets.subjects.c+"'>",i+="<br><strong>"+this.assets.subjects.g+"</strong></span>&nbsp;RELATED SUBJECTS",l.length)for(t=0;t<l.length;++t)i+="<br>",a.kmapid_strict_ss&&(i+="<span class='sui-itemRelated'>"+a.kmapid_strict_ss[l[t]]+"</span>"),i+="&nbsp;<span style='font-size:10px'>("+a.kmapid_strict[l[t]]+")</span>";i+="</div></div>"}d()("#sui-itemMore-"+e).html(i),d()("#sui-itemMore-"+e).slideDown(),d()("[id^=sui-itemPic]").on("click",(function(e){var t=e.currentTarget.id.substring(12);n.SendMessage("page="+n.curResults[t].url_html,n.curResults[t])}))}}},{key:"DrawGridItem",value:function(e){var t="<div class='sui-grid'>",a=this.curResults[e];return t+="<a href='#p="+a.uid+"'>",t+="<img src='"+a.url_thumb+"' class='sui-gridPic' id='sui-itemPic-"+e+"'></a>",a.url_thumb.match(/gradient.jpg/)&&(t+="<div class='sui-gridGlyph' style='color:".concat(this.assets[a.asset_type].c,"'>\n\t\t\t ").concat(this.assets[a.asset_type].g,"\n\t\t\t <p style='font-size:12px;margin-top:0'>").concat(a.title,"</p>\n\t\t\t </div>")),(t+="<div id='sui-gridInfo-"+e+"' class='sui-gridInfo'>&#xe67f</div>")+"</div>"}},{key:"DrawCardItem",value:function(e){var t=this.curResults[e],a="&#xe633",s="#9e894d",n=t.collection_title,i="<div class='sui-card'>";i+="<div style='width:100%;height:100px;overflow:hidden;display:inline-block;margin:0;padding:0'>",i+="<a href='#p="+t.uid+"'>",i+="<img src='"+t.url_thumb+"' class='sui-cardPic' id='sui-itemPic-"+e+"'></a></div>";var r=this.assets[t.asset_type].g;return"Audio"==t.asset_subtype?r="&#xe60a":"Video"==t.asset_subtype&&(r="&#xe62d"),i+="<div class='sui-cardType'>"+r+"</div>",t.url_thumb.match(/gradient.jpg/)&&(i+="<div class='sui-cardGlyph' style='color:".concat(this.assets[t.asset_type].c,"'>").concat(this.assets[t.asset_type].g,"</div>")),i+="<div class='sui-cardInfo'><div class='sui-cardTitle' id='sui-itemTitle-"+e+"'",t.ancestors_txt&&t.ancestors_txt.length>2&&(i+="title='"+t.ancestors_txt.join("/")+"'"),i+="><strong>"+t.title+"</strong><br></div>",i+="<div style='border-top:.5px solid "+s+";height:1px;width:100%;margin:6px 0 6px 0'></div>",t.ancestors_txt&&t.ancestors_txt.length>1&&(i+="&#xe638&nbsp;&nbsp;"+t.ancestors_txt[0]+"/...<br>",i+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.../"+t.ancestors_txt[t.ancestors_txt.length-2]+"<br>"),t.feature_types_ss&&(i+="&#xe62b&nbsp;&nbsp;"+t.feature_types_ss.join(", ")+"<br>"),t.data_phoneme_ss&&(i+="&#xe635&nbsp;&nbsp;"+t.data_phoneme_ss.join(", ")+"<br>"),t.creator&&(i+="&#xe600&nbsp;&nbsp;"+t.creator[0]+"<br>"),t.duration_s&&(i+="&#xe61c&nbsp;&nbsp;"+t.duration_s+"<br>"),t.timestamp&&(i+="&#xe60c&nbsp;&nbsp;"+t.timestamp.substr(0,10)+"<br>"),t.name_tibt&&(i+="=&nbsp;&nbsp;"+t.name_tibt+"<br>"),i+="</div>",n||(n=t.asset_type,a=this.assets[t.asset_type].g),i+="<div class='sui-cardFooter' style='background-color:"+s+"'>"+a+"&nbsp;&nbsp;",(i+="<span style='font-size:11px;vertical-align:2px'>"+n+"<span></div>")+"</div>"}},{key:"DrawAdvanced",value:function(){this.log("searchui.DrawAdvanced() short circuit")}},{key:"DrawFacetItems",value:function(e,t){"assets"!=e||this.curResults||this.Query(),"recent"==e?this.RecentSearches():"input"==this.facets[e].type?this.DrawInput(e,t):"tree"==this.facets[e].type?this.ActiveSearch()?this.DrawFacetList(e,t):this.DrawFacetTree(e,t):this.DrawFacetList(e,t)}},{key:"ActiveSearch",value:function(e){var t,a=!1;for(t in this.ss.query.text.length&&!e&&(a=!0),this.facets)this.ss.query[t].length&&"assets"!=t&&(a=!0);return a}},{key:"DrawInput",value:function(e){var t=this;if("none"==d()("#sui-advEdit-"+e).css("display")){this.facets[e].mode="input";var a="<input id='sui-advInput-".concat(e,"' placeholder='Type here'  \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'>\n\t\t<div class='sui-advEditNums'> <span id='sui-advListNum'>").concat(934,"</span> ").concat(e,"</div>");d()("#sui-advEdit-"+e).html(a+"</div>".replace(/\t|\n|\r/g,"")),d()("#sui-advEdit-"+e).slideDown(),d()("#sui-advInput-"+e).on("change",(function(a){a.target.id.split("-");t.AddNewFilter(d()("#sui-advInput-"+e).val(),e+"-0","AND",e)}))}else d()("#sui-advEdit-"+e).slideUp()}},{key:"RecentSearches",value:function(){var e=this;if("none"==d()("#sui-advEdit-recent").css("display")){var t,a,s,n="<i>Click below to recall a previous search</i><hr><div class='sui-advEditList'>";for(t=this.searches.length-1;t>=0;t--){for(s in n+="<div class='sui-advEditLine' style='width:100%' id='sui-recSrc-".concat(t,"' "),n+="title='"+this.searches[t].query.assets[0].title.toUpperCase(),n+=" "+this.searches[t].query.text,this.facets)if(this.searches[t].query[s].length&&"assets"!=s)for(a=0;a<this.searches[t].query[s].length;++a)n+=" "+this[this.searches[t].query[s][a].bool]+" "+this.searches[t].query[s][a].title;for(s in s=this.searches[t].query.assets[0].id,n+="'><span style='color:".concat(this.assets[s].c,"'>").concat(this.assets[s].g," </span>"),n+=this.searches[t].query.text,this.facets)this.searches[t].query[s].length&&"assets"!=s&&(n+=" + "+this.facets[s].icon);n+="</div>"}d()("#sui-advEdit-recent").html(n+"</div>".replace(/\t|\n|\r/g,"")),d()("[id^=sui-recSrc-]").off("click"),d()("[id^=sui-recSrc-]").on("click",(function(t){var a=t.target.id.substr(11);e.ss.query=JSON.parse(JSON.stringify(e.searches[a].query)),d()("#sui-search").val(e.ss.query.text),e.DrawAdvanced(),e.Query()})),d()("#sui-advEdit-recent").slideDown()}else d()("#sui-advEdit-recent").slideUp()}},{key:"ResetFacetList",value:function(e){var t,a,s=this,n="";if("assets"==e){var i=this.facets.assets.data=[];for(a in this.assets)i.push({title:a.charAt(0).toUpperCase()+a.slice(1),id:a,n:this.assets[a].n})}var r=Math.min(300,this.facets[e].data.length);for(d()("[id^=sui-advEditLine-]").remove(),t=0;t<r;++t)void 0==(a=this.facets[e].data[t].n)&&(a=""),a>1e3&&(a=Math.floor(a/1e3)+"K"),n+="<div class='sui-advEditLine' id='sui-advEditLine-".concat(t,"'>"),"assets"==e&&(n+="<span style='color:".concat(this.assets[this.facets[e].data[t].id].c,"'>").concat(this.assets[this.facets[e].data[t].id].g,"</span> &nbsp;")),n+="".concat(this.facets[e].data[t].title," (").concat(a,")"),"assets"!=e&&(n+=this.pages.AddPop(this.facets[e].data[t].id,!0)),n+="</div>";d()("#sui-advEditList-"+e).html("</div>"+n.replace(/\t|\n|\r/g,"")),d()("[id^=sui-advEditLine-]").off("click"),d()("[id^=sui-advEditLine-]").on("click",(function(t){var a=t.target.id.split("-"),n=s.facets[e].data;s.showSearch&&"assets"!=e?s.GetKmapFromID(n[a[2]].id,(function(e){s.SendMessage("page="+n[a[2]].url,e)})):s.AddNewFilter(n[a[2]].title,n[a[2]].id,"AND",e)})),d()("#sui-advListNum").html(r<300?r:"300+")}},{key:"DrawFacetList",value:function(e,t,a){var s,n=this,i=0;if(t||"none"==d()("#sui-advEdit-"+e).css("display")){this.QueryFacets(e),this.facets[e].mode="list";var r="<input id='sui-advEditFilter-".concat(e,"' placeholder='Filter this list' value='").concat(a||"","' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; ");"tree"==this.facets[e].type&&(r+="<div class='sui-advEditBut' id='sui-advListMap-".concat(e,"' title='Tree view'>&#xe638</div> | \n\t\t\t<div class='sui-advEditBut' id='sui-advTreeMap-").concat(e,"' title='List view'>&#xe61f</div>\n\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")),"assets"!=e&&(r+="<div class='sui-advEditBut' id='sui-advEditSort-".concat(e,"' title='Sort'>&#xe652</div>")),r+="<div class='sui-advEditNums'> <span id='sui-advListNum'></span> ".concat(e),r+="</div><hr style='border: .5px solid #a4baec'>\n\t\t<div class='sui-advEditList' id='sui-advEditList-".concat(e,"'></div>"),d()("#sui-advEdit-"+e).html(r.replace(/\t|\n|\r/g,"")),d()("#sui-advEdit-"+e).slideDown(),d()("#sui-advTreeMap-"+e).css({color:"#668eec"}),d()("[id^=sui-advEditFilter-]").off("click"),d()("#sui-advEditFilter-"+e).on("keydown",(function(t){var a,i=Math.min(300,n.facets[e].data.length),r=d()("#sui-advEditFilter-"+e).val();for(t.keyCode>31&&t.keyCode<91&&(r+=t.key),8==t.keyCode&&r.length&&(r=r.slice(0,-1)),r=RegExp(r,"i"),s=0;s<i;++s)(a=d()("#sui-advEditLine-"+s)).text().match(r)?a.css("display","block"):a.css("display","none")})),d()("[id^=sui-advEditSort-]").off("click"),d()("#sui-advEditSort-"+e).on("click",(function(){r="";var t,a,s=n.facets[e].data,l=Math.min(300,s.length);if(!(i=1-i)){for(d()("#sui-advEditList-"+e).empty(),t=0;t<l;++t)(a=n.facets[e].data[t].n)>1e3&&(a=Math.floor(a/1e3)+"K"),r+="<div class='sui-advEditLine' id='sui-advEditLine-".concat(t,"'>"),r+="".concat(s[t].title," (").concat(a,")").concat(n.pages.AddPop(s[t].id,!0),"</div>");return d()("#sui-advEditList-"+e).html(r),void d()("#sui-advEditSort-"+e).css("color","#666")}var c=d()(".sui-advEditLine");c.sort((function(e,t){var a=d()(e).text(),s=d()(t).text();return a>s?1:a<s?-1:0})),d()("#sui-advEditList-"+e).html(c),d()("#sui-advEditSort-"+e).css("color","#668eec")})),d()("[id^=sui-advListMap-]").off("click"),d()("#sui-advListMap-"+e).on("click",(function(){n.DrawFacetTree(e,1,d()("#sui-advEditFilter-"+e).val())})),d()("#sui-advEditList-"+e).css("max-height",d()("#l-site__wrap").height()-d()("#sui-advTerm-"+e).offset().top-d()("#sui-advTerm-"+e).height()-102+"px")}else d()("#sui-advEdit-"+e).slideUp()}},{key:"AddNewFilter",value:function(e,t,a,s){var n=this.ss.query[s];if(!n.filter((function(t){return t.title==e})).length){t&&(t=t.replace(/languages-|features-/i,"subjects-"));var i=n.length;n.push({}),n[i].title=e,n[i].id=t?t.replace(/collections-/,""):"",n[i].bool=a,"assets"==s&&(this.ss.query.assets=[{title:e,id:t,bool:a}]),this.ss.page=0,this.DrawAdvanced(),this.Query()}}},{key:"DrawFacetTree",value:function(e,t,a){var s=this;if(t||"none"==d()("#sui-advEdit-"+e).css("display")){this.facets[e].mode="tree",this.curTree=e;var n="#sui-tree"+e,i="<input id='sui-advTreeFilter' placeholder='Filter this list' value='".concat(a||"","' \n\t\tstyle='width:90px;border:1px solid #999;border-radius:12px;font-size:11px;padding-left:6px'> &nbsp; \n\t\t<div class='sui-advEditBut' id='sui-advListMap-").concat(e,"' title='Tree view'>&#xe638</div> | \n\t\t<div class='sui-advEditBut' id='sui-advTreeMap-").concat(e,"' title='List view'>&#xe61f</div>");i+="<hr style='border: .5px solid #a4baec'>\n\t\t<div id='sui-tree".concat(e,"' class='sui-tree'></div>"),d()("#sui-advEdit-"+e).html(i.replace(/\t|\n|\r/g,"")),"places"==e?this.LazyLoad(n,null,e,13735):"features"==e?this.LazyLoad(n,null,e,20):"languages"==e?this.LazyLoad(n,null,e,301):this.GetTopRow(n,e),d()("#sui-advListMap-"+e).css({color:"#668eec"}),d()("[id^=sui-advTreeMap-]").off("click"),d()("#sui-advTreeMap-"+e).on("click",(function(){s.DrawFacetList(e,1,d()("#sui-advTreeFilter").val())})),d()("[id^=sui-advTreeFilter-]").off("click"),d()("#sui-advTreeFilter").on("keydown",(function(t){s.DrawFacetList(e,1,d()("#sui-advTreeFilter").val()),d()("#sui-advEditFilter-"+e).focus()})),d()(".sui-advViewTreePage").off("click"),d()(".sui-advViewTreePage").on("click",(function(e){var t=e.target.id.split("-");s.GetKmapFromID(t[1]+"-"+t[2],(function(e){sui.SendMessage("",e)})),e.stopPropagation()})),d()(n).css("max-height",d()("#l-site__wrap").height()-d()("#sui-advTerm-"+e).offset().top-d()("#sui-advTerm-"+e).height()-102+"px"),d()("#sui-advEdit-"+e).slideDown()}else d()("#sui-advEdit-"+e).slideUp()}},{key:"GetTopRow",value:function(e,t){var a,s,n=this,i=e.match(/sui-btree-/)?"b":"",r=[],l="<ul>";for(s in"terms"==t?(r.ka=1,r.kha=14263,r.ga=24465,r.nga=45101,r.ca=51638,r.cha=55178,r.ja=62496,r.nya=66477,r.ta=73101,r.tha=80697,r.da=87969,r.na=105631,r.pa=114065,r.pha=120048,r.ba=127869,r.ma=142667,r.tsa=154251,r.tsha=158451,r.dza=164453,r.wa=166888,r.zha=167094,r.za=172249,r["'a"]=177092,r.ya=178454,r.ra=185531,r.la=193509,r.sha=199252,r.sa=204036,r.ha=215681,r.a=219022):"subjects"==t&&(r.Administration=5550,r.Architecture=6669,r.Collections=2823,r["Community Services Project Types"]=5553,r.Contemplation=5806,r["Cultural Landscapes"]=8868,r["Cultural Regions"]=305,r.Event=2743,r.General=6793,r["Geographical Features"]=20,r.Grammars=5812,r["Higher Education Digital Tools"]=6404,r["Historical Periods"]=5807,r["Human Relationships"]=306,r["Language Tree"]=301,r["Literary Genres"]=5809,r["Material Objects"]=2693,r["Mesoamerican Studies"]=6664,r["Oral Genres"]=5808,r["Organizations and Organizational Units"]=2688,r.Politics=7174,r.Profession=6670,r["Religious Sects"]=302,r["Religious Systems"]=5810,r.Ritual=5805,r.Scripts=192,r["Teaching Resources"]=6844,r["Text Typologies"]=4833,r["Tibet and Himalayas"]=6403,r["Zoologies (Biological and Spiritual)"]=5813),r)l+="<li class='parent'><a id='"+i+(a=t+"-"+r[s])+"'",l+="' data-path='"+r[s]+"'>"+s,l+=this.pages.AddPop(a,!0),l+="</a></li>";d()(e).html(l+"</ul>"),d()(".sui-tree li > a").off(),d()(".sui-tree li > a").on("click",(function(t){!function(t,a){var s=d()(t.parent()).hasClass("parent")?20:0;if(a.offsetX<s)1==t.parent().children().length?n.LazyLoad(e,t,n.curTree):(t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast"));else if(a.clientX<200||n.showSearch)n.pages.relatedBase=n.pages.relatedId="","related"==n.ss.mode&&(n.ss.mode=n.ss.lastMode),sui.GetKmapFromID(n.curTree+"-"+a.target.id.split("-")[1],(function(e){sui.SendMessage("",e)}));else{var i=d()("#"+a.target.id).text();sui.AddNewFilter(i,n.curTree+"-"+a.target.id.split("-")[1],"AND",n.curTree)}}(d()(this),t)}))}},{key:"LazyLoad",value:function(e,t,a,s){var n,i=this,r=this.sui,l=this;if(s||1==t.parent().children().length){var c=e.match(/sui-btree-/)?"b":"";n=s?""+s:""+t.data().path,this.GetTreeChildren(a,n,(function(n){var o,u,p,m="",h="<ul>";for("terms"==a?n.facet_counts&&n.facet_counts.facet_fields&&n.facet_counts.facet_fields["ancestor_id_tib.alpha_path"]&&(m=n.facet_counts.facet_fields["ancestor_id_tib.alpha_path"].join()):n.facet_counts&&n.facet_counts.facet_fields&&n.facet_counts.facet_fields.ancestor_id_path&&(m=n.facet_counts.facet_fields.ancestor_id_path.join()),u=0;u<n.response.docs.length;++u)o=n.response.docs[u],p=new RegExp("/"+o.id.split("-")[1]),h+="<li",(m&&m.match(p)||s)&&(h+=" class='parent'"),h+="><a id='"+c+o.id,h+="terms"==a?"' data-path='"+o["ancestor_id_tib.alpha_path"]+"'>":"' data-path='"+o.ancestor_id_path+"'>",h+=o.header,h+=i.pages.AddPop(o.id,!0),h+="</a></li>";n.response.docs.length&&(s?d()(e).html(h+"</ul>"):(t.after(h+"</ul>"),t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast")),d()(".sui-tree li > a").off(),d()(".sui-tree li > a").on("click",(function(t){!function(t,a){var s=d()(t.parent()).hasClass("parent")?20:0;if(a.offsetX<s)1==t.parent().children().length?l.LazyLoad(e,t,l.curTree):(t.parent().toggleClass("active"),t.parent().children("ul").slideToggle("fast"));else if(a.clientX<200||l.showSearch)l.pages.relatedBase=l.pages.relatedId="","related"==l.ss.mode&&(l.ss.mode=l.ss.lastMode),r.GetKmapFromID(l.curTree+"-"+a.target.id.split("-")[1],(function(e){r.SendMessage("",e)}));else{var n=d()("#"+a.target.id).text();r.AddNewFilter(n,l.curTree+"-"+a.target.id.split("-")[1],"AND",l.curTree)}}(d()(this),t)}))),d()(".sui-advViewTreePage").off("click"),d()(".sui-advViewTreePage").on("click",(function(e){var t=e.target.id.split("-");i.GetKmapFromID(t[1]+"-"+t[2],(function(e){r.SendMessage("",e)})),e.stopPropagation()}))}))}}},{key:"GeoLocate",value:function(){sui.plc.Draw("","",[{lat:36.6251,lon:-118.085,lab:"Lhasa",ui:"subjects-6061"},{lat:37.6251,lon:-119.085,lab:"Lhasa2",ui:"subjects-6060"}])}},{key:"LoadingIcon",value:function(e,t){if(e){var a="<img src='img/loading.gif' width='"+t+"' ";a+="id='sui-loadingIcon' style='position:absolute;top:calc(50% - "+t/2+"px);left:calc(50% - "+t/2+"px);z-index:5000'>",d()("#l-site__wrap").append(a)}else d()("[id^=sui-loadingIcon]").remove()}},{key:"SendMessage",value:function(e,t){this.pages.Draw(t)}},{key:"Popup",value:function(e,t,a,s){var n="";d()("#sui-popupDiv").remove(),n+="<div id='sui-popupDiv' class='sui-gridPopup' style='left:"+a+"px;top:"+s+"px'>",n+=e+"</div>",d()("#l-site__wrap").append(n),d()("#sui-popupDiv").fadeIn(500).delay(t?1e3*t:3e3).fadeOut(500)}},{key:"ShortenString",value:function(e,t,a){return"object"==typeof e&&(e=e[0]),e&&e.length>t&&(e=a?e.substr(0,(t-3)/2)+"..."+e.slice((t-3)/-2):e.substr(0,t-3)+"..."),e}},{key:"GetCookie",value:function(e){var t,a,s=e+"=",n=decodeURIComponent(document.cookie).split(";");for(t=0;t<n.length;t++){for(a=n[t];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(s))return a.substring(s.length,a.length)}return""}},{key:"SetCookie",value:function(e,t){var a=new Date;a.setTime(a.getTime()+31536e6),a=a.toUTCString(),document.cookie="".concat(e,"=").concat(t,"; expires=").concat(a,";")}},{key:"log",value:function(e,t,a){t&&console.dir(t),a&&alert(e,t)}},{key:"alert",value:function(e,t){this.log(e,t,!1)}}]),e}(),m=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.app=null,this.kmap=null,this.extent=null,this.showing=!1,d()("<link/>",{rel:"stylesheet",type:"text/css",href:"https://js.arcgis.com/4.12/esri/themes/light/main.css"}).appendTo("head"),this.div=t.pages.div,this.content=["","...loading","...loading"],this.content2=["<br>","<br>"],this.popovers=null}return Object(n.a)(e,[{key:"Draw",value:function(e,t,a){var s=this.sui;this.popovers=a,d()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),this.kmap=e,this.DrawMetadata(t),s.LoadingIcon(!0,64);var n={container:"plc-main",map:null,baseMap:"hybrid",kml:null,mapView:null,sceneView:null,activeView:null,opt:76,bookmarks:null,legend:null,layers:null,basePick:null,sketch:null,center:[91.1721,29.6524],zoom:12,tilt:80,reqs:["esri/Map","esri/WebMap","esri/views/MapView","esri/views/SceneView","esri/Graphic","esri/layers/FeatureLayer","esri/layers/KMLLayer","esri/core/watchUtils","esri/geometry/Extent"],div:this.div};this.app=n,1&n.opt&&n.reqs.push("esri/widgets/ScaleBar"),2&n.opt&&n.reqs.push("esri/widgets/Search"),8&n.opt&&n.reqs.push("esri/widgets/BasemapGallery"),16&n.opt&&n.reqs.push("esri/widgets/LayerList"),32&n.opt&&n.reqs.push("esri/widgets/Legend"),64&n.opt&&(n.reqs.push("esri/widgets/Sketch"),n.reqs.push("esri/layers/GraphicsLayer")),128&n.opt&&n.reqs.push("esri/widgets/Bookmarks")}},{key:"GeoLocate",value:function(){var e="";this.extent=null;var t=this;try{for(var a=this.kmap.ancestors_txt.length-1;a>0;--a)e+=this.kmap.ancestors_txt[a]+"%20";1==this.kmap.ancestors_txt.length&&(e=this.kmap.ancestors_txt[0]);var s="//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?f=pjson&SingleLine="+e;d.a.ajax({url:s,dataType:"jsonp"}).done((function(e){t.extent=e.candidates[0].extent,t.extent.spatialReference=e.spatialReference.wkid,t.showing&&t.app.GoToExtent(t.extent)}))}catch(n){}}},{key:"DrawContent",value:function(){var e=this,t=this.sui,a="<div id='sui-topCon' style='margin-left:192px'>";this.kmap.caption&&(a+="<div style='margin:5px 0 13px 0' class='sui-sourceText'>"+this.kmap.caption+"</div>"),a+=t.pages.DrawTabMenu(["MAP","NAMES","LOCATION"]),a+="</div><div class='plc-main' id='plc-main' ></div>",d()(this.div).html(a.replace(/\t|\n|\r|/g,"")),d()("#plc-main").css("height",.667*d()("#sui-main").height()+"px"),d()("[id^=sui-tabTab]").on("click",(function(t){e.ShowTab(t.currentTarget.id.substring(10))}))}},{key:"DrawMetadata",value:function(e){var t=this,a=this.sui;if(this.popovers)return d()(this.div).html("<div class='plc-main' id='plc-main'></div>"),void d()("#plc-main").css({margin:0,width:"100%",height:d()("#sui-legacy").height()+"px"});this.GeoLocate(),this.DrawContent(),this.ShowTab(e||0),a.pages.DrawRelatedAssets(this.kmap),a.GetChildNamesFromID("places",this.kmap.id,(function(e){var a,s,n,i=[],r="<div style='display:inline-block;width:50%'><br>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>NAMES</div>";if(e&&e[0]&&e[0]._childDocuments_&&e[0]._childDocuments_.length){for(a=0;a<e[0]._childDocuments_.length;++a)s=e[0]._childDocuments_[a],(n={}).lab=s.related_names_header_s,n.lang=s.related_names_language_s,n.rel=s.related_names_relationship_s,n.write=s.related_names_writing_system_s,n.ety=s.related_names_etymology_s,n.path=s.related_names_path_s,n.tab=s.related_names_level_i-1,i.push(n);i.sort((function(e,t){return e.path>t.path?1:e.path<t.path?-1:0}))}for(a=0;a<i.length;++a)r+="<div style='margin-left:".concat(16*i[a].tab,"px'>"),a&&(r+="&bull; "),r+="<strong>".concat(i[a].lab," </strong>&nbsp; (").concat(i[a].lang,", ").concat(i[a].write,", ").concat(i[a].rel,")</div>");for(r+="<br></div><div style='display:inline-block;width:calc(50% - 24px);vertical-align:top;border-left:1px solid #ccc; padding-left:12px;margin-top:22px'>\n\t\t\t<div style='font-weight:bold;color:#6faaf1;margin-bottom:8px'>ETYMOLOGY</div>",a=0;a<i.length;++a)i[a].ety&&(r+="<div>Etymology for <strong>".concat(i[a].lab,"</strong>: &nbsp; ").concat(i[a].ety,"</div>"));r+="</div><br>",t.content[1]=r.replace(/\t|\n|\r|/g,"")})),a.GetRelatedFromID(this.kmap.uid,(function(e){e[0].illustration_external_url&&e[0].illustration_external_url?(d()("#sui-relatedImg").addClass("sui-relatedImg"),d()("#sui-relatedImg").prop("src",e[0].illustration_external_url[0])):e[0].illustration_mms_url&&e[0].illustration_mms_url[0]&&(d()("#sui-relatedImg").addClass("sui-relatedImg"),d()("#sui-relatedImg").prop("src",e[0].illustration_mms_url[0])),t.AddRelatedTabs(),t.AddRelatedPlaces(t.kmap,e,t.content2,0),t.AddRelatedSubjects(t.kmap,e)}))}},{key:"ShowTab",value:function(e){var t=this.sui,a=this;d()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),d()("#sui-tabContent").css({display:"block","background-color":"#eee"}),d()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),d()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),0==e?d()("#plc-main").slideDown():d()("#plc-main").slideUp(),e>2?d()("#sui-topCon").html(this.content[e]):d()("#sui-tabContent").html(this.content[e]),4==e&&(d()("#sui-tabContent").css({display:"block","background-color":"#eee"}),d()("#sui-tabTabB0").css({"background-color":"#eee",color:"#000"}),d()("#sui-tabTabB0").css({"background-color":"#eee",color:"#000"}),d()("#sui-tabContent").html(this.content2[0]),d()("[id^=sui-spLab-]").on("click",(function(e){return!1})),d()("[id^=sui-spDot-]").on("click",(function(e){var s=e.currentTarget.id.substring(10);"null"!=s&&t.pages.AddRelBranch(a.kmap.asset_type,s,d()(this)),d()(this).html("&ndash;"),d()(this).parent().find("ul").slideToggle()}))),d()("#sui-spLab-"+this.kmap.uid).css({"font-weight":"bold","text-decoration":"underline"})}},{key:"AddRelatedTabs",value:function(){var e=this,t=this.sui,a=this,s=function(e){var t,a="";for(t=0;t<e.length;++t)a+="<div class='sui-tabTab' id='sui-tabTabB".concat(t,"' style='width:calc(").concat(100/e.length,"% - 2px)'>").concat(e[t],"&nbsp;&#xe609</div>");return(a+="<div class='sui-tabContent' id='sui-tabContent'></div>").replace(/\t|\n|\r|/g,"")}(["PLACE CONTEXT","RELATED PLACES"]);this.content[4]=s.replace(/\t|\n|\r|/g,""),d()("[id^=sui-tabTabB]").on("click",(function(s){var n=s.currentTarget.id.substring(11);d()("[id^=sui-spDot-]").off("click"),d()("[id^=sui-spItem-]").off("click"),d()("[id^=sui-togCat-]").off("click"),d()("[id^=sui-spCatUL-]").off("click"),d()("[id^=sui-tabTabB]").css({"background-color":"#999",color:"#fff"}),d()("#sui-tabContent").css({display:"block","background-color":"#eee"}),d()("#sui-tabTabB"+n).css({"background-color":"#eee",color:"#000"}),d()("#sui-tabTabB"+n).css({"background-color":"#eee",color:"#000"}),d()("#sui-tabContent").html(e.content2[n]),d()("[id^=sui-spDot-]").on("click",(function(e){var s=d()(this).parent().find("ul")[0],n=e.currentTarget.id.substring(10);"null"!=n&&t.pages.AddRelBranch(a.kmap.asset_type,n,d()(this)),d()(this).html("none"==d()(s).css("display")?"&ndash;":"+"),d()(this).parent().find("ul").slideToggle()})),d()("[id^=sui-spLab-]").on("click",(function(e){return!1})),d()("[id^=sui-spItem-]").on("click",(function(e){return!1})),d()("[id^=sui-spCatUL-]").slideDown(),d()("[id^=sui-spCat-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==d()("#sui-spCatUL"+t).css("display")?d()("#sui-spCatUL"+t).slideDown():d()("#sui-spCatUL"+t).slideUp()})),d()("[id^=sui-spSub-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==d()("#sui-spSubUL"+t).css("display")?d()("#sui-spSubUL"+t).slideDown():d()("#sui-spSubUL"+t).slideUp()})),d()("#sui-togCatA").on("click",(function(){d()("[id^=sui-spCatUL-]").slideDown()})),d()("#sui-togCatN").on("click",(function(){d()("[id^=sui-spCatUL-]").slideUp()}))}))}},{key:"AddRelatedPlaces",value:function(e,t,a){var s=this.sui,n=0,i=0;t[0].ancestors&&t[0].ancestors.length>2&&(i=t[0].ancestors.length-2);var r="<br><div class='sui-spHead'>Places related to ".concat(e.title,"</div>\n\t\t<div style='max-width:900px'>\n\t\t<strong>").concat(e.title[0],"</strong> has <strong>").concat(i,"</strong> superordinate places and<strong> TBD </strong> immediately subordinate places. \n\t\tYou can browse these subordinate places as well as its superordinate categories with the tree below. \n\t\tSee the RELATED PLACES tab if you instead prefer to view only its immediately subordinate places grouped together in useful ways, \n\t\tas well as places non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>");if("subjects"!=e.asset_type){if(t[0].ancestors){for(n=0;n<t[0].ancestors.length-1;++n)r+="<ul style='list-style-type:none'>",r+=s.pages.AddRelTreeLine(t[0].ancestors[n+1],t[0].ancestor_uids_generic[n+1],"&ndash;",null);s.GetTreeChildren(e.asset_type,t[0].ancestor_id_path,(function(e){var n,i,l,c,o,d=[];try{d=e.facets.child_counts.buckets}catch(u){}for(e=e.response.docs,n=0;n<e.length;++n){for(o="",c=null,l=new RegExp(e[n].id.split("-")[1]),i=0;i<d.length;++i)d[i].val.match(l)&&(c="+",o=d[i].val);r+="<ul style='list-style-type:none'>",r+=s.pages.AddRelTreeLine(e[n].header,e[n].id,c,o)+"</li></ul>"}for(n=0;n<t[0].ancestors.length;++n)r+="</li></ul>";a[0]=r.replace(/\t|\n|\r/g,"")+"</ul><br>"})),this.AddRelatedContext(e,t,a)}}else a[0]=r.replace(/\t|\n|\r/g,"")+"</ul><br>"}},{key:"AddRelatedContext",value:function(e,t,a){var s,n,i=this.sui,r=[],l=0;for(n=0;n<t.length;++n)"related_places"==t[n].block_child_type&&"Earth"!=t[n].related_places_header_s&&(++l,r[t[n].related_places_relation_label_s]||(r[t[n].related_places_relation_label_s]=[]),r[t[n].related_places_relation_label_s].push({title:t[n].related_places_header_s,sub:t[n].related_places_feature_type_s,id:t[n].related_uid_s}));var c=Object.keys(r).sort((function(e,t){return e.length>t.length?-1:1}))[0],o="<br><div class='sui-spHead'>Places related to ".concat(e.title,"</div>\n\t\t\t<div style='max-width:900px'>\n\t\t\t<strong>").concat(e.title[0],"</strong> has <strong>","TBD","</strong> other place").concat(l>1?"s":""," directly related to it, which is presented here. \n\t\t\tSee the PLACE CONTEXT tab if you instead prefer to browse all subordinate and superordinate places for ").concat(e.title[0],".</div>\n\t\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>");for(s in o+=d(c)+"</div><div style='display:inline-block;width:50%;vertical-align:top'>",r)s!=c&&(o+=d(s));function d(t){var a="xxx";r[t]=r[t].sort((function(e,t){return e.sub<t.sub?-1:1}));var s="<div id='sui-spCat-".concat(t.replace(/ /g,"_"),"' \n\t\t\t\tclass='sui-spCat' style='background-color:").concat(i.assets[e.asset_type].c,"'> ").concat(e.title," ").concat(t,"</div>\n\t\t\t\t<ul id='sui-spCatUL-").concat(t.replace(/ /g,"_"),"'><ul>");for(n=0;n<r[t].length;++n)a!=r[t][n].sub&&(a=r[t][n].sub,s+="</ul><div class='sui-spSubCat'>",s+="<div style='background-color:#999' class='sui-spDot' id='sui-spSub-"+r[t][n].id+"'>&ndash;</div>",s+="<strong>"+a+"</strong></div>",s+="<ul id='sui-spSubUL-"+r[t][n].id+"' style='list-style-type:none'>"),s+="<li style='list-style-type:none'><a class='sui-noA' id='sui-spItem-"+r[t][n].id,s+="' href='#p="+r[t][n].id+"'>",s+=r[t][n].title+"</a>"+i.pages.AddPop(r[t][n].id)+"</li>";return s+"</ul></ul>"}o+="</div></div>",a[1]=o.replace(/\t|\n|\r/g,"")+"</ul><br>"}},{key:"AddRelatedSubjects",value:function(e,t){var a,s,n=this.sui,i=[],r="<div style='width:50%;vertical-align:top'>\n\t\t\t<div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>");if(e.feature_types_ss&&e.feature_types_ss.length){for(r+="<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\tFeature Types</div>\n\t\t\t<div style='margin-left:24px'>",a=0;a<e.feature_types_ss.length;++a)r+="<li>"+e.feature_types_idfacet[a].split("|")[0]+n.pages.AddPop(e.feature_types_idfacet[a].split("|")[1])+"</li>";r+="</div><br>"}for(a=0;a<t.length;++a)"related_subjects"==t[a].block_child_type&&(s=t[a].related_subjects_display_string_s,t[a].related_subjects_time_units_t&&t[a].related_subjects_time_units_t[0]&&(s+=" (".concat(t[a].related_subjects_time_units_t[0],")")),i.push({title:s,id:t[a].related_subjects_id_s}));if(i.length)for(r+="<div class='sui-spCat' style='background-color:#6faaf1'>\n\t\t\t\tRelated subjects</div>\n\t\t\t\t<div style='margin-left:24px'>",a=0;a<i.length;++a)r+="<li>"+i[a].title+n.pages.AddPop(i[a].id)+"</li>";r+="</div>",this.content[3]=r.replace(/\t|\n|\r|/g,"")}}]),e}(),h=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading","...loading"],this.inPlay=!1,this.curTransSeg=-1,this.transRes=null,this.scrollStart=0,this.handScroll=!1,this.mouseDown=!1,this.playEnd=0,this.kmap=null}return Object(n.a)(e,[{key:"DrawPlayer",value:function(e,t){var a,s,n=this,i=this.sui,r=(d()("#sui-av"),"");this.inPlay=!1;d()(this.div).width();this.kmap=e,"undefined"!=typeof window.kWidget&&window.kWidget.destroy("sui-kplayer");var l='<div id="av-player-row" class="row avplayer"><div id=\'sui-viewerSide\' class="av col">';t.field_video&&t.field_video.und?r=t.field_video.und[0].entryid:t.field_video&&t.field_video.en?r=t.field_video.en[0].entryid:t.field_audio&&t.field_audio.und?r=t.field_audio.und[0].entryid:t.field_audio&&t.field_audio.en&&(r=t.field_audio.en[0].entryid),l+="<div class='sui-vPlayer' id='sui-kplayer'>\n        <img src=\"https://cfvod.kaltura.com/p/".concat("381832","/sp/").concat("381832","00/thumbnail/entry_id/").concat(r,'/version/100301/width/560/height/0" fill-height"></div>'),l+="<div style='display:inline-block;width:300px;margin-left:16px'>\n                <div title='Published'>&#xe60c&nbsp;&nbsp;&nbsp;",t.field_year_published&&t.field_year_published.en?l+=i.pages.FormatDate(t.field_year_published.en[0].value):e.node_created&&(l+=i.pages.FormatDate(e.node_created,"short")),l+="</div>",l+="<div title='Duration'>&#xe61c&nbsp;&nbsp;&nbsp;".concat(e.duration_s,"</div>"),l+="<div title='Uploader'>&#xe673&nbsp;&nbsp;&nbsp;".concat(e.node_user_full_s,"</div>"),l+="</div><div style='display:inline-block;vertical-align:top;width:calc(100% - 320px)'>";try{if(e.collection_title){var c=i.pages.GetPublicUrlPath("audio-video")+"audio-video-collection/"+e.id;l+="&#xe633&nbsp;&nbsp;&nbsp;\n                <a title='Collection' id='sui-avCol' href='".concat(c,"'>").concat(e.collection_title,"</a>")}}catch(_){}try{for(var o=[],u=["Creator","Director","Producer"],p=0;p<e.creator.length;p++){var m=e.creator_role_ss&&e.creator_role_ss.length>p?e.creator_role_ss[p]:"none";u.includes(m)&&o.push(i.pages.WrapInLangSpan(e.creator[p],!0)+" ("+m+")")}0===o.length&&(o=e.creator),l+="<div title='Creators'>&#xe600&nbsp;&nbsp;&nbsp;"+o.join(", ")+"</div>"}catch(_){}l+="<div title='Visibility'>&#xe67c&nbsp;&nbsp;&nbsp;Public</div>";var h=e.summary?e.summary:e.caption?e.caption:"",v=i.pages.GetLangCode(h);if(v.length>0&&(v=" u-"+v),l+="</div><hr>\n        <p class='sui-sourceText".concat(v,"'>").concat(h,"</p>"),t.field_pbcore_description&&t.field_pbcore_description.und&&t.field_pbcore_description.und.length){l+="<div class='sui-avMore1'><a class='sui-avMore2'>\n            SHOW MORE</a></div>",l+="<div id='sui-avlang' style='display:none'>";var f="";for(a=0;a<t.field_pbcore_description.und.length;++a)try{if((s=t.field_pbcore_description.und[a]).field_description.und[0].value.length>0){var g=i.pages.WrapInLangSpan(s.field_description.und[0].value);f+="<strong>".concat(s.field_language.und[0].value.toUpperCase(),"</strong>\n                            ").concat(g)}}catch(_){}l+=f+"</div>",0==f.length&&(l=l.replace("class='sui-avMore2'","class='sui-avMore2 hidden'"))}l+="</div>",d()("#sui-av").html(l.replace(/\t|\n|\r/g,"")),d()("#sui-av").addClass("processed"),this.DrawTranscript(e,"#sui-trans"),l="//cdnapi.kaltura.com/p/".concat("381832","/sp/").concat("381832","00/embedIframeJs/uiconf_id/").concat("31832371","/partner_id/").concat("381832"),d.a.ajax({url:l,dataType:"script"}).done((function(e){window.kWidget.embed({targetId:"sui-kplayer",wid:"_381832",uiconf_id:"31832371",entry_id:r,flashvars:{autoPlay:!1},params:{wmode:"transparent"}}),window.kWidget.addReadyCallback((function(){var e=document.getElementById("sui-kplayer");"object"===typeof e&&"function"===typeof e.kBind&&(e.kBind("doPlay.__tests__",(function(){d()("#sui-transTab1").html("&#xe681"),n.inPlay=!0,n.PlayAV()})),e.kBind("doPause.__tests__",(function(){d()("#sui-transTab1").html("&#xe641"),n.inPlay=!1,n.playEnd=0,clearInterval(n.transTimer)})))}))})),i.LoadingIcon(!1),"undefined"!=typeof window.kWidget&&window.kWidget.embed({entry_id:r})}},{key:"DrawMetaNew",value:function(e,t){var a,s,n,i,r=this.sui,l="";try{e.title&&(l+="<p title='Title'><strong>TITLE</strong>&nbsp;&nbsp;"+e.title+"</p>")}catch(g){}try{e.collection_title&&(l+="<p title='Collection'><strong>COLLECTION</strong>&nbsp;&nbsp;"+e.collection_title+"</p>")}catch(g){}try{if(t.field_subcollection_new.und.length>0){for(l+="<p><strong>SUBCOLLECTION</strong>&nbsp;&nbsp;",a=0;a<t.field_subcollection_new.und.length;++a)l+=t.field_subcollection_new.und[a].header+r.pages.AddPop(t.field_subcollection_new.und[a].domain+"-"+t.field_subcollection_new.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(g){}try{if(t.field_subject.und.length>0){for(l+="<p><strong>SUBJECT</strong>&nbsp;&nbsp;",a=0;a<t.field_subject.und.length;++a)l+=t.field_subject.und[a].header+r.pages.AddPop(t.field_subject.und[a].domain+"-"+t.field_subject.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(g){}try{if(t.field_location.und.length>0){for(l+="<p><strong>REFERENCED PLACES</strong>&nbsp;&nbsp;",a=0;a<t.field_location.und.length;++a)l+=t.field_location.und[a].header+r.pages.AddPop(t.field_location.und[a].domain+"-"+t.field_location.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(g){}try{l+="<p><strong>RECORDING LOCATION</strong>&nbsp;&nbsp;"+t.field_recording_location_new.und[0].header+r.pages.AddPop(t.field_recording_location_new.und[0].domain+"-"+t.field_recording_location_new.und[0].id)+"</p>"}catch(g){}try{l+="<p><strong>LANGUAGE</strong>&nbsp;&nbsp;"+t.field_language_kmap.und[0].header+r.pages.AddPop(t.field_language_kmap.und[0].domain+"-"+t.field_language_kmap.und[0].id)+"</p>"}catch(g){}try{if(t.field_kmap_terms.und.length>0){for(l+="<p><strong>TERMS</strong>&nbsp;&nbsp;",a=0;a<t.field_kmap_terms.und.length;++a)l+=t.field_kmap_terms.und[a].header+r.pages.AddPop(t.field_kmap_terms.und[a].domain+"-"+t.field_kmap_terms.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(g){}try{l+="<p><strong>COPYRIGHT OWNER</strong>&nbsp;&nbsp;"+t.field_copyright_owner.en[0].value+"</p>"}catch(g){}try{l+="<p><strong>YEAR PUBLISHED</strong>&nbsp;&nbsp;"+t.field_year_published.en[0].value+"</p>"}catch(g){}try{l+="<p><strong>RIGHTS SUMMARY</strong>&nbsp;&nbsp;"+t.field_pbcore_rights_summary.en[0].value+"</p>"}catch(g){}try{l+="<p><strong>UPLOADED</strong>&nbsp;&nbsp;"+e.timestamp.substr(0,10)+" by "+e.node_user_full_s+"</p>"}catch(g){}if(t.field_pbcore_creator&&t.field_pbcore_creator.und&&t.field_pbcore_creator.und.length)try{var c,o={},d="";for(a=0;a<t.field_pbcore_creator.und.length;++a)c=(s=t.field_pbcore_creator.und[a]).field_creator_role.und[0].value.toLowerCase(),d=r.pages.WrapInLangSpan(s.field_creator.und[0].value),c in o?o[c].push(d):o[c]=[d];for(c in o){var u=o[c].length>1?c+"s":c;l+="<p><strong>".concat(u.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(o[c].join(", "),"</p>")}}catch(g){console.error(g)}if(t.field_pbcore_contributor&&t.field_pbcore_contributor.und&&t.field_pbcore_contributor.und.length)try{var p,m,h={},v="";for(a=0;a<t.field_pbcore_contributor.und.length;++a)m=(p=(s=t.field_pbcore_contributor.und[a]).field_contributor_role.und[0].value.toLowerCase()).indexOf("assistant")>-1?"":"CONTRIBUTING",v=r.pages.WrapInLangSpan(s.field_contributor.und[0].value),p in h?h[p].push(v):h[p]=[v];for(p in h){var f=h[p].length>1?p+"s":p;l+="<p><strong>".concat(m," ").concat(f.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(h[p].join(", "),"</p>")}}catch(g){}try{l+="<p><strong>PUBLISHER</strong>&nbsp;&nbsp;"+t.field_pbcore_publisher.und[0].field_publisher.und[0].value+"</p>"}catch(g){}try{l+="<p><strong>DATA ENTRY</strong>&nbsp;&nbsp;"+e.node_user_full_s+"</p>"}catch(g){}if(t.field_pbcore_instantiation&&t.field_pbcore_instantiation.und&&t.field_pbcore_instantiation.und.length)for(a in t.field_pbcore_instantiation.und[0]){i=t.field_pbcore_instantiation.und[0][a],n=a.replace(/field_/,"").replace(/_/g," ");try{l+="<p><strong>".concat(n.toUpperCase(),"</strong>&nbsp;&nbsp;<span>").concat(i.und[0].value.replace(/(<([^>]+)>)/gi,""),"</span></p>")}catch(g){}}try{l+="<p><strong>FORMAT ID</strong>&nbsp;&nbsp;"+t.field_video.und[0].entryid+"</p>"}catch(g){}return"<div>"+(l+="<p><strong>FORMAT ID SOURCE</strong>&nbsp;&nbsp;(Kaltura.com)</p>")+"</div>"}},{key:"Draw",value:function(e){}},{key:"DrawMetaData",value:function(e,t){var a,s,n,i,r=this.sui,l="";try{e.title&&(l+="<p title='Title'><strong>TITLE</strong>&nbsp;&nbsp;"+e.title+"</p>")}catch(c){}try{e.collection_title&&(l+="<p title='Collection'><strong>COLLECTION</strong>&nbsp;&nbsp;"+e.collection_title+"</p>")}catch(c){}try{if(t.field_subcollection_new.und.length>0){for(l+="<p><strong>SUBCOLLECTION</strong>&nbsp;&nbsp;",a=0;a<t.field_subcollection_new.und.length;++a)l+=t.field_subcollection_new.und[a].header+r.pages.AddPop(t.field_subcollection_new.und[a].domain+"-"+t.field_subcollection_new.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}}catch(c){}try{for(l+="<p><strong>SUBJECT</strong>&nbsp;&nbsp;",a=0;a<t.field_subject.und.length;++a)l+=t.field_subject.und[a].header+r.pages.AddPop(t.field_subject.und[a].domain+"-"+t.field_subject.und[a].id)+"&nbsp;&nbsp; ";l+="</p>"}catch(c){}try{l+="<p><strong>RECORDING LOCATION</strong>&nbsp;&nbsp;"+t.field_recording_location_new.und[0].header+r.pages.AddPop(t.field_recording_location_new.und[0].domain+"-"+t.field_recording_location_new.und[0].id)+"</p>"}catch(c){}try{l+="<p'><strong>LANGUAGE</strong>&nbsp;&nbsp;"+t.field_language_kmap.und[0].header+r.pages.AddPop(t.field_language_kmap.und[0].domain+"-"+t.field_language_kmap.und[0].id)+"</p>"}catch(c){}try{l+="<p><strong>TERMS</strong>&nbsp;&nbsp;"+t.field_terms.und[0].header+"</p>"}catch(c){}try{l+="<p><strong>COPYRIGHT OWNER</strong>&nbsp;&nbsp;"+t.field_copyright_owner.en[0].value+"</p>"}catch(c){}try{l+="<p><strong>YEAR PUBLISHED</strong>&nbsp;&nbsp;"+t.field_year_published.en[0].value+"</p>"}catch(c){}try{l+="<p><strong>RIGHTS SUMMARY</strong>&nbsp;&nbsp;"+t.field_pbcore_rights_summary.en[0].value+"</p>"}catch(c){}try{l+="<p><strong>UPLOADED</strong>&nbsp;&nbsp;"+e.timestamp.substr(0,10)+" by "+e.node_user_full_s+"</p>"}catch(c){}if(this.content[0]="<div style='height:2px'/>"+l+"<br>",l="",t.field_pbcore_creator&&t.field_pbcore_creator.und&&t.field_pbcore_creator.und.length)for(a=0;a<t.field_pbcore_creator.und.length;++a){i=t.field_pbcore_creator.und[a];try{l+="<p><strong>".concat(i.field_creator_role.und[0].value.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(r.pages.WrapInLangSpan(i.field_creator.und[0].value),"</p>")}catch(c){}}if(t.field_pbcore_contributor&&t.field_pbcore_contributor.und&&t.field_pbcore_contributor.und.length)for(a=0;a<t.field_pbcore_contributor.und.length;++a){i=t.field_pbcore_contributor.und[a];try{l+="<p><strong>CONTRIBUTING ".concat(i.field_contributor_role.und[0].value.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(i.field_contributor.und[0].value,"</p>")}catch(c){}}try{l+="<p><strong>PUBLISHER</strong>&nbsp;&nbsp;"+t.field_pbcore_publisher.und[0].field_publisher.und[0].value+"</p>"}catch(c){}try{l+="<p><strong>DATA ENTRY</strong>&nbsp;&nbsp;"+e.node_user_full_s+"</p>"}catch(c){}if(this.content[1]="<div style='height:2px'/>"+l+"<br>",l="",t.field_pbcore_instantiation&&t.field_pbcore_instantiation.und&&t.field_pbcore_instantiation.und.length)for(a in t.field_pbcore_instantiation.und[0]){n=t.field_pbcore_instantiation.und[0][a],s=a.replace(/field_/,"").replace(/_/g," ");try{l+="<p><strong>".concat(s.toUpperCase(),"</strong>&nbsp;&nbsp;").concat(n.und[0].value,"</p>")}catch(c){}}try{l+="<p><strong>FORMAT ID</strong>&nbsp;&nbsp;"+t.field_video.und[0].entryid+"</p>"}catch(c){}l+="<p><strong>FORMAT ID SOURCE</strong>&nbsp;&nbsp;(Kaltura.com)</p>",this.content[2]="<div style='height:2px'/>"+l+"<br>"}},{key:"DrawTranscript",value:function(e,t){var a,s,n,i=this,r={};if(e.trid_i){this.curTransSeg=-1,r.ts_content_rus="Russian",r.content_bod="Tibetan",r.dzo_bod="Dzongkha",r.ts_content_sgt="Brokpake",r.ts_content_kjz="Bumthangkha",r.ts_content_tgf="Chalikha",r.ts_content_cgk="Chocangacakha",r.ts_content_dka="Dakpakha",r.ts_content_dzl="Dzalakha",r.ts_content_goe="Gongduk",r.ts_content_xkz="Kurtop",r.ts_content_kru="Kuruz",r.ts_content_lkh="Lakha",r.ts_content_lya="Layakha",r.ts_content_lep="Lepcha",r.ts_content_lhp="Lhokpu",r.ts_content_luk="Lunanakha",r.ts_content_npb="Nupbikha",r.ts_content_neh="Mangdekha",r.ts_content_ole="Olekha",r.ts_content_tsj="Tshangla",r.ts_content_xkf="Khengkha",r.ts_content_wylie="Wylie",r.ts_content_gyal="Gyalsumdo",r.ts_content_gvr="Gurung",r.ts_content_npa="Nar Phu",r.ts_content_nmm="Manange",r.ts_content_kte="Nubri",r.ts_content_tsum="Tsum",r.ts_content_nep="Nepali",r.ts_content_eng="English",r.ts_content_zho="Chinese",r.ts_content_und="Unknown",r.ts_content_gloss="Morpheme glossing";var l={languages:{},speakers:{},segs:[],layout:"Normal",rev:0,speaker:""},c="https://ss251856-us-east-1-aws.measuredsearch.com/solr/av_test/select?indent=on&q=is_trid:"+e.trid_i+"&wt=json&start=0&rows=1000";d.a.ajax({url:c,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){for(e.response.docs.sort((function(e,t){return e.fts_start>t.fts_start?1:-1})),a=0;a<e.response.docs.length;++a){for(var t in s=e.response.docs[a],n={start:s.fts_start,end:s.fts_end,dur:s.fts_duration},s.ss_speaker_bod&&(l.speakers[s.ss_speaker_bod]=1,n.speaker=s.ss_speaker_bod),n.lang=s.ss_language?s.ss_language:"",r)s[t]&&(n[r[t]]=s[t],l.languages[r[t]]=1);l.segs.push(n)}l.segs.length&&(i.transRes=l,d()(i.div).width()>700&&d()("#sui-viewerSide").width(.5*d()(i.div).width()),0===d()("#av-trscrpt-wrapper").length&&i.DrawTranscriptMenu(),i.DrawTransContent())}))}}},{key:"DrawTranscriptMenu",value:function(){var e=this,t=this.transRes,a=navigator.userAgent.includes("Chrome")?"chrome":navigator.userAgent.includes("Firefox")?"firefox":"safari",s="<div id='av-trscrpt-wrapper' class='col'>\n            <div class='av-trscrpt-ctrls row'>\n                <div id='sui-transTab0' class='sui-transTab col' title='Options'>&#xe66f&#xe609</div>\n                <div id='sui-transTab1' class='sui-transTab col' title='Play/Pause'>&#xe641</div>\n                <div id='sui-transTab2' class='sui-transTab col' title='Previous line'>&#xe602</div>\n                <div id='sui-transTab3' class='sui-transTab col' title='Same line'>&#xe632</div>\n                <div id='sui-transTab4' class='sui-transTab col' title='Next line'>&#xe604</div>\n                <div id='sui-transTab5' class='sui-transTab col' style='border:none' title='Search transcript'>&#xe623</div>\n                <div id='sui-transSrc' class='sui-transSrc'>\n                    <div class=\"transSrcWrap ".concat(a,"\">\n                        <div class=\"navigator\">\n                            <div class=\"navwrapper\" style=\"display: none;\">\n                                <div id='sui-transSrcB' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe640</div>\n                                <div id='sui-transSrcN' style='display:inline-block;color:#fff;margin:0 16px;font-size:12px;cursor:pointer;vertical-align:4px'>0 of 0</div>\n                                <div id='sui-transSrcF' style='display:inline-block;color:#fff;font-size:20px;cursor:pointer' title='Previous result'>&#xe641</div>\n                            </div>\n                        </div>\n                        <div id='sui-transSrcGo' class='sui-search4'>\n                            <input type='text' id='sui-transSrcInp' class='sui-search2' size='40' placeholder='Search this transcript'/>\n                            <span class=\"icon shanticon-magnify search\"></span>\n                            <span class=\"icon shanticon-cancel clear\" style=\"display: none;\"></span>\n                            <button class=\"search\"><span class=\"icon shanticon-angle-right\"></span></button>\n                        </div>\n                        \x3c!--\n                        <div id='sui-transSrcGo' class='sui-search4'>&#xe623</div> &lt;!&ndash; style='float:right;margin:12px 16px 0 0' &ndash;&gt;\n                            <div class='sui-search1'> &lt;!&ndash; style='float:right;margin-top:12px' &ndash;&gt;\n                                <input type='text' id='sui-transSrcInp' class='sui-search2' placeholder='Search this transcript'>\n                                <div id='sui-clear' class='sui-search3'>&#xe610</div>\n                            </div>\n                        </div>--\x3e\n                    </div>\n                <div id='sui-transOps' class='sui-transOps'></div>\n            </div>\n            <div id='sui-trans' class='sui-trans row'></div>\n\t\t</div>");d()("#av-player-row").append(s.replace(/\t|\n|\r/g,""));var n=0,i=[];function r(e){var t=window.sui;"undefined"==typeof e&&(e=t.av.transhits),d()(".srchit").each((function(){var e=d()(this).text();d()(this).replaceWith(e)})),e.map((function(e){var t=d()("#sui-transBox-"+e+" span").html(),a=d()("#sui-transSrcInp").val();t=t.replace(new RegExp(a,"g"),'<span class="srchit">'.concat(a,"</span>")),d()("#sui-transBox-"+e+" span").html(t)}));var a=e.length?n+1:0;e.length>0&&d()(".transSrcWrap .navwrapper").show(),d()("#sui-transSrcN").html(a+" of "+e.length),e.length&&(t.av.curTransSeg=e[n],t.av.HighlightSeg(t.av.curTransSeg,void 0))}for(var l in d()("#sui-transSrcGo button.search").on("click",(function(){var e,a,s;if(i=[],n=0,d()("#sui-transSrcInp").val()){for(a=RegExp(d()("#sui-transSrcInp").val(),"i"),e=0;e<t.segs.length;++e)for(s in t.languages)t.segs[e][s]&&t.segs[e][s].match(a)&&i.push(e);window.sui.av.transhits=i}r(i),d()("#sui-transSrcGo .icon.clear").show()})),d()("#sui-transSrcInp").on("change",(function(){d()("#sui-transSrcGo button.search").trigger("click")})),d()("#sui-transSrcB").on("click",(function(){n=n>0?Math.max(0,n-1):i.length-1,r()})),d()("#sui-transSrcF").on("click",(function(){n=n<i.length-1?Math.min(i.length-1,n+1):0,r()})),d()("div#sui-transSrcGo .icon.clear").on("click",(function(){d()(".srchit").each((function(){var e=d()(this).text();d()(this).replaceWith(e)})),d()("#sui-transSrcInp").val(""),d()("div#sui-transSrcGo .icon.clear, .transSrcWrap .navwrapper").hide()})),s="<div class='sui-transRow'>Transcript options<span class='sui-transCheck trans-opts-close'>&#xe60f</span></div>\n\t\t<div class='sui-transLab'>LANGUAGES</div>",t.languages)s+="<div class='sui-transRow' id='sui-transLan-"+l+"'>- "+l+"<span id='sui-transLang-"+l+"' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>";s+="<div class='sui-transLab'>SPEAKERS</div>\n\t\t<div class='sui-transRow'>- Tibetan<span id='sui-transS1' class='sui-transCheck' style='color:#58aab4'>&#xe60e</span></div>\t\n\t\t<div class='sui-transLab'>LAYOUTS</div>\n\t\t<div class='sui-transRow' id='sui-transMinR'>- Minimal<span id='sui-transMin' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transRow' id='sui-transRevR'>- Reversed<span id='sui-transRev' class='sui-transCheck'>&#xe60e</span></div>\n\t\t<div class='sui-transLab'>DOWNLOADS</div>\n\t\t<div class='sui-transRow' id='sui-transStr'->- SRT file<span class='sui-transCheck' style='color:#58aab4'>&#xe616</span></div>",d()("#sui-transOps").html(s.replace(/\t|\n|\r/g,"")),d()("#sui-transStr").on("click",(function(){e.SaveStrFile()})),d()("[id^=sui-transLan-]").on("click",(function(t){var a=e.transRes,s=t.currentTarget.id.substring(13);a.languages[s]=1-a.languages[s],d()("#sui-transLang-"+s).css("color",a.languages[s]?"#58aab4":"#ccc"),e.transRes=a,e.DrawTransContent()})),d()("#sui-transMinR").on("click",(function(){var t=e.transRes;t.layout="Minimal"==t.layout?"Normal":"Minimal",d()("#sui-transMin").css("color","Minimal"==t.layout?"#58aab4":"#ccc"),e.transRes=t,e.DrawTransContent()})),d()("#sui-transRevR").on("click",(function(){var t=e.transRes;t.rev=t.rev?0:1,d()("#sui-transRev").css("color",t.rev?"#58aab4":"#ccc"),e.transRes=t,e.DrawTransContent()})),d()("#sui-transTab0").on("click",(function(){d()("#sui-transOps").slideToggle("fast")})),d()(".sui-transCheck.trans-opts-close").on("click",(function(){d()("#sui-transOps").slideToggle("fast")})),d()("#sui-transTab5").on("click",(function(){d()("#sui-transSrc").slideToggle("fast"),d()("#av-trscrpt-wrapper #sui-trans").hasClass("searchshown")?d()("#av-trscrpt-wrapper #sui-trans").removeClass("searchshown"):d()("#av-trscrpt-wrapper #sui-trans").addClass("searchshown")})),d()("#sui-transTab1").on("click",(function(t){t.preventDefault(),clearInterval(e.transTimer),e.inPlay?d()("#sui-kplayer")[0].sendNotification("doPause"):(e.PlayAV(),d()("#sui-kplayer")[0].sendNotification("doPlay"))})),d()("#sui-transTab2").on("click",(function(t){t.preventDefault();var a=e.transRes;e.curTransSeg=Math.max(e.curTransSeg-1,0),e.PlayAV(a.segs[e.curTransSeg].start,a.segs[e.curTransSeg].end),d()("#sui-kplayer")[0].sendNotification("doPlay")})),d()("#sui-transTab3").on("click",(function(a){a.preventDefault(),e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),d()("#sui-kplayer")[0].sendNotification("doPlay")})),d()("#sui-transTab4").on("click",(function(a){a.preventDefault(),e.curTransSeg=Math.min(e.curTransSeg+1,t.segs.length-1),e.PlayAV(t.segs[e.curTransSeg].start,t.segs[e.curTransSeg].end),d()("#sui-kplayer")[0].sendNotification("doPlay")}))}},{key:"SaveStrFile",value:function(){var e,t,a,s=this.transRes,n="";for(t=0;t<s.segs.length;++t){for(e in a=s.segs[t],n+="".concat(t+1,"\n").concat(a.start,",000 --\x3e ").concat(a.end,",000\n").concat(a.speaker?">> "+a.speaker+"\n":""),s.languages)s.segs[t][e]&&s.languages[e]&&(n+=s.segs[t][e]+"\n");n+="\n"}var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),i.setAttribute("download","transcript-"+this.kmap.id+".str"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},{key:"DrawTransContent",value:function(){var e,t,a=this,s="",n=this,i=this.transRes;if("Minimal"==i.layout)for(e=0;e<i.segs.length;++e){for(t in s+="<div class='sui-transMinSeg' id='sui-transMinSeg-".concat(e,"'>\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t<div style='float:").concat(i.rev?"right":"left",";font-size:18px;'>\n\t\t\t\t").concat(i.segs[e].speaker?i.segs[e].speaker+"<br>":"","\n\t\t\t\t<div class='sui-transMinPlay' id='sui-transPlay-").concat(e,"' title='Play line ").concat(this.SecondsToTimecode(i.segs[e].start),"'>&#xe680</div> \n\t\t\t\t</div>\n\t\t\t\t<div class='sui-transMinBox' id='sui-transMinBox-").concat(e,"'\n\t\t\t\tstyle='margin:").concat(i.rev?"0 150px 0 0":"0  0 0 150px","'>"),i.languages)i.segs[e][t]&&i.languages[t]&&(s+=i.segs[e][t]+"<hr style='margin:0;border-top:1px dashed #eee'>");s+="</div></div>"}else for(e=0;e<i.segs.length;++e){for(t in s+="<div class='sui-transSeg' id='sui-transSeg-".concat(e,"'>\n\t\t\t\t<div style='float:").concat(i.rev?"right":"left",";font-size:18px;'>\n\t\t\t\t").concat(i.segs[e].speaker?i.segs[e].speaker+"<br>":"","\n\t\t\t\t<div class='sui-transPlay' id='sui-transPlay-").concat(e,"' \n\t\t\t\ttitle='Play line'>&#xe680\n\t\t\t\t<span style='margin-left:24px;font-size:12px;vertical-align:4px'>\n\t\t\t\t").concat(this.SecondsToTimecode(i.segs[e].start),"</span></div></div> \n\t\t\t\t<div class='sui-transBox' id='sui-transBox-").concat(e,"'\n\t\t\t\tstyle='margin:").concat(i.rev?"0 150px 0 0":"0  0 0 150px","'>"),i.languages)i.segs[e][t]&&i.languages[t]&&(s+=sui.pages.WrapInLangSpan(i.segs[e][t])+"<hr style='margin:0;border-top:1px dashed #eee'>");s+="</div></div>"}d()("#sui-trans").html(s.replace(/\t|\n|\r/g,"")),d()("#sui-trans").on("mousedown",(function(){a.mouseDown=!0})),d()("#sui-trans").on("mouseup",(function(){a.mouseDown=!1})),d()("#sui-trans").on("scroll",(function(){n.handScroll=!0,n.mouseDown||(clearTimeout(d.a.data(this,"scrollTimer")),d.a.data(this,"scrollTimer",setTimeout((function(){n.handScroll=!1}),250)))})),d()("[id^=sui-transPlay-]").on("click",(function(e){a.curTransSeg=e.currentTarget.id.substring(14),a.PlayAV(i.segs[a.curTransSeg].start,i.segs[a.curTransSeg].end),d()("#sui-kplayer")[0].sendNotification("doPlay")}))}},{key:"PlayAV",value:function(e,t){var a,s=this,n=this.transRes;clearInterval(this.transTimer),this.scrollStart=d()("#sui-trans").scrollTop(),void 0!=e&&d()("#sui-kplayer")[0].sendNotification("doSeek",e),t&&(this.playEnd=t),this.transTimer=setInterval((function(t){if("function"===typeof d()("#sui-kplayer")[0].evaluate){var i=d()("#sui-kplayer")[0].evaluate("{video.player.currentTime}");if(s.playEnd&&i>=s.playEnd)return clearInterval(s.transTimer),d()("#sui-kplayer")[0].sendNotification("doPause"),void(s.playEnd=0);for(a=0;a<n.segs.length;++a)if(i>=n.segs[a].start&&i<n.segs[a].end){s.curTransSeg=a;break}s.curTransSeg>0&&s.HighlightSeg(s.curTransSeg,e)}}),100)}},{key:"HighlightSeg",value:function(e,t){var a=d()("#sui-trans".concat("Minimal"==this.transRes.layout?"Min":"","Seg-").concat(e)).position().top-d()("#sui-trans".concat("Minimal"==this.transRes.layout?"Min":"","Seg-0")).position().top;void 0==t&&d()("#sui-trans").scrollTop(a),d()("[id^=sui-transSeg-]").css("background-color","#ddd"),d()("[id^=sui-transMinSeg-]").css("border-color","#fff"),d()("[id^=sui-transMinSeg-]").css("background-color","#fff"),d()("#sui-transMinSeg-"+e).css("border-color","#999"),d()("#sui-transMinSeg-"+e).css("background-color","#eee"),d()("#sui-transSeg-"+e).css("background-color","#aaa")}},{key:"TimecodeToSeconds",value:function(e){var t=0,a=0,s=(""+e).split(":"),n=s[0];return 2==s.length?(n=s[1],a=s[0]):3==s.length&&(n=s[2],a=s[1],t=s[0]),Number(3600*t)+Number(60*a)+Number(n)}},{key:"SecondsToTimecode",value:function(e){var t,a="";return(t=Math.floor(e/3600))&&(a+=t+":"),(t=Math.floor(e/60))<10&&(a+="0"),a+=t+":",(t=Math.floor(e%60))<10&&(a+="0"),a+=t}}]),e}(),v=function(){function e(t){Object(s.a)(this,e),this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading"],this.content2=["<br>","<br>"],this.kmap=null,this.relatedPlaceData=null,this.relatedSubjectData=null}return Object(n.a)(e,[{key:"Draw",value:function(e,t){console.error("subjects.Draw() called "),console.dir(arguments);var a=this.sui;this.kmap=e,d()("#sui-legacy").css({"padding-left":"12px",width:"calc(100% - 24px"}),this.GetSubjectData(e),this.DrawContent(e,t),a.pages.DrawRelatedAssets(e)}},{key:"DrawContent",value:function(e,t){var a=this,s=this.sui,n="<div class='sui-subjects' id='sui-subConDiv'>\n\t\t<div><span class='sui-subIcon'>".concat(s.assets[e.asset_type].g,"</span>\n\t\t<span class='sui-subText'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(s.assets[e.asset_type].c,"'>");e.caption&&(n+="<p id='sui-spCap'>"+e.caption+"</p></div>"),1==t?n="<div style='margin-left:192px'>"+s.pages.DrawTabMenu(["SUBJECT CONTEXT","RELATED SUBJECTS"]):2==t&&(n="<div id='sui-topCon' style='margin-left:216px'>"+this.GetPlaceData(e)),d()(this.div).html(n+"</div>".replace(/\t|\n|\r/g,"")),d()("[id^=sui-tabTab]").on("click",(function(e){var t=e.currentTarget.id.substring(10);a.ShowTab(t)}))}},{key:"ShowTab",value:function(e){var t=this;d()("[id^=sui-spLab-]").off("click"),d()("[id^=sui-spDot-]").off("click"),d()("[id^=sui-spItem-]").off("click"),d()("[id^=sui-togCat-]").off("click"),d()("[id^=sui-spCatUL-]").off("click"),d()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),d()("#sui-tabContent").css({display:"block","background-color":"#eee"}),d()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),d()("#sui-tabContent").html(this.content[e]),0==e?(d()("#sui-spLab-"+this.kmap.uid).css({"font-weight":"bold","text-decoration":"underline"}),d()("[id^=sui-spLab-]").on("click",(function(e){return!1})),d()("[id^=sui-spDot-]").on("click",(function(e){var a=e.currentTarget.id.substring(10);"null"!=a&&sui.pages.AddRelBranch(t.kmap.asset_type,a,d()(this)),d()(this).html("&ndash;"),d()(this).parent().find("ul").slideToggle()}))):1==e&&(d()("[id^=sui-spItem-]").on("click",(function(e){return!1})),d()("[id^=sui-spCatUL-]").slideDown(),d()("[id^=sui-spCat-]").on("click",(function(e){var t=e.currentTarget.id.substring(9);"none"==d()("#sui-spCatUL"+t).css("display")?d()("#sui-spCatUL"+t).slideDown():d()("#sui-spCatUL"+t).slideUp()})),d()("#sui-togCatA").on("click",(function(){d()("[id^=sui-spCatUL-]").slideDown()})),d()("#sui-togCatN").on("click",(function(){d()("[id^=sui-spCatUL-]").slideUp()})))}},{key:"GetPlaceData",value:function(e){var t=this;return sui.GetRelatedPlaces(e.uid,(function(e){t.relatedPlaceData=e,t.DrawRelatedPlaces("tree",1)})),"Loading..."}},{key:"DrawRelatedPlaces",value:function(e,t){var a,s,n,i=this,r=[],l=this.relatedPlaceData,c=this.kmap,o="<br><div class='sui-spHead'>Places related to ".concat(c.title,"</div>\n\t\t<p style='color:#666'>\n\t\t<input id='sui-rpSearch' placeholder='&nbsp;Search places' \n\t\tstyle='width:100px;border:1px solid #999;border-radius:12px;padding-left:8px'> &nbsp;\n\t\t<span class='sui-advEditBut' style='color:").concat("tree"==e?"#668eec":"#666","' \n\t\tid='sui-rpTree' title='Tree view'>&#xe638</span> | \n\t\t<span class='sui-advEditBut' style='color:").concat("tree"!=e?"#668eec":"#666","'\n\t\tid='sui-rpList' title='List view'>&#xe61f</span>");if("tree"!=e){for(s=d()("#sui-footer").offset().top-d()("#sui-legacy").offset().top-150,o+=" | <span class='sui-advEditBut' id='sui-rpSort' title='Sort'>\n\t\t\t".concat(1==t?"&#xe653":"&#xe652","</span>\t\t\n\t\t\t</p><div class='sui-rpList' style='height:").concat(s,"px'>"),l=l.sort((function(e,a){return e.title<a.title?-t:t})),a=0;a<l.length;++a)o+="<div id='sui-rpLine-".concat(a,"' style='width:300px' title='").concat(l[a].ancestors_txt.join("/"),"'>").concat(l[a].title,"</div>");return d()("#sui-topCon").html(o+"</div>"),d()("#sui-rpTree").on("click",(function(){i.DrawRelatedPlaces("tree",t)})),d()("#sui-rpSort").on("click",(function(){i.DrawRelatedPlaces("list",-1*t)})),void d()("#sui-rpSearch").on("keydown",(function(e){var t,s=d()("#sui-rpSearch").val();for(e.keyCode>31&&e.keyCode<91&&(s+=e.key),8==e.keyCode&&s.length&&(s=s.slice(0,-1)),s=RegExp(s,"i"),a=0;a<l.length;++a)(t=d()("#sui-rpLine-"+a)).text().match(s)?t.css("display","block"):t.css("display","none")}))}o+=" | <span class='sui-advEditBut' style='vertical-align:0' \n\t\tid='sui-togCatA' title='Expand all'<strong>&#x2295</strong></span> | \n\t\t<span class='sui-advEditBut' style='vertical-align:0'\n\t\tid='sui-togCatN' title='Collapse all'><strong>&#x2296</strong></span> \n\t\t</p><div style='width:100%'><div style='display:inline-block'>\n\t\t<ul style='list-style-type:none;margin-left:-24px'>";var u=l.length;for(a=0;a<u;++a)for(n="places-",s=0;s<l[a].ancestor_ids_is.length;++s)n+=l[a].ancestor_ids_is[s]+"-",r.push({lab:l[a].ancestors_txt[s],level:s,id:n.slice(0,-1),uid:"places-"+l[a].ancestor_ids_is[s]}),r[r.length-1].parent=n.split("-").slice(0,-2).pop();for(r=r.sort((function(e,t){return e.id<t.id?-1:1})),a=r[r.length-1],(r=r.filter((function(e,t){try{return e.id!=r[t+1].id}catch(a){}}))).push(a),u=r.length,a=0;a<u;++a)0==r[a].level&&(o+=h(r[a].lab,r[a].id,r[a].id,"&ndash;"));for(d()("#sui-topCon").html(o+"</ul></div>"),d()("#sui-rpList").on("click",(function(){i.DrawRelatedPlaces("list",t)})),d()("#sui-rpSearch").on("keyup",(function(){var e=d()("#sui-rpSearch").val();i.DrawRelatedPlaces("list",t),d()("#sui-rpSearch").val(e),d()("#sui-rpSearch").focus(),d()("#sui-rpSearch").trigger("keydown",{keyCode:13})})),a=0;a<u;++a)r[a].n=p(r[a].id);for(a=0;a<u;++a)0==r[a].level&&m(r[a].id,1);function p(e){var t,a=0;for(e=e.split("-").pop(),t=0;t<u;++t)r[t].parent==e&&++a;return a}function m(e,t){var a,s,n="";for(a=0;a<u;++a)r[a].id.match(e)&&r[a].level==t&&(s=r[a].n>0?"+":"&bull;",n="<ul style='list-style-type:none;display:none;padding:2px 0 0 24px'>",n+=h(r[a].lab,r[a].id,r[a].uid,s),n+="</ul>",d()("#sui-rpDot-"+e).parent().parent().append(n),m(r[a].id,t+1))}function h(e,t,a,s){var n="<li>";return n+="&bull;"!=s?"<div class='sui-spDot' id='sui-rpDot-".concat(t,"'>").concat(s,"</div>"):"<div class='sui-spDot' id='sui-rpDot-".concat(t,"' style='display:none;color:#5b66cb'><strong>&bull;</div>&bull;&nbsp;&nbsp;"),n+="<a class='sui-noA' href='#p=".concat(a,"'>").concat(e,"</strong>").concat(sui.pages.AddPop(a),"</a>")}d()("#sui-topCon").find("li").each((function(){(s=d()(this).parent().find("li").find("b").length)&&!d()(this).find("b").length&&d()(this).find("img").before("("+s/2+") ")})),d()("[id^=sui-rpDot-]").off("click"),d()("[id^=sui-rpDot-]").on("click",(function(e){var t=d()(this).parent().parent(),a=d()(this).html();d()(this).html("+"==a?"&ndash;":"+"),d()(t).children("ul").slideToggle()})),d()("#sui-togCatA").on("click",(function(){var e,t;for(e=0;e<u;++e)t=d()("#sui-rpDot-"+r[e].id).parent(),d()("#sui-rpDot-"+r[e].id).html("&ndash;"),t.parent().css("display","block"),t.css("display","block")})),d()("#sui-togCatN").on("click",(function(){var e,t;for(e=0;e<u;++e)"&bull;"!=(t=d()("#sui-rpDot-"+r[e].id)).html()&&t.html("+"),t.parent().parent().css("display","none"),r[e].level<3&&(r[e].level<2&&t.html("&ndash;"),t.parent().parent().css("display","block"))})),d()("#sui-togCatN").trigger("click")}},{key:"GetSubjectData",value:function(e){var t=this;this.sui.GetRelatedFromID(e.uid,(function(a){var s,n,i=0,r="<table>";if(a){if(t.relatedSubjectData=a,a[0].summary_eng&&a[0].summary_eng[0]&&d()("#sui-spCap").html(a[0].summary_eng[0]),e.names_txt&&e.names_txt.length)for(n=0;n<e.names_txt.length;++n)e.names_txt[n].match(/lang="bo"/i)&&(r+="<tr><td style='color:#000099;font-size:20px'><strong>"+e.names_txt[n]+"</strong>&nbsp;&nbsp;&nbsp;</td><td span='2'><i>Dzongkha, Tibetan script, Original</i></td></tr>");for(n=0;n<a.length;++n)"related_names"==(s=a[n]).block_child_type&&(i||(s.related_names_level_i=0),r+="<tr><td style='padding-left:".concat(16*s.related_names_level_i,"px'>\n\t\t\t\t").concat(i++?">&nbsp;":"","\n\t\t\t\t<strong>").concat(s.related_names_header_s,"&nbsp;&nbsp;&nbsp;</strong></td><td>\n\t\t\t\t<i>").concat(s.related_names_language_s,", ").concat(s.related_names_writing_system_s,", ").concat(s.related_names_relationship_s,"\n\t\t\t\t</i></td></tr>"));r+="</table><br>",d()("#sui-subConDiv").append(r.replace(/\t|\n|\r/g,"")),t.AddRelatedSubjects(e,a),t.AddSubjectContext(e,a)}}))}},{key:"AddRelatedSubjects",value:function(e,t){var a,s,n=0,i=[],r=t.length;for(s=0;s<r;++s)"related_subjects"==t[s].block_child_type&&(i[t[s].related_subjects_relation_label_s]||(i[t[s].related_subjects_relation_label_s]=[]),i[t[s].related_subjects_relation_label_s].push({title:t[s].related_subjects_header_s,id:t[s].related_uid_s}));var l=Object.keys(i).sort((function(e,t){return e.length>t.length?-1:1}))[0],c="<br><div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>\n\t\t<div>\n\t\t").concat(e.title[0],"</strong> has <strong>~|~</strong> other subject").concat(r>1?"s":""," directly related to it, which is presented here. \n\t\tSee the SUBJECT CONTEXT tab if you instead prefer to browse all subordinate and superordinate categories for ").concat(e.title[0],".</div>\n\t\t<p><a class='sui-advEditBut' id='sui-togCatA'>Expand all</a> / <a class='sui-advEditBut' id='sui-togCatN'>Collapse all</a>\n\t\t</p><div style='width:100%'><div style='width:50%;display:inline-block'>");for(a in c+=o(l)+"</div><div style='display:inline-block;width:50%;vertical-align:top'>",i)a!=l&&(c+=o(a));function o(t){if(!i||!i[t])return"</ul>";i[t]=i[t].sort((function(e,t){return e.title<t.title?-1:1}));var a="<div id='sui-spCat-"+t.replace(/ /g,"_")+"' class='sui-spCat'>"+e.title+" "+t+"</div><ul id='sui-spCatUL-"+t.replace(/ /g,"_")+"' style='display:none'>";for(s=0;s<i[t].length;++s)a+="<li><a class='sui-noA' id='sui-spItem-"+i[t][s].id,a+="' href='#p="+i[t][s].id+"'>",a+=i[t][s].title+"</a>"+sui.pages.AddPop(i[t][s].id)+"</li>",++n;return a+"</ul>"}c=(c+="</div></div>").replace(/~\|~/,n),this.content[1]=c}},{key:"AddSubjectContext",value:function(e,t){var a,s=this,n=this.sui,i=0,r=0;for(a=0;a<t.length;++a)r+=t[a].child_count.numFound;r="(TBD)";var l="<br><div class='sui-spHead'>Subjects related to ".concat(e.title,"</div>\n\t\t<div>\n\t\t<strong>").concat(e.title[0],"</strong> has <strong> ").concat(t[0].ancestors.length-1," </strong>superordinate subjects \n\t\tand <strong> ").concat(r," </strong>subordinate subjects. \n\t\tYou can browse these subordinate subjects as well as its superordinate categories with the tree below. \n\t\tSee the RELATED SUBJECTS tab if you instead prefer to view only its immediately \n\t\tsubordinate subjects grouped together in useful ways, as well as subjects non-hierarchically related to it.</div><br>\n\t\t<ul class='sui-spLin' id='sui-spRows'>");for(i=0;i<t[0].ancestors.length;++i)l+="<ul style='list-style-type:none'>",l+=n.pages.AddRelTreeLine(t[0].ancestors[i],t[0].ancestor_uids_generic[i],"&ndash;",null);n.GetTreeChildren(e.asset_type,t[0].ancestor_id_path,(function(e){var a,r,c,o,d,u=[];try{u=e.facets.child_counts.buckets}catch(p){}for(e=e.response.docs,a=0;a<e.length;++a){for(d="",o=null,c=new RegExp(e[a].id.split("-")[1]),r=0;r<u.length;++r)u[r].val.match(c)&&(o="+",d=u[r].val);l+="<ul style='list-style-type:none'>",l+=n.pages.AddRelTreeLine(e[a].header,e[a].id,o,d)+"</li></ul>"}for(l=l.replace(/~~/,i+e.length),a=0;a<t[0].ancestors.length;++a)l+="</li></ul>";s.content[0]=l.replace(/\t|\n|\r/g,"")+"</ul><br>",s.ShowTab(0)}))}}]),e}(),f=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(n.a)(e,[{key:"Draw",value:function(e){var t,a,s,n=this,i=this.sui,r=e.url_thumb_height/e.url_thumb_width;d()(this.div).width();for(e.url_thumb&&(e.url_thumb=e.url_thumb.replace(/images-test/i,"images")),t=0;t<i.curResults.length;++t)e.id==i.curResults[t].id&&(s=t);var l="<div class='sui-imagesBox' id='sui-imagesBox' style='margin:".concat("related"==i.ss.mode?"-12px 0 0 0":"-12px -12px 0 -12px","'>\n\t\t<div id='sui-picEnlarge' style='cursor:pointer;font-size:18px' title='Click to enlarge and pan'>&#xe650</div></p>\n\t\t<div id='sui-imageDiv' class='sui-imageDiv' >\n\t\t\t<img id='sui-thisPic' src='").concat(e.url_thumb.replace(/200,200/,"2000,2000"),"' style='width:100%'> \n\t\t</div><br>\n\t\t<div><span style='max-width:900px;font-size:20px;vertical-align:-2px;color:#ccc'>&#xe62a&nbsp;&nbsp;").concat(e.title[0],"</span></div>\n\t\t<div style='color:#ccc;margin-bottom:24px'>").concat(e.creator,"&nbsp;&nbsp;|&nbsp;&nbsp;").concat(e.img_width_s," x ").concat(e.img_height_s," px</div>\n\t\t<div class='sui-imageGal'id='sui-imageGal'>");for(t=0;t<s;++t)"images"==i.curResults[t].asset_type&&(l+="<div class='sui-pageThumb'><img id='sui-pageThumb-".concat(t,"' src='").concat(i.curResults[t].url_thumb,"' style='height:100%'></div>"));for(l+="<div class='sui-pageThumb' style=' border-color:#fff'><img id='sui-pageThumb-".concat(s,"' src='").concat(e.url_thumb,"' style='height:100%'></div>"),t=s+1;t<i.curResults.length;++t)"images"==i.curResults[t].asset_type&&(l+="<div class='sui-pageThumb'><img id='sui-pageThumb-".concat(t,"' src='").concat(i.curResults[t].url_thumb,"' style='height:100%'></div>"));l+="</div></div>",i.GetJSONFromKmap(e,(function(e){v(e)})),d()(this.div).html(l.replace(/\t|\n|\r/g,"")),i.pages.DrawRelatedAssets();var c,o=[],u=[],p=[];try{for(t=0;t<e.kmapid_strict.length;++t)if(e.kmapid_strict[t].match(/places/)&&o.push(e.kmapid_strict_ss[t]+i.pages.AddPop(e.kmapid_strict[t])),e.kmapid_strict[t].match(/subjects/)&&u.push(e.kmapid_strict_ss[t]+i.pages.AddPop(e.kmapid_strict[t])),e.kmapid_strict[t].match(/terms/)){c=e.kmapid_strict_ss[t];var m=RegExp(e.kmapid_strict[t]+"_definitions-(d*)","g");if(m=e.kmapid.join().match(m)){for(c+="<span><i><sup> (",a=1;a<=m.length;++a)c+=a,a<m.length&&(c+=",");c+=")</sup></i></span>"}c+=i.pages.AddPop(e.kmapid_strict[t]),p.push(c)}}catch(f){}if(l="<br><table class='sui-imageMid'>\n\t\t\t<tr class='sui-pageLab' style='font-size:16px;padding-bottom:4px'><td style='width:50%'>MANDALA COLLECTIONS</td><td>CLASSIFICATION</td></tr>\n\t\t\t<tr class='sui-pageLab' style='padding-bottom:8px'><td>&#xe633&nbsp;&nbsp;<i>",e.collection_title?l+="".concat(e.collection_title).concat(i.pages.AddPop(e.collection_uid_s)):l+="None",l+="</td><td><i>",u.length){for(l+="<span style='color:#cc4c39'>&#xe634</span>&nbsp;&nbsp",t=0;t<u.length;++t)l+=u[t]+", ";l=l.slice(0,-2)+"<br>"}if(o.length){for(l+="<span style='color:#6faaf1'>&#xe62b</span>&nbsp;&nbsp",t=0;t<o.length;++t)l+=o[t]+", ";l=l.slice(0,-2)+"<br>"}if(p.length){for(l+="<span style='color:#a2733f'>&#xe635</span>&nbsp;&nbsp",t=0;t<p.length;++t)l+=p[t]+", ";l=l.slice(0,-2)+"<br>"}l+="</td></tr></i></table>";var h=this.DrawItem;function v(a){l+="<div class='sui-images'>",l+="<div style='width:calc(49% - 24px);display:inline-block;margin-right:16px;vertical-align:top;height:100%;'><table style='width:100%'>";try{l+=h(i.assets[e.asset_type].g,"CAPTION",e.caption,"Untitled")}catch(f){}l+="<tr><td colspan='2'><hr></td></tr>";try{l+=h("&#xe600","CREATOR",e.creator)}catch(f){}try{l+=h("&#xe66d","TYPE",a.field_image_type.und[0].value.charAt(0).toUpperCase()+a.field_image_type.und[0].value.slice(1))}catch(f){}try{l+=h("&#xe665","SIZE",e.img_width_s+" x "+e.img_height_s+" px")}catch(f){}l+="<tr><td colspan='2'><hr></td></tr>";try{for(l+="<p class='sui-pageLab'>",t=0;t<a.field_image_descriptions.und.length;++t)l+=a.field_image_descriptions.und[t].title+"<br>";l+="</p>"}catch(f){}try{l+=h("&#xe600",a.field_image_agents.und[0].field_agent_role.und[0].value.toUpperCase(),a.field_image_agents.und[0].title+" ("+i.pages.FormatDate(a.field_image_agents.und[0].field_agent_dates.und[0].value)+")")}catch(f){}try{l+="</table><p>",l+=a.field_image_descriptions.und[0].field_description.und[0].value+"<br></p>"}catch(f){}l+="</div><div style='width:49%;display:inline-block;vertical-align:top;border-left:1px solid #ddd;padding-left:16px'><br><table style='width:100%'>";try{l+=h("&#xe67f","ONLY DIGITAL",a.field_image_digital.und[0].value?"Yes":"No")}catch(f){}try{l+=h("&#xe67f","COLOR",a.field_image_color.und[0].value?"Yes":"No")}catch(f){}try{l+=h("&#xe67f","QUALITY",a.field_image_quality.und[0].value)}catch(f){}try{l+=h("&#xe67f","ROTATION",a.field_image_rotation.und[0].value+"&deg;")}catch(f){}try{l+=h("&#xe665","PHYSICAL&nbsp;SIZE",a.field_physical_size.und[0].value)}catch(f){}try{l+=h("&#xe659","CAPURE&nbsp;DEVICE",a.field_image_capture_device.und[0].value)}catch(f){}try{l+=h("&#xe65f","MATERIALS",a.field_image_materials.und[0].value)}catch(f){}try{l+=h("&#xe66c","ENHANCEMENT",a.field_image_enhancement.und[0].value)}catch(f){}try{l+="<tr><td>&#xe62B&nbsp;&nbsp;<span class='sui-pageLab'>LOCATION</span>:</td><td>"+a.field_longitude.und[0].value+"&nbsp;&nbsp;&nbsp;"+a.field_latitude.und[0].value+"</td></tr>"}catch(f){}try{l+=h("&copy;","COPYRIGHT&nbsp;HOLDER",a.field_copyright_holder.und[0].value)}catch(f){}try{l+=h("&copy;","COPYRIGHT&nbsp;STATEMENT",a.field_copyright_statement.und[0].value)}catch(f){}try{l+=h("&#xe614","ORIGINAL&nbsp;FILE",a.field_original_filename.und[0].value)}catch(f){}try{l+=h("&#xe678","TECHNICAL&nbsp;NOTES",a.field_technical_notes.und[0].value)}catch(f){}try{l+=h("&#xe639","UPLOADED&nbsp;BY",e.node_user_full_s)}catch(f){}try{l+=h("&#xe67f","LICENSE","<a style='font-weight:400' target='_blank' href='"+a.field_license_url.und[0].value+"'>"+a.field_license_url.und[0].value+"</a>")}catch(f){}var s=e.img_height_s/e.img_width_s;l+="</table><p class='sui-pageLab' style='cursor:pointer' onclick='$(\"#sui-dlOps\").toggle()'>\n\t\t\t\t&#xe616&nbsp;&nbsp;<a>DOWNLOAD IMAGE</a>\n\t\t\t\t\t<div id='sui-dlOps' style='display:none;margin-left:24px;font-size:12px'>\t\t\t\n\t\t\t\t\t<a target='_blank' href='".concat(e.url_thumb.replace(/200,200/,e.img_width_s+","+e.img_width_s),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Original (").concat(e.img_width_s,"x").concat(e.img_height_s,")</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"1200,1200"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Large (1200x").concat(1200*s,"))</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"800,800"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Medium (800x").concat(800*s,")</a><br>\n\t\t\t\t\t<a target='_blank' href='").concat(e.url_thumb.replace(/200,200/,"400,400"),"'\n\t\t\t\t\tstyle='display:inline-block;cursor:pointer'>Small (400x").concat(400*s,')</a>\n\t\t\t\t\t<p><i>Right-click and select "Download/Save Linked File"</i></p>\n\t\t\t\t\t</div>\n\t\t\t\t</p></div></div></div>'),d()(i.pages.div).append(l.replace(/\t|\n|\r/g,"")),d()("#sui-imgCol").on("click",(function(){return i.GetKmapFromID(e.collection_uid_s,(function(e){i.SendMessage("",e)})),!1}))}d()("[id^=sui-pageThumb-]").on("click",(function(e){var t=e.currentTarget.id.split("-")[2];i.pages.Draw(i.curResults[t])})),d()("#sui-picEnlarge").on("click",(function(){var e,t,a,s,i=d()("#sui-legacy")[0],l=d()(n.div).width()/2*r;if(d()("#sui-imagesBox").css({"padding-top":"12px"}),d()("#sui-imageDiv").css({width:"100%",height:d()("#sui-legacy").height()+"px"}),d()("#sui-picEnlarge").html().match(/Zoom/))return d()("#sui-picEnlarge").html("&#xe650"),d()("#sui-thisPic").offset(d()("#sui-imageDiv").offset()),d()("#sui-imageDiv").css({width:"50%",height:l+"px"}),d()("#sui-imagesBox").css({"padding-top":"60px"}),void(i.onmousedown=i.onwheel=null);d()("#sui-picEnlarge").html("Zoom &nbsp; &#xe651  &nbsp; out "),d()("#sui-thisPic").css("width","auto"),i.style.cursor="grab",i.onwheel=function(t){(t=t||window.event).preventDefault(),e=d()("#sui-thisPic").offset(),d()("#sui-thisPic").offset({left:(t.deltaX?t.deltaX:0)/5+e.left,top:(t.deltaY?t.deltaY:0)/3+e.top})},i.onmousedown=function(n){(n=n||window.event).preventDefault(),e=n.pageX,t=n.pageY,a=d()("#sui-thisPic").offset().left,s=d()("#sui-thisPic").offset().top,i.onmousemove=function(n){(n=n||window.event).preventDefault();var i=n.pageX-e,r=n.pageY-t;d()("#sui-thisPic").offset({left:a+i,top:s+r})},i.onmouseup=function(e){i.onwheeel=i.onmouseup=i.onmousemove=null}}}))}},{key:"DrawItem",value:function(e,t,a,s,n,i){var r,l="<tr><td>";if(null==a||void 0==a||""==a)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",i&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="</td><td><span class='",l+=(n||"sui-pageVal")+"'>","object"==typeof a)for(r=0;r<a.length;++r)a[r].header?l+=a[r].header:a[r].value?l+=a[r].value:a[r].val?l+=a[r].val:a[r].title?l+=a[r].title:l+=a[r],r!=a.length-1&&(l+=", ");else l+=a&&!a.match(/undefined/)?a:s;return l+"</span></td></tr>"}}]),e}(),g=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.content=["...loading","...loading","...loading"]}return Object(n.a)(e,[{key:"Draw",value:function(e){var t=this;console.error("texts.Draw()");var a=this.sui,s=this;d()(".shanti-texts-section-content").length||d()("<link/>",{rel:"stylesheet",type:"text/css",href:"https://texts-dev.shanti.virginia.edu/sites/all/themes/shanti_sarvaka_texts/css/shanti_texts.css"}).appendTo("head");var n=e.url_ajax.replace(/node_ajax/i,"node_embed")+"?callback=pfunc";d()(this.div).html();d()(this.div).html("<div id='sui-textCon' class='sui-texts'></div>\n\t\t<div style='display:inline-block;width:calc(34% + 3px);margin-left:-8px;vertical-align:top'>\n\t\t<div class='sui-textTop' id='sui-textTop'>\n\t\t\t<div class='sui-textTab' id='sui-textTab0'>CONTENTS</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab1'>DESCRIPTION</div>\n\t\t\t<div class='sui-textTab' id='sui-textTab2'>VIEWS</div>\n\t\t</div>\n\t\t<div class='sui-textContent' id='sui-textContent'></div></div>".replace(/\t|\n|\r/g,"")),a.LoadingIcon(!0,64),d.a.ajax({url:n,dataType:"jsonp"}).done((function(n){a.LoadingIcon(!1),d()("#sui-textCon").html(n),d()("#shanti-texts-container").height(d()("#c-columnContent__main").height()-80),d()("#shanti-texts-body").height(d()("#sui-content").height()-110),t.content[0]=d()("#shanti-texts-toc").html(),d()("#shanti-texts-sidebar").remove(),r(0),d()("#shanti-texts-container").append("xxxxxxxxxxxxx<br><br>"),d()(".kmap-tag-group").each((function(){var e=d()(this).data("kmdomain"),t=e+"-"+d()(this).data("kmid"),s='<span style=\'font-family:"Open Sans",shanticon;color:'.concat(a.assets[e].c,"'>\n\t\t\t\t\t").concat(a.assets[e].g,"&nbsp;</span>\n\t\t\t\t\t").concat(d()(this.children[0]).text(),"\n\t\t\t\t\t").concat(a.pages.AddPop(t),"&nbsp;&nbsp;");d()(this.children[0]).html(s.replace(/\t|\n|\r/g,""))}));var i="<p><strong>ALTERNATIVE FORMATS</strong></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/book_pubreader/".concat(e.id,"'>&#xe678&nbsp;&nbsp;View in PubReader</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/voyant/").concat(e.id,"'>&#xe678&nbsp;&nbsp;View in Voyant</a></p>\n\t\t\t<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='https://texts.shanti.virginia.edu/shanti_texts/node_ajax_text/").concat(e.id,"'>&#xe678&nbsp;&nbsp;View as raw text</a></p>");function r(t){d()("#sui-textContent").html("<div class='sui-sourceText' style='font-size:18px;color:#000'>"+e.title+"<div><hr>"),d()("[id^=sui-textTab]").css({"background-color":"#eee"}),d()("#sui-textTab"+t).css({"background-color":"#fff"}),d()("#sui-textContent").append(s.content[t]),d()("#sui-txtCol").off("click"),d()("#sui-txtCol").on("click",(function(){return a.GetKmapFromID(e.collection_uid_s,(function(e){a.SendMessage("",e)})),!1}))}t.content[2]=i.replace(/\t|\n|\r/g,""),a.GetJSONFromKmap(e,(function(s){var n,r="";r+="<table style='width:100%'>";try{i="<a title='Collection' id='sui-txtCol' href='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>").concat(a.pages.AddPop(e.collection_uid_s)),e.collection_title&&(r+=t.DrawItem("&#xe633","COLLECTION",i))}catch(l){}r+=t.DrawItem("&#xe67c","VISIBILITY","Public - accessible to all site users"),e.summary&&(r+="<tr><hr><td colspan='2' style='max-width:"+d()("#c-columnContent__main").width()/4+"px'>"+e.summary+"<hr><td></tr>");try{r+=t.DrawItem("&#xe600","AUTHOR",s.field_book_author.und,"","sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe675","EDITOR",s.field_book_editor.und,"","sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe633","YEAR&nbsp;PUBLISHED",s.field_dc_date_publication_year.und[0].value.substr(0,4),"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe633","ORIGINAL&nbsp;YEAR PUBLISHED",s.field_dc_date_orginial_year.und[0].value.substr(0,4),"sui-pageLab")}catch(l){}if(s.field_kmap_places&&s.field_kmap_places.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe62b&nbsp;&nbspPLACES:</td><td>",n=0;n<s.field_kmap_places.und.length;++n)r+=s.field_kmap_places.und[n].header,r+=a.pages.AddPop(s.field_kmap_places.und[n].domain+"-"+s.field_kmap_places.und[n].id),n<s.field_kmap_places.und.length-1&&(r+="<br>");r+="</td></tr>"}if(s.field_kmap_subjects&&s.field_kmap_subjects.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe634&nbsp;&nbspPLACES:</td><td>",n=0;n<s.field_kmap_subjects.und.length;++n)r+=s.field_kmap_subjects.und[n].header,r+=a.pages.AddPop(s.field_kmap_subjects.und[n].domain+"-"+s.field_kmap_subjects.und[n].id),n<s.field_kmap_subjects.und.length-1&&(r+="<br>");r+="</td></tr>"}if(s.field_kmap_terms&&s.field_kmap_terms.und){for(r+="<tr><td style='vertical-align:top'><span class='sui-pageLab'>&#xe635&nbsp;&nbspTERMS:</td><td>",n=0;n<s.field_kmap_terms.und.length;++n)r+=s.field_kmap_terms.und[n].header,r+=a.pages.AddPop(s.field_kmap_termss.und[n].domain+"-"+s.field_kmap_terms.und[n].id),n<s.field_kmap_terms.und.length-1&&(r+="<br>");r+="</td></tr>"}try{r+=t.DrawItem("&#xe674","TRANSLATOR",s.field_book_translator.und,"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&#xe670","LANGUAGE",s.field_dc_language_original.und,"sui-pageLab")}catch(l){}try{r+=t.DrawItem("&copy;","RIGHTS",s.field_dc_rights_general.und,"sui-pageLab")}catch(l){}r+="</table>",t.content[1]=r.replace(/\t|\n|\r/g,"");try{t.content[2]+="<p>&nbsp;&nbsp;&nbsp;&nbsp;<a target='_blank' href='"+s.field_pdf_version.und[0].url+"'>&#xe678&nbsp;&nbsp;View as PDF</a></p>"}catch(l){}})),d()("[id^=sui-textTab]").on("click",(function(e){r(e.currentTarget.id.substring(11))}))}))}},{key:"DrawItem",value:function(e,t,a,s,n,i){var r,l="<tr><td>";if(null==a||void 0==a||""==a)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",i&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="</td><td><span class='",l+=(n||"sui-pageVal")+"'>","object"==typeof a)for(r=0;r<a.length;++r)a[r].header?l+=a[r].header:a[r].value?l+=a[r].value:a[r].val?l+=a[r].val:a[r].title?l+=a[r].title:l+=a[r],r!=a.length-1&&(l+=", ");else l+=a&&!a.match(/undefined/)?a:s;return l+"</span></td></tr>"}}]),e}(),_=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(n.a)(e,[{key:"Draw",value:function(e){var t=this.sui,a="<div class='sui-sources' id='sui-sources'>\n\t\t<span style='font-size:24px;color:".concat(t.assets[e.asset_type].c,";vertical-align:-4px'>").concat(t.assets[e.asset_type].g,"</span>\n\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(t.assets[e.asset_type].c,"'>\n\t\t<div class='sui-sourceSec' id='sui-srcSec'></div><br>");e.creator&&e.creator.length&&(a+="<span class='sui-pageLab' style='color:".concat(t.assets[e.asset_type].c,"'>&#xe600</span>\n\t\t\t&nbsp;&nbsp;").concat(e.creator.join(", "),"<br><br>")),e.url_thumb&&!e.url_thumb.match(/gradient.jpg/)&&(a+="<img src='"+e.url_thumb+"' style='float:right;width:33%; padding:0 0 12px 12px'>"),e.collection_title&&(a+="<p>COLLECTION:&nbsp;&nbsp<a id='sui-imgCol' href='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a></p>")),e.asset_subtype&&(a+="<p>FORMAT:&nbsp;&nbsp<span class='sui-sourceText'>"+e.asset_subtype+"</span></p>"),a+="<p class='sui-pageLab' id='sui-p2'>PUBLICATION YEAR:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcYear'></span>",e.publisher_s&&(a+="<p>PUBLISHER:&nbsp;&nbsp<span class='sui-sourceText'>"+e.publisher_s+"</span></p>"),a+="<p class='sui-pageLab' id='sui-p3'>PLACE OF PUBLICATION:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPlc'></span>",a+="<p class='sui-pageLab' id='sui-p1'>PAGES:&nbsp;&nbsp<span class='sui-sourceText' id='sui-srcPages'></span>",a+="<p class='sui-pageLab'>SOURCE ID:&nbsp;&nbsp<span class='sui-sourceText'>sources-"+e.id+"</span></p>",e.summary&&(a+="<p>ABSTRACT:<div class='sui-sourceText'>"+e.summary+"</div></p>"),a+="</div>",d()(this.div).html(a.replace(/\t|\n|\r/g,"")),t.pages.DrawRelatedAssets(),d()("#sui-imgCol").on("click",(function(){return t.GetKmapFromID(e.collection_uid_s,(function(e){t.SendMessage("",e)})),!1})),t.GetJSONFromKmap(e,(function(e){var a,s="";if(e.biblio_pages?d()("#sui-srcPages").html(e.biblio_pages):d()("#sui-sp1").hide(),e.biblio_year?d()("#sui-srcYear").html(e.biblio_year):d()("#sui-sp2").hide(),e.biblio_secondary_title?d()("#sui-srcSec").html(e.biblio_secondary_title):d()("#sui-srcSec").hide(),e.biblio_place_published?d()("#sui-srcPlc").html(e.biblio_place_published):d()("#sui-sp3").hide(),e.field_kmaps_subjects&&e.field_kmaps_subjects.und){for(s+="<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;",a=0;a<e.field_kmaps_subjects.und.length;++a)s+=e.field_kmaps_subjects.und[a].header,s+=t.pages.AddPop(e.field_kmaps_subjects.und[a].domain+"-"+e.field_kmaps_subjects.und[a].id),a<e.field_kmaps_subjects.und.length-1&&(s+=", ");s+="</p>"}if(e.field_kmaps_places&&e.field_kmaps_places.und){for(s+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;",a=0;a<e.field_kmaps_places.und.length;++a)s+=e.field_kmaps_places.und[a].header,s+=t.pages.AddPop(e.field_kmaps_places.und[a].domain+"-"+e.field_kmaps_places.und[a].id),a<e.field_kmaps_places.und.length-1&&(s+=", ");s+="</p>"}if(e.field_kmap_terms&&e.field_kmap_terms.und){for(s+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;",a=0;a<e.field_kmap_terms.und.length;++a)s+=e.field_kmap_terms.und[a].header,s+=t.pages.AddPop(e.field_kmap_terms.und[a].domain+"-"+e.field_kmap_terms.und[a].id),a<e.field_kmap_terms.und.length-1&&(s+=", ");s+="</p>"}e.biblio_url&&(s+="<p class='sui-pageLab'>URL:&nbsp;&nbsp;<a target='_blank' href='"+e.biblio_url+"'>"+e.biblio_url+"</a></p>"),d()("#sui-sources").append(s)}))}}]),e}(),b=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div}return Object(n.a)(e,[{key:"Draw",value:function(e){var t=this.sui;t.GetJSONFromKmap(e,(function(e){n(e)}));var a="//visuals.shanti.virginia.edu/sites/all/libraries/SHIVA/go.htm?m=//visuals.shanti.virginia.edu/data/json/";a+=e.id;var s=t.pages.DrawItem;function n(n){var i,r=d.a.parseJSON(n.shivanode_json.und[0].value),l=r.width?r.width+"px":"100%",c=r.height?r.height+"px":"calc(100% - 155px)",o=r.dataSourceUrl?r.dataSourceUrl:"",u="<iframe id='sui-iframe' frameborder='0' scrolling='no' src='".concat(a,"' \n\t\t\tstyle='margin-left:auto;margin-right:auto;height:").concat(c,";width:").concat(l,";display:block;overflow:hidden'></Iframe><br>");u+="<div class='sui-sources' style='padding-top:0'>";try{i=e.collection_title?"<a title='Collection' id='sui-imgCol'\thref='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"):"None"}catch(v){}u+="<div style='text-align:center'>"+s("&#xe633","MANDALA COLLECTION",i)+"</div>",u+="<hr style='border-top: 1px solid #6e9456;margin-top:12px'>";try{u+=s("&#xe63b","TITLE",e.title[0],"Untitled")}catch(v){}try{u+=s("&#xe65f","TYPE",e.asset_subtype.replace(/:/g," | "))}catch(v){}try{u+=s("&#xe60c","DATE",e.node_created.substr(0,10))}catch(v){}try{u+="&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>CREATOR</span>:&nbsp;&nbsp;<span class='sui-pageVal'>",u+=e.node_user_full?e.node_user_full+"&nbsp;&nbsp":"",u+=e.node_user?e.node_user:"",u+="</span>"}catch(v){}if(n.field_kmaps_subjects&&n.field_kmaps_subjects.und){u+="<p class='sui-pageLab'>SUBJECTS:&nbsp;&nbsp;";for(var p=0;p<n.field_kmaps_subjects.und.length;++p)u+=n.field_kmaps_subjects.und[p].header,u+=t.pages.AddPop(n.field_kmaps_subjects.und[p].domain+"-"+n.field_kmaps_subjects.und[p].id),p<n.field_kmaps_subjects.und.length-1&&(u+=", ");u+="</p>"}if(n.field_kmaps_places&&n.field_kmaps_places.und){u+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;";for(var m=0;m<n.field_kmaps_places.und.length;++m)u+=n.field_kmaps_places.und[m].header,u+=t.pages.AddPop(n.field_kmaps_places.und[m].domain+"-"+n.field_kmaps_places.und[m].id),m<n.field_kmaps_places.und.length-1&&(u+=", ");u+="</p>"}if(n.field_kmap_terms&&n.field_kmap_terms.und){u+="<p class='sui-pageLab'>TERMS:&nbsp;&nbsp;";for(var h=0;h<n.field_kmap_terms.und.length;++h)u+=n.field_kmap_terms.und[h].header,u+=t.pages.AddPop(n.field_kmap_terms.und[h].domain+"-"+n.field_kmap_terms.und[h].id),h<n.field_kmap_terms.und.length-1&&(u+=", ");u+="</p>"}o&&(u+="<p>&#xe678&nbsp;&nbsp;<a target='_blank' href='"+o+"'>External spreadsheet</a></p>"),e.caption&&(u+=e.caption);'[iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"]'),'&lt;iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"&gt;');u+="<hr>&#xe600&nbsp;&nbsp;<span class='sui-pageLab'>SHARE AS</span>:&nbsp;&nbsp;\n\t\t\t\t<a id='sui-share-1' style='display:inline-block;cursor:pointer'>Link&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-2' style='display:inline-block;cursor:pointer'>WordPress&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<a id='sui-share-3' style='display:inline-block;cursor:pointer'>Iframe&nbsp;&nbsp;&nbsp;</a>\n\t\t\t\t<p id='sui-resShare' style='border-radius:4px;background-color:#fff;padding:8px;display:none;border:1px solid #ccc'></p>\n\t\t\t\t</div>",d()("#sui-resShare").html("<strong>LINK</strong>: ${url}"),d()("#sui-resShare").toggle(),d()(t.pages.div).html(u.replace(/\t|\n|\r/g,"")),t.pages.DrawRelatedAssets(e),d()("[id^=sui-share-]").on("click",(function(e){var t=e.currentTarget.id.split("-")[2];"1"==t?d()("#sui-resShare").html(a):"2"==t?d()("#sui-resShare").html('[iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"]')):"3"==t&&d()("#sui-resShare").html('&lt;iframe src="'.concat(a,'" width="').concat(l,'" height="').concat(c,'"&gt;')),d()("#sui-resShare").show()}))}}}]),e}(),y=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.sui=t,this.div=t.pages.div,this.recordingGroup=0,this.tabs=[],this.tagged=[],this.kmap=null}return Object(n.a)(e,[{key:"Draw",value:function(e){var t=this,a=this.sui,s=[""];this.kmap=e;var n="<div class='c-content__main__kmaps' id='sui-terms' style=''>\n\t\t<span class='sui-termIcon'>".concat(a.assets[e.asset_type].g,"</span>&nbsp;&nbsp;&nbsp;\n\t\t<span class='sui-termTitle' id='sui-termTitle'>").concat(e.title[0],"</span>\n\t\t<hr style='border-top: 1px solid ").concat(a.assets[e.asset_type].c,"'>\n\t\t<p id='sui-termNames'>Names</p>\n\t\t<div id='sui-player' style='display:none'>\n\t\t<p><div class='sui-termPlay' id='sui-termPlay'>&#xe60a</div>\n\t\t<select class='sui-termSpeak unpopulated' id='sui-termGroup'><option>AMDO GROUP</option></select></p></div>");n+="<div id='sui-termDetails'></div>",n+="<div id='sui-termDefs' class='sui-termOther'></div>",n+="<br><div class='sui-termOHead'>OTHER DICTIONARIES</div>",n+="<div id='sui-termOther' class='sui-termOther' style='padding:0 24px'></div></div>",d()(this.div).html(n.replace(/\t|\n|\r/g,"")),this.tabs=[],this.SetTabContent(e),d()("#sui-termPlay").off("click").on("click",(function(e){new Audio(s[t.recordingGroup]).play()})),d()("#sui-termGroup").off("change").on("change",(function(e){t.recordingGroup=d()("#sui-termGroup").prop("selectedIndex")})),a.GetAudioFromID(e.id,(function(e){s=e,e.length&&d()("#sui-player").slideDown(),e.length>1&&d()("#sui-termGroup.unpopulated").append("<option>KHAM-HOR GROUP</option>"),e.length>2&&d()("#sui-termGroup.unpopulated").append("<option>CENTRAL TIBET DIALECT</option>"),d()("#sui-termGroup.unpopulated").removeClass("unpopulated")})),a.pages.DrawRelatedAssets(e)}},{key:"SetTabContent",value:function(e){var t=this,a=this.sui;a.GetChildDataFromID(e.uid,(function(s){var n,i,r=1,l=0,c="<br>",o="",u="<div style='height:2px'/>",p="<table>",m="";try{var h=s._childDocuments_;for(n=0;n<h.length;++n)h[n].id.match(/_definitions-/)&&(h[n].related_definitions_source_s?(c+="<div>"+r+++". <i>"+h[n].related_definitions_source_s+"</i></div>",c+="<p class='termDefs'>",c+=h[n].related_definitions_content_s,c+="</p><div class='sui-termData'>",h[n].related_definitions_author_s&&(c+="AUTHOR: "+h[n].related_definitions_author_s+" | "),c+="LANGUAGE: "+h[n].related_definitions_language_s,c+="</div><br><hr style='border-top:1px solid #a2733f'>"):(o+=t.DrawTabMenu(l++,[l+".&nbsp;&nbsp;DEFINITION","DETAILS","PASSAGES (0)","RESOURCES (0)"]),(i=["","<br>","<br>Waiting for data from Derik...<br><br><br><br>","<br>"])[0]+="<div class='termDefs'>",i[0]+=h[n].related_definitions_content_s,i[0]+="</div><div class='sui-termData'>",h[n].related_definitions_author_s&&(i[0]+="AUTHOR: "+h[n].related_definitions_author_s+" | "),i[0]+="LANGUAGE: "+h[n].related_definitions_language_s+"</div><br><br>",h[n]["related_definitions_branch_subjects-185_header_s"]&&(i[1]+=h[n]["related_definitions_branch_subjects-185_header_s"].toUpperCase(),i[1]+=": <i>"+h[n]["related_definitions_branch_subjects-185_subjects_headers_t"]+"</i>",i[1]+=a.pages.AddPop(h[n]["related_definitions_branch_subjects-185_subjects_uids_t"][0])+"<br>"),i[1]+="LANGUAGE: <i>"+h[n].related_definitions_language_s+"</i>",h[n]["related_definitions_branch_subjects-184_subjects_uids_t"]&&(i[1]+=a.pages.AddPop(h[n]["related_definitions_branch_subjects-184_subjects_uids_t"][0])+"<br>"),h[n]["related_definitions_branch_subjects-5855_header_s"]&&(i[1]+=h[n]["related_definitions_branch_subjects-5855_header_s"].toUpperCase(),i[1]+=": <i>"+h[n]["related_definitions_branch_subjects-5855_subjects_headers_t"]+"</i>",i[1]+=a.pages.AddPop(h[n]["related_definitions_branch_subjects-5855_subjects_uids_t"][0])+"<br>"),i[1]+="<br>",t.tabs.push(i))),h[n].id.match(/_names-/)&&(m||(m=h[n].related_names_header_s),p+="<tr><td <td style='padding-left:".concat(16*h[n].related_names_level_i,"px'>> <strong>").concat(h[n].related_names_header_s,"&nbsp;&nbsp;&nbsp;</strong></td><td>\n\t\t\t\t\t\t<i>").concat(h[n].related_names_language_s,", ").concat(h[n].related_names_writing_system_s,", ").concat(h[n].related_names_relationship_s,"\n\t\t\t\t\t\t</i></td></tr>"),c+="</table><br>"),d()("#sui-termNames").html(p+"</table>"),d()("#sui-termTitle").html("".concat(m,"&nbsp;&nbsp;&nbsp;").concat(e.title[0]))}catch(f){throw f}if(a.GetDefinitionAssets(e.uid,(function(e){var s,n,i,r,l,c,o,u,p=[];if(!e)return"";if(!e.length)return"";for(t.tagged=[],s=0;s<t.tabs.length;++s)t.tagged.push([]);for(s=0;s<e.length;++s)if("terms"!=(i=e[s]).asset_type)for(n=0;n<i.kmapid.length;++n)(l=i.kmapid[n].match(/_definitions-(\d*)/i))&&t.tagged[l[1]-1].push(i);for(s=0;s<t.tabs.length;++s){for(p.all=p.subjects=p.places=p.images=p.sources=p.visuals=p.collections=p.texts=p["audio-video"]=0,n=0;n<t.tagged[s].length;++n)p[t.tagged[s][n].asset_type]++,p.all++;for(n in r="",p)if(p[n]){r="<strong>Resources tagged with this definition: </strong><br>";break}for(n in p)p[n]&&(r+=(c=n,o=s,u=p[n],"<div id='sui-termAssetBut-".concat(o,"-").concat(c,"'\n\t\t\t\t\tclass='sui-termAssetBut' style='background-color:").concat(a.assets[c].c,"'>\n\t\t\t\t\t<span style='font-size:20px; vertical-align:-4px'>").concat(a.assets[c].g,"&nbsp;</span>").concat(c,"&nbsp;&nbsp;\n\t\t\t\t\t(").concat(u,")</div>").replace(/\t|\n|\r/g,"")));d()("#sui-tabTab-"+s+"-3").text("RESOURCES ("+p.all+")"),t.tabs[s][3]+=r}})),u="<table style='width:100%'><tr>",v("PHONEME",e.data_phoneme_ss),v("GRAMMARS",e.data_grammars_ss),u+="</tr><tr>",v("TOPICS",e.data_tibet_and_himalayas_ss),v("LITERARY PERIOD",e.data_literary_period_ss),u+="</tr><tr>",v("REGISTER",e.data_register_ss),v("LANGUAGE CONTEXT",e.data_language_context_ss),u+="</tr></table>",s.etymologies_ss&&s.etymologies_ss.length){for(u+="<br><strong>Etymology</strong><br><div class='sui-termDefs'>",n=0;n<s.etymologies_ss.length;++n)u+=s.etymologies_ss[n];c+="</div>"}for(d()("#sui-termDetails").html(u+"<br>"),d()("#sui-termDefs").html(o.replace(/\t|\n|\r/g,"")),d()("#sui-termOther").html(c.replace(/\t|\n|\r/g,"")),n=0;n<l;++n)t.ShowTab(n,0);function v(t,s){var n=0;if(s){if(e.kmapid_subjects_idfacet){for(n=0;n<e.kmapid_subjects_idfacet.length&&e.kmapid_subjects_idfacet[n].split("|")[0]!=s;++n);n=Math.min(e.kmapid_subjects_idfacet.length-1,n)}u+="<td>".concat(t,": <i>").concat(s,"</i>"),e.kmapid_subjects_idfacet?u+=a.pages.AddPop(e.kmapid_subjects_idfacet[n].split("|")[1])+"</td>":u+=a.pages.AddPop(e.related_uid_ss[n])+"</td>"}}}))}},{key:"DrawTabMenu",value:function(e,t){var a,s="";for(a=0;a<t.length;++a)s+="<div class='sui-tabTab' id='sui-tabTab-".concat(e,"-").concat(a,"' style='display:inline-block;text-align:left;padding-left:24px;width:calc(25% - 26px)'>\n\t\t\t").concat(t[a],"&nbsp;&#xe609</div>");return(s+="<div class='sui-tabContent' id='sui-tabContent-".concat(e,"'>hhh</div>")).replace(/\t|\n|\r|/g,"")}},{key:"ShowTab",value:function(e,t){var a=this,s=this.sui;d()("[id^=sui-tabTab-"+e).css({"background-color":"#999",color:"#fff","border-top":"1px solid #999"}),d()("#sui-tabContent-"+e).css({display:"block","background-color":"#eee"}),d()("#sui-tabTab-"+e+"-"+t).css({"background-color":"#eee",color:"#000","border-top":"1px solid #a2733f"}),d()("#sui-tabContent-"+e).html(this.tabs[e][t]),d()("[id^=sui-tabTab]").off(),d()("[id^=sui-termAssetBut-]").off(),d()("[id^=sui-termAssetBut-]").on("click",(function(e){var t,n=e.currentTarget.id.substring(17).split("-");if(s.ss.mode="related","audio"==n[1]&&(n[1]="audio-video"),s.pages.relatedType=n[1],s.pages.relatedBase=a.kmap,s.pagesrelatedId=s.pages.relatedBase.asset_type+"-"+s.pages.relatedBase.id,"all"==n[1])s.curResults=a.tagged[n[0]];else for(s.curResults=[],t=0;t<a.tagged[n[0]].length;++t)a.tagged[n[0]][t].asset_type==n[1]&&s.curResults.push(a.tagged[n[0]][t]);s.DrawResults()})),d()("[id^=sui-tabTab]").on("click",(function(e){var t=e.currentTarget.id.substring(11).split("-");a.ShowTab(t[0],t[1])}))}}]),e}(),E=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("SearchUI must be passed to constructor");this.div=t.pages.div,this.content=["",""," "],this.sui=t}return Object(n.a)(e,[{key:"Draw",value:function(e){var t=this,a=this.sui,s=a.assets[e.asset_subtype.toLowerCase()],n="<div id='sui-topCon' style='margin-left:192px'>\n\t\t<div class='sui-sources'  id='sui-collections'>\n\t\t\t<span style='font-size:24px;color:".concat(s.c,";vertical-align:-4px'>").concat(s.g,"</span>\n\t\t\t&nbsp;&nbsp;<span class='sui-sourceTitle'>").concat(e.title[0],"</span>\n\t\t\t&nbsp;&nbsp;(").concat(e.asset_subtype.toUpperCase(),")\n\t\t\t<hr style='border-top: 1px solid ").concat(a.assets[e.asset_type].c,"'>\n\t\t\t<div class='sui-sourceSec' id='sui-srcSec'></div>");e.url_thumb&&!e.url_thumb.match(/gradient.jpg/)&&(n+="<img src='"+e.url_thumb+"' style='width:33%;padding-right:12px;vertical-align:top'>"),e.summary&&(n+="<div class='sui-sourceText' style='display:inline-block;width:calc(66% - 12px)'>".concat(e.summary,"</div>")),n+="<br>"+a.pages.DrawTabMenu(["RELATED COLLECTIONS","MEMBERS","DETAILS"])+"</div>",d()(this.div).html(n.replace(/\t|\n|\r/g,"")),d()("[id^=sui-tabTab]").on("click",(function(e){var a=e.currentTarget.id.substring(10);t.ShowTab(a)})),d()("#sui-imgCol").on("click",(function(){return a.GetKmapFromID(e.collection_uid_s,(function(e){a.SendMessage("",e)})),!1})),a.pages.DrawRelatedAssets(e),this.AddTabContent(e),this.ShowTab(0)}},{key:"AddTabContent",value:function(e){var t,a,s=this.sui,n=0;this.content[0]="<br>";var i=e.asset_subtype.toLowerCase()+"-collection-";try{e.collection_title_path_ss&&(a=e.collection_uid_path_ss,this.content[0]+="<div><a href='#p=".concat(a,"' id='sui-spItem-").concat(a,"+\"'>").concat(e.collection_title_path_ss,"</a></div>"),n++)}catch(r){}if(this.content[0]+="<div style='margin-left:".concat(24*n,"px'><strong>").concat(e.title[0],"</strong></div>"),e.subcollection_name_ss&&e.subcollection_name_ss.length)for(n++,t=0;t<e.subcollection_name_ss.length;++t)a=i+e.subcollection_id_is[t],this.content[0]+="<div style='margin-left:".concat(24*n,"px'><a  href='#p=").concat(a,"' id='sui-spItem-").concat(a,"+\"'>").concat(e.subcollection_name_ss[t],"</a></div>");if(this.content[0]+="<br><br>",this.content[1]="",e.members_name_ss&&e.members_name_ss.length){for(t=0;t<e.members_name_ss.length;++t)this.content[1]+="<br>"+e.members_name_ss[t]+" &nbsp; ("+e.members_id_ss[t]+")";this.content[1]+="<br><br>"}this.content[2]="<br>",e.node_user_full_s&&(this.content[2]+=s.pages.DrawItem("&#xe600","OWNER",e.node_user_full_s+" &nbsp; ("+e.node_user+")","","sui-pageLab",1)),e.collection_visibility_s&&(this.content[2]+=s.pages.DrawItem("&#xe622","VISIBILITY",e.collection_visibility_s.substr(0,1).toUpperCase()+e.collection_visibility_s.substr(1),"","sui-pageLab",1)),e.asset_subtype&&(this.content[2]+=s.pages.DrawItem(s.assets[e.asset_subtype.toLowerCase()].g,"TYPE",e.asset_subtype,"","sui-pageLab",1)),e.collection_title&&(this.content[2]+=s.pages.DrawItem(s.assets[e.asset_subtype.toLowerCase()].g,"COLLECTION","<a title='Collection' id='sui-imgCol'\thref='#p=".concat(e.collection_uid_s,"'>").concat(e.collection_title,"</a>"),"","sui-pageLab",1)),this.content[2]+="<br>"}},{key:"ShowTab",value:function(e){d()("[id^=sui-tabTab]").css({"background-color":"#999",color:"#fff"}),d()("#sui-tabContent").css({display:"block","background-color":"#eee"}),d()("#sui-tabTab"+e).css({"background-color":"#eee",color:"#000"}),d()("#sui-tabContent").html(this.content[e])}}]),e}(),k=function(){function e(t){if(Object(s.a)(this,e),!t)throw new Error("sui must be defined in constructor");this.sui=t,t.pages=this,this.div=d()("<div></div>"),this.reldiv=d()("<div></div>"),this.relatedBase=null,this.relatedType="Home",this.relatedId="",this.lastMode=t.ss.mode,this.curKmap=null,this.carouselTimer=null,t.plc=new m(t),t.av=new h(t),t.sub=new v(t),t.img=new f(t),t.txt=new g(t),t.src=new _(t),t.vis=new b(t),t.trm=new y(t),t.col=new E(t),this.recentPages=[],this.editing=!1,window.location.hash&&t.PageRouter(window.location.hash)}return Object(n.a)(e,[{key:"Draw",value:function(e,t){var a=this.sui;if(clearInterval(this.carouselTimer),e){t||a.SetState("p=".concat(e.uid)),this.curKmap=e,this.recentPages.push(e.uid+"|"+e.title+"|"+e.asset_type);var s,n=this.recentPages.length-1;for(s=n-1;s>=0;--s)if(this.recentPages[s]==this.recentPages[n]){this.recentPages.splice(s,1);break}"related"!=a.ss.mode&&this.DrawHeader(e),d()(this.div).css({"background-image":""}),d()(this.div).css({"padding-left":"12px",width:"calc(100% - 24px"}),d()(this.div).css({display:"block",color:"#000"}),"related"==a.ss.mode&&(e.asset_type.match(/places|subjects|terms/)||d()(this.div).css({"padding-left":"192px",width:"calc(100% - 216px"})),"places"==e.asset_type?a.plc.Draw(e):"sources"==e.asset_type?a.src.Draw(e):"terms"==e.asset_type?a.trm.Draw(e):"subjects"==e.asset_type?a.sub.Draw(e):"images"==e.asset_type?a.img.Draw(e):"audio-video"==e.asset_type?a.av.Draw(e):"texts"==e.asset_type?a.txt.Draw(e):"visuals"==e.asset_type?a.vis.Draw(e):"collections"==e.asset_type&&a.col.Draw(e)}}},{key:"ShowPopover",value:function(e,t){var a=this,s=this.sui;if((!e||!e.match(/collections-/))&&(!this.PopoverTimer||"mousemove"!=t.type)&&("mousemove"!=t.type||e!=this.lastPopover))return"mousedown"==t.type?("related"==s.ss.mode&&(s.ss.mode=this.lastMode),this.relatedBase=null,s.GetKmapFromID(e,(function(e){a.Draw(e)})),void this.ClearPopover()):void(this.PopoverTimer=setTimeout((function(){a.DisplayPopover(e,t)}),500))}},{key:"ClearPopover",value:function(){clearTimeout(this.PopoverTimer),this.PopoverTimer=null,d()("[id^=sui-popover-]").remove(),this.lastPopover=""}},{key:"DisplayPopover",value:function(e,t){var a,s,n=this,i=this.sui;clearTimeout(this.PopoverTimer),this.PopoverTimer=null,t.target?s=d()(t.target).offset():((s=d()("#plc-main").offset()).top+=t.y,s.left+=t.x);var r=Math.max(160,Math.min(s.left,d()("#sui-main").width()-200)),l=s.left-r+150,c=String(l)+"px";if(s.top){this.lastPopover=e,i.GetKmapFromID(e,(function(t){var l;if(t)if(t.error)console.error("Solr Callback for sui.GetKmapFromID (pages.js, line 201) returned error for kmap ".concat(e,": \n"),t.error.stack);else{d()("[id^=sui-popover-]").remove();var o=d()("#sui-main").scrollTop(),u="<div id='sui-popover-".concat(e,"' class='sui-popover' \n\t\t\tstyle='top:").concat(s.top+24+o,"px;left:").concat(r-150,"px'><div class='sui-popover-body'>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid #999;top:-10px;\n\t\t\tleft:").concat(c,"'</div>\n\t\t\t<div style='position:absolute;width:0;height:0;border-left:8px solid transparent;\n\t\t\tborder-right:8px solid transparent;border-bottom:10px solid white;left:-8px;top:2px;'</div>\n\t\t\t</div>");if(d()("#sui-main").append(u.replace(/\t|\n|\r/g,"")),d()("#sui-main").one("click",(function(){n.ClearPopover()})),u="<div style='float:right;margin-top:-8px;font-size:10px'>".concat(t.id,"</div>\n\t\t\t<strong>").concat(t.title?t.title[0]:"untitled","</strong><hr style='border-top:1px solid #ccc'>\n\t\t\t<span style='font-size:12px;text-transform:capitalize'>\n\t\t\tFor more information about this ").concat(t.asset_type.slice(0,-1),", see Full Entry below.<p>"),t.feature_types_idfacet&&"places"==t.asset_type)for(u+="<strong>Feature types: </strong>",a=0;a<t.feature_types_idfacet.length;++a)l=t.feature_types_idfacet[a].split("|"),u+="<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-".concat(l[1],"'\n\t\t\t\t\thref='#p=").concat(l[1],"'>").concat(l[0],"</a>"),a<t.feature_types_idfacet.length-1?u+=", ":u+="<br>";if(t.ancestors_txt&&t.ancestors_txt.length>1&&(u+="<strong>".concat(t.asset_type,": </strong>")),t.ancestors_txt)for(a=0;a<t.ancestors_txt.length-1;++a)u+="<a class='sui-crumb' style='color:#000;text-transform:none' id='sui-crumb-".concat(t.asset_type,"-").concat(t.ancestor_ids_is[a],"'\n\t\t\t\t\thref='#p=").concat(t.asset_type,"-").concat(t.ancestor_ids_is[a],"'>").concat(t.ancestors_txt[a],"</a>"),a<t.ancestors_txt.length-2&&(u+=" / ");u+="</p></span>",d()("#sui-popover-"+e).find(".sui-popover-body").eq(0).append(u.replace(/\t|\n|\r/g,""));var p="<div id='sui-popbot'> \n\t\t\t<a class='sui-popItem' href='#p=".concat(t.uid,"'>\n\t\t\t<p id='sui-full-").concat(t.uid,"'>&#xe629&nbsp;&nbsp;FULL ENTRY</p></a>\n\t\t\t</div>");d()("#sui-popover-"+e).append(p.replace(/\t|\n|\r/g,"")),d()("#sui-popover-"+e).on("mouseleave",(function(){n.ClearPopover()})),d()("#sui-full-"+e).on("click",(function(e){n.ClearPopover(),"related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.relatedBase=null;var t=e.currentTarget.id.substring(9).toLowerCase();return i.GetKmapFromID(t,(function(e){i.SendMessage("",e)})),!1})),d()("[id^=sui-crumb-]").on("click",(function(e){n.ClearPopover(),"related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.relatedBase=null;var t=e.currentTarget.id.substring(10).toLowerCase();return i.GetKmapFromID(t,(function(e){i.SendMessage("",e)})),!1}))}}));var o=i.solrUtil.createKmapQuery(e,null,null,300);d.a.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var a,s,r="";if(!d()("[id^=sui-pop-]")[0]&&t.facets.asset_counts.buckets&&t.facets.asset_counts.buckets.length){var l=t.facets.asset_counts.buckets;for(a=0;a<l.length;++a)s=l[a].count,"texts:pages"!=l[a].val&&(s>1e3&&(s=Math.floor(s/1e3)+"K"),r+="<a class='sui-popItem' href='#v=".concat(e,"=").concat(l[a].val,"'>\n\t\t\t\t\t<p id='sui-pop-").concat(e,"-").concat(l[a].val,"' style='cursor:pointer;text-transform:capitalize'>\n\t\t\t\t\t<span style='color:").concat(i.assets[l[a].val].c,"'>").concat(i.assets[l[a].val].g,"</span>\n\t\t\t\t\t&nbsp;&nbsp;Related ").concat(l[a].val," (").concat(s,")</p></a>"));d()("#sui-popbot").append(r.replace(/\t|\n|\r/g,"")),d()("[id^=sui-pop-]").on("click",(function(t){n.ClearPopover();var a=t.currentTarget.id.toLowerCase().split("-");"audio"==a[4]&&(a[4]="audio-video");var s=i.solrUtil.createKmapQuery(a[2]+"-"+a[3],a[4],0,1e3);return d.a.ajax({url:s,dataType:"jsonp",jsonp:"json.wrf"}).done((function(e){i.curResults=i.MassageKmapData(e.response.docs),i.DrawItems(),i.DrawFooter(),i.ss.page=0})),i.GetKmapFromID(e,(function(e){n.relatedBase=e,n.relatedId=e.asset_type+"-"+e.id,n.DrawHeader(e)})),!1}))}}))}}},{key:"DrawRelatedAssets",value:function(e,t){var a,s,n=this,i=this.sui,r="",l=!0,c=this.relatedBase||e;if(c&&(l=c.asset_type.match(/places|subjects|terms|collections/)),"related"==i.ss.mode?e=this.relatedBase:this.lastMode=i.ss.mode,e&&(l||"related"==i.ss.mode)){if("collections"!=c.asset_type){var o=i.solrUtil.createKmapQuery(e.uid);d.a.ajax({url:o,dataType:"jsonp",jsonp:"json.wrf"}).done((function(t){var a,s,n=0;if(t.facets.asset_counts.buckets&&t.facets.asset_counts.buckets.length){var i=t.facets.asset_counts.buckets;for(a=0;a<i.length;++a)"texts:pages"!=i[a].val&&("terms"==e.asset_type&&"terms"==i[a].val||(n+=s=i[a].count,s>1e3&&(s=Math.floor(s/1e3)+"K"),d()("#sui-rln-"+i[a].val).html(s),d()("#sui-rl-"+i[a].val).css({display:"block"})));n>1e3&&(n=Math.floor(n/1e3)+"K"),d()("#sui-rln-all").html(n),d()("#sui-rl-all").css({display:"block"})}var r="#sui-btree-"+e.asset_type;d()("#sui-footer").offset()&&d()(r).offset()&&d()(r).css("max-height",d()("#sui-footer").offset().top-d()(r).offset().top-40+"px")}))}else l=!1,s=e.asset_subtype.toLowerCase();for(a in d()("#c-columnContent__main").scrollTop(0),d()(this.div).scrollTop(0),a=e.asset_type,r+="<div class='l-related__wrap' style='border-color:".concat("related"==i.ss.mode?i.assets[a].c:"transparent",";\n\t\t\theight:").concat(d()(this.div).height()+6,"px'>"),"related"!=i.ss.mode&&(r+="RELATED RESOURCES<hr>"),r+="<div class='c-relatedViewer'>",r+="<div class='c-related__item' id='sui-rl-Home'><span style='font-size:18px; vertical-align:-3px; color:"+i.assets[a].c+"'>"+i.assets[a].g+" </span> <b style='color:"+i.assets[a].c+"'>Home</strong></div>","collections"==c.asset_type&&(r+="<div class='c-related__item' id='sui-rl-"+s+"'><span style='font-size:18px; vertical-align:-3px; color:"+i.assets[s].c+"'>"+i.assets[s].g+" </span> "+e.asset_subtype+"</div>"),i.assets)r+="<a class='c-related__item' style='display:none' id='sui-rl-"+a.toLowerCase(),r+="' href='#r="+this.relatedId+"="+this.relatedId+"="+a+"="+e.uid+"'>",r+="<span style='font-size:18px; vertical-align:-3px; color:"+i.assets[a].c+"'>"+i.assets[a].g+"</span> ",r+=a.charAt(0).toUpperCase()+a.substr(1)+" (<span id='sui-rln-"+a.toLowerCase()+"'>0</span>)</a>";0,d()(this.reldiv).html(r.replace(/\t|\n|\r/g,"")),l&&this.DrawTree("#sui-btree-"+e.asset_type,e.asset_type),this.relatedType?d()("#sui-rl-"+this.relatedType).css({"background-color":"#f7f7f7"}):d()("#sui-rl-Home").css({"background-color":"#f7f7f7"}),d()("[id^=sui-rcItem-]").off("click"),d()("[id^=sui-rcItem-]").on("click",(function(e){var t=e.currentTarget.id.substring(11);return"related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.relatedBase=null,i.GetKmapFromID(t,(function(e){i.SendMessage("",e)})),!1})),d()("[id^=sui-rl-]").on("click",(function(a){return alert("CLICKED RELATED LINK "+a.target),n.relatedType=a.currentTarget.id.substring(7),"Home"==n.relatedType?("related"==i.ss.mode&&(i.ss.mode=n.lastMode),n.Draw(n.relatedBase?n.relatedBase:e),n.relatedBase=null):"places"==c.asset_type&&"places"==n.relatedType?i.plc.Draw(e,4):"places"==c.asset_type&&"subjects"==n.relatedType?i.plc.Draw(e,3):"subjects"==c.asset_type&&"subjects"==n.relatedType?i.sub.Draw(e,1):"subjects"==c.asset_type&&"places"==n.relatedType?i.sub.Draw(e,2):(n.relatedBase||(n.relatedBase=e),n.DrawRelatedResults(e),t||i.SetState("r="+n.relatedId+"="+n.relatedBase.uid+"="+n.relatedType+"="+e.uid)),!1}))}}},{key:"DrawRelatedResults",value:function(e){e.uid&&e.uid;var t=this.sui;t.ss.mode="related",this.relatedBase||(this.relatedBase=e),this.relatedId=this.relatedBase.asset_type+"-"+this.relatedBase.id,t.Query(!1,"collections"==e.asset_type?e.uid:""),t.DrawFooter(),t.ss.page=0}},{key:"DrawHeader",value:function(e){}},{key:"AddRelTreeLine",value:function(e,t,a,s){var n=this.sui,i="<li style='margin:2px 0 2px ".concat(-24,"px'>");return i+=a?"<div class='sui-spDot' id='sui-spDot-".concat(s,"'>").concat(a,"</div>"):"<div class='sui-spLoner'><strong>&bull;&nbsp;&nbsp;</strong></div>",i+="<a class='sui-noA' href='#p=".concat(t,"' id='sui-spLab-").concat(t,"'>").concat(e,"</strong>").concat(n.pages.AddPop(t),"</a>")}},{key:"AddRelBranch",value:function(e,t,a){var s=this,n=this.sui,i=this;n.GetTreeChildren(e,t,(function(t){var n,r,l,c,o,u="",p=[];try{p=t.facets.child_counts.buckets}catch(m){}for(t=t.response.docs,n=0;n<t.length;++n){for(o="",c=null,l=new RegExp(t[n].id.split("-")[1]),r=0;r<p.length;++r)p[r].val.match(l)&&(c="+",o=p[r].val);u+="<ul style='list-style-type:none'>",u+=s.AddRelTreeLine(t[n].header,t[n].id,c,o)+"</li></ul>"}d()(a).prop("id","sui-spDot-null"),a.parent().append(u),d()("[id^=sui-spDot-]").off("click"),d()("[id^=sui-spDot-]").on("click",(function(t){var a=d()(this).parent().find("ul")[0],s=t.currentTarget.id.substring(10);"null"!=s?(d()(this).html("&ndash;"),i.AddRelBranch(e,s,d()(this))):d()(this).html("none"==d()(a).css("display")?"&ndash;":"+"),d()(this).parent().find("ul").slideToggle()}))}))}},{key:"DrawTabMenu",value:function(e){var t,a="";for(t=0;t<e.length;++t)a+="<div class='sui-tabTab' id='sui-tabTab".concat(t,"' style='width:calc(").concat(100/e.length,"% - 2px)'>").concat(e[t],"&nbsp;&#xe609</div>");return(a+="<div class='sui-tabContent' id='sui-tabContent'></div>").replace(/\t|\n|\r|/g,"")}},{key:"DrawCarousel",value:function(e){var t,a=this.sui,s=0,n="<div class='sui-caroBox'>\n\t\t<div class='sui-caroButL' id='sui-caroButL'>&#xe640</div>\n\t\t<div class='sui-caroButR' id='sui-caroButR'>&#xe641</div>\n\t\t<div class='sui-caroHeader'>&nbsp;</div>\n\t\t\t<div class='sui-caroLeft'>\n\t\t\t\t<div class='sui-caroTitle' id='sui-caroTitle'></div>\n\t\t\t\t<div class='sui-caroText' id='sui-caroText'></div>\n\t\t\t</div>\n\t\t\t<img class='sui-caroPic' id='sui-caroPic' src=''><br>\n\t\t\t<a class='sui-caroRes' id='sui-caroRes')' href='#p=".concat((e=[{title:"The Shinj\xe9 Yapyum Cham is performed",text:"One of the most common sacred masked dances performed during religious festivals in Bhutan is the Shinj\xe9 Yapyum Cham. The dance is often performed early during a festival\u2019s program as it is believed to subdue negative spirits and harmful influences. Although known as the Shinj\xe9 Yapyum Cham, or the Dance of the Male and Female Lords of Death, it represents the male and female Yam\u0101ntaka is the Destroyer of Death...",pic:"https://cicada.shanti.virginia.edu/images/mandala/shanti-image-550401/full/!600,/0/default.jpg",id:"images-stage_shanti_virginia_edu-1187696"},{title:"A Song Called Ja legmo Tsering",text:"Unlike today, meeting a person was extremely difficult in the past. The lyrics of this song say that meeting someone was considered as an act of fate. People would meet even if they had never thought of meeting that person. The composer wishes for two people who have met through fate, to stay together for their entire life...",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_xvwn4fvx/version/100021/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-22741"},{title:"Tongue Twister in the Kheng Language",text:"In the past, parents taught their kids tongue twisters as a way to practice pronunciation. Rinchen Drakpa from Sharigang presents two tongue twisters in his local language, Khengkha. Rinchen Drakpa says that in his childhood he witnessed villagers competing to be the one who could say the tongue twisters with the most perfect pronunciation.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/0_ou7n6lp9/version/100021/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-3806"},{title:"Seven Limbs of Practice: Ch\xf6pa",text:"Most Bhutanese Buddhist rituals contain the set of seven practices known as yoen lak duen pa (\u0f61\u0f53\u0f0b\u0f63\u0f42\u0f0b\u0f56\u0f51\u0f74\u0f53\u0f0b\u0f54\u0f0b). The seven practices prostration (\u0f55\u0fb1\u0f42\u0f0b), offering (\u0f58\u0f46\u0f7c\u0f51\u0f0b\u0f54\u0f0b), confession (\u0f56\u0f64\u0f42\u0f66\u0f0b\u0f54\u0f0b), rejoicing (\u0f62\u0f97\u0f7a\u0f66\u0f0b\u0f66\u0f74\u0f0b\u0f61\u0f72\u0f0b\u0f62\u0f44\u0f0b\u0f56\u0f0b), request to live long (\u0f56\u0f5e\u0f74\u0f42\u0f66\u0f0b\u0f54\u0f62\u0f0b\u0f42\u0f66\u0f7c\u0f63\u0f0b\u0f56\u0f0b\u0f60\u0f51\u0f7a\u0f56\u0f66\u0f0b\u0f54\u0f0b), request to turn the wheel of Dharma (\u0f46\u0f7c\u0f66\u0f0b\u0f40\u0fb1\u0f72\u0f0b\u0f60\u0f41\u0f7c\u0f62\u0f0b\u0f63\u0f7c\u0f0b\u0f66\u0f90\u0f7c\u0f66\u0f90\u0f7c\u0f62\u0f0b\u0f56\u0f62\u0f0b\u0f56\u0f66\u0f90\u0f74\u0f63\u0f0b\u0f56\u0f0b) and to dedicate the merits (\u0f56\u0f66\u0f94\u0f7c\u0f0b\u0f56\u0f0b).This piece was initially published in Bhutan\u2019s national newspaper Kuensel..",pic:"https://mms.thlib.org/images/0050/8753/63691_large.jpg",id:"texts-stage_shanti_virginia_edu-38836"},{title:"A Story of a Rich and a Poor Girl",text:"Ap Tempo of Karna Gewog, Dagana narrates a story of a poor girl who is straight forward and faithful. Her rich friend was always insecure. The poor girl gets rewarded by a deity for her kind heart and good attitude; she suddenly becomes rich, and her rich friend became insecure about her. She tries to achieve what the poor girl has achieved, but gets punished due to her jealousy and greediness.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_607tfowl/version/100031/600/600/height/0",id:"audio-video-stage_shanti_virginia_edu-24651"},{title:"An Exchange of Tsangmo Poems",text:"Tsangmo is a type of song used to express individual's emotions, conveying their inner warmth and affection to another person, through numerious lyrical tunes. Tsangmo can be sung to express love, hatred and any other feelings. While it is sung, the Tsangmo songs are never sung with dance, as it is a poetry song for a singing expression without a dance. It is usually a composition limited to a verse of four lines for an expression.",pic:"https://cfvod.kaltura.com/p/381832/sp/38183200/thumbnail/entry_id/1_zk9hsnff/version/100011/609/600/height/0",id:"audio-video-stage_shanti_virginia_edu-22596"}])[s].id,"'>\n\t\t\t<i>View Resource</i>&nbsp;&nbsp;&#xe683</a>\n\t\t\t<div class='sui-caroDots'>");for(t=0;t<e.length;++t)n+="<div class='sui-caroDot' id='sui-caroDot-".concat(t,"'></div>");function i(t){d()("#sui-caroTitle").html("&#xe633&nbsp;&nbsp;"+e[t].title),d()("#sui-caroText").html(e[t].text),d()("#sui-caroPic").prop("src",e[t].pic),d()("[id^=sui-caroDot-]").css({"background-color":"#fff"}),d()("#sui-caroDot-"+t).css({"background-color":"#5d68cc"})}n+="</div></div>",d()(this.div).append(n.replace(/\t|\n|\r/g,"")),clearInterval(this.carouselTimer),this.carouselTimer=setInterval((function(){d()("#sui-caroButR").trigger("click")}),8e3),i(s),d()("#sui-caroRes").on("click",(function(t){return a.GetKmapFromID(e[s].id,(function(e){a.SendMessage("",e)})),!1})),d()("#sui-caroButL").on("click",(function(t){i(s=s?s-1:e.length-1)})),d()("#sui-caroButR").on("click",(function(t){i(s=s==e.length-1?0:s+1)})),d()("[id^=sui-caroDot-]").on("click",(function(t){s=t.target.id.substring(12),i(s=Math.min(e.length-1,Math.max(s,0)))}))}},{key:"DrawItem",value:function(e,t,a,s,n,i){var r,l="<p>";if(null==a||void 0==a)return"";if(e&&(l+=e+"&nbsp;&nbsp;"),l+="<span class='sui-pageLab'",i&&(l+=" style='font-weight:600'"),l+=">"+t+":&nbsp;&nbsp;</span>",l+="<span class='",l+=(n||"sui-pageVal")+"'>","object"==typeof a)for(r=0;r<a.length;++r)a[r].header?l+=a[r].header:a[r].value?l+=a[r].value:a[r].val?l+=a[r].val:a[r].title?l+=a[r].title:l+=a[r],r!=a.length-1&&(l+=", ");else l+=a&&!a.match(/undefined/)?a:s;return l+"</span></p>"}},{key:"FormatDate",value:function(e,t){var a=new Date(e);return a&&(t="string"!=typeof t?"default":t),e="short"==t?a.toDateString():a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()}},{key:"GetLangCode",value:function(e){var t=(e=d.a.trim(e.replace(/(<([^>]+)>)/gi,""))).charCodeAt(0);return t>2303&&t<2432?"sa":t>3455&&t<3584?"si":t>3583&&t<3712?"th":t>3839&&t<4096?"bo":t>4095&&t<4256?"my":t>4352&&t<4547?"ko":t>6143&&t<6320?"mn":t>12351&&t<12446?"ja":t>19967?"zh":""}},{key:"WrapInLangSpan",value:function(e,t){var a=t?" text-nowrap":"",s=this.GetLangCode(e);return""===s?e:'<span class="u-'.concat(s).concat(a,'">').concat(e,"</span>")}},{key:"GetPublicUrlPath",value:function(e){var t=window.location.href.split("#"),a=(t=(t=t[0].split(e))[0].split(window.location.host)).length>1&&t[1];return a&&"/"!==a[a.length-1]&&(a+="/"),a}},{key:"AddPop",value:function(e,t){this.sui;window.sui=this.sui;return"&nbsp;<img class='popover-icon' style='display:inline-block' src='".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAANCAYAAABLjFUnAAAACXBIWXMAAAsSAAALEgHS3X78AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFlJREFUeNpijEq9+J+BSoBp6Sw9RqoZxsDAwEAtAxn//0f4MjrtEoaXl87Sw2tAdNol7IbhMpAsl2EzkBSXsRCyDVkxIUDQsFGXYU+0VM0B1AIAAAAA//8DAPEeJvJ295NvAAAAAElFTkSuQmCC","' \n                    ").concat(t?"style='width:13px'":"","\n                    onmouseenter='sui.pages.ShowPopover(\"").concat(e,"\",event); return false;'\n                    onmousemove='sui.pages.ShowPopover(\"").concat(e,"\",event); return false;'\n                    onmousedown='sui.pages.ShowPopover(\"").concat(e,"\",event) return false;'>").replace(/\t|\n|\r|/g,"")}},{key:"DrawTree",value:function(e,t){var a=this.sui;a.curTree=t,"places"==t?a.LazyLoad(e,null,t,13735):a.GetTopRow(e,t),d()("#sui-footer").offset()&&d()(e).offset()&&d()(e).css("max-height",d()("#sui-footer").offset().top-d()(e).offset().top-120+"px")}}]),e}(),w=a(31),x=a(9),T=a(21),j=a(7),S="standalone"===Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om",REACT_APP_STANDALONE_PATH:"/mandala",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyAXpnXkPS39-Bo5ovHQWvyIk6eMgcvc1q4",REACT_APP_GOSERVER_URL:"https://dev-places.kmaps.virginia.edu/geoserver/"}).REACT_APP_STANDALONE?j.b:j.a,A=a(55),P=a.n(A),N=a(18),O=a(5),C=a(19),D=a.n(C),R=document.getElementById("basicSearchPortal");function L(e){var t,a=Object(T.h)(),s=Object(l.useRef)(null),n=Object(N.k)((function(e){return e}));var i=null===(t=n.search.query)||void 0===t?void 0:t.searchText,r=function(){e.search.setSearchText(s.current.value),e.onSubmit(s.current.value),console.log("BasicSearch handleSubmit: ",s.current.value),"standalone"===Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om",REACT_APP_STANDALONE_PATH:"/mandala",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyAXpnXkPS39-Bo5ovHQWvyIk6eMgcvc1q4",REACT_APP_GOSERVER_URL:"https://dev-places.kmaps.virginia.edu/geoserver/"}).REACT_APP_STANDALONE?window.location.href="".concat("/mandala","/#/search"):a.push("/search")},o=D.a.debounce((function(){console.log("BasicSearch handleChange: ",s.current.value)}),500);Object(l.useLayoutEffect)((function(){s.current.value!==e.search.query.searchText&&(s.current.value=e.search.query.searchText)}));var d=c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"sui-search1"},c.a.createElement("input",{type:"text",id:"sui-search",className:"sui-search2",defaultValue:i,placeholder:"Enter Search",onChange:o,onKeyDownCapture:function(e){13===e.keyCode&&r()},ref:s}),c.a.createElement("span",{className:"l-search__input__buttons"},c.a.createElement("span",{id:"sui-searchgo",className:"sui-search4",onClick:r},c.a.createElement("span",{className:"icon"})),c.a.createElement("span",{id:"sui-clear",className:"sui-search3",onClick:function(){s.current.value="",e.search.setSearchText(s.current.value),e.onSubmit(s.current.value),console.log("BasicSearch clearInput: ",s.current.value)}}," ","x"," "))));return R?P.a.createPortal(d,R):d}L.propTypes={onChange:O.func};var I=a(199);function M(e){var t=Object(l.useState)(""),a=Object(x.a)(t,2),s=(a[0],a[1]);return c.a.createElement("section",{id:"c-site__search",className:"c-site__search"},c.a.createElement(I.a,null,c.a.createElement(L,{onSubmit:function(e){console.log("Submit: "+e),s(e)},onChange:function(e){console.log("Input Change",e.target.value),s(e.target.value)}})))}a(541);function F(e){return c.a.createElement("header",{className:"standalone"!==Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om",REACT_APP_STANDALONE_PATH:"/mandala",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyAXpnXkPS39-Bo5ovHQWvyIk6eMgcvc1q4",REACT_APP_GOSERVER_URL:"https://dev-places.kmaps.virginia.edu/geoserver/"}).REACT_APP_STANDALONE?"c-site__header":"c-site__header-standalone"},c.a.createElement("nav",{className:"navbar navbar-expand-lg bg-light"},c.a.createElement(j.c,{to:"/home",className:"navbar-brand"},c.a.createElement("img",{src:"/mandala-om/img/bhutanleft.gif",alt:"Home Page",className:"o-image-logo d-inline-block align-top"}),c.a.createElement("h1",{className:"sr-only"},"Bhutan Library")),c.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav",role:"navigation"},c.a.createElement("ul",{className:"navbar-nav"},c.a.createElement("li",{className:"nav-item active"},c.a.createElement("a",{className:"nav-link",href:"#"},"Home ",c.a.createElement("span",{className:"sr-only"},"(current)"))),c.a.createElement("li",{className:"nav-item"},c.a.createElement("a",{className:"nav-link",href:"#"},"About")),c.a.createElement("li",{className:"nav-item"},c.a.createElement("a",{className:"nav-link",href:"#"},"Documentation")))),c.a.createElement(M,{advanced:e.advanced,tree:e.tree,onStateChange:e.onStateChange}),c.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},c.a.createElement("span",{className:"navbar-toggler-icon"}))))}var U=a(269),q=(a(542),a(268)),B=a(390),G=a(391);a(543);function H(e){return c.a.createElement(q.a,null,c.a.createElement(B.a,null,c.a.createElement(G.a,null,c.a.createElement(U.a,null,c.a.createElement("h3",null,"Work-in-Progress"),c.a.createElement("h4",null,"Terms"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/terms/terms-12434"},"/terms/terms-12434")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/terms/terms-45057"},"'gro ba/ (terms-45057)")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/terms/terms-85193"},"thod rgal/: (terms-85193)"))),c.a.createElement("h4",null,"Places"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-16408"},"Potala Palace: (places-16408)")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-637"},"Lhasa: (places-637)")),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-637/related-images/deck"},"Related Images")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-637/related-audio-video/deck"},"Related Audio-Video"))),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-427"},"Bhutan: (places-427)")),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-427/related-images/deck"},"Related Images")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/places/places-427/related-audio-video/deck"},"Related Audio-Video")))),c.a.createElement("h4",null,"Subjects"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/subjects/subjects-20"},"Geographical Features: (subjects-20)")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/subjects/subjects-8260"},"Bhutan Cultural Library: (subjects-8260)")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/subjects/subjects-3719"},"Whaling Station Test: (subjects-3719)")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/subjects/subjects-4102"},"Tibetan Contemporaneous Art: (subjects-4102)"))),c.a.createElement("h4",null,"Search"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/search"},"/search"))),c.a.createElement("h4",null,"Collections"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/audio-video/collection/3"},"Audio-Video Collection: THL")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/images/collection/45316"},"Image Collection: Central Tibet")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/sources/collection/23541"},"Source Collection: Yog\u0101c\u0101ra Example")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/texts/collection/48596"},"Text Collection: University of Flourishing")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/visuals/collection/5786"},"Visual Collection: University of Flourishing"))),c.a.createElement("h4",null,"Audio-Video"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/audio-video/825"},"Video: Carpenter of Lhagya Ri Palace")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/audio-video/306"},"Video: Dawa and Pudr\xf6n Flirt")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/audio-video/9246"},"Video: Riddle of the Terma Vase")," ","(Many Agents, Transcript, Tibetan and Chinese text)")),c.a.createElement("h4",null,"Images"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/images/1421596"},"Image: Dudul Dorjay Festival Photo")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/images/160186"},"Image: High Tibet Chu ser")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/images/1243906"},"Image: Lhasa Mural Painting")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/images/45806"},"Image: Woman on Basum Island"))),c.a.createElement("h4",null,"Sources"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/sources/26856"},"Source: Winternitz Dummy Test")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/sources/87826"},"Source: 100% Renewable Energy Systems")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/sources/87476"},"Source: Accounting for Nat. Resources & Env. Sustainability"))),c.a.createElement("h4",null,"Texts"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/texts/16230"},"Text: Introduction to Drepung Colleges")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/texts/46641"},"Text: Veronoica\u2019s Test")," ","has embedded video etc."),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/texts/50751"},"Text: Hagar of The Pawn-Shop")," ","has Hagar... and a Pawn Shop.")),c.a.createElement("h4",null,"Visuals"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(j.c,{to:"/visuals/4451"},"Visuals: Bloodtype Pie Chart")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/visuals/5821"},"Visuals: Vimeo Video")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/visuals/1806"},"Visuals: Graph Indo-European Languages")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/visuals/5266"},"Visuals: Timeline DH Chronology"))),c.a.createElement("h4",null,"References"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement("a",{href:"https://www.viseyes.org/ksolr/#s=text:lhasa=assets:All:all:AND"},"KSolr search on Lhasa")),c.a.createElement("li",null,c.a.createElement(j.c,{to:"/poptest/places/637"},"Kmaps Popover Test Page")))))))}var z=a(45);function K(e){var t=e.uid,a=e.label,s=e.className,n=t.split("-"),i=Object(x.a)(n,2),r=i[0],l=t;if("collection"==i[1]){var o=t.split("-"),d=o.pop(),u=o.join("-");return c.a.createElement(j.c,{className:s,key:l,to:"/"+u+"/"+d},a)}return c.a.createElement(j.c,{className:s,key:l,to:"/"+r+"/"+t},a)}a(544);function V(e){var t=Object(z.c)((function(e){return e.status})),a=[];t.path.forEach((function(e,t){0!==t&&a.push(">"),"/"==e.uid.charAt(0)?a.push(c.a.createElement(j.c,{key:e.uid,to:e.uid,className:"breadcrumb-item"},e.name)):a.push(c.a.createElement(K,{key:e.uid,className:"breadcrumb-item",uid:e.uid,label:e.name}))}));var s=a;return c.a.createElement("header",{id:"c-content__header__main",className:"c-content__header__main legacy ".concat(e.siteClass," ").concat(t.type)},c.a.createElement("div",{id:"c-content__header__main__wrap",className:"c-content__header__main__wrap legacy"},c.a.createElement("h1",{className:"c-content__header__main__title"},c.a.createElement("span",{className:"icon u-icon__".concat(t.type)}),t.headerTitle),c.a.createElement("div",{className:"c-content__header__breadcrumb breadcrumb"},s),c.a.createElement("h5",{className:"c-content__header__main__id"},t.id),c.a.createElement("h4",{className:"c-content__header__main__sub"},t.subTitle)))}var Y=function(){return Object(N.i)((function(e){return e.status}))},W=a(71),Q=a.n(W),J=a(72),X=a(364),Z=a(181),$=(a(545),a(125)),ee=a(66),te=a(123),ae=a(54),se=a(167),ne=a(270),ie=a.n(ne);function re(e){var t=Array.isArray(e.doc.title)&&e.doc.title.length>0?e.doc.title[0]:e.doc.title;function a(e,t){return D.a.findIndex(e,(function(e){return e===t}))}switch(e.doc.asset_type){case"places":var s=a(e.doc.ancestors_txt,"United States of America");if(s>1){var n=e.doc.ancestors_txt[s+1];a(e.doc.feature_types_ss,"County")>-1&&(t+=" County"),-1===a(e.doc.feature_types_ss,"State")&&(t+=", "+n)}break;case"subjects":case"terms":case"audio-video":case"texts":case"sources":case"visuals":case"images":break;case"collections":e.doc.asset_subtype&&(t+=" ("+e.doc.asset_subtype+")")}return c.a.createElement(ie.a,{style:{whiteSpace:"pre-wrap"},maxLine:2,text:t,basedOn:"words"})}function le(e){var t=e.doc;var a,s,n=c.a.createElement(c.a.Fragment,null,t.ancestors_txt.join("/"));switch(t.asset_type){case"places":n=(a=e.doc.ancestors_txt,s="United States of America",D.a.findIndex(a,(function(e){return e===s})))>1?c.a.createElement(c.a.Fragment,null,t.ancestors_txt.slice(3,6).join("/")):c.a.createElement(c.a.Fragment,null,t.ancestors_txt.slice(2,5).join("/"));break;case"subjects":n=c.a.createElement(c.a.Fragment,null,t.ancestors_txt[t.ancestors_txt.length-2]);break;case"terms":n=null}return n}a(546),a(547),a(549);function ce(e){return c.a.createElement("div",{className:"c-smartRelateds__limited"},e.relateds)}a(550);var oe={"audio-video/video":c.a.createElement("span",{className:"icon color-invert u-icon__video"}),"audio-video/audio":c.a.createElement("span",{className:"icon color-invert u-icon__audio"})};function de(e){var t,a,s,n,i,r,l,o=e.inline||!1,d=c.a.useState(!1),u=Object(x.a)(d,2),p=u[0],m=u[1],h=oe[e.doc.asset_type+"/"+e.doc.asset_subtype],v=e.doc.uid?h||c.a.createElement("span",{className:"icon color-invert u-icon__"+e.doc.asset_type}):null,f=e.doc.uid&&"images"!==e.doc.asset_type&&"audio-video"!==e.doc.asset_type?c.a.createElement("span",{className:"icon u-icon__"+e.doc.asset_type}):null,g=e.doc.asset_type,_=null===(t=e.doc.kmapid_places_idfacet)||void 0===t?void 0:t.map((function(e,t){var a=e.split("|"),s=Object(x.a)(a,2),n=s[0],i=s[1];return c.a.createElement("div",{key:t,className:"c-card__content-field shanti-field-place"},c.a.createElement("span",{className:"icon shanti-field-content"},c.a.createElement(K,{uid:i,label:n})))})),b=null===(a=e.doc.kmapid_subjects_idfacet)||void 0===a?void 0:a.map((function(e,t){var a=e.split("|"),s=Object(x.a)(a,2),n=s[0],i=s[1];return c.a.createElement("div",{key:t,className:"c-card__content-field shanti-field-subject"},c.a.createElement("span",{className:"icon shanti-field-content"},c.a.createElement(K,{uid:i,label:n})))})),y=null===(s=e.doc.feature_types_idfacet)||void 0===s?void 0:s.map((function(e,t){var a=e.split("|"),s=Object(x.a)(a,2),n=s[0],i=s[1];return c.a.createElement("div",{key:i,className:"c-card__content-field shanti-field-subject"},c.a.createElement("span",{className:"icon shanti-field-content"},c.a.createElement(K,{uid:i,label:n})))})),E=e.doc.node_created?e.doc.node_created:e.doc.timestamp;E=null===(n=E)||void 0===n?void 0:n.split("T")[0];var k=(null===(i=e.doc.creator)||void 0===i?void 0:i.length)>0?e.doc.creator.join(", "):e.doc.node_user;(null===(r=e.doc.creator)||void 0===r?void 0:r.length)>3&&(k=e.doc.creator.slice(0,3).join(", ")+"\u2026"),k&&(k=k.replace(/\&amp\;/g,"&"));var w=null===(l=e.doc)||void 0===l?void 0:l.collection_uid_path_ss;w&&w.length>0&&(w="/"+(w=w[w.length-1]).replace("-collection-","/collection/"));var T=e.doc.collection_title?c.a.createElement(j.c,{to:w},c.a.createElement("span",{className:"icon u-icon__collections"}," ",e.doc.collection_title," ")):c.a.createElement("span",null,e.doc.ancestors_txt&&"terms"!==e.doc.asset_type&&c.a.createElement("div",{className:"info shanti-field-path"},c.a.createElement("span",{className:"shanti-field-content u-icon__"+e.doc.asset_type},c.a.createElement(le,{doc:e.doc})))),S=null;"places"===e.doc.asset_type?S=y:"subjects"===e.doc.asset_type?S=_:"terms"===e.doc.asset_type&&(S=b);var A=o?"./view/".concat(e.doc.uid,"?asset_type=").concat(e.doc.asset_type):"/".concat(g,"/").concat(e.doc.id);return c.a.createElement(te.a,{key:e.doc.uid,className:"c-card__grid--"+e.doc.asset_type},c.a.createElement(j.c,{to:A,className:"c-card__link--asset c-card__wrap--image"},c.a.createElement(te.a.Img,{className:"c-card__grid__image--top",variant:"top",src:e.doc.url_thumb}),c.a.createElement("div",{className:"c-card__grid__glyph--type color-invert"},v),c.a.createElement("div",{className:"c-card__grid__glyph--asset"},f)),c.a.createElement(te.a.Body,null,c.a.createElement(te.a.Title,null,c.a.createElement(j.c,{to:A,className:"c-card__link--asset"},c.a.createElement(re,{doc:e.doc}))),c.a.createElement(se.a,null,c.a.createElement(se.a.Item,{className:"c-card__listItem--creator"},e.doc.creator&&c.a.createElement("div",{className:"info shanti-field-creator"},c.a.createElement("span",{className:"icon shanti-field-content"},k))),c.a.createElement(se.a.Item,{className:"c-card__listItem--duration"},e.doc.duration_s&&c.a.createElement("div",{className:"info shanti-field-duration"},c.a.createElement("span",{className:"icon shanti-field-content"},e.doc.duration_s))),c.a.createElement(se.a.Item,{className:"c-card__listItem--related"},c.a.createElement("div",{className:"info shanti-field-related"},c.a.createElement("span",{className:"shanti-field-content"},c.a.createElement(ce,{relateds:S})))),c.a.createElement(se.a.Item,{className:"c-card__listItem--created"},E&&c.a.createElement("div",{className:"shanti-field-created"},c.a.createElement("span",{className:"icon shanti-field-content"},E)))),c.a.createElement("div",{className:"c-button__json"},c.a.createElement("span",{className:"sui-showinfo u-icon__info float-right",onClick:function(){return m(!0)}}),c.a.createElement(ue,{show:p,onHide:function(){return m(!1)},data:e.doc,scrollable:!0}))),c.a.createElement(te.a.Footer,{className:"c-card__footer c-card__footer--"+e.doc.asset_type},T))}function ue(e){return c.a.createElement(ae.a,Object.assign({},e,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0}),c.a.createElement(ae.a.Header,{closeButton:!0},c.a.createElement(ae.a.Title,{id:"contained-modal-title-vcenter"},"JSON DATA")),c.a.createElement(ae.a.Body,null,c.a.createElement("pre",null,JSON.stringify(e.data,void 0,3))),c.a.createElement(ae.a.Footer,null,c.a.createElement(ee.a,{onClick:e.onHide},"Close")))}var pe=a(393),me=(a(667),a(275)),he=a.n(me);a(551);function ve(e){var t=Object(l.useRef)(null);if(void 0===e.pager)return null;var a=e.pager,s=c.a.createElement(he.a,{"aria-label":"Goto page",min:1,max:a.getMaxPage()+1,size:5,value:a.getPage()+1,onChange:function(e){var t,s;(null===(t=window)||void 0===t?void 0:t.fppgwait)&&clearTimeout(null===(s=window)||void 0===s?void 0:s.fppgwait);window.fppgwait=setTimeout((function(){a.setPage(e-1)}),800)},mobile:!1,noStyle:!0,ref:t});var n=(null===e||void 0===e?void 0:e.numFound)?e.numFound:null===a||void 0===a?void 0:a.numFound;n||(n=a.getPageSize());var i=a.getPage()*a.getPageSize()+1,r=i+a.getPageSize()-1;n<r&&(r=n);var o=(null===e||void 0===e?void 0:e.position)?" "+e.position:"",d=a.getMaxPage()+1;d=isNaN(d)?"...":d;var u=e.className?" "+e.className:"";return c.a.createElement("div",{className:"c-featurePager__container".concat(o).concat(u)},i&&r&&n&&c.a.createElement("div",{className:"c-featurePager__resultSummary"},"(Displaying ",c.a.createElement("span",{className:"start"},i),"to ",c.a.createElement("span",{className:"end"},r),"of ",c.a.createElement("span",{className:"total"},n),")"),c.a.createElement("div",{className:"c-featurePager__navButtons"},c.a.createElement("span",{onClick:function(){a.firstPage(),t.current.refsInput.setValue(a.getPage()+1)},className:"icon u-icon__arrow-end-left c-pagerIcon__buttonFirst"}," "),c.a.createElement("span",{onClick:function(){a.prevPage(),t.current.refsInput.setValue(a.getPage()+1)},className:"icon u-icon__arrow3-left c-pagerIcon__buttonPrev"}," "),c.a.createElement("span",{className:"c-pager__counterWrapper"},c.a.createElement("span",{className:"c-pager__counter-1"},s),"of",c.a.createElement("span",{className:"c-pager__counterMax"},d)),c.a.createElement("span",{onClick:function(){a.nextPage(),t.current.refsInput.setValue(a.getPage()+1)},className:"icon u-icon__arrow3-right c-pagerIcon__buttonNext"}," "),c.a.createElement("span",{onClick:function(){a.lastPage(),t.current.refsInput.setValue(a.getPage()+1)},className:"icon u-icon__arrow-end-right c-pagerIcon__buttonLast"}," ")),e.loadingState?c.a.createElement("span",null," loading..."):c.a.createElement("span",null),c.a.createElement("div",{className:"c-featurePager__itemCount"},c.a.createElement("span",null,"Items per page:"),c.a.createElement(he.a,{"aria-label":"Set number of items per page",min:1,max:100,size:3,step:10,value:a.getPageSize(),onChange:function(e){a.setPageSize(e)},mobile:!1,style:{"input.mobile":{border:"0px"},"btnUp.mobile":{}}})))}var fe=a(196);function ge(e){var t=function(t){var a=!0;if(!1===e.inline)return!1;switch(t.asset_type){case"subjects":case"terms":case"places":break;default:a=!0}return a},a=e.docs,s=[];a&&(s=null===a||void 0===a?void 0:a.map((function(e,a){var s=[],n=c.a.createElement(de,{doc:e,key:a,inline:t(e)});return s.push(n),s})),a.length||(s=c.a.createElement("div",{className:"u-search__results__wrap"},e.loadingState?c.a.createElement(fe.a,{animation:"border",role:"status"},c.a.createElement("span",{className:"sr-only"},"Loading...")):c.a.createElement(_e,null))),$.a,$.a.Toggle,ee.a,$.a.Collapse,JSON.stringify(a,void 0,1));var n=c.a.createElement("div",{className:"c-view"},c.a.createElement(ve,e),c.a.createElement(pe.a,{className:"c-card__grid"},s),c.a.createElement(ve,e));return c.a.createElement("div",{className:"c-view__wrapper deck"},n)}function _e(e){return c.a.createElement("h2",{className:"u-search__noresults__header"},"No results. Your query yielded no results.")}var be=a(62),ye=a.n(be),Ee=a(44);function ke(e){var t=e.url,a=e.gourl?e.gourl:t;t.indexOf("youtube.com")>-1&&(t=t.replace("watch?v=","embed/")).indexOf("&t")>-1&&(t=(t=t.replace("&t","?start")).substring(0,t.length-1));var s=e.text,n=e.title?e.title:"External Link",i=Object(l.useState)(!1),r=Object(x.a)(i,2),o=r[0],d=r[1],u=function(){return d(!1)};return c.a.createElement(c.a.Fragment,null,c.a.createElement("a",{className:"mandala-modal","data-original-url":t,href:"#",onClick:function(){return d(!0)}},s),c.a.createElement(ae.a,{size:"xl",show:o,onHide:u,backdrop:"static",keyboard:!1},c.a.createElement(ae.a.Header,{closeButton:!0},c.a.createElement(ae.a.Title,null,"External Link: \u201c",n,"\u201d")),c.a.createElement(ae.a.Body,null,c.a.createElement("iframe",{className:"mdlmodal",src:t})),c.a.createElement(ae.a.Footer,null,c.a.createElement("a",{href:a,target:"_blank"},c.a.createElement(ee.a,{variant:"success"},"Go")),c.a.createElement(ee.a,{variant:"primary",onClick:u},"Done"))))}var we=a(33),xe=a.n(we),Te=a(52),je=a(131),Se={assets:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",terms:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select"},Ae=function(){var e=Object(Te.a)(xe.a.mark((function e(t,a){var s,n,i,r,l,c;return xe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=a.query).index in Se&&s.params){e.next=4;break}return console.warn("The query object sent to useSolr() did not have proper index or params values: ",s),e.abrupt("return",!1);case 4:return"wt"in(n=s.params)||(n.wt="json"),i={adapter:J.a,callbackParamName:"json.wrf",url:Se[s.index],params:n},e.next=9,Q.a.request(i);case 9:return r=e.sent,l=r.data,c=l&&l.response?l.response:l,l.facets&&(c.facets=l.facets),e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function Pe(e,t){var a=Object(je.a)([e,{query:t}],Ae);return!(!a||!a.data)&&(a.data.status=a.status,a.data)}function Ne(e,t){if(e.attribs&&"kmap-tag-group"===e.attribs.class){var a,s,n,i=e.attribs["data-kmdomain"],r=e.attribs["data-kmid"],l=i+"-"+r+"-"+Math.ceil(1e4*Math.random()),o="Loading ...";return(null===e||void 0===e||null===(a=e.children)||void 0===a?void 0:a.length)>0&&(null===(s=e.children[0])||void 0===s?void 0:s.children.length)>0&&(null===(n=e.children[0].children[0])||void 0===n?void 0:n.data)?o=e.children[0].children[0].data:(o="Loading...",console.log("Could not find label from popover node:",e)),c.a.createElement(Ee.a,{domain:i,kid:r,key:l,children:[o]})}if("img"===e.name&&e.attribs&&e.attribs.class&&"popover-icon"===e.attribs.class&&e.attribs.onmouseenter){var d=e.attribs.onmouseenter.match(/(places|subjects|terms)\-(\d+)/);if(d){var u,p=!!(null===e||void 0===e||null===(u=e.prev)||void 0===u?void 0:u.data)&&e.prev.data;return p||(p="Loading ...",console.log("Could not find label from popover node:",e)),c.a.createElement(Ee.a,{domain:d[1],kid:d[2],children:[e.prev.data]})}return null}if("text"===e.type&&e.next&&e.next.attribs&&e.next.attribs.class&&"popover-icon"===e.next.attribs.class)return ye()("&nbsp;&nbsp;");if(e.name&&"a"===e.name&&e.attribs&&e.attribs.href){var m=e.attribs.href,h="undefined"!==typeof e.attribs["data-mandala-id"]&&e.attribs["data-mandala-id"],v=[];for(var f in e.children)v.push(Object(be.convertNodeToElement)(e.children[f],t,Ne));var g=!!e.attribs.title&&e.attribs.title;!1===g&&(g="string"===typeof v[0]?v[0].split(":")[0]:"No title");var _=function(e){var t=[".virginia.edu","youtube.com","vimeo.com"];for(var a in t){var s=t[a];if(e.includes(s))return!1}return!0}(m);if("#"===m[0])return;if(h)return c.a.createElement(De,{mid:h,contents:v});if(!m.includes("https://mandala")&&("/"===m[0]||m.includes("shanti.virginia.edu"))){var b=m.replace(/https?\:\/\//,"").split("?")[0].split("/"),y=!!b[0].includes(".shanti.virginia")&&b.shift(),E=!(!y||"string"!=typeof y)&&y.match(/(audio-video|images|sources|texts|visuals)/);if(1==b.length||!E)return""===b[0]?c.a.createElement(c.a.Fragment,null,v):c.a.createElement(ke,{url:m,title:g,text:v});var k=b.join("/");return c.a.createElement(Re,{mpath:k,url:m,title:g,contents:v})}if(_)return c.a.createElement("a",{href:m,target:"_blank"},v);if(-1==m.search(/(subjects|places|terms)\/\d+/))return c.a.createElement(ke,{url:m,title:g,text:v})}}function Oe(e){var t=e.markup?e.markup:"<div></div>",a={decodeEntities:!0,transform:Ne};return c.a.createElement(c.a.Fragment,null,ye()(t,a))}function Ce(e){var t=e.markup?e.markup:"<div></div>",a=e.options?e.options:{};return a&&!a.decodeEntities&&(a.decodeEntities=!0),c.a.createElement(c.a.Fragment,null,ye()(t,a))}function De(e){var t=e.mid,a=e.contents,s="/mandala-om/";return t.includes("-collection-")?s+=t.replace("-collection-","-collection/"):s+=t.replace(/\-/g,"/").replace("audio/video","audio-video"),c.a.createElement("a",{href:s,"data-mandala-id":t},a)}function Re(e){var t=e.mpath,a=Pe(t,{index:"assets",params:{q:'url_html:"'+t+'"',fl:"asset_type,id"}});if(a&&a.docs&&a.docs.length>0){var s=a.docs[0],n=s.asset_type,i=s.id;if(n&&i){var r="/mandala-om/"+n+"/"+i;return c.a.createElement("a",{href:r,title:e.title,"data-original-url":e.url},e.contents)}}return c.a.createElement(ke,{url:e.url,title:e.title,text:e.contents})}var Le=a(46);function Ie(e){var t=e.id,a=e.mdlasset,s=e.nodejson,n=e.sui,i=!!e.ismain&&e.ismain,r=Object(l.useState)(!1),o=Object(x.a)(r,2),u=o[0],p=o[1],m=Y();return Object(l.useEffect)((function(){i&&(m.clear(),m.setType("audio-video"),d()("body").on("click","a.sui-avMore2",(function(){d()("#sui-avlang").toggle(),this.text="SHOW MORE"==this.text?"SHOW LESS":"SHOW MORE"})),d()("#l-site__wrap").addClass("av"))}),[]),Object(l.useEffect)((function(){if(a){if(i){var e=a.title&&a.title.length>0?a.title[0]:"";m.setHeaderTitle(e);var t=Object(Le.c)(a);m.setPath(t)}s&&(u||(n.av.DrawPlayer(a,s),window.sui=n,p(!0)))}}),[a,s]),c.a.createElement("div",{id:"av-viewer"},c.a.createElement("div",{id:"sui-av"},"Loading ..."),c.a.createElement(Me,{id:t,asset:a,sui:n,node:s}))}function Me(e){var t=e.asset,a=e.node,s=e.sui,n=t&&a?s.av.DrawMetaNew(t,a):"Loading ...",i=Object(l.useState)("details"),r=Object(x.a)(i,2),o=r[0],u=r[1];return Object(l.useEffect)((function(){d()(".c-columnContent__main").scrollTop(0),u("details")}),[t]),c.a.createElement("div",{id:"av-meta-row"},c.a.createElement(X.a,{id:"av-meta-tabs",activeKey:o,onSelect:function(e){return u(e)}},c.a.createElement(Z.a,{eventKey:"details",title:"DETAILS \ue609"},c.a.createElement("div",{id:"meta-details"},c.a.createElement(Oe,{markup:n}))),c.a.createElement(Z.a,{eventKey:"related",title:"RELATED \ue609"},c.a.createElement(Fe,{asset:t,node:a}))))}function Fe(e){var t=e.asset,a=e.node,s=a&&a.nid?a.nid:t&&t.id?t.id:"",n=Object(l.useState)([]),i=Object(x.a)(n,2),r=i[0],o=i[1],d="https://audio-video-dev.shanti.virginia.edu/services/mlt/"+s+"?wt=json";return Object(l.useEffect)((function(){Q()({url:d,adapter:J.a}).then((function(e){o(e.data)})).catch((function(e){o([])}))}),[s]),c.a.createElement("div",{id:"meta-mlt"},c.a.createElement(ge,{docs:r,title:"Related AV Assets",inline:!1}))}var Ue=a(276);a(588),a(589);function qe(e){var t,a=Object(l.useState)(),s=Object(x.a)(a,2);s[0],s[1],null===(t=e.focus)||void 0===t||t.alt;if(Object(l.useEffect)((function(){})),!e.focus)return null;var n=e.focus,i=null===n||void 0===n?void 0:n.date_created;i&&(i=new Date(i).toLocaleDateString());var r=c.a.createElement("div",{className:"info"},c.a.createElement("span",{className:"creator"},n.creator),c.a.createElement("span",{className:"size"},n.full_width,"x",n.full_height),c.a.createElement("span",{className:"date"},i)),o=(null===n||void 0===n?void 0:n.summary)?c.a.createElement("div",{className:"summary"},n.summary):"",d=(null===e||void 0===e?void 0:e.inline)?"./view/".concat(n.id,"?asset_type=").concat(n.asset_type):"/".concat(n.asset_type,"/").concat(n.id);return c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{id:"fov-close",className:"c-foviewer__close"},c.a.createElement("span",{className:"u-icon__close2"})," "),c.a.createElement("div",{className:"c-foviewer__inner"},c.a.createElement("div",{id:"previmg",className:"prev arrow"},c.a.createElement("span",{className:"u-icon__arrow3-left"})),c.a.createElement("div",{className:"c-foviewer__image"},c.a.createElement("img",{src:n.original})),c.a.createElement("div",{className:"c-foviewer__details"},c.a.createElement("h2",null,c.a.createElement("span",{className:"u-icon__images"})," ",n.caption),r,c.a.createElement("div",{className:"ids"},"ID: ",null===n||void 0===n?void 0:n.id),o,c.a.createElement(Ge,{domain:"subjects",data:n.subjects}),c.a.createElement(Ge,{domain:"places",data:n.places}),c.a.createElement(Ge,{domain:"terms",data:n.terms}),c.a.createElement("div",{className:"link"},c.a.createElement(j.c,{to:d},"Details"," ",c.a.createElement("span",{className:"u-icon__angle-double-right"})))),c.a.createElement("div",{id:"nextimg",className:"next arrow"},c.a.createElement("span",{className:"u-icon__arrow3-right"}))))}function Be(e){var t,a=e.children,s=e.portalRootId,n=(e.focused,e.galleryRef,document.getElementById(s)),i=n&&(null===n||void 0===n||null===(t=n.children)||void 0===t?void 0:t.length)>0?n.children[0]:document.createElement("div");return Object(l.useEffect)((function(){n&&i!==n.children[0]&&n.appendChild(i)}),[i,n]),Object(A.createPortal)(a,i)}function Ge(e){var t=e.domain,a=e.data;if(!a)return null;var s=a.map((function(e,a){var s=e.split("|");if(s.length>1){var n=s[0],i=s[1].split("-"),r=i.length>1&&i[1];if(r){var l=t+"-"+r+Math.ceil(1e4*Math.random());return c.a.createElement(Ee.a,{domain:t,kid:r,children:[n],key:l})}}return null}));return c.a.createElement("div",{className:"kmaprow "+t},c.a.createElement("span",{className:"u-icon__"+t+" icon"}),s)}var He="FoldOutViewer";function ze(e){var t=document.getElementById(He);t||((t=document.createElement("div")).id=He);var a=Object(l.useState)(null),s=Object(x.a)(a,2),n=s[0],i=s[1],r=Object(l.useRef)();Object(l.useEffect)((function(e){var t=document.getElementById("fov-close");if(t){t.onclick=function(e){var t=document.getElementById(He);t&&t.remove()}}setTimeout(Ve,800);var a=function(e){var t=e.target.parentElement.id,a="previmg"===t?n.previous.id:"nextimg"===t&&n.next.id;a&&document.getElementById(a).click()},s=document.getElementById("previmg");s&&(s.onclick=a);var i=document.getElementById("nextimg");i&&(i.onclick=a)}));var o=e.docs,d=[],u=[];o&&(u=null===o||void 0===o?void 0:o.map((function(e,t){var a,s=e.url_thumb_width?Number(e.url_thumb_width):200,n=e.url_thumb_height?Number(e.url_thumb_height):200,i=e.url_thumb.replace("!200,200","!400,400"),r=e.url_thumb.replace("!200,200","!800,800");return{id:null===e||void 0===e?void 0:e.id,asset_type:null===e||void 0===e?void 0:e.asset_type,original:r,thumbnail:i,src:i,width:s,height:n,key:e.uid,alt:e.uid,caption:e.caption,summary:null===e||void 0===e?void 0:e.summary,creator:null===e||void 0===e||null===(a=e.creator)||void 0===a?void 0:a.join(", "),date_created:(null===e||void 0===e?void 0:e.date_start)?e.date_start:null===e||void 0===e?void 0:e.node_created,full_width:null===e||void 0===e?void 0:e.img_width_s,full_height:null===e||void 0===e?void 0:e.img_height_s,places:null===e||void 0===e?void 0:e.kmapid_places_idfacet,subjects:null===e||void 0===e?void 0:e.kmapid_subjects_idfacet,terms:null===e||void 0===e?void 0:e.kmapid_terms_idfacet}})),d=c.a.createElement($.a,null,c.a.createElement($.a.Toggle,{as:ee.a,eventKey:"0"},"Full JSON"),c.a.createElement($.a.Collapse,{eventKey:"0"},c.a.createElement("pre",null,JSON.stringify(o,void 0,1)))));var p=c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{ref:r},c.a.createElement(Ue.b,{targetRowHeight:200,photos:u,onClick:function(e,t){i(t);var a=document.getElementById(He);a||((a=document.createElement("div")).id=He),a.getAttribute("uid")===t.photo.alt&&"hidden"!==a.className?a.className="hidden":a.className="w-100",a.setAttribute("uid",t.photo.alt);for(var s="div[photoKey='"+t.photo.alt+"']",n=r.current.querySelector(s),l=n.offsetTop;n.offsetTop===l;){var c=n.nextSibling;if(!c||c.offsetTop!==l)break;n=c}n.after(a)},renderImage:function(e){var t,a=e.key;delete e.key;var s=a===(null===n||void 0===n||null===(t=n.photo)||void 0===t?void 0:t.alt)?{className:"sui-featureGallery-selectedImg"}:{};return c.a.createElement("div",Object.assign({photokey:a,key:a},s),c.a.createElement(Ue.a,e))}})),c.a.createElement(Be,{portalRootId:He,focus:null===n||void 0===n?void 0:n.photo},c.a.createElement(qe,{focus:null===n||void 0===n?void 0:n.photo,inline:null===e||void 0===e?void 0:e.inline}))),m=c.a.createElement("div",{className:"c-view"},c.a.createElement(Ke,{title:e.title}),c.a.createElement(ve,e),p,c.a.createElement(ve,e),c.a.createElement(U.a,null,d));return c.a.createElement("div",{className:"c-view__wrapper gallery"},m)}function Ke(e){return e.title?c.a.createElement("h5",{className:"sui-relatedHeader"},e.title):null}function Ve(){var e=document.getElementById(He);if(e){var t=e.getBoundingClientRect(),a=window.innerHeight,s=t.bottom;if(s>a){var n=window.pageYOffset+s-a+50;window.scrollTo(0,n)}}}a(366);function Ye(e){var t,a=e.domain,s=e.kid,n="".concat(a,"-").concat(s),i=Pe(n,{index:"assets",params:{q:"kmapid:".concat(n),rows:0,"json.facet":"{related_count:{type:terms,field:asset_type}}"}}).facets,r={length:0};if(i&&(null===(t=i.related_count)||void 0===t?void 0:t.buckets)){r.length=i.related_count.buckets.length;for(var l=0;l<i.related_count.buckets.length;l++){var o=i.related_count.buckets[l];r[o.val]=o.count}}return c.a.createElement("ul",{className:"c-relateds-icons"},D.a.map(["subjects","places","terms","audio-video","picture","sources","texts","visuals"],(function(e){if(r[e])return c.a.createElement(We,{key:a+s+e,domain:a,id:s,asset_type:e,number:r[e]})})))}function We(e){var t="picture"===e.asset_type?"images":e.asset_type,a="/".concat(e.domain,"/").concat(e.domain,"-").concat(e.id,"/related-").concat(t,"/default"),s=e.number;return c.a.createElement("li",{className:t,title:t},c.a.createElement("div",null,c.a.createElement(j.c,{to:a},c.a.createElement("div",null,c.a.createElement("span",{className:"icon shanticon-".concat(t)}),c.a.createElement("span",{className:"kmaps-results-name"},t),c.a.createElement("span",{className:"badge"},s)))))}function Qe(e){var t=Object(T.i)(),a=!!(null===e||void 0===e?void 0:e.inline)&&e.inline,s=D.a.map(e.docs,(function(e){var s=(null===e||void 0===e?void 0:e.tree)?e.tree:null===e||void 0===e?void 0:e.asset_type,n=e.id,i="".concat(s,"-").concat(n);if("sources"===s&&!t.pathname.includes("/search")){var r=e.citation_s.replace(/<\/?a[^>]*>/g,""),l=a?"./view/".concat(e.uid,"?asset_type=").concat(e.asset_type):"/".concat(e.asset_type,"/").concat(e.id);return c.a.createElement(te.a,{className:"p-0 m-1 ".concat(s),key:i},c.a.createElement(j.c,{to:l},c.a.createElement(Ce,{markup:r})))}return["places","subjects","terms","kmaps"].indexOf(s)>-1?c.a.createElement(Ze,{asset_type:s,doc:e,key:i,inline:a}):c.a.createElement(Je,{asset_type:s,doc:e,key:i,inline:a})})),n=c.a.createElement("div",{className:"c-view"},c.a.createElement(ve,Object.assign({position:"top"},e)),s,c.a.createElement(ve,Object.assign({position:"bottom"},e)));return c.a.createElement("div",{className:"c-view__wrapper list"},n)}function Je(e){var t=e.asset_type,a=e.doc,s=(null===e||void 0===e?void 0:e.inline)||!1?"./view/".concat(a.uid,"?asset_type=").concat(a.asset_type):"/".concat(a.asset_type,"/").concat(a.id),n=!!(null===a||void 0===a?void 0:a.collection_nid)&&c.a.createElement(j.c,{to:"/".concat(t,"/collection/").concat(a.collection_nid)},a.collection_title),i=a.summary;return i||(i=""),i.indexOf("<p>")>-1?i=c.a.createElement(Ce,{markup:i}):i.length>0&&(i=c.a.createElement("p",null,i)),c.a.createElement(te.a,{className:"p-0 m-1 ".concat(t),key:"".concat(a.asset_type,"-").concat(a.id)},c.a.createElement($.a,null,c.a.createElement(te.a.Body,{className:"p-1 row"},c.a.createElement(G.a,{className:"title",md:8,sm:7},c.a.createElement($.a.Toggle,{as:"span",eventKey:"0",onClick:function(e){var t=d()(e.target);t&&!t.hasClass("u-icon__plus")&&t.find("span").length>0&&(t=d()(t.find("span").eq(0))),t.hasClass("openitem")?t.removeClass("openitem"):t.addClass("openitem")}},c.a.createElement("span",{className:"u-icon__plus"})),c.a.createElement("span",{className:"shanticon-".concat(a.asset_type," type icon")})," ",c.a.createElement(j.c,{className:"header",to:s},a.title)),c.a.createElement(G.a,{className:"meta",md:4,sm:5},c.a.createElement("span",{className:"uid"},a.uid),n&&c.a.createElement("span",{className:"coll"},c.a.createElement("span",{className:"u-icon__collections"}),n)),c.a.createElement($.a.Collapse,{eventKey:"0"},c.a.createElement(G.a,{className:"info"},c.a.createElement(j.c,{to:s},c.a.createElement("span",{className:"img"},c.a.createElement("img",{src:a.url_thumb}))),c.a.createElement("span",{className:"shanticon-".concat(a.asset_type," icon")})," ",c.a.createElement("span",{className:"text-capitalize"},a.asset_type,a.asset_subtype&&c.a.createElement(c.a.Fragment,null," / ",a.asset_subtype)),(null===a||void 0===a?void 0:a.creator)&&a.creator.length>0&&c.a.createElement("span",{className:"creator text-capitalize"},c.a.createElement("span",{className:"u-icon__agents"}),a.creator.join(", ")),i,c.a.createElement("div",{className:"kmap-container"},c.a.createElement(Xe,{domain:"places",doc:a}),c.a.createElement(Xe,{domain:"subject",doc:a}),c.a.createElement(Xe,{domain:"terms",doc:a})))))))}function Xe(e){var t=e.doc,a=e.domain,s="kmapid_"+a+"_idfacet";return t[s]?c.a.createElement(G.a,{className:"kmaps ".concat(a)},c.a.createElement("h5",null,c.a.createElement("span",{className:"u-icon__".concat(a," icon")}),"Related ",a),c.a.createElement("ul",null,D.a.map(t[s],(function(e){var t=e.split("|");if(t.length>1)return c.a.createElement("li",{key:e},t[0]," (",t[1],")")})))):null}function Ze(e){var t=e.doc,a=e.asset_type,s="/".concat(a,"/").concat(a,"-").concat(t.id),n=c.a.createElement("span",{className:"feature-types"},D.a.map(t.feature_types_ss,(function(e){return c.a.createElement("span",{key:e},e)}))),i=D.a.map(t["kmapid_".concat(a,"_idfacet")],(function(e){var t=e.split("|");if(t.length>1)return c.a.createElement("span",{key:e},c.a.createElement(j.c,{to:"/".concat(a,"/").concat(t[1])},t[0]))}));"places"===a&&Array.isArray(i)&&i.length>0&&i.shift();var r=t.names_txt;return r&&(r.splice(r.indexOf(t.title),1),r.length>0&&(r='<div class="altnames">'+r.join(", ")+"</div>",r=c.a.createElement(Ce,{markup:r.replace(/xmllang/g,"xmlLang")}))),c.a.createElement(te.a,{className:"p-0 ".concat(a),key:"".concat(t.asset_type,"-").concat(t.id)},c.a.createElement($.a,null,c.a.createElement(te.a.Body,{className:"p-1 row"},c.a.createElement(G.a,{className:"title",md:8,sm:7},c.a.createElement($.a.Toggle,{as:"span",eventKey:"0",onClick:function(e){var t=d()(e.target);t.hasClass("open")?t.removeClass("open"):t.addClass("open")}},c.a.createElement("span",{className:"u-icon__plus"})),c.a.createElement("span",{className:"shanticon-".concat(a," type icon")})," ",c.a.createElement(j.c,{to:s,className:"header"},t.title),n,i&&i.length>0&&c.a.createElement("div",{className:"ancestors"},i)),c.a.createElement(G.a,{className:"meta",md:4,sm:5},c.a.createElement("span",{className:"uid"},t.uid)),c.a.createElement($.a.Collapse,{eventKey:"0"},c.a.createElement(G.a,{className:"info kmaps"},t.caption&&c.a.createElement("p",{className:"caption"},t.caption),r,c.a.createElement(Ye,{domain:a,kid:t.id}))))))}var $e=a(144),et=a(280),tt=a(281),at=a(679),st=a(683);function nt(e){var t=Object(N.k)((function(e){return e.search.query.filters})),a=(Object(N.k)((function(e){return e.search})),Object(N.i)((function(e){return e.search})).removeFilters);var s=(null===t||void 0===t?void 0:t.map((function(e){return c.a.createElement(at.a,{key:e.id,timeout:1e3,classNames:"item"},c.a.createElement(tt.a,{mode:"remove",key:"Remove ".concat(e.id),className:"sui-advTermRem u-icon__cancel-circle icon",value:e.id,labelText:e.label,label:e.label,facetType:e.field,onFacetClick:function(e){!function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];console.log("Received ",t),console.log(" try to remove id = ",t.value),a([{id:t[0].value}])}(Object(w.a)(Object(w.a)({},e),{},{action:"remove"}))}}))})))||[];return s.length&&s.unshift(c.a.createElement(at.a,{key:"label",timeout:1e3,classNames:"item"},c.a.createElement("span",null,"Applied Filters: "))),c.a.createElement("span",null,c.a.createElement(st.a,{className:"sui-facetList-horiz"},s))}function it(e){var t=Object(T.j)().viewMode,a=Object(l.useState)("deck"),s=Object(x.a)(a,2),n=s[0],i=s[1],r=t||e.viewMode;if(D.a.isEmpty(r)||n===r||i(r),n&&t&&t!==n)return c.a.createElement(T.a,{to:n});var o=c.a.createElement(T.a,{to:"deck"});switch(n){case"gallery":o=c.a.createElement(ze,e);break;case"deck":o=c.a.createElement(ge,e);break;case"list":o=c.a.createElement(Qe,e)}var d="gallery"===n;if((null===e||void 0===e?void 0:e.docs)&&e.docs.length>0){var u,p=null===(u=e.docs[0])||void 0===u?void 0:u.asset_type;p&&"audio-video|images".includes(p)&&(d=!0)}return c.a.createElement("div",{className:"c-buttonGroup__viewMode__wrap"},c.a.createElement("div",{className:"c-buttonGroup__viewMode"},c.a.createElement(rt,{viewMode:n,inclGallery:d}),e.loadingState&&c.a.createElement(fe.a,{animation:"border",role:"status"},c.a.createElement("span",{className:"sr-only"},"Loading..."))),e.showSearchFilters&&c.a.createElement(nt,null),o)}function rt(e){var t=Object(T.h)(),a=Object(T.i)().search,s=e.viewMode,n=e.inclGallery;var i=c.a.createElement("span",{className:"u-icon__address-card-o icon"}),r=c.a.createElement("span",{className:"u-icon__th icon"}),l=c.a.createElement("span",{className:"u-icon__list2 icon"});return c.a.createElement(et.a,{name:s,value:s,type:"radio",onChange:function(e){return function(e){t.push(e+a)}(e)}},c.a.createElement($e.a,{name:"viewMode",value:"deck",type:"radio",title:"View Mode: Cards"},i),n&&c.a.createElement($e.a,{name:"viewMode",value:"gallery",type:"radio",title:"View Mode: Gallery"},r),c.a.createElement($e.a,{name:"viewMode",value:"list",type:"radio",title:"View Mode: List"},l))}function lt(e){var t=Y(),a=e.asset_type,s=Object(l.useState)(0),n=Object(x.a)(s,2),i=n[0],r=n[1],o=Object(l.useState)(0),d=Object(x.a)(o,2),u=d[0],p=d[1],m=Object(l.useState)(100),h=Object(x.a)(m,2),v=h[0],f=h[1],g=Object(l.useState)(0),_=Object(x.a)(g,2),b=_[0],y=_[1],E={index:"assets",params:{q:"asset_type: ".concat(a," and -asset_subtype:page"),sort:"title_sort_s asc",start:i,rows:v}},k=Pe("asset-".concat(a,"-all"),E),w=null===k||void 0===k?void 0:k.numFound,T="deck";"images"===a?T="gallery":"sources"!==a&&"texts"!==a||(T="list");var j={numFound:b,getMaxPage:function(){return Math.floor(j.numFound/j.getPageSize())},getPage:function(){return u},setPage:function(e){e=parseInt(e),!isNaN(e)&&e>-1&&e<=j.getMaxPage()&&(p(e),j.pgnum=e)},setPageSize:function(e){e=parseInt(e),!isNaN(e)&&e>0&&e<101&&(f(e),j.pgsize=e)},getPageSize:function(){return v},nextPage:function(){j.setPage(j.getPage()+1)},prevPage:function(){j.setPage(j.getPage()-1)},lastPage:function(){j.setPage(j.getMaxPage())},firstPage:function(){j.setPage(0)}};return Object(l.useEffect)((function(){t.clear(),t.setType(a);var e=a[0].toUpperCase()+a.substr(1).replace("-v","-V");t.setHeaderTitle(e+" Home")}),[a]),Object(l.useEffect)((function(){r(u*v)}),[u,v]),Object(l.useEffect)((function(){y(w)}),[w]),c.a.createElement(it,{docs:null===k||void 0===k?void 0:k.docs,numFound:null===k||void 0===k?void 0:k.numFound,pager:j,viewMode:T,inline:!1})}function ct(e){var t=Y();return t.setType("audio-video"),t.setHeaderTitle("Loading..."),c.a.createElement("div",{className:"assethome audio-video"},c.a.createElement("div",{className:"desc"},c.a.createElement("p",null,"This page shows all the audio-video resources in this project.")),c.a.createElement(lt,{asset_type:"audio-video"}))}a(590);function ot(e){var t=e.solrdoc,a=null===t||void 0===t?void 0:t.asset_type,s=null===t||void 0===t?void 0:t.collection_nid,n=Pe("collitems",{index:"assets",params:{q:"asset_type:".concat(a," AND collection_nid:").concat(s),fl:["id","title","url_thumb"],sort:"title_sort_s asc",rows:1e3}}),i=function(){clearTimeout(window.centerCarousel),window.centerCarousel=setTimeout((function(){if(0!==d()(".thumb.current").length){var e=Math.floor(d()(".thumb.current").get(0).offsetLeft-d()("#image-carousel").get(0).offsetWidth/2);d()("#image-carousel").scrollLeft(e)}}),10)};if(Object(l.useEffect)((function(){d()("#image-carousel").length>0&&(window.mndlImgCarouselTimeout&&clearTimeout(window.mndlImgCarouselTimeout),window.mndlImgCarouselTimeout=setTimeout((function(){i()}),3500)),d()(".thumb.current").length>0&&(0===d()(".thumb.current").prev("div").length?d()(".page-control .prev-arrow").addClass("disabled").attr("title","No Previous Image"):d()(".page-control .prev-arrow").removeClass("disabled").attr("title","Previous Image"),0===d()(".thumb.current").next("div").length?d()(".page-control .next-arrow").addClass("disabled").attr("title","No Next Image"):d()(".page-control .next-arrow").removeClass("disabled").attr("title","Next Image"))}),[d()("#image-carousel")]),"undefined"===typeof t||"undefined"===typeof n.docs)return null;var r=n.docs;r.sort((function(e,t){return e.id===t.id?0:e.id<t.id?-1:1}));var o=r.findIndex((function(e){return e.id==t.id})),u=o>30?o-30:0,p=o+30<r.length-1?o+30:r.length-1,m=r.slice(u,p);return c.a.createElement("div",{id:"image-carousel",className:"c-image__carousel"},m.map((function(e,a){return c.a.createElement("div",{key:"cs-"+a,id:"carousel-slide-"+a,className:"thumb"+(e.id===t.id?" current":"")},c.a.createElement(j.c,{to:e.id},c.a.createElement("img",{src:e.url_thumb,onLoad:i})))})))}function dt(e){var t=e.solrdoc,a=t.asset_type;if("undefined"!==typeof t){var s=a&&t?"/"+a+"/collection/"+t.collection_nid:"#",n=t.collection_title;return c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"u-icon__collections"}),c.a.createElement(j.c,{to:s},n),c.a.createElement("span",{className:"u-visibility"},"Public"))}}function ut(e){var t,a,s,n,i,r,l,o=e.nodejson,d=null===e||void 0===e?void 0:e.kmapid;if(!o||"undefined"===typeof o)return null;var u=null===(t=o[e.collfield?e.collfield:"field_kmap_collections"])||void 0===t||null===(a=t.und)||void 0===a?void 0:a.map((function(e,t){var a="kmcolls-"+e.domain+"-"+e.id+"-"+t;return c.a.createElement(Ee.a,{key:a,domain:e.domain,kid:e.id,children:[null===e||void 0===e?void 0:e.header]})})),p=null===(s=o[e.subjectfield?e.subjectfield:"field_subjects"])||void 0===s||null===(n=s.und)||void 0===n?void 0:n.map((function(e,t){var a="kmsubj-"+e.domain+"-"+e.id+"-"+t;return c.a.createElement(Ee.a,{key:a,domain:e.domain,kid:e.id,children:[null===e||void 0===e?void 0:e.header]})})),m=null===(i=o.field_places)||void 0===i||null===(r=i.und)||void 0===r?void 0:r.map((function(e,t){var a="kmplc-"+e.domain+"-"+e.id+"-"+t;return c.a.createElement(Ee.a,{key:a,domain:e.domain,kid:e.id,children:[null===e||void 0===e?void 0:e.header]})})),h=o.field_terms?o.field_terms:o.field_kmap_terms,v=null===h||void 0===h||null===(l=h.und)||void 0===l?void 0:l.map((function(e,t){var a="kmterm-"+e.domain+"-"+e.id+"-"+t;return c.a.createElement(Ee.a,{key:a,domain:e.domain,kid:e.id,kmapid:d,children:[null===e||void 0===e?void 0:e.header]})})),f=u&&0!==u.length?"":" d-none",g=p&&0!==p.length?"":" d-none",_=m&&0!==m.length?"":" d-none",b=v&&0!==v.length?"":" d-none";return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"c-kmaps__collections"+f},c.a.createElement("span",{className:"u-icon__collections",title:"Collections"})," ",u," "),c.a.createElement("div",{className:"c-kmaps__subjects"+g},c.a.createElement("span",{className:"u-icon__subjects",title:"Subjects"})," ",p," "),c.a.createElement("div",{className:"c-kmaps__places"+_},c.a.createElement("span",{className:"u-icon__places",title:"Places"})," ",m," "),c.a.createElement("div",{className:"c-kmaps__terms"+b},c.a.createElement("span",{className:"u-icon__terms",title:"Terms"})," ",v," "))}var pt=function(){window.history.back(),setTimeout((function(){window.location.reload()}),1e3)};function mt(e){var t=e.type,a=c.a.createElement("div",null,c.a.createElement("p",null,"Sorry, the page you are looking for"),c.a.createElement("p",{className:"badurl"},window.location.href),c.a.createElement("p",null,"is not available. It either does not exist or is private. Please try again!"));if(t&&""!==t&&(null===e||void 0===e?void 0:e.id)){"s"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t="aeiou".includes(t[0])?"an "+t:"a "+t;var s=e.id;a=c.a.createElement("p",null,"Sorry, ",t," with ID, ",s,", does not exist.",c.a.createElement("br",null),"If you followed a link to an item, you may have the wrong item ID,",c.a.createElement("br",null),"or the item may have been deleted or is private.")}return c.a.createElement("div",{className:"c-not-found"},c.a.createElement(q.a,{fluid:!0},c.a.createElement(B.a,{className:"justify-content-md-center"},c.a.createElement(G.a,{lg:"auto"},c.a.createElement("img",{className:"logo",src:"/mandala-om/img/logo-shanti.png",alt:"mandala logo"}),c.a.createElement("h1",null,"Page Not Found!"),a,c.a.createElement(ee.a,{variant:"primary",href:"#",onClick:pt},"Back")))))}var ht=["field_image_digital|Only Digital|info","field_image_color|Color|info","field_image_quality|Quality|info","field_image_rotation|Rotation|info","field_physical_size|Physical Size|arrows","field_image_capture_device|Capture Device|camera","field_image_materials|Materials|th","field_image_enhancement|Enhancement|plus-square-o","location_constructed|Location|places","copyright_statement|Copyright|copyright","field_license_url|License|info","field_aperture|Aperture|info","field_exposure_bias|Exposure Bias|info","field_flash_settings|Flash Settings|info","field_focal_length|Focal Length|info","field_iso_speed_rating|ISO Speed|info","field_lens|lens|info","field_light_source|Light Source|info","field_metering_mode|Metering Mode|info","field_noise_reduction|Noise Reduction|info","field_organization_name|Organization|info","field_original_filename|Original File Name|info","field_project_name|Project|info","field_sensing_method|Sensing Method|info","field_sponsor_name|Sponsor|info","field_spot_feature|Spot Feature|info"];function vt(e){var t,a,s=e.solrdoc,n=e.nodejson,i=e.sizestr?e.sizestr:"",r=null===n||void 0===n?void 0:n.title,o=Object(l.useState)(""),d=Object(x.a)(o,2),u=d[0];d[1];n&&(n.copyright_statement=function(e){var t=!1,a=!1,s=!1,n="";if(e){var i,r;if(e.field_copyright_holder.und&&e.field_copyright_holder.und.length>0&&(t=e.field_copyright_holder.und[0].value),e.field_copyright_statement.und&&e.field_copyright_statement.und.length>0)a=null===e||void 0===e||null===(i=e.field_copyright_statement)||void 0===i?void 0:i.und[0].value;if(e.field_copyright_date.und&&e.field_copyright_date.und.length>0)s=(s=new Date(null===e||void 0===e||null===(r=e.field_copyright_date)||void 0===r?void 0:r.und[0].value)).getFullYear();s&&s.toString().length>0&&(s+=". "),t&&t.length>0&&(t+=",  "),a&&(n=t+s+"|"+a)}return{und:[{value:n}]}}(n),n.location_constructed=function(e){var t,a,s,n,i,r,l=!!(null===e||void 0===e||null===(t=e.field_longitude)||void 0===t?void 0:t.und)&&(null===e||void 0===e||null===(a=e.field_longitude)||void 0===a?void 0:a.und[0].value),c=!!(null===e||void 0===e||null===(s=e.field_latitude)||void 0===s?void 0:s.und)&&(null===e||void 0===e||null===(n=e.field_latitude)||void 0===n?void 0:n.und[0].value),o=!!(null===e||void 0===e||null===(i=e.field_altitude)||void 0===i?void 0:i.und)&&(null===e||void 0===e||null===(r=e.field_altitude)||void 0===r?void 0:r.und[0].value),d=!1;if(e&&c&&l){if(!l||!c||!o)return{und:[]};isNaN(1*l)||(l=l>0?"+"+l:"-"+l),isNaN(c)||(c=c>0?"+"+c:"-"+c),isNaN(o)||(o=o>0?"+"+o:"-"+o),d=l+" "+c+" "+o}return{und:[{value:d}]}}(n));var p=(null===n||void 0===n||null===(t=n.field_image_descriptions)||void 0===t?void 0:t.und)?n.field_image_descriptions.und:[],m="ir-caption-main-"+Math.floor(3333333*Math.random());return c.a.createElement(c.a.Fragment,null,c.a.createElement(B.a,{className:"l-top"},c.a.createElement(G.a,{className:"l-first col-sm-12 col-md-6"},c.a.createElement("h5",{className:"c-image__colhead"},"Mandala Collections"),c.a.createElement("div",null,c.a.createElement(dt,{solrdoc:s}))),c.a.createElement(G.a,{className:"col-sm-12 col-md-6"},c.a.createElement("h5",{className:"c-image__colhead"},"Classifications"),c.a.createElement("div",{className:"c-kmaps-list"},c.a.createElement(ut,{nodejson:n,kmapid:null===s||void 0===s?void 0:s.kmapid})))),c.a.createElement(B.a,{className:"l-meta"},c.a.createElement(G.a,{className:"l-first col-sm-12 col-md-6"},c.a.createElement(ft,{key:m,cls:"c-image__caprow",icon:"images",label:"Caption",value:r}),c.a.createElement("hr",null),c.a.createElement(_t,{json:null===n||void 0===n?void 0:n.field_image_agents}),c.a.createElement(ft,{key:"ir-uploader",cls:"u-data",icon:"agents",label:"Data Entry",value:s.node_user_full_s,date:gt(n.created,"ts")}),c.a.createElement(ft,{key:"ir-image-type",cls:"u-data",icon:"square-o",label:"Type",value:null===n||void 0===n||null===(a=n.field_image_type)||void 0===a?void 0:a.und[0].value,valclass:"text-capitalize"}),c.a.createElement(ft,{key:"ir-image-size",cls:"u-data",icon:"arrows",label:"size",value:i}),c.a.createElement("hr",null),p.map((function(e,t){return c.a.createElement(bt,{key:"im-desc-"+t,data:p[t],defaultauth:u})}))),c.a.createElement(G.a,{className:"l-second col-sm-12 col-md-6"},ht.map((function(e,t){var a=e.split("|");if(a.length<3)do{a.push("")}while(a.length<3);return c.a.createElement(yt,{key:a[0],fieldName:a[0],label:a[1],icon:a[2],nodejson:n})})))))}function ft(e){var t=e.cls?e.cls:"",a=e.icon?e.icon:"info",s=e.label?e.label:"",n=e.labclass?" "+e.labclass:"",i=e.value?e.value:"",r=e.valclass?" "+e.valclass:"",l=e.date?" ("+e.date+")":"",o="ir-"+s.toLowerCase().replace(" ","-")+Math.floor(888888*Math.random());return c.a.createElement(B.a,{className:t,key:o},c.a.createElement(G.a,{key:o+"-c1"},c.a.createElement("span",{className:"u-icon__"+a})," ",c.a.createElement("span",{className:"u-label"+n},s)," "),c.a.createElement(G.a,{className:"u-value"+r,key:o+"-c2"},i,l))}function gt(e,t){if(!e||""===e)return null;var a=new Date(e);return t&&"ts"===t&&(a=new Date(1e3*e)),a.toLocaleString().split(",")[0]}function _t(e){var t=null===e||void 0===e?void 0:e.json;return t&&"undefined"!==typeof t&&t.und&&0!==t.und.length?c.a.createElement(c.a.Fragment,null,t.und.map((function(e,t){var a,s=(null===e||void 0===e||null===(a=e.field_agent_dates)||void 0===a?void 0:a.und)&&e.field_agent_dates.und.length>0?gt(e.field_agent_dates.und[0].value):"",n=e.field_agent_role.und[0].value.toLowerCase()+e.title.toLowerCase();return n=n.replace(" ","-"),c.a.createElement(ft,{key:n,cls:"u-data",icon:"agents",label:e.field_agent_role.und[0].value.toUpperCase(),value:e.title,date:s})}))):c.a.createElement(ft,{cls:"u-data",icon:"agents",label:"Creator",value:"Unknown"})}function bt(e){var t,a,s=e.data,n=e.defaultauth,i=gt(s.created,"ts"),r=(null===s||void 0===s||null===(t=s.field_author)||void 0===t?void 0:t.und)&&s.field_author.und.length>0?s.field_author.und[0].value:n,l=""===r?"byline noauthor":"byline",o=(null===s||void 0===s||null===(a=s.field_description)||void 0===a?void 0:a.und)?s.field_description.und[0].value:"";return c.a.createElement("div",{className:"o-desc"},c.a.createElement("h5",{className:"o-desc__title"},s.title),c.a.createElement("p",{className:"o-desc__"+l},r," (",i,")"),c.a.createElement(Ce,{markup:o}))}function yt(e){var t,a,s=e.nodejson,n=e.fieldName,i=e.icon,r=e.label;if(!(null===(t=s[n])||void 0===t?void 0:t.und))return null;var l=null===(a=s[n])||void 0===a?void 0:a.und[0].value;if("location_constructed"===n&&!l)return null;if("field_original_filename"===n)l=c.a.createElement("span",{className:"t-overwrap-any"},l);else if("field_license_url"===n){var o=s[n].und[0].title.replace(/&mdash;/g,"\u2014").replace(/&amp;/g,"&");l=c.a.createElement("a",{href:l,target:"_blank",className:"t-overwrap-any"},o)}else if("http"===l.substr(0,4))l=c.a.createElement("a",{href:l,target:"_blank"},l);else if("field_image_digital"===n)l="0"===l?"No":"Yes";else if("field_image_rotation"===n)l+="\xb0";else if("copyright_statement"===n){var d=l.split("|");if(""===d[0])return null;for(;d.length<2;)d.push("");return c.a.createElement(c.a.Fragment,null,c.a.createElement(B.a,{className:"o-desc"},c.a.createElement(G.a,null,c.a.createElement("span",{className:"u-icon__"+i})," ",c.a.createElement("span",{className:"u-label"},r)," "),c.a.createElement(G.a,{className:"u-value"},d[0])),c.a.createElement(B.a,{className:"o-desc"},c.a.createElement(G.a,null,d[1])))}return c.a.createElement(ft,{cls:"u-data",icon:i,label:r.toUpperCase(),value:l})}a(592);var Et=a(397),kt=a.n(Et);function wt(e){var t=e.manifest,a=e.rotation,s=a&&0!==a?1:0,n=Object(l.useState)(!1),i=Object(x.a)(n,2),r=(i[0],i[1]);return Object(l.useEffect)((function(){if(t&&a&&1===d()("#osdviewer").length){d()("#osdviewer").html("");var e=kt()({id:"osdviewer",prefixUrl:"/mandala-om/seadragon/images/",tileSources:t,degrees:a,showRotationControl:!0,defaultZoomLevel:s,minZoomImageRatio:.1,maxZoomPixelRatio:1.8,maxZoomLevel:10,minZoomLevel:.5});r(e)}}),[t,a]),c.a.createElement("div",{id:"osdviewer",className:"c-osdviewer"},"Loading ...")}function xt(e){var t=e.mdlasset,a=e.nodejson,s=e.ismain,n=Y();(null===e||void 0===e?void 0:e.id)||(null===t||void 0===t?void 0:t.id)||null===a||void 0===a||a.nid;Object(l.useEffect)((function(){s&&(n.clear(),n.setType("images"))}),[]),Object(l.useEffect)((function(){if(t&&s){n.setHeaderTitle((null===t||void 0===t?void 0:t.title)||(null===t||void 0===t?void 0:t.caption)||"ImageViewer");var e=Object(Le.c)(t);n.setPath(e)}var a=d()(".react-iiif-viewer");if(a.length>0){var i=a.children();if(i.length>2){d()(i[1]).addClass("zoom");var r=d()(i[1]).children().eq(0);r.addClass("in"),r.html('<span class="u-icon__zoom-in"></span>');var l=d()(i[1]).children().eq(1);l.addClass("out"),l.html('<span class="u-icon__zoom-out"></span>'),d()(i[2]).addClass("fullscreen"),0===d()("#expand-proxy").length&&d()(i[2]).children("button").eq(0).prepend('<span id="expand-proxy" class="u-icon__enlarge"></span>')}}}),[t]);var i=function(e){var t=d()(e.target),a=d()(".thumb.current").length>0?d()(".thumb.current"):d()(".thumb").eq(0),s="prev"===(t.parent().hasClass("before")?"prev":"next")?a.prev("div").find("a"):a.next("div").find("a");try{d()(s).get(0).click()}catch(e){}};if(t){var r,o=Array.isArray(t.creator)?t.creator.join(", "):t.creator,u=t.img_width_s+" x "+t.img_height_s,p=!!(null===a||void 0===a||null===(r=a.field_image_rotation)||void 0===r?void 0:r.und[0])&&a.field_image_rotation.und[0].value;return c.a.createElement("div",{className:"c-image"},c.a.createElement(q.a,{fluid:!0,className:"c-image__context"},c.a.createElement(G.a,{className:"c-image__viewer"},c.a.createElement(B.a,{className:"c-image__viewer-row"},c.a.createElement(G.a,{className:"page-control before"},c.a.createElement("span",{className:"u-icon__arrow3-left prev-arrow",onClick:i})),c.a.createElement(G.a,null,c.a.createElement(wt,{manifest:t.url_iiif_s,rotation:p})),c.a.createElement(G.a,{className:"page-control after"},c.a.createElement("span",{className:"u-icon__arrow3-right next-arrow",onClick:i}))),c.a.createElement("div",{className:"c-image__caption"},c.a.createElement("h1",{className:"c-image__title"},c.a.createElement("span",{className:"u-icon__images"}),t.title),c.a.createElement("div",{className:"c-image__byline"},c.a.createElement("span",{className:"author"},o),"|",c.a.createElement("span",{className:"size"},u))),c.a.createElement(ot,{solrdoc:t}))),c.a.createElement(q.a,{className:"c-image__metadata"},c.a.createElement(vt,{q:!0,solrdoc:t,nodejson:a,sizestr:u})))}return c.a.createElement(c.a.Fragment,null,"Loading...")}function Tt(e){var t=Y();return t.setType("images"),t.setHeaderTitle("Loading..."),c.a.createElement("div",{className:"assethome images"},c.a.createElement("div",{className:"desc"},c.a.createElement("p",null,"This page shows all images in this project.")),c.a.createElement(lt,{asset_type:"images"}))}var jt=a(346);a(593);function St(e){var t=e.nodejson?e.nodejson:"",a=e.mdlasset?e.mdlasset:"",s=t?t.nid:"",n=t?t.title:"",i=(null===e||void 0===e?void 0:e.ismain)||!1,r=(null===e||void 0===e?void 0:e.inline)||!1;i&&r&&(i=!1);var o=Object(l.useState)([]),u=Object(x.a)(o,2),p=u[0],m=u[1],h=Object(l.useState)(["shanti-texts-"+s]),v=Object(x.a)(h,2),f=v[0],g=v[1],_=Object(l.useState)(""),b=Object(x.a)(_,2),y=b[0],E=b[1],k=Y();Object(l.useEffect)((function(){if(a&&i){k.setType("texts");var e=a.title?a.title:"Loading ...";e&&k.setHeaderTitle(e);var t=Object(Le.c)(a);k.setPath(t),d()(".l-site__wrap").addClass("texts")}}),[a]),Object(l.useEffect)((function(){if(0===p.length&&d()("#shanti-texts-body .shanti-texts-section").length>0){var e=d()("#shanti-texts-body .shanti-texts-section").toArray(),t=d.a.map(e,(function(t,a){var s=d()(t);if(a<e.length+1){var n=d()(e[a+1]).offset();n&&n.top&&n.top-145}return{el:s,id:s.attr("id"),title:d.a.trim(s.children().eq(0).text()),getTop:function(){return this.el.offset().top}}}));m(t);var a=window.location.hash,s=a.replace("shanti-texts-","shanti-texts-toc-"),n=d()(".shanti-texts-toc > ul > li.first > a");a&&1===d()(".shanti-texts-toc > ul  a"+s).length&&(n=d()(".shanti-texts-toc > ul  a"+s),d()(a).get(0).scrollIntoView()),n.addClass("toc-selected")}}));var w=c.a.createElement(c.a.Fragment,null,c.a.createElement(q.a,{className:"astviewer texts",fluid:!0},c.a.createElement(B.a,{id:"shanti-texts-container"},c.a.createElement("div",{className:"loading"},c.a.createElement(fe.a,{as:"div",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Loading text..."),c.a.createElement("div",{className:"not-found-msg d-none"},c.a.createElement("h1",null,"Text Not Found!"),c.a.createElement("p",{className:"error"},"Could not find the requested text: ",e.id)))));return t&&t.nid&&(""===t.bibl_summary&&(t.bibl_summary="<div>Description is loading!</div>"),w=c.a.createElement(c.a.Fragment,null,c.a.createElement(q.a,{className:"astviewer texts",fluid:!0},c.a.createElement(B.a,{id:"shanti-texts-container"},c.a.createElement(At,{id:t.nid,alias:t.alias,markup:t.full_markup,listener:function(e){var t=90+d()("#shanti-texts-body").height(),a=[];d()(".toc-selected").removeClass("toc-selected"),d.a.each(p,(function(e){var s=p[e],n=e<p.length-1&&p[e+1],i=s.getTop(),r=n?n.getTop():1e7;if(i>90&&i<t||i<90&&r>90){a.push(s.id);var l="#"+s.id.replace("texts-","texts-toc-");d()(l).addClass("toc-selected")}})),g(a)}}),c.a.createElement(Pt,{toc:t.toc_links,meta:t.bibl_summary,links:t.views_links,html:a.url_html,title:n,sections:f,altChange:E}))),c.a.createElement(Nt,{title:n,url:y,altChange:E}))),w}function At(e){var t=e.alias;return Object(l.useEffect)((function(){d()(".l-content__wrap, #l-content__main,.astviewer, .astviewer.texts #shanti-texts-container").css("height","inherit")}),[]),Object(l.useEffect)((function(){Object(Le.a)("#l-content__main")})),c.a.createElement(G.a,{id:"shanti-texts-body",onScroll:e.listener},c.a.createElement("div",{className:"link-external mandala-edit-link"},c.a.createElement("a",{href:t,target:"_blank",title:"View Text in Mandala"},c.a.createElement("span",{className:"icon u-icon__external"}))),c.a.createElement(Oe,{markup:e.markup}))}function Pt(e){var t=c.a.createElement("span",{className:"shanticon shanticon-info"}),a=c.a.createElement("span",{className:"shanticon shanticon-circle-right"}),s=Object(l.useState)(!0),n=Object(x.a)(s,2),i=n[0],r=n[1],o=Object(l.useState)(a),u=Object(x.a)(o,2),p=u[0],m=u[1],h=function(){m(i?a:t)},v=d()(e.links).find("a").map((function(t,a){var s=d()(a).attr("href");s.includes("http")||(s="https://texts-dev.shanti.virginia.edu"+s);var n=d()(a).text(),i=function(e){var t=e||Math.floor(Math.random()*Math.pow(10,15)).toString(16);return Math.floor(Math.random()*Math.pow(10,15)).toString(16)+t}(n);return c.a.createElement("tr",{className:"shanti-texts-field nothing",key:i},c.a.createElement("td",{colSpan:"2",className:"shanti-texts-field-content"},c.a.createElement("a",{href:"#","data-href":s,onClick:function(){e.altChange(s)}},n)))})),f=e.title;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{id:"sidecolumn-ctrl"},c.a.createElement("a",{onClick:function(){r(!i)},"aria-controls":"txtsidecol","aria-expanded":"open",className:"sidecol-toggle"},p)),c.a.createElement(jt.a,{in:i,onExited:h,onEnter:h},c.a.createElement(G.a,{id:"shanti-texts-sidebar",md:4},c.a.createElement(X.a,{id:"shanti-texts-sidebar-tabs",className:"nav-justified"},c.a.createElement(Z.a,{eventKey:"text_toc",title:"Contents",className:"shanti-texts-toc"},c.a.createElement("div",{className:"shanti-texts-record-title"},c.a.createElement("a",{href:"#shanti-top"},e.title)),c.a.createElement(Oe,{markup:e.toc,app:"texts"})),c.a.createElement(Z.a,{eventKey:"text_bibl",title:"Description"},c.a.createElement(Oe,{markup:e.meta,app:"texts"})),c.a.createElement(Z.a,{eventKey:"text_links",title:"Views"},c.a.createElement("div",{className:"shanti-texts-record-title"},f),c.a.createElement("h6",null,"Alternative Formats"),c.a.createElement("div",null,c.a.createElement("table",{className:"shanti-texts-record-table table"},c.a.createElement("tbody",null,v,c.a.createElement("tr",{className:"shanti-texts-field nothing"},c.a.createElement("td",{colSpan:"2",className:"shanti-texts-field-content"},c.a.createElement("a",{href:e.html,target:"_blank"},"View in Mandala")))))))))))}function Nt(e){var t=e.url?e.url:"",a=t?"hidden":"shown",s=e.title?e.title:"",n=t?c.a.createElement("iframe",{src:t,className:"full-page-frame"}):" ";return c.a.createElement("div",{id:"text-alt-viewer",className:a},c.a.createElement("div",{className:"close-iframe"},c.a.createElement("a",{href:"#",title:"Back to "+s,onClick:function(){e.altChange("")}},c.a.createElement("span",{className:"icon shanticon-cancel"}))),n)}function Ot(e){var t=Y();return t.setType("texts"),t.setHeaderTitle("Loading..."),c.a.createElement("div",{className:"assethome texts"},c.a.createElement("div",{className:"desc"},c.a.createElement("p",null,"This page shows all texts in this project.")),c.a.createElement(lt,{asset_type:"texts"}))}var Ct=a(680);a(594);function Dt(e){var t,a,s,n,i,r,o,u,p,m,h=e.mdlasset,v=e.nodejson,f=e.ismain,g=Y();(null===e||void 0===e?void 0:e.id)||(null===h||void 0===h?void 0:h.id)||null===v||void 0===v||v.nid;if(Object(l.useEffect)((function(){f&&(g.clear(),g.setType("sources"),g.setHeaderTitle("Loading ..."))}),[]),Object(l.useEffect)((function(){if(h&&f){g.clear();var e=(null===h||void 0===h?void 0:h.title)||(null===h||void 0===h?void 0:h.caption);e=""===e?"Sources Viewer":e,g.setHeaderTitle(e),d()("main.l-column__main").addClass("sources");var t=Object(Le.c)(h);g.setPath(t)}}),[h]),!h)return c.a.createElement(q.a,{fluid:!0,className:"c-source__container"},c.a.createElement(G.a,{className:"c-source"},c.a.createElement("div",{className:"loading"},"Loading ...")));var _=(null===h||void 0===h||null===(t=h.url_thumb)||void 0===t?void 0:t.length)>0?8:12;return c.a.createElement(q.a,{fluid:!0,className:"c-source__container"},c.a.createElement(G.a,{className:"c-source"},c.a.createElement("h1",{className:"c-source__head"},c.a.createElement("span",{className:"u-icon__sources"})," ",c.a.createElement("span",{className:"c-source__title"},null===h||void 0===h?void 0:h.title)),(null===v||void 0===v||null===(a=v.biblio_secondary_title)||void 0===a?void 0:a.length)>0&&c.a.createElement("h2",{className:"c-source__second-head"},v.biblio_secondary_title),(null===v||void 0===v||null===(s=v.biblio_tertiary_title)||void 0===s?void 0:s.length)>0&&c.a.createElement("h3",{className:"c-source__third-head"},v.biblio_tertiary_title),c.a.createElement(B.a,null,c.a.createElement(G.a,{md:_,className:"c-sources__data"},(null===v||void 0===v||null===(n=v.biblio_contributors)||void 0===n?void 0:n.length)>0&&c.a.createElement(Rt,{agents:v.biblio_contributors}),c.a.createElement(Lt,{sdata:h}),c.a.createElement(Mt,{label:"Format",value:v.biblio_type_name}),(null===v||void 0===v||null===(i=v.biblio_year)||void 0===i?void 0:i.length)>0&&c.a.createElement(Mt,{label:"Publication Year",value:v.biblio_year}),(null===v||void 0===v||null===(r=v.biblio_publisher)||void 0===r?void 0:r.length)>0&&c.a.createElement(Mt,{label:"Publisher",value:v.biblio_publisher}),(null===v||void 0===v||null===(o=v.biblio_place_published)||void 0===o?void 0:o.length)>0&&c.a.createElement(Mt,{label:"Place of Publication",value:v.biblio_place_published}),(null===v||void 0===v||null===(u=v.biblio_pages)||void 0===u?void 0:u.length)>0&&c.a.createElement(Mt,{label:"Pages",value:v.biblio_pages}),c.a.createElement(Mt,{label:"Source ID",value:"sources-"+v.nid}),c.a.createElement(It,{label:"Language",field:v.field_language_kmaps}),c.a.createElement(It,{label:"Places",field:v.field_kmaps_places}),c.a.createElement(It,{label:"Subjects",field:v.field_kmaps_subjects}),c.a.createElement(It,{label:"Terms",field:v.field_kmaps_terms}),(null===v||void 0===v||null===(p=v.biblio_abst_e)||void 0===p?void 0:p.length)>0&&c.a.createElement(Mt,{label:"Abstract",value:v.biblio_abst_e,has_markup:!0}),(null===v||void 0===v||null===(m=v.biblio_url)||void 0===m?void 0:m.length)>0&&c.a.createElement(Mt,{label:"url",value:v.biblio_url})),(null===h||void 0===h?void 0:h.url_thumb)&&h.url_thumb.length>0&&c.a.createElement(G.a,{className:"c-source__thumb"},c.a.createElement(Ct.a,{src:h.url_thumb,fluid:!0})))))}function Rt(e){var t,a=null===e||void 0===e||null===(t=e.agents)||void 0===t?void 0:t.map((function(e){var t="".concat(e.firstname,"-").concat(e.lastname,"-").concat(Math.ceil(1e4*Math.random()));return c.a.createElement("span",{className:"agent",key:t},e.firstname," ",e.lastname," (",function(e){if(isNaN(e))return"Author";switch(parseInt(e)){case 1:return"Author";case 2:return"Secondary Author";case 3:return"Tertiary Author";case 4:return"Subsidiary Author";case 5:return"Corporate Author";case 10:return"Series Editor";case 11:return"Performer";case 12:return"Sponsor";case 13:return"Translator";case 14:return"Editor";case 15:return"Counsel";case 16:return"Director";case 17:return"Producer";case 18:return"Department";case 19:return"Issuing Organization";case 20:return"International Author";case 21:return"Recipient";case 22:return"Advisor";default:return"Author"}}(e.auth_type),")")}));return c.a.createElement(B.a,{className:"agents",key:"src-agent-row"},c.a.createElement("span",{className:"u-icon__agents"}),a)}function Lt(e){var t=e.sdata;if(!t)return null;var a=(null===t||void 0===t?void 0:t.url_html)?t.url_html:"";if(a.includes(".edu")){var s=a.split(".edu");a=s[0]+".edu/node/"}var n=(null===t||void 0===t?void 0:t.collection_title_path_ss)?t.collection_title_path_ss:[],i=(null===t||void 0===t?void 0:t.collection_nid_path_is)?t.collection_nid_path_is:[];if(n.length>0){var r=n.length-1,l=i[r],o=n[r],d=c.a.createElement(j.c,{to:"/sources/collection/"+l},o);return c.a.createElement(Mt,{label:"Collection",value:d})}return null}function It(e){var t=e.field;if(!t||!(null===t||void 0===t?void 0:t.und)||0==t.und.length)return null;var a=t.und.map((function(e){var t="".concat(e.domain,"-").concat(e.id,"-").concat(Math.ceil(1e4*Math.random()));return c.a.createElement(Ee.a,{domain:e.domain,kid:e.id,children:[e.header],key:t})}));return c.a.createElement(Mt,{label:e.label,value:a})}function Mt(e){var t=e.cls?e.cls:"",a=(e.icon&&e.icon,e.label?e.label:""),s=" "+a.replace(/\s+/g,"-").toLowerCase(),n=!!e.has_markup&&e.has_markup,i=e.value?e.value:"";n?i=c.a.createElement(Ce,{markup:i}):"string"==typeof i&&0==i.indexOf("http")&&(i=c.a.createElement("a",{href:i,target:"_blank"},i));var r=e.valclass?" "+e.valclass:"",l="ir-"+a.toLowerCase().replace(" ","-")+Math.floor(888888*Math.random());return c.a.createElement(B.a,{className:t+s,key:l},c.a.createElement("span",{className:"u-label"},a)," ",c.a.createElement("span",{className:"u-value"+r},i))}function Ft(e){var t=Y();return t.setType("sources"),t.setHeaderTitle("Loading..."),c.a.createElement("div",{className:"assethome sources"},c.a.createElement("div",{className:"desc"},c.a.createElement("p",null,"This page shows all sources in this project.")),c.a.createElement(lt,{asset_type:"sources"}))}a(595);function Ut(e){var t,a,s,n,i=e.mdlasset,r=e.nodejson,o=e.ismain,u=Object(l.useState)({}),p=Object(x.a)(u,2),m=p[0],h=(p[1],Object(l.useState)({})),v=Object(x.a)(h,2),f=v[0],g=v[1],_=Y();(null===e||void 0===e?void 0:e.id)||(null===i||void 0===i?void 0:i.id)||null===r||void 0===r||r.nid;if(Object(l.useEffect)((function(){o&&(_.clear(),_.setType("visuals"))}),[]),Object(l.useEffect)((function(){if(i&&o){var e=(null===i||void 0===i?void 0:i.title)||(null===i||void 0===i?void 0:i.caption);e=""===e?"Visuals Viewer":e,_.setHeaderTitle(e),d()("main.l-column__main").addClass("visuals");var t=Object(Le.c)(i);_.setPath(t)}}),[i]),Object(l.useEffect)((function(){if(r){var e=r.shivanode_json.und[0].value;g(JSON.parse(e))}}),[r]),!i)return _.setHeaderTitle("Loading Visuals Record ..."),c.a.createElement(q.a,{fluid:!0,className:"c-visual__container"},c.a.createElement(G.a,{className:"c-visual"},c.a.createElement("div",{className:"loading"},"Loading ...")));var b=new Date(null===i||void 0===i?void 0:i.node_created),y=f&&f.shivaGroup?f.shivaGroup:"",E="Chart"==y||"Graph"==y||y.toLowerCase().includes("timeline"),k="Video"==y&&isNaN(null===f||void 0===f?void 0:f.dataSourceUrl)?"YouTube":"Vimeo",w="YouTube"==k?"https://www.youtube.com/watch?v="+(null===f||void 0===f?void 0:f.dataSourceUrl):"https://vimeo.com/"+(null===f||void 0===f?void 0:f.dataSourceUrl);return c.a.createElement(q.a,{fluid:!0,className:"c-visual__container"},c.a.createElement(G.a,{className:"c-visual"},c.a.createElement("div",{className:"c-visual__player"},c.a.createElement(Ce,{markup:r.iframe})),c.a.createElement("div",{className:"c-visual__info",style:{width:f.width+"px"}},c.a.createElement("h2",null,c.a.createElement("span",{className:"u-icon__visuals"}),c.a.createElement("span",{className:"title"},null===i||void 0===i?void 0:i.title)),c.a.createElement(qt,{label:"Collection",value:m.name,url:m.uid,icon:"collections"}),c.a.createElement(qt,{label:"Type",value:null===r||void 0===r||null===(t=r.shivanode_element_type)||void 0===t?void 0:t.label,icon:"th"}),c.a.createElement(qt,{label:"Date",value:b.toLocaleDateString(),icon:"calendar"}),c.a.createElement(qt,{label:"Data Entry",value:null===i||void 0===i?void 0:i.node_user,icon:"agents"}),c.a.createElement(qt,{label:"UID",value:"visuals-"+(null===i||void 0===i?void 0:i.id)}),c.a.createElement(Bt,{label:"Language",field:null===r||void 0===r?void 0:r.field_language_kmap,icon:"comments-o"}),c.a.createElement(Bt,{label:"Subjects",field:null===r||void 0===r?void 0:r.field_subjects_kmap,icon:"subjects"}),c.a.createElement(Bt,{label:"Places",field:null===r||void 0===r?void 0:r.field_places_kmap,icon:"places"}),c.a.createElement(Bt,{label:"Terms",field:null===r||void 0===r?void 0:r.field_terms_kmap,icon:"terms"}),(null===r||void 0===r||null===(a=r.shivanode_description)||void 0===a?void 0:a.und)&&(null===r||void 0===r||null===(s=r.shivanode_description)||void 0===s?void 0:s.und.length)>0&&c.a.createElement(qt,{label:"Description",value:null===r||void 0===r||null===(n=r.shivanode_description)||void 0===n?void 0:n.und[0].safe_value,has_markup:!0,myclass:"visdesc",icon:"file-text-o"}),(null===f||void 0===f?void 0:f.dataSourceUrl)&&E&&c.a.createElement(qt,{label:"Data Source",value:"External spreadsheet",url:f.dataSourceUrl,icon:"list-alt"}),(null===f||void 0===f?void 0:f.dataSourceUrl)&&"Video"==y&&c.a.createElement(qt,{label:"Data Source",value:k,url:w,icon:"list-alt"}))))}function qt(e){var t=null===e||void 0===e?void 0:e.label,a=null===e||void 0===e?void 0:e.value,s=null===e||void 0===e?void 0:e.url,n=null===e||void 0===e?void 0:e.icon,i=null===e||void 0===e?void 0:e.has_markup,r=(null===e||void 0===e?void 0:e.myclass)?" "+e.myclass:"",l=(null===e||void 0===e?void 0:e.valclass)?" "+(null===e||void 0===e?void 0:e.valclass):"";n||(n="info");var o=t.replace(/\s+/g,"-").toLowerCase();i?a=c.a.createElement(Ce,{markup:a}):s&&(a=c.a.createElement("a",{href:s,target:"_blank"},a));var d="ir-"+t.toLowerCase().replace(" ","-")+Math.floor(888888*Math.random());return c.a.createElement(B.a,{className:o+r,key:d},c.a.createElement("span",{className:"icon u-icon__"+n}),c.a.createElement("span",{className:"u-label"},t)," ",c.a.createElement("span",{className:"u-value"+l},a))}function Bt(e){var t=e.field,a=(null===e||void 0===e?void 0:e.icon)?e.icon:"info";if(!t||!(null===t||void 0===t?void 0:t.und)||0==t.und.length)return null;var s=t.und.map((function(e){return c.a.createElement(Ee.a,{domain:e.domain,kid:e.id})}));return c.a.createElement(qt,{label:e.label,value:s,icon:a,myclass:"kmapfield",valclass:"kmapval"})}function Gt(e){var t=Y();return t.setType("visuals"),t.setHeaderTitle("Loading..."),c.a.createElement("div",{className:"assethome visuals"},c.a.createElement("div",{className:"desc"},c.a.createElement("p",null,"This page shows all visualizations in this project.")),c.a.createElement(lt,{asset_type:"visuals"}))}var Ht=a(117),zt=a(385);function Kt(e){var t,a,s=Object(T.k)(["/:baseType/:baseUid/related-:type","/:baseType/:baseUid"]),n={};n[(null===s||void 0===s?void 0:s.params.type)||"home"]="selected";var i={baseType:(null===s||void 0===s?void 0:s.params.baseType)||(null===(t=e.kmap)||void 0===t?void 0:t.tree)||"assets",baseUid:e.id||(null===s||void 0===s?void 0:s.params.baseUid),relateds:e.relateds};if(!e.id&&!i.baseUid)return null;var r=(null===e||void 0===e||null===(a=e.kmap)||void 0===a?void 0:a.tree)?e.kmap.tree:"subjects",l=c.a.createElement(Ht.default,{domain:"places",tree:"places",descendants:!0,directAncestors:!1,displayPopup:!0,perspective:"pol.admin.hier",view:"roman.scholar",sortBy:"header_ssort+ASC",currentFeatureId:e.id});return"subjects"===r&&(l=c.a.createElement(Ht.default,{domain:"subjects",tree:"subjects",descendants:!0,directAncestors:!1,displayPopup:!0,perspective:"gen",view:"roman.popular",sortBy:"header_ssort+ASC",currentFeatureId:e.id})),"terms"===r&&(l=c.a.createElement(Ht.default,{domain:"terms",tree:"terms",descendants:!0,directAncestors:!1,displayPopup:!0,perspective:"tib.alpha",view:"roman.scholar",sortBy:"position_i+ASC",currentFeatureId:e.id})),c.a.createElement("aside",{className:"l-column__related"},c.a.createElement("div",{className:"l-column__related__wrap"},c.a.createElement("section",{className:"l-related__list__wrap"},c.a.createElement("div",{className:"u-related__list__header"},"Related Resources"),c.a.createElement("div",{className:"c-relatedViewer"},c.a.createElement(j.c,{id:"sui-rl-Home",to:"/"+i.baseType+"/"+i.baseUid,className:"c-related__link--home c-related__item ".concat(n.home)},c.a.createElement("span",{className:"icon u-icon__overview"})," ",c.a.createElement("span",null,"Home")),c.a.createElement(Vt,Object.assign({type:"all"},i,{className:n.mandala})),c.a.createElement(Vt,Object.assign({type:"places"},i,{className:n.places})),c.a.createElement(Vt,Object.assign({type:"audio-video"},i,{className:n["audio-video"]})),c.a.createElement(Vt,Object.assign({type:"images"},i,{className:n.images})),c.a.createElement(Vt,Object.assign({type:"sources"},i,{className:n.sources})),c.a.createElement(Vt,Object.assign({type:"texts"},i,{className:n.texts})),c.a.createElement(Vt,Object.assign({type:"visuals"},i,{className:n.visuals})),c.a.createElement(Vt,Object.assign({type:"subjects"},i,{className:n.subjects})),c.a.createElement(Vt,Object.assign({type:"terms"},i,{className:n.terms})),c.a.createElement(Vt,Object.assign({type:"collections"},i,{className:n.collections})))),c.a.createElement("section",{className:"l-history__list__wrap"},c.a.createElement("div",{className:"u-related__list__header"},"Recently Viewed"),c.a.createElement(zt.a,null)),c.a.createElement("section",{className:"l-terms__tree__wrap"},c.a.createElement("div",{className:"u-related__list__header"},"Browse"," ",c.a.createElement("span",{className:"text-capitalize"},r)),l)))}function Vt(e){var t,a,s=(null===(t=e.relateds)||void 0===t?void 0:t.assets)?null===(a=e.relateds.assets[e.type])||void 0===a?void 0:a.count:0,n="icon u-icon__"+("all"===e.type?"logo-shanti":e.type),i="deck";return"sources"!==e.type&&"texts"!==e.type||(i="list"),"images"===e.type&&(i="gallery"),s?c.a.createElement(j.c,{id:"sui-rl-"+e.type,href:"#",className:"c-related__item c-related__link--"+e.type,to:"/"+e.baseType+"/"+e.baseUid+"/related-"+e.type+"/"+i},c.a.createElement("span",{className:"u-icon__"+e.type+" "+n}),c.a.createElement("span",{className:"c-related__item__label"}," ",e.type),c.a.createElement("span",{id:"sui-rln-places"},s)):null}var Yt=a(398),Wt=function(e){Object(i.a)(a,e);var t=Object(r.a)(a);function a(e){var n;Object(s.a)(this,a),(n=t.call(this,e)).props=e,n.sui=e.sui;var i=n.props.id||n.props.match.params.id;return n.sui.GetKmapFromID(i,(function(e){console.log("LegacyViewer: kmasset = ",e),(!n.state||!n.state.kmasset||e.uid&&e.uid!==n.state.kmasset.uid)&&(n.state={kmasset:e,id:i},n.sui.pages.Draw(n.state.kmasset,!1),n.props.onStateChange(n.state),console.log("LegacyViewer: whoop"))})),n}return Object(n.a)(a,[{key:"render",value:function(){var e=new Yt.Parser,t=e.parse(d()(this.sui.pages.div).html()),a=e.parse(d()(this.sui.pages.reldiv).html());return console.log("LegacyViewer VIEWER = ",t),console.log("LegacyViewer RELDIV = "+a),c.a.createElement("div",{className:"legacyviewer"},t)}}]),a}(c.a.Component),Qt=Object(T.l)(Wt),Jt=a(120),Xt=a.n(Jt);function Zt(e){var t=Y(),a=Object(T.h)(),s=Object(T.i)(),n=Object(N.k)((function(e){return e.search.loadingState})),i=Object(N.k)((function(e){return e.search})),r=Xt.a.stringify({page:{current:i.page.current,rows:i.page.rows},query:{filters:i.query.filters,searchText:i.query.searchText}},{allowDots:!0});return Object(l.useEffect)((function(){var e,a,s,n,r=(null===(e=i.query)||void 0===e||null===(a=e.searchText)||void 0===a?void 0:a.length)>1?'"'+i.query.searchText+'"':"*",l=(null===(s=i.query)||void 0===s||null===(n=s.filters)||void 0===n?void 0:n.length)||0,c=l?" (+"+l+" filter"+(1!==l?"s":"")+")":"";t.clear(),t.setHeaderTitle("Search Results: "+r+" "+c),t.setSubTitle("For a Better Tomorrow...")}),[r]),Object(l.useEffect)((function(){"true"===Xt.a.parse(s.search).internal?a.replace("?".concat(r)):a.replace("?".concat(r)+"&internal=true")}),[r]),c.a.createElement(it,Object.assign({},e,{viewMode:"deck",loadingState:n,inline:!1,showSearchFilters:!0}))}a(651);var $t=function(e,t){var a=Pe("kmassets-"+e+"-"+t,{index:"assets",params:{q:"id:".concat(t),fq:["asset_type:collections","asset_subtype:".concat(e)],rows:1}});return(null===a||void 0===a?void 0:a.docs)&&a.docs.length>0?a.docs[0]:a};function ea(e){var t,a,s=Y(),n=Object(T.j)(),i=null===n||void 0===n?void 0:n.view_mode,r=null===n||void 0===n?void 0:n.asset_type,o=null===n||void 0===n?void 0:n.id;s.setType(r);var u=c.a.createElement("span",{className:"text-capitalize"},r),p=$t(r,o),m=Object(l.useState)(0),h=Object(x.a)(m,2),v=h[0],f=h[1],g=Object(l.useState)(0),_=Object(x.a)(g,2),b=_[0],y=_[1],E=Object(l.useState)(100),k=Object(x.a)(E,2),w=k[0],S=k[1],A=Object(l.useState)(0),P=Object(x.a)(A,2),N=P[0],O=P[1];Object(l.useEffect)((function(){s.clear(),s.setType("collections")}),[]);var C=Pe("collection-"+r+"-"+o,{index:"assets",params:{fq:["asset_type:"+r,"-asset_subtype:page"],q:"collection_nid_path_is:"+o,sort:"title_sort_s asc",start:v,rows:w}}),D={numFound:N,getMaxPage:function(){return Math.floor(D.numFound/D.getPageSize())},getPage:function(){return b},setPage:function(e){e=parseInt(e),!isNaN(e)&&e>-1&&e<=D.getMaxPage()&&(y(e),D.pgnum=e)},setPageSize:function(e){e=parseInt(e),!isNaN(e)&&e>0&&e<101&&(S(e),D.pgsize=e)},getPageSize:function(){return w},nextPage:function(){D.setPage(D.getPage()+1)},prevPage:function(){D.setPage(D.getPage()-1)},lastPage:function(){D.setPage(D.getMaxPage())},firstPage:function(){D.setPage(0)}};Object(l.useEffect)((function(){f(b*w)}),[b,w]),Object(l.useEffect)((function(){O(C.numFound)}),[null===C||void 0===C?void 0:C.numFound]);(null===C||void 0===C?void 0:C.docs)&&(null===(t=C.docs)||void 0===t?void 0:t.length)>0&&C.docs[0].collection_nid_path_is;var R=[];Object(l.useEffect)((function(){e.ismain&&p&&(s.setHeaderTitle(p.title),R=[{uid:"/"+r,name:u}],(null===p||void 0===p?void 0:p.collection_nid)&&p.collection_nid.length>0&&R.push({uid:"/"+r+"/collection/"+p.collection_nid,name:p.collection_title}),R.push({uid:"/"+r+"/collection/"+p.id,name:p.title}),s.setPath(R),s.setType(r))}),[p]);var L=(null===p||void 0===p?void 0:p.node_user_full_s)?p.node_user_full_s:p.node_user,I=null===p||void 0===p?void 0:p.collection_nid;I&&(I=c.a.createElement("li",{className:"text-nowrap"},c.a.createElement(j.c,{to:"/".concat(r,"/collection/").concat(I)},p.collection_title)));var M=null===p||void 0===p?void 0:p.subcollection_id_is,F=null===p||void 0===p?void 0:p.subcollection_name_ss,U=null===M||void 0===M?void 0:M.map((function(e,t){return"".concat(F[t],"###").concat(e)}));(null===U||void 0===U?void 0:U.length)>0&&U.sort();var H=null===U||void 0===U?void 0:U.map((function(e){var t=e.split("###"),a=Object(x.a)(t,2),s=a[0],n=a[1],i="/".concat(r,"/collection/").concat(n),l="".concat(n,"-").concat(s);return c.a.createElement("li",{key:l,className:"text-nowrap"},c.a.createElement(j.c,{to:i},s))})),z=d.a.trim(null===p||void 0===p?void 0:p.url_thumb);z&&z.length>0&&(z=c.a.createElement("img",{src:z,className:"rounded float-left",alt:"alignment"}));var K=d.a.trim(null===p||void 0===p?void 0:p.summary);return K&&0==K.length&&(K=!1),0===(null===p||void 0===p?void 0:p.numFound)?((R=[{uid:"/"+r,name:u}]).push({uid:"#",name:"Not Found"}),s.setHeaderTitle(r[0].toUpperCase()+r.substr(1)),s.setPath(R),c.a.createElement(mt,{type:r+" collection",id:o})):c.a.createElement(q.a,{fluid:!0,className:"c-collection__container "+r},c.a.createElement(B.a,{className:"c-collection"},c.a.createElement(G.a,{lg:9,md:8,sm:7,className:"c-collection__items"},((null===p||void 0===p||null===(a=p.url_thumb)||void 0===a?void 0:a.length)>0||d.a.trim(null===p||void 0===p?void 0:p.summary).length>0)&&c.a.createElement("p",{className:"colldesc clearfix"},z,K),c.a.createElement("h3",{className:"clearfix"},u," Items in This Collection"),c.a.createElement(it,{docs:null===C||void 0===C?void 0:C.docs,numFound:null===C||void 0===C?void 0:C.numFound,pager:D,viewMode:i,inline:!1})),c.a.createElement(G.a,{md:2,sm:4,className:"c-collection__metadata"},I&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h3",null,"Parent Collection"),c.a.createElement("ul",null,I)),H&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h3",null,"Subcollections (",H.length,")"),c.a.createElement("ul",null,H)),c.a.createElement("h3",null,"Owner"),c.a.createElement("ul",null,c.a.createElement("li",null,L))),c.a.createElement(G.a,{sm:"auto"})))}function ta(e){var t=Y();return Object(l.useEffect)((function(){t.clear(),t.setHeaderTitle("Collections Home")})),c.a.createElement(c.a.Fragment,null," Collections Home: Not much here yet.. ")}function aa(e){Y();var t=Object(z.b)((function(e){return e.kmap})),a=(t.firstRelatedsPage,t.gotoRelatedsPage),s=(t.lastRelatedsPage,t.nextRelatedsPage,t.prevRelatedsPage,t.setRelatedsPage),n=t.setRelatedsPageSize,i=t.setUid,r=(t.update,t.receiveKmap,Object(z.b)((function(e){return e.search})),Object(z.c)((function(e){return e.kmap})),Object(z.c)((function(e){return e.kmap.uid})),Object(z.c)((function(e){return e.kmap.asset}))),o=Object(z.c)((function(e){return e.kmap.relateds})),d=Object(z.c)((function(e){return e.kmap.kmap})),u=(Object(z.c)((function(e){return e.kmap.loadingState})),Object(z.c)((function(e){var t;return null===(t=e.kmap.relatedsPage)||void 0===t?void 0:t.page}))),p=Object(z.c)((function(e){var t;return null===(t=e.kmap.relatedsPage)||void 0===t?void 0:t.pageSize}));(isNaN(p)||0===p)&&n(100);var m=Object(T.j)(),h=m.id,v=m.relatedType,f=m.definitionID,g="";h&&!h.match(/[a-z]\-\d+/)&&e.assetType&&(g=e.assetType+"-");var _=g+h,b={getMaxPage:function(){if(o.assets&&o.assets[v]){if(f){var e=o.assets[v],t=e;"any"!==f&&(t=e.filter((function(e){return e.kmapid.includes(f)})));var a=t.count;return Math.floor((a-1)/p)}var s=o.assets[v].count;return Math.floor((s-1)/p)}return 1},getPage:function(){return u},setPage:function(e){e=Number(e);var t=o.assets[v].count,s=Math.floor(t/p);e=D.a.isNaN(e)?0:e,a(e>s?s:e<0?0:e)},setPageSize:function(e){e=Number(e);var t=Number(e),a=Number(u);e=e<1?1:e,e=D.a.isNaN(e)?t:e,n(e);var s=Math.floor(p/t*a);s=D.a.isNaN(s)?0:s,b.setPage(s)},getPageSize:function(){return p},nextPage:function(){b.setPage(b.getPage()+1)},prevPage:function(){b.setPage(b.getPage()-1)},lastPage:function(){b.setPage(b.getMaxPage())},firstPage:function(){b.setPage(0)}};return Object(l.useEffect)((function(){_&&(i(_),s({related_type:v,page:u,pageSize:p}))}),[_,v,u,p,s]),c.a.Children.map(e.children,(function(e){return e.type?c.a.cloneElement(e,{id:_,kmap:d,kmasset:r,relateds:o,pager:b}):e}))}var sa=function(e,t){var a="all"!==t?" AND id:".concat(t):"";return Pe("kmassets-"+e+"-"+t,{index:"assets",params:{q:"asset_type:".concat(e).concat(a),rows:1}})},na=function(){var e=Object(Te.a)(xe.a.mark((function e(t,a){var s,n,i,r,l;return xe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(s=a.query)){e.next=3;break}return e.abrupt("return",!1);case 3:return n={adapter:J.a,callbackParamName:"callback",url:s},e.next=6,Q.a.request(n);case 6:return i=e.sent,r=i.data,l=r&&r.response?r.response:r,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ia=function(e){var t="";e&&(e.url_json?t=e.url_json:e.docs&&e.docs.length>0&&(t=e.docs[0].url_json)),t=t.replace(/\.json$/,".jsonp?callback=mdldata");var a=Object(je.a)(["mndlapi",{query:t}],na,{enabled:t});return!(!a||!a.data)&&a.data};function ra(e){var t=e.assetType,a=Object(l.useState)(null),s=Object(x.a)(a,2),n=s[0],i=s[1],r=Object(l.useState)(!1),o=Object(x.a)(r,2),d=o[0],u=o[1],p=Object(T.j)(),m=p.relId||p.id||p.nid;m.indexOf("-")>1&&(m=m.split("-").pop());var h=Y(),v=sa(t,m),f=ia(v);if(Object(l.useEffect)((function(){(null===v||void 0===v?void 0:v.docs)&&v.docs.length>0?i(v.docs[0]):"success"===v.status&&u(!0)}),[v]),d){var g="Not found";return t&&"string"===typeof t&&(g=(g=t).charAt(0).toUpperCase()+g.substr(1).replace("-v","-V"),h.setHeaderTitle(g)),c.a.createElement(mt,{type:t,id:m})}return c.a.Children.map(e.children,(function(e){return e.type?c.a.cloneElement(e,{asset_type:t,id:m,mdlasset:n,nodejson:f}):e}))}a(652);function la(e){var t,a=Object(Le.b)(null===(t=e.kmap)||void 0===t?void 0:t._childDocuments_,"related_names");return c.a.createElement("div",{className:"sui-nameEntry__wrapper"},c.a.createElement("ul",{className:"sui-nameEntry first-entry"},c.a.createElement(ca,{names:a})))}function ca(e){var t=[];return Object.entries(e.names).map((function(e){var a=Object(x.a)(e,2),s=a[0],n=a[1];return t.push(c.a.createElement("li",{id:s,key:s,className:"sui-nameEntry"},c.a.createElement("span",{className:"sui-nameEntry-header"},n.related_names_header_s),c.a.createElement("span",{className:"sui-nameEntry-meta"},c.a.createElement("span",{className:"sui-nameEntry-language"},n.related_names_language_s),c.a.createElement("span",{className:"sui-nameEntry-relationship"},n.related_names_relationship_s),c.a.createElement("span",{className:"sui-nameEntry-writing-system"},n.related_names_writing_system_s)),c.a.createElement("span",{className:"sui-nameEntry-etymology"},ye()(n.related_names_etymology_s)),!D.a.isEmpty(n._nested_)&&c.a.createElement("ul",null,c.a.createElement(ca,{names:n._nested_})))),!0})),c.a.createElement(c.a.Fragment,null,t)}a(653);var oa=function(e){Object(T.h)();var t,a,s,n=Object(T.k)(),i=e.back||!1,r=n.params,l=r.id,o=r.relId,d=r.relatedType,u=r.viewerType,p=(r.viewMode,null);e.relatedType&&(d=e.relatedType);var m=o?Object(Le.d)(o):Object(Le.d)(l),h=sa(d,m);if(o&&d){var v=null===h||void 0===h?void 0:h.docs,f=null;(null===v||void 0===v?void 0:v.length)&&(f=v[0].caption||v[0].title?v[0].title[0]:null),p=(null===v||void 0===v?void 0:v.length)?c.a.createElement("h5",{className:"c-nodeHeader-itemHeader"},c.a.createElement("span",{className:"icon u-icon__"+v[0].asset_type}),c.a.createElement("span",{className:"c-nodeHeader-itemHeader-subType"},v[0].asset_subtype),c.a.createElement("span",{className:"c-nodeHeader-itemHeader-caption"},f)):null}var g=e.subHeader||("all"===d?"All Related Items":u?"Related "+d:null),_=(null===(t=e.kmasset)||void 0===t?void 0:t.name_tibt)?e.kmasset.name_tibt[0]:null,b=(null===(a=e.kmasset)||void 0===a?void 0:a.name_latin)?e.kmasset.name_latin[0]:e.kmasset.title[0],y=_?c.a.createElement("span",{className:"sui-nodeTitle-item tibt"},_," "):null,E=b?c.a.createElement("span",{className:"sui-nodeTitle-item latin"},b):null,k="";return"subjects"!==e.kmasset.asset_type||b.includes(e.kmasset.title)||(k=e.kmasset.title),c.a.createElement("div",{className:"c-nodeHeader"},i&&c.a.createElement("div",{className:"c-nodeHeader__backLink__wrap"},c.a.createElement(j.c,{to:"..",className:"c-nodeHeader__backLink"},c.a.createElement("span",{className:"icon u-icon__arrow-left_2"},"Return"))),c.a.createElement("span",{className:"icon u-icon__".concat(null===(s=e.kmasset)||void 0===s?void 0:s.asset_type)}),c.a.createElement("span",{className:"sui-termTitle sui-nodeTitle",id:"sui-termTitle"},k," ",y," ",E)," ",g&&c.a.createElement("span",{className:"sui-relatedSubHeader"},g),p)};function da(e){var t,a=Object(T.j)(),s=a.relatedType,n=a.definitionID,i=null===(t=e.relateds)||void 0===t?void 0:t.assets,r=i?i[s]:null,l=null===r||void 0===r?void 0:r.docs,o=null!==n&&void 0!==n?n:"any",d=l;"any"!==o&&(d=l.filter((function(e){return e.kmapid.includes(o)})));var u="all"!==s?"Related ".concat(s):"All Related Items";return c.a.createElement(it,{docs:d,pager:e.pager,numFound:d.length,title:u,viewMode:"gallery",inline:!0})}a(654),a(655);var ua=c.a.memo((function(e){var t,a,s=D.a.filter(null===(t=e.kmap)||void 0===t?void 0:t._childDocuments_,(function(e){return"terms_recording"===e.block_child_type}));console.log("GerardKetumaAudio",s);var n=Object(l.useRef)(),i=null===(a=s[0])||void 0===a?void 0:a.recording_url,r=Object(l.useState)(i),o=Object(x.a)(r,2),d=o[0],u=o[1],p=D.a.map(s,(function(e,t){return c.a.createElement("option",{key:t,value:e.recording_url},e.recording_dialect_s)})),m=D.a.isEmpty(d)?null:c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{className:"c-audioPlayer__button",onClick:function(){n.current.play()}},c.a.createElement("span",{className:"icon u-icon__audio"})),c.a.createElement("div",{class:"c-audioPlayer__select--wrapper"},c.a.createElement("select",{className:"c-audioPlayer__select",onChange:function(e){return function(e){u(e.target.value)}(e)}},p)));return c.a.createElement("div",{className:"c-audioPlayer"},c.a.createElement("audio",{preload:"none",src:d,ref:function(e){return n.current=e}}),c.a.createElement("form",{onSubmit:function(e){return e.preventDefault(),!1}},m))})),pa=(a(656),function(e){var t=D.a.pickBy(e.kmap,(function(e,t){return/^etymology_\d+/.test(t)}));return t=D.a.reduce(t,(function(e,t,a){var s=/^etymology_(\d+)/.exec(a)[1];return e[s]||(e[s]={}),-1!==a.indexOf("_content_")?e[s].content=t:e[s].heading=t,e}),{}),c.a.createElement("div",{className:"sui-etymology__wrapper"},c.a.createElement("div",{className:"sui-etymology__content"},Object.keys(t).map((function(e){return c.a.createElement("div",{key:e,className:"sui-etymology__content-items"},c.a.createElement("span",{className:"sui-etymology__heading"},t[e].heading,":"," "),c.a.createElement("span",{className:"sui-etymology__text"},ye()(t[e].content.toString().replace(/(<([^>]+)>)/gi,""))))}))))}),ma=a(277),ha=a(1),va=a(189),fa=(a(657),function(e){var t=e.details;return c.a.createElement("div",{className:"sui-termDefDetailsWrapper"},Object.keys(t).map((function(e){return c.a.createElement("div",{key:e,className:"sui-termDefDetails__item"},c.a.createElement("span",{className:"sui-termDefDetails__title"},t[e].header_title,":"," "),c.a.createElement("span",{className:"sui-termDefDetails__text"},t[e].header_text.join(", ")))})))}),ga=(a(658),function(){return c.a.createElement("div",null,"No Passage data currently available")}),_a=(a(659),function(e){var t=e.defID,a=e.resCounts[t];return a?c.a.createElement("div",{className:"sui-termDefResource__wrapper"},c.a.createElement("div",{className:"sui-termDefResource__header"},"Resources tagged with this definition:"),c.a.createElement("div",{className:"sui-termDefResource__content"},Object.keys(a).filter((function(e){return"all"!==e})).map((function(e){return c.a.createElement(ee.a,{key:e,variant:"outline-dark",size:"lg"},c.a.createElement("span",{className:"u-icon__".concat(e," icon")}),c.a.createElement("span",{className:"btn-text"},e.toUpperCase())," ",c.a.createElement("span",{className:"badge badge-light"},a[e]))})))):c.a.createElement("div",{className:"sui-termDefResource__wrapper"},"No resources are currently tagged with this definition.")}),ba=(a(660),D.a.memoize((function(e){return D.a.reduce(e,(function(e,t,a){var s=a.match(/^related_definitions_branch_subjects-(\d+)_(\w+)/);if((null===s||void 0===s?void 0:s.length)>0)switch(e[s[1]]=e[s[1]]||{},s[2]){case"header_s":e[s[1]].header_title=t;break;case"subjects_headers_t":e[s[1]].header_text=t;break;case"subjects_uids_t":e[s[1]].header_uids=t}return e}),{})}))),ya=function(e){var t,a,s,n=(null===(t=e.kmRelated.assets)||void 0===t||null===(a=t.all)||void 0===a?void 0:a.docs)||[],i=e.kmRelated.uid,r=new RegExp("".concat(i,"_definitions-\\d+")),l={},o=Object(ma.a)(n);try{for(o.s();!(s=o.n()).done;){var d,u=s.value,p=Object(ma.a)(u.kmapid);try{for(p.s();!(d=p.n()).done;){var m,h=d.value;if(r.test(h))l[h]=null!==(m=l[h])&&void 0!==m?m:{},l[h][u.asset_type]=l[h][u.asset_type]+1||1,l[h].all=l[h].all+1||1}}catch(v){p.e(v)}finally{p.f()}}}catch(v){o.e(v)}finally{o.f()}return c.a.createElement("div",{className:"sui-termDefinitions_wrapper"},c.a.createElement("div",{className:"sui-termDefinitions__content"},D.a.orderBy(e.mainDefs,(function(e){return e.order}),"asc").map((function(e,t){var a,s;return c.a.createElement(X.a,{key:e.id,defaultActiveKey:"definition"},c.a.createElement(Z.a,{eventKey:"definition",title:c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"".concat(parseInt(t,10)+1,". "),"Definition"," "),c.a.createElement(ha.b.Provider,{value:{style:{verticalAlign:"middle"}}},c.a.createElement(va.a,null)))},ye()(e.related_definitions_content_s),e.related_definitions_author_s&&e.related_definitions_language_s&&c.a.createElement("div",{className:"sui-termDefinitions__extra"},c.a.createElement("span",{className:"sui-termDefinitions__extra-author"},"Author:")," ",c.a.createElement("span",{className:"sui-termDefinitions__extra-author-text"},e.related_definitions_author_s)," ","|"," ",c.a.createElement("span",{className:"sui-termDefinitions__extra-lang"},"Language:")," ",c.a.createElement("span",{className:"sui-termDefinitions__extra-lang-text"},e.related_definitions_language_s))),c.a.createElement(Z.a,{eventKey:"details",title:c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"Details"," "),c.a.createElement(ha.b.Provider,{value:{style:{verticalAlign:"middle"}}},c.a.createElement(va.a,null))),disabled:D.a.isEmpty(ba(e))},c.a.createElement(fa,{details:ba(e)})),c.a.createElement(Z.a,{eventKey:"passages",title:c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"Passages (0)"," "),c.a.createElement(ha.b.Provider,{value:{style:{verticalAlign:"middle"}}},c.a.createElement(va.a,null))),disabled:!0},c.a.createElement(ga,null)),c.a.createElement(Z.a,{eventKey:"resources",title:c.a.createElement(c.a.Fragment,null,c.a.createElement("span",{className:"sui-termDefinitions__tabHeading"},"Resources (",(null===(a=l[e.id])||void 0===a?void 0:a.all)||0,")"," "),c.a.createElement(ha.b.Provider,{value:{style:{verticalAlign:"middle"}}},c.a.createElement(va.a,null))),disabled:parseInt((null===(s=l[e.id])||void 0===s?void 0:s.all)||0)<1},c.a.createElement(_a,{defID:e.id,resCounts:l})))}))))},Ea=(a(661),function(e){var t=e.definitions;return c.a.createElement("div",{className:"sui-termDicts__wrapper"},c.a.createElement("div",{className:"sui-termDicts__title"},"Other Dictionaries"),c.a.createElement("div",{className:"sui-termDicts__content"},Object.keys(t).map((function(e,a){return c.a.createElement(c.a.Fragment,{key:e},c.a.createElement("div",{className:"sui-termDicts__dict-name"},a+1,". ",e),c.a.createElement("ul",{className:"sui-termDicts__dict-wrapper"},t[e].map((function(e){return c.a.createElement("li",{className:"sui-termDicts__dict",key:e.id},ye()(e.related_definitions_content_s.replace(/(<p[^>]+?>|<p>|<\/p>)/gim,"")),e.related_definitions_language_s&&c.a.createElement("div",{className:"sui-termDicts__dict-extra"},c.a.createElement("span",{className:"sui-termDicts__dict-extra-lang"},"Language:")," ",c.a.createElement("span",{className:"sui-termDicts__dict-extra-lang-text"},e.related_definitions_language_s)))}))))}))))}),ka=(a(662),function(e){var t,a;return c.a.createElement("div",{className:"sui-termsDetails__wrapper"},c.a.createElement("ul",{className:"sui-termsDetails__list"},null===(t=e.kmAsset)||void 0===t||null===(a=t.associated_subject_map_idfacet)||void 0===a?void 0:a.map((function(e){var t=e.split("|"),a=t[1].split("="),s=a[1].split("-");return c.a.createElement("li",{className:"sui-termsDetails__list-item",key:e},t[0].split("=")[0].toUpperCase(),": "," ",c.a.createElement(Ee.a,{domain:s[0],kid:s[1]},c.a.createElement("span",{className:"sui-termsDetails__li-subjects"},a[0])))}))))}),wa=c.a.memo((function(e){var t,a=D()(null===(t=e.kmap)||void 0===t?void 0:t._childDocuments_).pickBy((function(e){return"related_definitions"===e.block_child_type})).groupBy((function(e){return D.a.get(e,"related_definitions_source_s","main_defs")})).value();return e.kmap?c.a.createElement(c.a.Fragment,null,c.a.createElement(ka,{kmAsset:e.kmasset}),c.a.createElement(ua,{kmap:e.kmap}),e.kmap.etymologies_ss&&c.a.createElement(pa,{kmap:e.kmap}),c.a.createElement(ya,{mainDefs:a.main_defs,kmRelated:e.kmRelated}),c.a.createElement(Ea,{definitions:D.a.omit(a,["main_defs"])})):c.a.createElement(c.a.Fragment,null)})),xa=a(145),Ta=a(682),ja=a(401),Sa=a(188),Aa=a(681),Pa=a(227),Na=a(379),Oa=a(229),Ca=a(380),Da=a(381),Ra=a(8),La=a(161),Ia=a(400),Ma=function(e){Object(i.a)(a,e);var t=Object(r.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).updateDimensions=n.updateDimensions.bind(Object(xa.a)(n)),n.state={height:e.height||400,width:e.width||400,fid:e.fid,language_layer:e.languageLayer||"roman_popular",zoom:e.zoom||7},n}return Object(n.a)(a,[{key:"updateDimensions",value:function(){var e=this.state.element.clientHeight,t=this.state.element.clientWidth;this.setState({height:e,width:t})}},{key:"componentWillMount",value:function(){window.addEventListener("resize",this.updateDimensions)}},{key:"componentDidMount",value:function(){var e=this;this.setState({element:this.refs.inset_map});var t=this.createMap();t.once("postrender",(function(a){e.zoomToFeature(t)}))}},{key:"createMap",value:function(){var e=new La.a({mapTypeId:"satellite"}),t=this.state.language_layer,a=this.state.fid,s=new Sa.a({source:new Aa.a({url:"".concat("https://dev-places.kmaps.virginia.edu/geoserver/","/wms"),params:{LAYERS:"thl:"+t+"_poly,thl:"+t+"_pt,thl:"+t+"_line",STYLES:"thl_noscale,thl_noscale,thl_noscale",TILED:!0,CQL_FILTER:"fid=".concat(a,";fid=").concat(a,";fid=").concat(a)},projection:"EPSG:900913"})}),n=new Ta.a({interactions:Object(Pa.a)().extend([new Na.a]),target:this.refs.inset_map,layers:[e,s],controls:Object(Oa.a)().extend([new Ca.a,new Da.a]),view:new ja.a({projection:"EPSG:900913",zoom:this.state.zoom})});return new Ia.a({map:n}).activate(),n}},{key:"zoomToFeature",value:function(e){var t=this,a="fid=".concat(this.state.fid);fetch("https://dev-places.kmaps.virginia.edu/geoserver//wfs?service=wfs&version=1.1.0&request=GetFeature&typename=thl:bbox&cql_filter="+a+"&projection=EPSG:4326&SRS=EPSG:4326&outputFormat=json").then((function(e){return e.json()})).then((function(a){var s=[a.bbox[1],a.bbox[0],a.bbox[3],a.bbox[2]],n=Object(Ra.n)(s,Object(Ra.f)("EPSG:4326"),Object(Ra.f)("EPSG:900913"));e.getView().fit(n,{size:[t.state.height,t.state.width],padding:[1,1,1,1],constraintResolution:!1})}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions)}},{key:"render",value:function(){var e={width:this.state.width+"px",height:this.state.height+"px",backgroundColor:"#cccccc"};return c.a.createElement("div",null,c.a.createElement("div",{tabIndex:"1",style:e,ref:"inset_map"}))}}]),a}(c.a.Component);a(382);function Fa(e){e.kmap;var t=e.kmasset,a=Object(l.useState)({height:0,width:0}),s=Object(x.a)(a,2),n=s[0],i=s[1];return Object(l.useEffect)((function(){d()(".sui-nameEntry__wrapper").length>0&&d()(".sui-nameEntry__wrapper").hide(),i({height:d()("#place-kmap-tabs-tabpane-map").height(),width:d()("#place-kmap-tabs-tabpane-map").width()})}),[t]),c.a.createElement(X.a,{defaultActiveKey:"map",id:"place-kmap-tabs"},c.a.createElement(Z.a,{eventKey:"map",title:"Map"},n.height>0&&c.a.createElement(Ma,{fid:t.id,languageLayer:"roman_popular",height:n.height,width:n.width})),c.a.createElement(Z.a,{eventKey:"names",title:"Names"},c.a.createElement(Ua,e),c.a.createElement("h3",null,"Feature Types"),c.a.createElement("ul",null,(null===t||void 0===t?void 0:t.feature_types_idfacet)&&t.feature_types_idfacet.map((function(e,t){var a=e.split("|"),s=Object(x.a)(a,2),n=s[0],i=s[1];return c.a.createElement("li",null,c.a.createElement(K,{key:i,uid:i,label:n}))})))),c.a.createElement(Z.a,{eventKey:"location",title:"Location"},c.a.createElement(qa,e)))}function Ua(e){var t={index:"terms",params:{fl:"uid,[child childFilter=id:".concat(e.id,"_names-* parentFilter=block_type:parent]"),q:"uid:".concat(e.id),wt:"json",rows:300}},a=Pe("place-".concat(e.id,"-names"),t),s=[],n=[];return(null===a||void 0===a?void 0:a.numFound)&&a.numFound>0&&((s=(s=a.docs[0]._childDocuments_).map((function(e,t){return{label:e.related_names_header_s,lang:e.related_names_language_s,rel:e.related_names_relationship_s,write:e.related_names_writing_system_s,ety:e.related_names_etymology_s,path:e.related_names_path_s,tab:e.related_names_level_i-1}}))).sort((function(e,t){return e.path>t.path?1:e.path<t.path?-1:0})),n=s.filter((function(e,t){return e.ety&&e.ety.length>0}))),c.a.createElement(B.a,{className:"c-place-names"},c.a.createElement(G.a,null,c.a.createElement("h1",null,"Names"),s.map((function(e,t){return c.a.createElement("div",{key:"place-name-".concat(t),className:"lv-".concat(e.tab)},c.a.createElement("strong",null,e.label," "),"\xa0 (",e.lang,","," ",e.write,", ",e.rel,")")}))),n&&n.length>0&&c.a.createElement(G.a,null,c.a.createElement("h1",null,"Etymology"),n.map((function(e,t){if(e.ety)return c.a.createElement("div",{key:"place-etymology-".concat(t)},c.a.createElement("strong",null,e.label," "),":",c.a.createElement(Ce,{markup:e.ety.replace(/<p\/?>/g," ")}))}))))}function qa(e){var t,a,s,n,i,r=null===e||void 0===e||null===(t=e.kmap)||void 0===t?void 0:t.shapes_centroid_grptgeom,l=!!r&&JSON.parse(r),o=!1;if(l&&(null===l||void 0===l?void 0:l.features)&&l.features.length>0&&(null===(a=l.features[0].geometry)||void 0===a?void 0:a.coordinates)){var d=l.features[0].geometry.coordinates,u=Math.round(1e5*d[1])/1e5,p=Math.round(1e5*d[0])/1e5;o="".concat(u,"\xba N, ").concat(p,"\xba E")}var m=null===e||void 0===e||null===(s=e.kmap)||void 0===s?void 0:s._childDocuments_.filter((function(e,t){return e.id.includes("altitude")}));return c.a.createElement("div",{className:"c-place-location"},o&&c.a.createElement("p",null,c.a.createElement("span",{className:"icon shanticon-places"}," ")," ",c.a.createElement("label",null,"Lat/Long")," ",o),m&&(null===m||void 0===m?void 0:m.length)>0&&(null===(n=m[0])||void 0===n?void 0:n.estimate_s)&&c.a.createElement("p",null,c.a.createElement("span",{className:"altitude"},"\u2191 ")," ",c.a.createElement("label",null,"Alt")," ",m&&(null===m||void 0===m?void 0:m.length)>0&&(null===(i=m[0])||void 0===i?void 0:i.estimate_s)),!o&&m&&0===(null===m||void 0===m?void 0:m.length)&&c.a.createElement("p",null,"There is no location information for ",e.kmap.header))}a(267);function Ba(e){var t,a,s,n=e.kmap,i=(e.kmasset,e.relateds,Y());Object(l.useEffect)((function(){i.clear(),i.setType("subjects"),i.setHeaderTitle("Loading ...")}),[]),Object(l.useEffect)((function(){d()("main.l-column__main").addClass("subjects")}),[n]);var r=(null===n||void 0===n||null===(t=n.illustration_external_url)||void 0===t?void 0:t.length)>0&&n.illustration_external_url[0].replace("!1000","!500");!r&&(null===n||void 0===n||null===(a=n.illustration_mms_url)||void 0===a?void 0:a.length)>0&&(r=n.illustration_mms_url[0].replace("essay","large"));var o=r?c.a.createElement("div",{id:"ftimage",className:"featured-image"},c.a.createElement("img",{src:r})):null,u=(null===n||void 0===n||null===(s=n.summary_eng)||void 0===s?void 0:s.length)>0?c.a.createElement("div",{className:"summary"},c.a.createElement("h3",null,"Summary"),c.a.createElement(Ce,{markup:n.summary_eng[0]})):null,p=!1;for(var m in n)if(m.includes("homepage_text_")){p=n[m];break}return c.a.createElement("div",{className:"c-subject-info"},o,u,p&&c.a.createElement("div",{className:"desc"},c.a.createElement("h3",null,"Overview"," ",c.a.createElement("span",{className:"text-id d-none"},c.a.createElement(j.c,{to:"/texts/".concat(p)},"text-",p))),c.a.createElement(Ga,{textid:p})))}function Ga(e){var t=e.textid,a=sa("texts",t),s=ia(a),n=(null===s||void 0===s?void 0:s.toc_links)&&s.toc_links.length>0,i=n?"toc":"info";return(null===s||void 0===s?void 0:s.full_markup)?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"desc-toc"},c.a.createElement(X.a,{defaultActiveKey:i,id:"text-meta-tabs"},n&&c.a.createElement(Z.a,{eventKey:"toc",title:"Table of Contents"},c.a.createElement("div",{className:"toc"},c.a.createElement(Ce,{markup:s.toc_links}))),c.a.createElement(Z.a,{eventKey:"info",title:"Info"},(null===s||void 0===s?void 0:s.bibl_summary)&&c.a.createElement("div",{className:"info"},c.a.createElement(Oe,{markup:null===s||void 0===s?void 0:s.bibl_summary}))))),c.a.createElement(Oe,{markup:null===s||void 0===s?void 0:s.full_markup})):c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"mt-5"},c.a.createElement("h5",null,"Loading ...")))}d()(document).ready((function(){window.show_not_found=setTimeout((function(){d()(".loading").hide(),d()(".not-found-msg").show()}),1e4)}));a(663);function Ha(e){var t,a,s=Object(l.useState)("context"),n=Object(x.a)(s,2),i=n[0],r=n[1],o=e.kmap,u=(e.kmasset,o.header),p=o.tree,m=p[0].toUpperCase()+p.substr(1),h=null===o||void 0===o?void 0:o.uid,v=1*(null===h||void 0===h?void 0:h.split("-")[1]),f=window.location.pathname.split(p)[0]+p,g=(null===o||void 0===o||null===(t=o.ancestors_gen)||void 0===t?void 0:t.length)?o.ancestors_gen.length-1:0,_=0;(null===o||void 0===o||null===(a=o._childDocuments_)||void 0===a?void 0:a.length)>0&&(_=d.a.map(o._childDocuments_,(function(e){return"related_subjects"===e.block_child_type?e:null})).length-1);var b=[],y=[];return d.a.each(null===o||void 0===o?void 0:o._childDocuments_,(function(e,t){var a,s=null===t||void 0===t||null===(a=t.related_uid_s)||void 0===a?void 0:a.split("-");if(s&&2===s.length){var n=null===t||void 0===t?void 0:t.related_subjects_relation_code_s;"is.part.of"===n&&b.push(c.a.createElement(Ee.a,{domain:s[0],kid:s[1],children:[t.related_subjects_header_s]})),"has.as.a.part"===n&&y.push(c.a.createElement(Ee.a,{domain:s[0],kid:s[1],children:[t.related_subjects_header_s]}))}})),Object(l.useEffect)((function(){d()("main.l-column__main").addClass("subjects")}),[o]),c.a.createElement(X.a,{id:"kmaps-relateds-tabs",className:"kmaps-related-viewer",activeKey:i,onSelect:function(e){return r(e)}},c.a.createElement(Z.a,{eventKey:"context",title:"".concat(m," Context")},c.a.createElement("div",{className:"kmap-context"},c.a.createElement("h2",null,m," related to ",u),c.a.createElement("p",null,u," has ",g," superordinate"," ",m.toLowerCase()," and ",_," subordinate"," ",m.toLowerCase(),". You can browse these subordinate"," ",m.toLowerCase()," as well as its superordinate categories with the tree below. See the RELATED"," ",m.toUpperCase()," tab if you instead prefer to view only its immediately subordinate ",m.toLowerCase()," ","grouped together in useful ways, as well as"," ",m.toLowerCase()," non-hierarchically related to it."),c.a.createElement(Ht.default,{domain:p,tree:p,currentFeatureId:"".concat(p,"-").concat(v),featuresPath:f+"/%%ID%%/related-subjects/deck",descendants:!0,directAncestors:!0,displayPopup:!0,perspective:"gen",sortBy:"related_subjects_header_s+ASC"}))),c.a.createElement(Z.a,{eventKey:"related",title:"Related ".concat(m)},c.a.createElement("div",{className:"kmap-related"},c.a.createElement("h2",null,m.toUpperCase()," RELATED TO"," ",u.toUpperCase()),"Natural has ",y.length+b.length," other subjects directly related to it, which is presented here. See the ",m.toUpperCase()," CONTEXT tab if you instead prefer to browse all subordinate and superordinate categories for ",u,".",b.length>0&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h3",null,u," Is a Part Of These Types"),c.a.createElement("ul",null,d.a.map(b,(function(e,t){return c.a.createElement("li",{key:"km-parent-".concat(t)},e)})))),y.length>0&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h3",null,u," Has These Types"),c.a.createElement("ul",null,d.a.map(y,(function(e,t){return c.a.createElement("li",{key:"km-part-".concat(t)},e)})))))))}var za=a(82);function Ka(e){var t=e.kmap,a=(e.kmasset,Object(l.useState)(0)),s=Object(x.a)(a,2),n=s[0],i=s[1],r=Object(l.useState)(0),o=Object(x.a)(r,2),u=o[0],p=o[1],m=Object(l.useState)(100),h=Object(x.a)(m,2),v=h[0],f=h[1],g=Object(l.useState)(20),_=Object(x.a)(g,2),b=_[0];_[1];Object(l.useEffect)((function(){d()("main.l-column__main").addClass("subjects")}),[t]);t.tree;var y=null===t||void 0===t?void 0:t.uid,E=1*(null===y||void 0===y?void 0:y.split("-")[1]),k=Pe(y+"-related-places",{index:"terms",params:{q:"({!parent which=block_type:parent}related_subjects_id_s:"+y+" AND tree:places) OR feature_type_id_i:"+E,fl:"tree,uid,uid_i,header,origin_uid_s",sort:"header ASC",rows:v,start:n}}),w=(null===k||void 0===k?void 0:k.numFound)?null===k||void 0===k?void 0:k.numFound:0,T={numFound:w,getMaxPage:function(){return Math.floor(T.numFound/T.getPageSize())},getPage:function(){return u},setPage:function(e){e=parseInt(e),!isNaN(e)&&e>-1&&e<=T.getMaxPage()&&(p(e),T.pgnum=e)},setPageSize:function(e){e=parseInt(e),!isNaN(e)&&e>0&&e<101&&(f(e),T.pgsize=e)},getPageSize:function(){return v},nextPage:function(){T.setPage(T.getPage()+1)},prevPage:function(){T.setPage(T.getPage()-1)},lastPage:function(){T.setPage(T.getMaxPage())},firstPage:function(){T.setPage(0)}};Object(l.useEffect)((function(){i(u*v)}),[u,v]);var j=Wa(d.a.map(k.docs,(function(e,t){var a=Math.ceil(1e4*Math.random());if(!e.uid.includes("_featureType")){var s=e.uid+"-"+t+a,n=Math.floor(e.uid_i/100);return c.a.createElement("li",{key:s},c.a.createElement(Ee.a,{domain:e.tree,kid:n,children:[e.header]}))}var i=e.origin_uid_s,r=i+"-"+a,l=i.split("-");if(2===l.length)return c.a.createElement("li",{key:r},c.a.createElement(Ee.a,{domain:l[0],kid:l[1],children:[e.header]}))})),b);return c.a.createElement(q.a,{fluid:!0,className:"c-relplaces-list subjects"},c.a.createElement("h2",{className:"row"},"Related Places "),w>v&&c.a.createElement(ve,{pager:T,position:"top",className:"row"}),c.a.createElement(B.a,null,d.a.map(j,(function(e,t){return c.a.createElement(G.a,{md:3,key:"chunk-col-".concat(t)},c.a.createElement("ul",null,e))}))),w>v&&c.a.createElement(ve,{pager:T,position:"bottom",className:"row"}))}function Va(e){var t=e.kmap,a=(e.kmasset,null===t||void 0===t?void 0:t.uid),s=t._childDocuments_,n=null===t||void 0===t?void 0:t.ancestor_id_path.split("/");n.pop();var i=s.filter((function(e,t){return"administers"===e.related_places_relation_code_s})),r=s.filter((function(e,t){return"has.entirely.located.within.it"===e.related_places_relation_code_s})),o=s.map((function(e,t){if("related_places"===e.block_child_type)return e.related_places_feature_type_s}));(o=Object(za.a)(new Set(o))).sort();var u=o.map((function(e,t){return{label:e,children:s.filter((function(t,a){return t.related_places_feature_type_s===e}))}}));return Object(l.useEffect)((function(){d()("main.l-column__main").addClass("places")}),[t]),c.a.createElement(X.a,{defaultActiveKey:"context",id:"place-kmap-tabs"},c.a.createElement(Z.a,{eventKey:"context",title:"Place Context"},c.a.createElement(q.a,{fluid:!0,className:"c-relplaces-list places"},c.a.createElement("h2",{className:"row"},"Hierarchy of Places Related to ",t.header),c.a.createElement(B.a,null,c.a.createElement("p",null,t.header," has ",n.length," superordinate"," ","places and ",i.length+r.length," ","subordinate places. It administers"," ",i.length,", while ",r.length," of the places are simply located in ",t.header,"."),c.a.createElement("p",null,"One can browse these subordinate places as well as its superordinate categories with the tree below.")),c.a.createElement(B.a,null,c.a.createElement(Ht.default,{domain:"places",tree:"places",descendants:!0,directAncestors:!0,displayPopup:!0,perspective:"pol.admin.hier",view:"roman.scholar",sortBy:"header_ssort+ASC",currentFeatureId:a})))),c.a.createElement(Z.a,{eventKey:"related",title:"Related Places"},c.a.createElement(q.a,{fluid:!0,className:"c-relplaces-list places"},c.a.createElement("h2",{className:"row"},"Places Related to ",t.header," by Feature Type"),c.a.createElement(B.a,null,c.a.createElement(G.a,null,c.a.createElement("p",null,"These are the list of related places by feature type."),c.a.createElement("p",null,"One can browse these subordinate places as well as its superordinate categories with the tree below."))),c.a.createElement(B.a,null,c.a.createElement(Ya,{children:u})))))}function Ya(e){var t=Wa(null===e||void 0===e?void 0:e.children,4).map((function(e,t){return c.a.createElement(G.a,{key:"col-".concat(t)},e.map((function(e,a){return(null===e||void 0===e?void 0:e.label)&&""!==e.label?c.a.createElement("div",{key:"col-".concat(t,"-cat-").concat(a)},c.a.createElement("h3",{className:"text-capitalize"},e.label),c.a.createElement("ul",null,e.children.map((function(e,t){var a;if(null===e||void 0===e||null===(a=e.related_uid_s)||void 0===a?void 0:a.includes("-"))return c.a.createElement("li",{key:"clitem-".concat(t)}," ",e.related_places_header_s,c.a.createElement(Ee.a,{uid:e.related_uid_s}))})))):null})))}));return c.a.createElement(c.a.Fragment,null,t)}function Wa(e,t){if("undefined"===typeof e||e.length<1||"undefined"===typeof t||isNaN(t)||t<1)return e;for(var a=[];e.length;){var s=e.splice(0,25);a.push(s)}return a}a(664);var Qa=function(e){var t,a,s=Object(l.useState)(!1),n=Object(x.a)(s,2),i=n[0],r=n[1],o=Object(l.useState)(null!==(t=e.defID)&&void 0!==t?t:"any"),d=Object(x.a)(o,2),u=d[0],p=d[1],m=Object(T.h)(),h=Object(T.j)(),v=e.definitions,f=null!==(a=D.a.find(v,["id",u]))&&void 0!==a?a:{id:"any",text:"-- Any --"},g=function(e){var t=e.target.getAttribute("data-value");p(t);var a=Object(w.a)(Object(w.a)({},h),{},{definitionID:t}),s=Object(T.f)("/:viewerType/:id/related-:relatedType/:definitionID/:viewMode",a);m.push(s)};return c.a.createElement("div",{className:"custSelect__component"},c.a.createElement("div",{className:"custSelect__header"},c.a.createElement("div",{className:"custSelect__header-title"},"Filter by Definition:"),c.a.createElement("div",{className:"custSelect__header-link"},c.a.createElement("a",{href:"#"},"> View all Definitions"))),c.a.createElement("div",{className:"custSelect__wrapper"},c.a.createElement("div",{className:"custSelect__main ".concat(i?"cs_open":"cs_close"),onClick:function(){return r(!i)}},c.a.createElement("div",{className:"custSelect__trigger"},c.a.createElement("span",{className:"custSelect__selected_item"},ye()(f.text)),c.a.createElement("div",{className:"custSelect__arrow"})),c.a.createElement("div",{className:"custSelect__options"},c.a.createElement("span",{className:"custSelect__option".concat("any"===u?" cs_selected":""),"data-value":"any",onClick:g},"-- Any --"),v.map((function(e){return c.a.createElement("span",{key:e.id,className:"custSelect__option".concat(e.id.includes(u)?" cs_selected":""),"data-value":e.id,onClick:g},ye()(e.text))}))))))},Ja=(a(665),function(e){var t,a,s,n,i,r=Object(T.j)(),l=r.relatedType,o=r.definitionID,d=null!==(t=null===e||void 0===e||null===(a=e.relateds)||void 0===a||null===(s=a.assets[l.toLowerCase()])||void 0===s?void 0:s.docs)&&void 0!==t?t:[],u=D.a.chain(d).map((function(e){return e.kmapid})).flatten().uniq().filter((function(e){return e.includes("_definitions-")})).sort().value(),p=null!==(n=null===e||void 0===e||null===(i=e.kmap)||void 0===i?void 0:i._childDocuments_)&&void 0!==n?n:[],m=D.a.chain(p).filter((function(e){return u.includes(e.id)})).map((function(e){return{id:e.id,text:e.related_definitions_content_s.replace(/(<([^>]+)>)/gi,"")}})).value();return c.a.createElement(Qa,{definitions:m,defID:o})});function Xa(e){var t=Object(T.k)(),a=Object(l.useState)(),s=Object(x.a)(a,2),n=s[0],i=s[1],r=Y();Object(l.useEffect)((function(){r.clear(),r.setHeaderTitle("Loading ...")}),[r]);var o=new URLSearchParams(Object(T.i)().search);var d=function(t,a){var s=a.get("asset_type"),n=null;switch(s){case"images":n=c.a.createElement(xt,{kmasset:e.kmasset,kmap:e.kmap});break;case"audio-video":n=c.a.createElement(Ie,{sui:window.sui});break;case"sources":n=c.a.createElement(Dt,null);break;case"texts":n=c.a.createElement(St,null);break;case"visuals":n=c.a.createElement(Ut,null);break;case"subjects":case"terms":case"places":n=c.a.createElement(Xa,null);break;default:n=c.a.createElement("span",null,"No defined viewer")}return{declaredType:s,declaredViewer:n}}(0,o),u=d.declaredType,p=d.declaredViewer;Object(l.useEffect)((function(){if(e.kmasset){var t;r.clear(),r.setHeaderTitle(e.kmasset.title),r.setType(e.kmasset.asset_type);var a=function(e,t){var a=[];if((null===t||void 0===t?void 0:t.ancestor_ids_is)&&(null===t||void 0===t?void 0:t.ancestors_txt)){var s=t.asset_type,n=t.ancestor_ids_is,i=t.ancestors_txt;a.push({uid:"/"+s,name:s[0].toUpperCase()+s.substr(1)});for(var r=0;r<n.length;r++){var l=s+"-"+n[r],c=i[r];a.push({uid:l,name:c})}}else console.log("KmapContext.assembledPath: kmasset does not have ancestor_ids_is or ancestors_txt.");return a}(e.kmap,e.kmasset);r.setPath(a),r.setId(null===(t=e.kmasset)||void 0===t?void 0:t.uid)}}),[t,e.kmap,e.kmasset,r]);var m=c.a.createElement("div",{className:"l-content__main__wrap"},"Loading...");return e.kmasset&&e.kmasset.asset_type&&(m=c.a.createElement("section",{className:"l-content__main__wrap"},c.a.createElement("div",{className:"c-content__main__kmaps"},c.a.createElement(T.d,null,c.a.createElement(T.b,{path:"/:viewerType/:nid/related-audio-video/view/:relId"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset,relatedType:"audio-video",back:"true"})),c.a.createElement(ra,{assetType:"audio-video"},c.a.createElement(Ie,{sui:window.sui}))),c.a.createElement(T.b,{path:"/:viewerType/:nid/related-texts/view/:relId"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset,relatedType:"texts",back:"true"})),c.a.createElement(ra,{assetType:"texts"},c.a.createElement(St,{inline:!0}))),c.a.createElement(T.b,{path:"/:viewerType/:nid/related-images/view/:relId"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset,relatedType:"images",back:"true"})),c.a.createElement(ra,{assetType:"images"},c.a.createElement(xt,{inline:!0}))),c.a.createElement(T.b,{path:"/:viewerType/:nid/related-sources/view/:relId"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset,relatedType:"sources",back:"true"})),c.a.createElement(ra,{assetType:"sources"},c.a.createElement(Dt,{inline:!0}))),c.a.createElement(T.b,{path:"/:viewerType/:nid/related-visuals/view/:relId"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset,relatedType:"visuals",back:"true"})),c.a.createElement(ra,{assetType:"visuals"},c.a.createElement(Ut,{inline:!0}))),c.a.createElement(T.b,{path:"/:viewerType/:nid/related-all/view/:relId"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset,relatedType:"all",back:"true"})),c.a.createElement(ra,{assetType:u,inline:!0},p)),c.a.createElement(T.a,{from:"/:viewerType/:id/related-:relatedType/view/:relId",to:"/:viewerType/:relId"}),c.a.createElement(T.b,{path:"/subjects/:id/related-subjects"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset})),c.a.createElement(Ha,e)),c.a.createElement(T.b,{path:"/subjects/:id/related-places"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset})),c.a.createElement(Ka,e)),c.a.createElement(T.a,{from:"/places/:id/related-places/:view",to:"/places/:id/related-places"}),c.a.createElement(T.b,{path:"/places/:id/related-places"},c.a.createElement(oa,Object.assign({},e,{kmasset:e.kmasset})),c.a.createElement(Va,e)),c.a.createElement(T.b,{path:["/:viewerType/:id/related-:relatedType/:definitionID/:viewMode","/:viewerType/:id/related-:relatedType/:viewMode"]},c.a.createElement(oa,e),c.a.createElement(Ja,e),c.a.createElement(da,e)),c.a.createElement(T.b,{path:"/:viewerType/:id/related-:relatedType"},c.a.createElement(T.a,{to:"./all"})),c.a.createElement(T.b,null,c.a.createElement(oa,{kmasset:e.kmasset}),c.a.createElement(la,{kmap:e.kmap}),c.a.createElement(T.d,null,c.a.createElement(T.b,{path:"/subjects"},c.a.createElement(Ba,e)),c.a.createElement(T.b,{path:"/places"},c.a.createElement(Fa,e)),c.a.createElement(T.b,{path:"/terms"},c.a.createElement(wa,{kmasset:e.kmasset,kmap:e.kmap,kmRelated:e.relateds,defnum:o.get("def")})))))),c.a.createElement("span",{className:"sui-showinfo u-icon__info float-right",onClick:function(){return i(!0)}}),c.a.createElement(Za,{show:n,onHide:function(){return i(!1)},data:e.kmasset,scrollable:!0}))),m}function Za(e){return c.a.createElement(ae.a,Object.assign({},e,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0}),c.a.createElement(ae.a.Header,{closeButton:!0},c.a.createElement(ae.a.Title,{id:"contained-modal-title-vcenter"},"JSON DATA")),c.a.createElement(ae.a.Body,null,c.a.createElement("pre",null,JSON.stringify(e.data,void 0,3))),c.a.createElement(ae.a.Footer,null,c.a.createElement(ee.a,{onClick:e.onHide},"Close")))}var $a=function(e){var t=Y();return Object(l.useEffect)((function(){t.clear(),t.setHeaderTitle("Places Home")})),c.a.createElement(c.a.Fragment,null," Places Home: Not much here yet.. ")};var es=function(e){var t=Y();t.clear(),t.setType("subjects"),t.setHeaderTitle("Subjects Home");var a=Object(l.useState)(0),s=Object(x.a)(a,2),n=s[0],i=s[1],r=Object(l.useState)(0),o=Object(x.a)(r,2),d=o[0],u=o[1],p=Object(l.useState)(100),m=Object(x.a)(p,2),h=m[0],v=m[1],f=Object(l.useState)(20),g=Object(x.a)(f,2),_=(g[0],g[1],Pe("subjects",{index:"assets",params:{q:"asset_type:subjects",rows:h,start:n,sort:"title_latin_sort ASC"}})),b={numFound:(null===_||void 0===_?void 0:_.numFound)?null===_||void 0===_?void 0:_.numFound:0,getMaxPage:function(){return Math.floor(b.numFound/b.getPageSize())},getPage:function(){return d},setPage:function(e){e=parseInt(e),!isNaN(e)&&e>-1&&e<=b.getMaxPage()&&(u(e),b.pgnum=e)},setPageSize:function(e){e=parseInt(e),!isNaN(e)&&e>0&&e<101&&(v(e),b.pgsize=e)},getPageSize:function(){return h},nextPage:function(){b.setPage(b.getPage()+1)},prevPage:function(){b.setPage(b.getPage()-1)},lastPage:function(){b.setPage(b.getMaxPage())},firstPage:function(){b.setPage(0)}};return Object(l.useEffect)((function(){i(d*h)}),[d,h]),c.a.createElement(it,{pager:b,docs:null===_||void 0===_?void 0:_.docs,numFound:null===_||void 0===_?void 0:_.numFound,viewMode:"list"})};var ts=function(e){var t=Y();return Object(l.useEffect)((function(){t.clear(),t.setHeaderTitle("Terms Home")}),[t]),c.a.createElement(c.a.Fragment,null," Terms Home: Not much here yet.. ")};function as(e){var t=Object(T.j)(),a=null===t||void 0===t?void 0:t.asset_type,s=null===t||void 0===t?void 0:t.id,n="deck";"images"===a?n="gallery":"sources"!==a&&"texts"!==a||(n="list");var i="/".concat(a,"/collection/").concat(s,"/").concat(n);return c.a.createElement(T.a,{to:i})}var ns=a(159),is=a.n(ns),rs=c.a.lazy((function(){return Promise.all([a.e(3),a.e(4)]).then(a.bind(null,709))}));function ls(e){var t=Object(T.k)().path,a=e.title||"Untitled",s=e.site||"defauit";return c.a.createElement("main",{className:"l-column__main"},c.a.createElement("article",{id:"l-column__main__wrap",className:"l-column__main__wrap"},c.a.createElement(V,{siteClass:s,title:a,sui:e.sui}),c.a.createElement("div",{className:"two-columns"},c.a.createElement("section",{id:"l-content__main",className:"l-content__main"},c.a.createElement(T.d,null,c.a.createElement(T.b,{path:"".concat(t,"collections")},c.a.createElement(ta,null)),c.a.createElement(T.b,{path:"".concat(t,":asset_type/collection/:id/:view_mode")},c.a.createElement(ea,{ismain:!0})),c.a.createElement(T.b,{path:"".concat(t,":asset_type/collection/:id")},c.a.createElement(as,null)),c.a.createElement(T.b,{path:"".concat(t,"audio-video/:id")},c.a.createElement(ra,{assetType:"audio-video"},c.a.createElement(Ie,{sui:e.sui,ismain:!0}))),c.a.createElement(T.b,{path:"".concat(t,"audio-video")},c.a.createElement(ct,null)),c.a.createElement(T.b,{path:"".concat(t,"images/:id")},c.a.createElement(ra,{assetType:"images"},c.a.createElement(xt,{ismain:!0,sui:e.sui}))),c.a.createElement(T.b,{path:"".concat(t,"images")},c.a.createElement(Tt,null)),c.a.createElement(T.b,{path:"".concat(t,"texts/:id")},c.a.createElement(ra,{assetType:"texts"},c.a.createElement(St,{ismain:!0,onStateChange:e.onStateChange}))),c.a.createElement(T.b,{path:"".concat(t,"texts")},c.a.createElement(Ot,null)),c.a.createElement(T.b,{path:"".concat(t,"sources/:id")},c.a.createElement(ra,{assetType:"sources"},c.a.createElement(Dt,{ismain:!0,onStateChange:e.onStateChange}))),c.a.createElement(T.b,{path:"".concat(t,"sources")},c.a.createElement(Ft,null)),c.a.createElement(T.b,{path:"".concat(t,"visuals/:id")},c.a.createElement(ra,{assetType:"visuals"},c.a.createElement(Ut,{ismain:!0,onStateChange:e.onStateChange}))),c.a.createElement(T.b,{path:"".concat(t,"visuals")},c.a.createElement(Gt,null)),c.a.createElement(T.b,{path:["".concat(t,"places/:id/related-:relatedType/:viewMode"),"".concat(t,"places/:id")]},c.a.createElement(aa,{assetType:"places"},c.a.createElement(Kt,null),c.a.createElement(Xa,{id:e.id,sui:e.sui,onStateChange:e.onStateChange}))),c.a.createElement(T.b,{path:"".concat(t,"places")},c.a.createElement($a,null)),c.a.createElement(T.b,{path:["".concat(t,"subjects/:id/related-:relatedType/:viewMode"),"".concat(t,"subjects/:id")]},c.a.createElement(aa,{assetType:"subjects"},c.a.createElement(Kt,null),c.a.createElement(Xa,{id:e.id,sui:e.sui,onStateChange:e.onStateChange}))),c.a.createElement(T.b,{path:"".concat(t,"subjects")},c.a.createElement(es,null)),c.a.createElement(T.b,{path:["".concat(t,"terms/:id/related-:relatedType/:viewMode"),"".concat(t,"terms/:id")]},c.a.createElement(aa,{assetType:"terms"},c.a.createElement(Kt,null),c.a.createElement(Xa,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})," ")),c.a.createElement(T.b,{path:"".concat(t,"terms")},c.a.createElement(ts,null)),c.a.createElement(T.b,{path:"".concat(t,"terms/:id/related-:relatedType")},c.a.createElement(T.a,{to:"./default"})),c.a.createElement(T.b,{path:"".concat(t,"search/:viewMode")},c.a.createElement(I.a,null,c.a.createElement(Zt,null))),c.a.createElement(T.b,{exact:!0,path:"".concat(t,"search")},c.a.createElement(T.a,{to:"".concat(t,"search/default")})),c.a.createElement(T.b,{path:"".concat(t,"assets/:id")},c.a.createElement(Kt,null),c.a.createElement(Qt,{id:e.id,sui:e.sui,onStateChange:e.onStateChange})),c.a.createElement(T.b,{path:"*"},c.a.createElement(ms,null)))),c.a.createElement(c.a.Suspense,{fallback:c.a.createElement("div",{style:{maxWidth:"35rem",minWidth:"15rem",fontSize:"1.4rem",width:"25%",padding:"1.6rem"}},c.a.createElement(ns.SkeletonTheme,{color:"#d0d0d0",highlightColor:"#a5a5a5"},c.a.createElement(is.a,{duration:.5,count:10,height:47.5})))},c.a.createElement(rs,{onStateChange:e.onStateChange})))))}function cs(e){var t=e.hamburgerOpen?"open":"closed";return c.a.createElement("div",{className:"sui-hamburger ".concat(t),id:"sui-hamburger"},c.a.createElement("span",{id:"sui-help",className:"sui-hamItem"},"\ue67e","\xa0\xa0HELP GUIDE"),c.a.createElement("span",{id:"sui-home",className:"sui-hamItem"},"\ue60b","\xa0\xa0HOME"))}function os(){var e,t,a,s,n,i,r=Object(z.b)((function(e){return e.search})).setSearchState,c=Object(z.b)((function(e){return e.history})),o=c.addLocation,d=(c.clear,Object(T.i)()),u=Object(T.k)(["/:type/:id/related-:relType/view/:relId","/:type/:id","/:type"]),p=Object(T.k)("/search/:mode"),m=null===u||void 0===u||null===(e=u.params)||void 0===e?void 0:e.relType,h=null===u||void 0===u||null===(t=u.params)||void 0===t?void 0:t.relId;function v(e){if(!e)return null;var t=e.match(/(\d+)$/)||[];return Object(x.a)(t,1)[0]}var f=v(null===u||void 0===u?void 0:u.params.id),g=sa(null===u||void 0===u?void 0:u.params.type,f),_=v(h),b=sa(m,_);function y(e){var t=null;return(null===e||void 0===e?void 0:e.length)&&((t=e[0].title)||(t=e[0].caption)),t||(t=null),t}var E=Jt.parse(d.search,{allowDots:!0,ignoreQueryPrefix:!0,depth:5}),k={searchString:"",filters:[]};(null===(a=E.query)||void 0===a||null===(s=a.searchText)||void 0===s?void 0:s.length)&&(k.searchString=E.query.searchText),(null===(n=E.query)||void 0===n||null===(i=n.filters)||void 0===i?void 0:i.length)&&(k.filters=E.query.filters),E.page&&(k.page={current:Number(E.page.current),rows:Number(E.page.rows)}),E.key&&(k.key=E.key),Object(l.useEffect)((function(){var e;"true"!==Jt.parse(d.search).internal&&((null===(e=d.search)||void 0===e?void 0:e.length)&&r(k))}),[d.search]),Object(l.useEffect)((function(){if(p&&k){var e,t;if((null===(e=k.filters)||void 0===e?void 0:e.length)>0){var a=1===k.filters.length?"":"s";" (+".concat(k.filters.length," filter").concat(a,")")}var s=Object(w.a)(Object(w.a)({},d),{},{name:'"'+k.searchString+'"',pathname:u.url,state:k});""===k.searchString&&0===(null===(t=k.filters)||void 0===t?void 0:t.length)||o(s)}}),[d.search]);var j=(null===u||void 0===u?void 0:u.url)||"",S=(null===b||void 0===b?void 0:b.docs)||[];return Object(l.useEffect)((function(){if(g&&g.numFound>0){var e=y(g.docs),t=y(b.docs),a=m?t:null,s=Object(w.a)(Object(w.a)({},d),{},{name:e,relTitle:a,pathname:u.url,asset_type:null===g||void 0===g?void 0:g.docs[0].asset_type,kmasset:null===g||void 0===g?void 0:g.docs[0]});o(s)}}),[o,g,d,j,S,m]),null}var ds={kmasset:{header:"Mandala",title:["Mandala"],uid:"mandala"}};function us(e){var t=Object(l.useState)(ds),a=Object(x.a)(t,2),s=a[0],n=a[1],i=function(e){n(Object(w.a)(Object(w.a)({},s),e))},r=Object(N.j)(),o=c.a.createElement("div",{className:"loading-msg"},"Loading..."),d=[];s.advanced&&d.push("u-ToggleState--advanced"),s.tree&&d.push("u-ToggleState--tree"),s.tree||s.advanced||d.push("u-ToggleState--off");Object(z.c)((function(e){return e.kmap.uid}));var u=d.join(" "),p=c.a.createElement(S,"standalone"!==Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om",REACT_APP_STANDALONE_PATH:"/mandala",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyAXpnXkPS39-Bo5ovHQWvyIk6eMgcvc1q4",REACT_APP_GOSERVER_URL:"https://dev-places.kmaps.virginia.edu/geoserver/"}).REACT_APP_STANDALONE?{basename:"/mandala-om"}:{},c.a.createElement("div",{id:"l-site__wrap",className:"l-site__wrap  ".concat(u)},c.a.createElement(os,null),c.a.createElement(F,{advanced:s.advanced,tree:s.tree,onStateChange:i}),c.a.createElement(cs,{hamburgerOpen:s.hamburgerOpen}),c.a.createElement(T.d,null,c.a.createElement(T.b,{path:"/home"},c.a.createElement(H,null)),"standalone"!==Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om",REACT_APP_STANDALONE_PATH:"/mandala",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyAXpnXkPS39-Bo5ovHQWvyIk6eMgcvc1q4",REACT_APP_GOSERVER_URL:"https://dev-places.kmaps.virginia.edu/geoserver/"}).REACT_APP_STANDALONE&&c.a.createElement(T.b,{exact:!0,path:"/"},c.a.createElement(T.a,{to:"/home"})),c.a.createElement(T.b,{path:"/"},c.a.createElement(ls,{site:"mandala",mode:"development",title:"Mandala",sui:e.sui,kmasset:s.kmasset,kmap:s.kmap,onStateChange:i})),c.a.createElement(T.b,{path:"*"},c.a.createElement(ms,null),c.a.createElement(H,null))),c.a.createElement(cs,{hamburgerOpen:s.hamburgerOpen})));return r?p:o}var ps=function(e){Object(i.a)(a,e);var t=Object(r.a)(a);function a(e){var n;return Object(s.a)(this,a),n=t.call(this),window.sui||(window.sui=new p),n.sui=window.sui,window.sui.pages||(n.sui.pages=window.sui.pages=new k(n.sui)),n}return Object(n.a)(a,[{key:"render",value:function(){return c.a.createElement(us,{sui:this.sui})}}]),a}(c.a.Component);function ms(){return c.a.createElement(mt,null)}t.b=ps},385:function(e,t,a){"use strict";var s=a(0),n=a.n(s),i=a(18),r=(a(367),a(45)),l=a(21),c=a(5),o=a(231),d=a(166),u=a(46);function p(e){var t,a,s=null===(t=e.location)||void 0===t?void 0:t.state,i=null===(a=e.location)||void 0===a?void 0:a.kmasset,r=[];if(s){r.push(n.a.createElement("div",{key:e.key},Object(u.e)("search"),' "',s.searchString,'"'," "));for(var l=0;l<s.filters.length;l++){var c=s.filters[l];r.push(n.a.createElement("div",null,Object(u.e)(c.field)," ",c.label))}return n.a.createElement(n.a.Fragment,null,r)}return n.a.createElement(n.a.Fragment,null," ",Object(u.e)(null===i||void 0===i?void 0:i.asset_type)," ",null===i||void 0===i?void 0:i.uid)}function m(e){var t,a,s,i,c,m=Object(r.b)((function(e){return e.history})).removeLocation,v=Object(l.h)(),f=e.location.kmasset?null===(t=e.location.kmasset)||void 0===t?void 0:t.asset_type:"search",g=(null===(a=e.location)||void 0===a?void 0:a.relTitle)?n.a.createElement(n.a.Fragment,null,JSON.stringify(e.location.relTitle)):n.a.createElement("span",{className:"c-HistoryViewer__title"},Object(u.e)(f)," ",null===(s=e.location)||void 0===s?void 0:s.name,n.a.createElement(h,{state:e.location.state}));return n.a.createElement(o.a,{placement:"auto",delay:{show:250,hide:400},overlay:function(t){var a;return n.a.createElement(d.a,Object.assign({},t,{className:"c-HistoryLocation--popover"}),n.a.createElement(d.a.Content,null,n.a.createElement(p,{location:e.location,key:null===(a=e.location)||void 0===a?void 0:a.key})))},"data-filters":null===(i=e.location)||void 0===i||null===(c=i.state)||void 0===c?void 0:c.filters,popperConfig:{modifiers:[{name:"offset",options:{offset:[0,10]}}]}},n.a.createElement("div",{className:"c-HistoryViewer__relatedRecentItem",onClick:function(t){return v.push(e.location)}},g,n.a.createElement("span",{className:"c-HistoryViewer__removeItem u-icon__cancel-circle icon","data-key":e.location.key,alt:"Remove from list","aria-label":"Remove from list",onClick:function(t){console.log("delete:",t.target.dataset.key),m(e.location),t.stopPropagation()}})))}function h(e){var t,a=e.state;if(!a)return null;for(var s=[],i=0;i<a.filters.length;i++){var r=a.filters[i].field,l=Object(u.e)(r);s.push(l)}var c=(null===a||void 0===a||null===(t=a.searchString)||void 0===t?void 0:t.length)>0?a.searchString:"Facet Icon";return n.a.createElement("span",{className:"c-HistoryViewer__filterIcons",alt:c},s)}p.propTypes={location:c.any};t.a=function(e){var t=Object(i.k)((function(e){return e.history.historyStack})),a=[];return t.forEach((function(t,s){var i,r=!!(null===(i=t.search)||void 0===i?void 0:i.length);(r&&"search"===e.mode||!r&&"search"!==e.mode)&&a.unshift(n.a.createElement(m,{key:s,location:t}))})),n.a.createElement("div",{className:"c-HistoryViewer"},a)}},419:function(e,t,a){e.exports=a(666)},424:function(e,t,a){},44:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var s=a(9),n=a(0),i=a.n(n),r=a(402),l=a(166),c=a(159),o=a.n(c),d=a(7),u=a(33),p=a.n(u),m=a(31),h=a(52),v=a(131),f=a(71),g=a.n(f),_=a(72),b={assets:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",terms:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select"},y={info:{url:b.terms,params:{q:"uid:_DOMAIN_-_KID_",fl:"*"},dataFilter:function(e){return!!(e.response&&e.response.numFound>0)&&e.response.docs[0]}},related:{url:b.assets,params:{q:"kmapid:_DOMAIN_-_KID_",start:"0",facets:"on",group:"true","group.field":"asset_type","group.ngroups":"true","group.limit":"0"},dataFilter:function(e){return!(!e.grouped||!e.grouped.asset_type)&&e.grouped.asset_type.groups}}},E=function(){var e=Object(h.a)(p.a.mark((function e(t,a){var s,n,i,r,l,c,o,d,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(l in s=a.qtype,n=a.domain,i=a.kid,(r=Object(m.a)({},y[s])).params=Object(m.a)({},r.params),r.params)r.params[l]=r.params[l].replace("_DOMAIN_",n).replace("_KID_",i);return"wt"in(c=r.params)||(c.wt="json"),o={adapter:_.a,callbackParamName:"json.wrf",url:r.url,params:c,transformResponse:function(e){var t=r.dataFilter(e);return t||e}},e.next=9,g.a.request(o);case 9:return d=e.sent,u=d.data,e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function k(e,t,a){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return a="undefined"===typeof a?"info":a,Object(v.a)(["kmap",{qtype:a,domain:e,kid:t}],E,{enabled:!s})}var w=function(e){var t,a=e.domain,c=e.kid,d=e.placement,u=e.kmapid,p=e.children,m=Object(n.useState)(!1),h=Object(s.a)(m,2),v=h[0],f=h[1],g=Object(n.useState)(!0),_=Object(s.a)(g,2),b=_[0],y=_[1],E=k(a,c,"info",b),w=E.isError,T=E.data,j=E.error,S=k(a,c,"related",b),A=S.isError,P=S.data,N=S.error,O=Object(n.useRef)(null);d=null!==(t=d)&&void 0!==t?t:"bottom";var C=!1,D=i.a.createElement(o.a,null),R=i.a.createElement("div",{style:{width:"100%"}},i.a.createElement("p",{style:{fontSize:16,lineHeight:1.2}},i.a.createElement(o.a,{count:8})));if(T&&P){var L=!1;"terms"===a&&u&&u.length>0&&(L=(L=u.filter((function(e){return e.includes("-".concat(c,"_definitions"))}))).map((function(e){return e.split("_definitions-")[1]}))),D=(C="terms"===T.tree&&!!T.name_tibt)?T.name_tibt[0]:T.header,R=i.a.createElement(x,{domain:a,kid:c,defs:L,info:T,related:P,kmapIsError:w,relIsError:A})}if(w||A){D=i.a.createElement("span",null,"Error occurred");var I="",M="";w&&(I=i.a.createElement("div",null,"Error: ",j.message)),A&&(M=i.a.createElement("div",null,"Error: ",N.message)),R=i.a.createElement("span",null,I,M)}return i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{"data-kmdomain":a,"data-kmid":c,className:"d-inline-flex align-items-center kmap-tag-group"},p),i.a.createElement("span",{onMouseEnter:function(e){y(!1),f(!0)},onMouseLeave:function(){return f(!1)}},i.a.createElement("span",{ref:O,className:"popover-link"},i.a.createElement("span",{className:"icon u-icon__kmaps-popover"})),i.a.createElement(r.a,{target:O.current,placement:d,show:v},i.a.createElement(l.a,{id:"popover-contained",className:"related-resources-popover processed"},i.a.createElement(l.a.Title,{as:"h5",className:C?"bo":""},D," ",i.a.createElement("span",{className:"kmid"},c)),i.a.createElement(l.a.Content,null,R)))))};function x(e){if(e.kmapIsError||e.relIsError)return console.error(e.kmapIsError?e.kmapError:e.relError),i.a.createElement("span",{className:"red"},"Error occurred ....");var t=e.info,a=e.related,s=null===e||void 0===e?void 0:e.defs;a.sort((function(e,t){var a=e.groupValue,s=t.groupValue;return a<s?-1:a>s?1:0}));var n=e.domain,r=e.kid,l=t.caption_eng&&t.caption_eng.length>0?t.caption_eng[0].replace(/<\/?p>/g,"")+" ":"",c="/mandala-om/"+n+"/"+n+"-"+r,o="";t.feature_type_ids&&t.feature_type_ids.length>0&&(o=i.a.createElement("div",{className:"other featuretypes clearfix"},i.a.createElement("p",null,i.a.createElement("strong",null,"Feature Type"),t.feature_type_ids.map((function(e,a){var s="/mandala-om/subjects/subjects-"+e;return i.a.createElement(i.a.Fragment,null,i.a.createElement("a",{href:s,key:n+r+a},t.feature_types[a]))})))));var u="",p="terms"===t.tree&&t["ancestor_ids_tib.alpha"]?t["ancestor_ids_tib.alpha"]:t.ancestor_ids_generic,m="terms"===t.tree&&t["ancestors_tib.alpha"]?t["ancestors_tib.alpha"]:t.ancestors;if(p&&p.length>1){var h=t.tree[0].toUpperCase()+t.tree.substr(1);u=i.a.createElement("div",{className:"parents clearfix"},i.a.createElement("p",null,i.a.createElement("strong",null,h),"\xa0",p.map((function(e,a){if(a!==p.length-1){var s="/mandala-om/"+t.tree+"/"+t.tree+"-"+e,n=m[a],r="akey-"+e+"-"+a;return i.a.createElement("a",{key:r,href:s},n)}}))))}var v="";"terms"===t.tree&&t.associated_subject_ids&&(v=i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"other"},i.a.createElement("strong",null,"Wylie"),t.header),i.a.createElement("div",{className:"termtypes"},t.associated_subject_ids.map((function(e,a){var s="/mandala-om/subjects/subjects-"+e;return i.a.createElement("a",{href:s,key:s+a},t.associated_subjects[a])})))));var f=i.a.createElement(i.a.Fragment,null,a.map((function(e,t){var a=e.groupValue;if("picture"!==a&&"texts:pages"!==a){var s=c+"/related-"+a+"/deck",n="Related "+a[0].toUpperCase()+a.substr(1).replace("-v"," V").replace("-"," "),r="icon u-icon__"+a;return i.a.createElement("div",{className:"popover-footer-button",key:s},i.a.createElement("a",{href:s,className:r},n," (",e.doclist.numFound,")"))}}))),g="";return s&&(g=i.a.createElement("div",{className:"defs"},i.a.createElement("strong",null,"Definitions"),i.a.createElement("span",{className:"deflinks"},s.map((function(e){return i.a.createElement(d.c,{to:"/".concat(n,"/").concat(n,"-").concat(r,"?def=").concat(e),title:"Definition ".concat(e)},e)}))))),i.a.createElement("div",{className:"react-popover-body"},i.a.createElement("span",{className:"kmdomain"},n),i.a.createElement("span",{className:"kmid"},r),i.a.createElement("div",{className:"popover-body"},v,i.a.createElement("div",{className:"desc"},l,"For more information about this term, see Full Entry below."),g,o,u),i.a.createElement("div",{className:"popover-footer"},i.a.createElement("div",{className:"popover-footer-button"},i.a.createElement("a",{className:"icon u-icon__link-external",href:c},"Full Entry")),f))}},45:function(e,t,a){"use strict";a.d(t,"a",(function(){return L})),a.d(t,"b",(function(){return M})),a.d(t,"c",(function(){return F}));var s,n,i=a(33),r=a.n(i),l=a(52),c=a(18),o=a(82),d=a(31),u=a(9),p=a(71),m=a.n(p),h=a(72),v=a(389),f=a.n(v),g=a(19),_=a.n(g),b=a(121),y=a.n(b);function E(e){return f.a.createHash("sha1").update(e).digest("base64")}function k(e){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){y.a.getItem(E(JSON.stringify(e))).then((function(e){return e})).catch((function(e){return console.log("getCached failed.  Returning null: ",e),null}))}function T(e,t){y.a.setItem(E(JSON.stringify(e)),t).then((function(){})).catch((function(e){console.log("setCache failed.  Ignoring: ",e)}))}function j(e){var t,a,s,n,i,r,l,c,p,v,f,g,b,y,E,k,w,j,S,A,P,O,C,D,R,L,I,M,F,U,q,B,G,H,z,K,V,Y,W,Q,J,X,Z=e.page,$=e.query,ee=Z.start||0,te=Z.rows||100,ae=$.facetFilters,se={asset_count:{type:"terms",field:"asset_type",limit:(null===(t=ae.asset_type)||void 0===t?void 0:t.limit)||20,offset:(null===(a=ae.asset_type)||void 0===a?void 0:a.offset)||0,sort:(null===(s=ae.asset_type)||void 0===s?void 0:s.sort)||"count desc",domain:{excludeTags:"asset_type"}},related_subjects:{type:"terms",field:"kmapid_subjects_idfacet",limit:(null===(n=ae.subjects)||void 0===n?void 0:n.limit)||500,offset:(null===(i=ae.subjects)||void 0===i?void 0:i.offset)||0,sort:(null===(r=ae.subjects)||void 0===r?void 0:r.sort)||"count desc"},related_places:{type:"terms",field:"kmapid_places_idfacet",limit:(null===(l=ae.places)||void 0===l?void 0:l.limit)||500,offset:(null===(c=ae.places)||void 0===c?void 0:c.offset)||0,sort:(null===(p=ae.places)||void 0===p?void 0:p.sort)||"count desc"},related_terms:{type:"terms",field:"kmapid_terms_idfacet",limit:(null===(v=ae.terms)||void 0===v?void 0:v.limit)||500,offset:(null===(f=ae.terms)||void 0===f?void 0:f.offset)||0,sort:(null===(g=ae.terms)||void 0===g?void 0:g.sort)||"count desc"},feature_types:{type:"terms",field:"feature_types_idfacet",limit:(null===(b=ae.feature_types)||void 0===b?void 0:b.limit)||500,offset:(null===(y=ae.feature_types)||void 0===y?void 0:y.offset)||0,sort:(null===(E=ae.feature_types)||void 0===E?void 0:E.sort)||"count desc"},languages:{type:"terms",field:"node_lang",limit:(null===(k=ae.languages)||void 0===k?void 0:k.limit)||500,offset:(null===(w=ae.languages)||void 0===w?void 0:w.offset)||0,sort:(null===(j=ae.languages)||void 0===j?void 0:j.sort)||"count desc"},collections:{type:"terms",field:"collection_idfacet",limit:(null===(S=ae.collections)||void 0===S?void 0:S.limit)||500,offset:(null===(A=ae.collections)||void 0===A?void 0:A.offset)||0,sort:(null===(P=ae.collections)||void 0===P?void 0:P.sort)||"count desc"},collection_nid:{type:"terms",field:"collection_nid",limit:(null===(O=ae.collection_nid)||void 0===O?void 0:O.limit)||500,offset:(null===(C=ae.collection_nid)||void 0===C?void 0:C.offset)||0,sort:(null===(D=ae.collection_nid)||void 0===D?void 0:D.sort)||"count desc"},collection_uid:{type:"terms",field:"collection_uid_s",limit:(null===(R=ae.collection_uid)||void 0===R?void 0:R.limit)||500,offset:(null===(L=ae.collection_uid)||void 0===L?void 0:L.offset)||0,sort:(null===(I=ae.collection_uid)||void 0===I?void 0:I.sort)||"count desc"},asset_subtype:{type:"terms",field:"asset_subtype",facet:{parent_type:{limit:1,type:"terms",field:"asset_type"}},limit:(null===(M=ae.asset_subtype)||void 0===M?void 0:M.limit)||500,offset:(null===(F=ae.asset_subtype)||void 0===F?void 0:F.offset)||0,sort:(null===(U=ae.asset_subtype)||void 0===U?void 0:U.sort)||"count desc"},node_user:{type:"terms",field:"node_user_full_s",limit:(null===(q=ae.user)||void 0===q?void 0:q.limit)||500,offset:(null===(B=ae.user)||void 0===B?void 0:B.offset)||0,sort:(null===(G=ae.user)||void 0===G?void 0:G.sort)||"count desc"},creator:{type:"terms",field:"creator",limit:(null===(H=ae.creator)||void 0===H?void 0:H.limit)||500,offset:(null===(z=ae.creator)||void 0===z?void 0:z.offset)||0,sort:(null===(K=ae.creator)||void 0===K?void 0:K.sort)||"count desc"},perspective:{type:"terms",field:"perspectives_ss",limit:(null===(V=ae.perspective)||void 0===V?void 0:V.limit)||50,offset:(null===(Y=ae.perspective)||void 0===Y?void 0:Y.offset)||0,sort:(null===(W=ae.perspective)||void 0===W?void 0:W.sort)||"count desc"},associated_subjects:{type:"terms",field:"associated_subject_map_idfacet",limit:(null===(Q=ae.associated_subjects)||void 0===Q?void 0:Q.limit)||50,offset:(null===(J=ae.associated_subjects)||void 0===J?void 0:J.offset)||0,sort:(null===(X=ae.associated_subjects)||void 0===X?void 0:X.sort)||"count desc"}},ne={fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:ee,rows:te,"json.facet":JSON.stringify(se)},ie=function(e){var t=(i=e||"",i=(i=(i=(i=(i=(i=(i=(i=i.replace(/ /g,"\\ ")).replace("(","\\(")).replace(")","\\)")).replace(":","\\:")).replace("+","\\+")).replace("-","\\-")).replace('"','\\"')).replace("?","\\?")),a=t.length?t+"*":"*",s=t.length?"*"+t+"*":"*",n=t+"/";var i;e&&0!==t.length||(t=s=n="*");return{q:"( title:${xact}^100 title:${slashy}^100 title:${starts}^80 names_txt:${xact}^90 names_txt:${starts}^70)",xact:t,starts:a,search:s,slashy:n}}(e.query.searchText),re=function(e){var t=(n=e,i="field",n||(n=[]),n.reduce((function(e,t){var a=t[i]||"unknown key";return e[a]||(e[a]=[]),e[a].push(t),e}),{})),a=Object.keys(t),s=[];var n,i;function r(e,t){var a=[],s=[],n=[],i=[];e.forEach((function(e){"NOT"===e.operator?s.push(e.match):"AND"===e.operator?n.push(e.match):i.push('"'+e.match+'"')}));var r="{!tag="+t+"}"+t+":("+i.join(" ")+")";return i.length&&a.push(r),n.length&&a.push.apply(a,n),s.length&&a.push.apply(a,s),a}return a.forEach((function(e){var a=t[e],n=[];switch(e){case"asset_type":n=r(a,"asset_type"),s.push.apply(s,Object(o.a)(n));break;case"subjects":case"places":case"terms":n=r(a,"kmapid"),s.push.apply(s,Object(o.a)(n));break;case"languages":n=r(a,"language"),s.push.apply(s,Object(o.a)(n));break;case"feature_types":n=r(a,"kmapid"),s.push.apply(s,Object(o.a)(n));break;case"users":n=r(a,"node_user_full_s"),s.push.apply(s,Object(o.a)(n));break;case"creator":n=r(a,"creator"),s.push.apply(s,Object(o.a)(n));break;case"collections":n=r(a,"collection_uid_s"),s.push.apply(s,Object(o.a)(n));break;case"perspective":n=r(a,"perspectives_ss"),s.push.apply(s,Object(o.a)(n));break;case"associated_subjects":n=r(a,"associated_subject_map_idfacet"),s.push.apply(s,Object(o.a)(n));break;default:console.error("UNHANDLED FACET TYPE: "+e)}})),{fq:s}}(e.query.filters);ne=Object(d.a)(Object(d.a)(Object(d.a)({},ne),ie),re);var le={adapter:h.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:ne},ce=new Promise((function(e,t){x(le);m.a.request(le).then((function(t){if(t.data.response,t.data.response){var a={numFound:t.data.response.numFound,docs:_.a.map(t.data.response.docs,(function(e){return N(e)})),facets:t.data.facets};T(le,a),e(a)}})).catch((function(e){console.log("getAssetSearchPromise(): OUCH axios call failed!",e),t(e)})).finally((function(){}))}));return new Promise((function(e,t){ce.then((function(t){e(function(e,t){return Object.entries(t).forEach((function(t){var a=Object(u.a)(t,2),s=a[0],n=a[1].search,i="";if(i="subjects"===s?"related_subjects":"places"===s?"related_places":"terms"===s?"related_terms":"users"===s?"node_user":s,e.facets&&e.facets[i]){var r=e.facets[i].buckets,l=_.a.filter(r,(function(e){return e.val.split("|")[0].toLowerCase().includes(n)}));e.facets[i].buckets=l}})),e}(t,$.facetFilters))})).catch((function(e){console.log("Promise rejected: ",e),t(e)}))}))}function S(e){var t={adapter:h.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:{fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:0,rows:1,q:"uid:${kmapid}",kmapid:e}};return new Promise((function(e,a){var s=x(t);s?e(s):m.a.request(t).then((function(a){var s=a.data.response.docs[0];T(t,s),e(s)})).catch((function(e){a(e)}))}))}function A(e){var t={adapter:h.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev/select",params:{fl:"*,[child parentFilter=block_type:parent limit=1000]",wt:"json",echoParams:"explicit",indent:"true",start:0,rows:1,q:"uid:${kmapid}",kmapid:e}};return new Promise((function(e,a){var s=x(t);s?e(s):m.a.request(t).then((function(a){var s=a.data.response.docs[0];T(t,s),e(s)})).catch((function(e){a(e)}))}))}function P(e,t,a,s){var n="undefined"===typeof t||null===t||"all"===t?["audio-video","images","texts","visuals","sources","subjects","places","terms"]:[t],i={fl:"*",wt:"json",echoParams:"explicit",indent:"true",start:"undefined"===typeof a?0:a,rows:"undefined"===typeof s?100:s,"json.facet":JSON.stringify({asset_counts:{limit:20,type:"terms",field:"asset_type",domain:{excludeTags:"ast"}}}),q:"(uid:${kmapid}^100+kmapid:${kmapid})",kmapid:e,fq:"{!tag=ast}asset_type:( "+n.join(" ")+")"},r={adapter:h.a,callbackParamName:"json.wrf",url:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev/select",params:i};return new Promise((function(n,i){m.a.request(r).then((function(i){var l=function(n){var i=n.data.facets.asset_counts.buckets,r={all:{count:0,docs:n.data.response.docs}};return i.forEach((function(e){r[e.val]={count:e.count,docs:[]},r.all.count+=e.count})),n.data.response.docs.forEach((function(e){var t=N(e);r[e.asset_type].docs.push(t)})),{uid:e,start:a,rows:s,type:t,stateKey:[e,t,a,s].join("/"),assets:r}}(i);T(r,l),n(l)})).catch((function(e){console.log("getRelatedAssetsPromise(): OUCH axios call failed!",e),i(e)}))}))}function N(e){var t,a,s=e.asset_type,n="standalone"===Object({NODE_ENV:"production",PUBLIC_URL:"/mandala-om",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_SOLR_KMASSETS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmassets_dev",REACT_APP_SOLR_KMTERMS:"https://ss251856-us-east-1-aws.measuredsearch.com/solr/kmterms_dev",REACT_APP_DRUPAL_HOME:"https://mandala-dev.shanti.virginia.edu",REACT_APP_DRUPAL_AUDIO_VIDEO:"https://audio-video-dev.shanti.virginia.edu",REACT_APP_DRUPAL_IMAGES:"https://images-dev.shanti.virginia.edu",REACT_APP_DRUPAL_SOURCES:"https://sources-dev.shanti.virginia.edu",REACT_APP_DRUPAL_PLACES:"https://mandala-dev.shanti.virginia.edu/places",REACT_APP_DRUPAL_SUBJECTS:"https://mandala-dev.shanti.virginia.edu/subjects",REACT_APP_DRUPAL_TERMS:"https://mandala-dev.shanti.virginia.edu/terms",REACT_APP_DRUPAL_TEXTS:"https://texts-dev.shanti.virginia.edu",REACT_APP_DRUPAL_VISUALS:"https://visuals-dev.shanti.virginia.edu",REACT_APP_MANDALA_KB:"https://confluence.its.virginia.edu/display/KB/Mandala+Suite+of+Tools",REACT_APP_PUBLIC_URL:"https://shanti-uva.github.io/mandala-om",REACT_APP_STANDALONE_PATH:"/mandala",REACT_APP_GOOGLE_MAPS_API_KEY:"AIzaSyAXpnXkPS39-Bo5ovHQWvyIk6eMgcvc1q4",REACT_APP_GOSERVER_URL:"https://dev-places.kmaps.virginia.edu/geoserver/"}).REACT_APP_STANDALONE?"/wp-content/uploads/gradient.jpg":"/mandala-om/img/gradient.jpg";switch(s){case"texts":case"sources":case"subjects":case"places":case"terms":case"collections":e.url_large=n,e.url_thumb=n,e.url_thumb_height=100,e.url_thumb_width=150;break;case"images":e.url_large=(t=e.url_thumb,a=1200,t.toString().replace("200,200",a+","+a))}return e}!function(e){e.Places="places",e.Subjects="subjects",e.Terms="terms",e.AudioVideo="audio-video",e.Images="images",e.Visuals="visuals",e.Sources="sources"}(s||(s={})),function(e){e.Not="NOT",e.And="AND",e.Or="OR"}(n||(n={}));var O,C,D={loadingState:!1,results:{numFound:0,docs:[],facets:[]},query:{searchText:"",filters:[],facetFilters:{}},page:{current:0,start:0,rows:100,maxStart:0},gotoPage:Object(c.b)((function(e,t){t*e.page.rows>e.page.maxStart?t=Math.floor(e.page.maxStart/e.page.rows):t<0&&(t=0),e.page.start=e.page.rows*t,e.page.current=t})),nextPage:Object(c.b)((function(e,t){t|=1;e.page.current;var a=e.page.start+t*e.page.rows;a>e.page.maxStart&&(a=e.page.rows*Math.floor(e.page.maxStart/e.page.rows)),e.page.start=a,e.page.current=Math.floor(a/e.page.rows)})),prevPage:Object(c.b)((function(e,t){t|=1;var a=e.page.start-t*e.page.rows;a<0&&(a=0),e.page.start=a,e.page.current=Math.floor((a+1)/e.page.rows)})),lastPage:Object(c.b)((function(e){e.page.start=e.page.rows*Math.floor(e.page.maxStart/e.page.rows),e.page.current=Math.floor(e.page.maxStart/e.page.rows)})),firstPage:Object(c.b)((function(e){e.page.start=0,e.page.current=0})),setPageSize:Object(c.b)((function(e,t){t<1&&(t=1),e.page.rows=t})),narrowFilters:Object(c.b)((function(e,t){e.query.facetFilters[t.filter]={search:t.search,limit:t.limit,offset:t.offset,sort:t.sort}})),update:Object(c.g)(function(){var e=Object(l.a)(r.a.mark((function e(t,a,s){var n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.getStoreState().search,_.a.isEmpty(n.query.searchText)){e.next=14;break}return n.loadingState=!0,performance.mark("SearchModelSearchUpdateThunkStart"),e.next=6,k(n);case 6:i=e.sent,console.log("SearchStateResults",i),performance.mark("SearchModelSearchUpdateThunkEnd"),performance.measure("SearchModelSearchUpdate","SearchModelSearchUpdateThunkStart","SearchModelSearchUpdateThunkEnd"),performance.getEntriesByName("SearchModelSearchUpdate").forEach((function(e){})),performance.clearMeasures(),t.receiveResults(i);case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}()),receiveResults:Object(c.b)((function(e,t){e.page.maxStart!==t.numFound&&(e.page.maxStart=t.numFound),e.results!==t&&(e.results=t),e.loadingState=!1})),setSearchText:Object(c.b)((function(e,t){e.query.searchText=t,e.page.current=0,e.page.start=0})),addFilters:Object(c.b)((function(e,t){for(var a=function(a){var s=t[a],n=e.query.filters.findIndex((function(e){return e.id===s.id}));n>=0&&e.query.filters.splice(n,1),e.query.filters.push(t[a]),e.page.current=0,e.page.start=0},s=0;s<t.length;s++)a(s)})),removeFilters:Object(c.b)((function(e,t){for(var a=function(a){var s=t[a],n=e.query.filters.findIndex((function(e){return console.log("checking "+e.id+" against ",s.id),e.id===s.id}));n>=0?(e.query.filters.splice(n,1),e.page.current=0,e.page.start=0):(console.log("SearchFilter.removeFilters(): Couldn't find filter by that id: ",s.id,"  -- Ignoring."),console.log("   Requested = ",s),console.log("   Filters = ",JSON.parse(JSON.stringify(e.query.filters))))},s=0;s<t.length;s++)a(s)})),clearFilters:Object(c.b)((function(e,t){t?console.error("HEY: clearing by specific filter not implemented yet!  type = ",t):(e.query.filters=[],e.query.facetFilters={}),e.page.current=0,e.page.start=0})),clearAll:Object(c.b)((function(e){e.query.filters=[],e.query.facetFilters={},e.query.searchText="",e.page.current=0,e.page.start=0})),superClear:Object(c.b)((function(e){e.query.filters=[],e.query.facetFilters={},e.query.searchText="",e.page.current=0,e.page.start=0,y.a.clear().then((function(){console.log("localForage cleared!")})).catch((function(e){console.error("localForage error on clear(): ",e)}))})),setSearchState:Object(c.b)((function(e,t){e.query.searchText=t.searchString,e.query.filters=t.filters})),onUpdate:Object(c.h)((function(e,t){return[e.setPageSize,e.nextPage,e.prevPage,e.gotoPage,e.lastPage,e.firstPage,e.removeFilters,e.clearFilters,e.clearAll,e.addFilters,e.setSearchText,e.narrowFilters,e.superClear,e.setSearchState]}),function(){var e=Object(l.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.update();case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())},R={loading:!1,stateKey:Object(c.c)((function(e){var t,a,s,n;return(null===(t=e.kmap)||void 0===t?void 0:t.uid)+"/"+(null===(a=e.relatedsPage)||void 0===a?void 0:a.related_type)+"/"+(null===(s=e.relatedsPage)||void 0===s?void 0:s.page)+"/"+(null===(n=e.relatedsPage)||void 0===n?void 0:n.pageSize)})),uid:"",kmap:{uid:""},asset:{uid:""},relateds:[],relatedsPage:{related_type:null,page:0,pageSize:100},gotoRelatedsPage:Object(c.b)((function(e,t){e.relatedsPage.page=t})),firstRelatedsPage:Object(c.b)((function(e){e.relatedsPage.page=0})),lastRelatedsPage:Object(c.b)((function(e){throw new Error("need maxpage!")})),nextRelatedsPage:Object(c.b)((function(e){e.relatedsPage.page++})),prevRelatedsPage:Object(c.b)((function(e){e.relatedsPage.page--})),setRelatedsPage:Object(c.b)((function(e,t){e.relatedsPage=t})),setRelatedsPageSize:Object(c.b)((function(e,t){e.relatedsPage.pageSize=t})),receiveKmap:Object(c.b)((function(e,t){})),setUid:Object(c.b)((function(e,t){e.uid=t})),onUpdate:Object(c.h)((function(e,t){return[e.gotoRelatedsPage,e.nextRelatedsPage,e.prevRelatedsPage,e.firstRelatedsPage,e.lastRelatedsPage,e.setRelatedsPage,e.setUid]}),function(){var e=Object(l.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.update();case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),update:Object(c.g)(function(){var e=Object(l.a)(r.a.mark((function e(t,a,s){var n,i,l,c,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=s.getStoreState().kmap).loading=!0,i=n.relatedsPage.related_type,l=Number(n.relatedsPage.page*n.relatedsPage.pageSize)||0,c=n.relatedsPage.pageSize||100,o=[S(n.uid),A(n.uid),P(n.uid,i,l,c)],Promise.allSettled(o).then((function(e){var a=Object(u.a)(e,3),s=a[0],i=a[1],r=a[2];"fulfilled"===i.status&&(n.kmap=i.value),"fulfilled"===s.status&&(n.asset=s.value),"fulfilled"===r.status&&(n.relateds=r.value),t.receiveKmap(n)})).catch((function(e){throw console.error("oh dear! ",e),e})),n.loading=!1;case 8:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}())};!function(e){e.FeatureTypes="feature_types",e.RelatedPlaces="related_places"}(O||(O={})),function(e){e.Child="child"}(C||(C={}));var L={kmap:R,search:D,status:{type:null,headerTitle:"Mandala",subTitle:null,path:[],id:null,clear:Object(c.b)((function(e){e.id=null,e.type=null,e.subTitle=null,e.headerTitle=null,e.path=[],e.id=null})),setId:Object(c.b)((function(e,t){document.title=e.headerTitle+" ("+t+")",e.id=t})),setPath:Object(c.b)((function(e,t){e.path=t})),setSubTitle:Object(c.b)((function(e,t){e.subTitle=t})),setHeaderTitle:Object(c.b)((function(e,t){document.title=t+(e.id?" ("+e.id+")":""),e.headerTitle=t})),setType:Object(c.b)((function(e,t){var a;e.type=t;var s=null===(a=document)||void 0===a?void 0:a.getElementById("l-site__wrap");if("undefined"!==typeof s){var n=["audio-video","collections","images","places","sources","subjects","terms","texts"];for(var i in n)null===s||void 0===s||s.classList.remove(n[i]);null===s||void 0===s||s.classList.add(t)}})),setStatus:Object(c.b)((function(e,t){Object(d.a)({},t)}))},history:a(342).b},I=Object(c.e)(),M=I.useStoreActions,F=I.useStoreState;I.useStoreDispatch,I.useStore},451:function(e,t){},453:function(e,t){},46:function(e,t,a){"use strict";a.d(t,"b",(function(){return p})),a.d(t,"a",(function(){return m})),a.d(t,"d",(function(){return h})),a.d(t,"e",(function(){return v})),a.d(t,"c",(function(){return f}));var s=a(9),n=a(19),i=a.n(n),r=a(2),l=a.n(r),c=a(586),o=a(363),d=a(0),u=a.n(d);function p(e,t,a){a=a||t+"_path_s";var s={};return e=i.a.filter(e,(function(e){return e.block_child_type===t})),i.a.forEach(e,(function(e,t){var n=e[a].split("/");if(e.order=t,1===n.length)s[n[0]]=e;else for(var i=s,r=0;r<n.length;r++)i[n[r]]||(i[n[r]]={}),r===n.length-1&&(i[n[r]]=e),i[n[r]]._nested_||(i[n[r]]._nested_={}),i=i[n[r]]._nested_})),s}function m(e){var t="h1, h2, h3, h4, h5, h6, h7, div, p, blockquote, li, span, label, th, td, a, b, strong, i, em, u, s, dd, dl, dt, figure",a=/[a-zA-Z0-9\,\.\:\;\-\s]/g;("undefined"===typeof e||"all"===e?l()(t):l()(e).find(t)).each((function(){var e=l()(this).clone().children().remove().end().text(),t=(e=e.replace(a,"")).charCodeAt(0);t>3839&&t<4096&&(l()(this).hasClass("bo")||l()(this).parents().hasClass("bo")||l()(this).addClass("bo"))}))}function h(e){var t=e.match(/(\d+)$/);return Object(s.a)(t,1)[0]}function v(e){var t="".concat(e,"-").concat(Math.ceil(1e4*Math.random()));return{"audio-video":u.a.createElement("span",{className:"facetItem icon u-icon__audio-video",key:"av-".concat(t)}),texts:u.a.createElement("span",{className:"facetItem icon u-icon__texts",key:"texts-".concat(t)}),"texts:pages":u.a.createElement("span",{className:"facetItem icon u-icon__texts",key:"texts-pages-".concat(t)}),images:u.a.createElement("span",{className:"facetItem icon u-icon__images",key:"images-".concat(t)}),sources:u.a.createElement("span",{className:"facetItem icon u-icon__sources",key:"sources-".concat(t)}),visuals:u.a.createElement("span",{className:"facetItem icon u-icon__visuals",key:"visuals-".concat(t)}),places:u.a.createElement("span",{className:"facetItem icon u-icon__places",key:"places-".concat(t)}),subjects:u.a.createElement("span",{className:"facetItem icon u-icon__subjects",key:"subjects-".concat(t)}),terms:u.a.createElement("span",{className:"facetItem icon u-icon__terms",key:"terms-".concat(t)}),collections:u.a.createElement("span",{className:"facetItem",key:"facetitem-".concat(t)},u.a.createElement(c.a,null)),asset_type:u.a.createElement("span",{className:"facetItem",key:"facetitem2-".concat(t)},u.a.createElement(o.b,null)),users:u.a.createElement("span",{className:"facetItem icon u-icon__community",key:"community-".concat(t)}),creator:u.a.createElement("span",{className:"facetItem icon u-icon__agents",key:"agents-".concat(t)}),languages:u.a.createElement("span",{className:"facetItem icon u-icon__comments-o",key:"comments-".concat(t)}),feature_types:u.a.createElement("span",{className:"facetItem",key:"feattypes-".concat(t)},u.a.createElement(o.c,null)),associated_subjects:u.a.createElement("span",{className:"facetItem icon u-icon__essays",key:"essays-".concat(t)}),perspective:u.a.createElement("span",{className:"facetItem icon u-icon__file-picture",key:"picture-".concat(t)}),search:u.a.createElement("span",{className:"facetItem icon u-icon__search",key:"search-".concat(t)})}[e]}function f(e){var t,a=e.asset_type,s=[{uid:"/"+a,name:(t=a,t[0].toUpperCase()+t.substr(1).replace("-v","-V"))}];if(e.collection_title_path_ss&&e.collection_title_path_ss.length>0){for(var n=0;n<e.collection_title_path_ss.length;n++){var i=e.collection_title_path_ss[n],r=e.collection_nid_path_is[n],l="/".concat(a,"/collection/").concat(r);s.push({uid:l,name:i})}var c={uid:"#",name:e.title&&e.title.length>0?e.title[0]:e.caption};s.push(c)}return s}},463:function(e,t){},465:function(e,t){},492:function(e,t){},494:function(e,t){},495:function(e,t){},501:function(e,t){},503:function(e,t){},521:function(e,t){},523:function(e,t){},535:function(e,t){},538:function(e,t){},541:function(e,t,a){},543:function(e,t,a){},544:function(e,t,a){},545:function(e,t,a){},549:function(e,t,a){},550:function(e,t,a){},551:function(e,t,a){},572:function(e,t){},589:function(e,t,a){},591:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=591},592:function(e,t,a){},593:function(e,t,a){},594:function(e,t,a){},595:function(e,t,a){},600:function(e,t,a){},632:function(e,t){},651:function(e,t,a){},652:function(e,t,a){},654:function(e,t,a){},655:function(e,t,a){},656:function(e,t,a){},657:function(e,t,a){},658:function(e,t,a){},659:function(e,t,a){},660:function(e,t,a){},661:function(e,t,a){},662:function(e,t,a){},663:function(e,t,a){},664:function(e,t,a){},665:function(e,t,a){},666:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),i=a(55),r=a.n(i),l=(a(424),a(383));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(45),o=a(121),d=a.n(o),u=a(18),p=Object(u.d)(Object(u.f)(c.a,{storage:d.a})),m=document.getElementById("root");m&&r.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(u.a,{store:p},n.a.createElement(l.b,null))),m),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},72:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(120),n=a.n(s);function i(e){return n.a.stringify(e,{arrayFormat:"repeat"})}function r(e){return new Promise((function(t,a){var s=document.createElement("script"),n=e.url;if(e.params){var r=i(e.params);r&&(n+=(n.indexOf("?")>=0?"&":"?")+r)}function l(){s&&(s.onload=s.onreadystatechange=s.onerror=null,s.parentNode&&s.parentNode.removeChild(s),s=null)}s.async=!0;var c="axiosJsonpCallback_"+(Math.floor(Math.random()*Math.pow(10,12))+1),o=window[c],d=!1;window[c]=function(e){(window[c]=o,d)||t({data:e,status:200})};var u={_:(new Date).getTime()};u[e.callbackParamName||"callback"]=c,n+=(n.indexOf("?")>=0?"&":"?")+i(u),s.onload=s.onreadystatechange=function(){s.readyState&&!/loaded|complete/.test(s.readyState)||l()},s.onerror=function(){l(),a(new Error("Network Error"))},e.cancelToken&&e.cancelToken.promise.then((function(e){s&&(d=!0,a(e))})),s.src=n,document.head.appendChild(s)}))}}},[[419,1,2]]]);
//# sourceMappingURL=main.efd656ca.chunk.js.map